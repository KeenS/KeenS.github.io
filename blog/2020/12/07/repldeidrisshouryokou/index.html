<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="REPLでIdris小旅行 | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="このエントリはIdris Advent Calendar 2020の8日目の記事です。
κeenです。昨日の予告通り今回は手を動かすパートとしてIdrisのREPLを紹介することにします。" />
        <meta property="og:title" content="REPLでIdris小旅行 | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://KeenS.github.io/blog/2020/12/07/repldeidrisshouryokou/" />
        <meta property="og:description" content="このエントリはIdris Advent Calendar 2020の8日目の記事です。
κeenです。昨日の予告通り今回は手を動かすパートとしてIdrisのREPLを紹介することにします。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/REPLdeIdrisshouryokou.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/REPLdeIdrisshouryokou.png" />
        
        <meta property="og:article:published_time" content="2020-12-07 22:24:20 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2020-12-07 22:24:20 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>REPLでIdris小旅行 | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="https://KeenS.github.io/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://KeenS.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="https://KeenS.github.io/manifest.json">
        <link rel="mask-icon" href="https://KeenS.github.io/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="https://KeenS.github.io/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://KeenS.github.io/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="https://KeenS.github.io/about/"> About </a></li>
                        
                            <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                        
                            <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                        
                            <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                        
                            <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="https://KeenS.github.io/about/"> About </a></li>
                    
                        <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                    
                        <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                    
                        <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                    
                        <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">REPLでIdris小旅行</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2020-12-07</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="https://KeenS.github.io/categories/idris">Idris</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/idris-advent-calendar">Idris Advent Calendar</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/advent-calendar-2020">Advent Calendar 2020</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/advent-calendar">Advent Calendar</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>このエントリは<a href="https://qiita.com/advent-calendar/2020/idris">Idris Advent Calendar 2020</a>の8日目の記事です。</p>
<p>κeenです。昨日の予告通り今回は手を動かすパートとしてIdrisのREPLを紹介することにします。</p>
<p><code>idris</code> を引数なしで起動するとインタラクティブシェルに入ります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ idris
</span></span><span class="line"><span class="cl">     ____    __     _
</span></span><span class="line"><span class="cl">    /  _/___/ /____(_)
</span></span><span class="line"><span class="cl">    / // __  / ___/ / ___/     Version 1.3.3
</span></span><span class="line"><span class="cl">  _/ // /_/ / /  / (__  )      https://www.idris-lang.org/
</span></span><span class="line"><span class="cl"> /___/\__,_/_/  /_/____/       Type :? for help
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Idris is free software with ABSOLUTELY NO WARRANTY.
</span></span><span class="line"><span class="cl">For details type :warranty.
</span></span><span class="line"><span class="cl">Idris&gt; 
</span></span></code></pre></div><p>ここに式を入力するとその評価結果を表示してくれます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; 1 + 1
</span></span><span class="line"><span class="cl">2 : Integer
</span></span><span class="line"><span class="cl">Idris&gt; 
</span></span></code></pre></div><p>これは入力の読み取り（Read）、評価（Eval）、表示（Print）を繰り返して（Loop）くれるのでREPLと呼ばれます。</p>
<p>言語の初学者にはいちいちファイルを書いてコンパイルして実行しなくても挙動を確認できるので便利ですね。
さらにIdrisはかなりREPLを作り込んでるので玄人にも重要な機能です。</p>
<p>それではこれを使っていきましょう。</p>
<h1 id="式の評価">式の評価</h1>
<p>上にも書いたとおり、式を入力するとそれを計算して表示してくれます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; [1..10]
</span></span><span class="line"><span class="cl">[1, 2, 3, 4, 5, 6, 7, 8, 9, 10] : List Integer
</span></span><span class="line"><span class="cl">Idris&gt; [ i | i &lt;- [1..10], i `mod ` 2 == 0]
</span></span><span class="line"><span class="cl">[2, 4, 6, 8, 10] : List Integer
</span></span></code></pre></div><p>Idrisでは型も値として扱えることを思い出すと、型名を入力するとそれも評価して表示してくれることが分かります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; List
</span></span><span class="line"><span class="cl">List : Type -&gt; Type
</span></span><span class="line"><span class="cl">Idris&gt; Integer
</span></span><span class="line"><span class="cl">Integer : Type
</span></span><span class="line"><span class="cl">Idris&gt; List
</span></span><span class="line"><span class="cl">List : Type -&gt; Type
</span></span><span class="line"><span class="cl">idris&gt; List Integer
</span></span><span class="line"><span class="cl">List Integer : Type
</span></span></code></pre></div><p>とはいえ型は実体がないので特に計算とかは走りません。</p>
<p>一応計算を含む型であればそれを計算した結果が表示されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; if True then Integer else String
</span></span><span class="line"><span class="cl">Integer : Type
</span></span></code></pre></div><p>ところで「型の型」である <code>Type</code> の型、 「型の型の型」が気になりませんか？
これを打ち込むとこう表示されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; Type
</span></span><span class="line"><span class="cl">Type : Type
</span></span></code></pre></div><p><code>Type</code> 自身が <code>Type</code> のインスタンスになってますね。
これではかの有名な<a href="https://ja.wikipedia.org/wiki/%E3%83%A9%E3%83%83%E3%82%BB%E3%83%AB%E3%81%AE%E3%83%91%E3%83%A9%E3%83%89%E3%83%83%E3%82%AF%E3%82%B9">ラッセルのパラドックス</a>になってしまいます。
しかし（私も自信はないですが）恐らくこれは表示を省略しているだけでそういう矛盾はIdrisには含まれていません。</p>
<h1 id="replコマンド">REPLコマンド</h1>
<p>さて、ここからが本番です。
IdrisのREPLには豊富なコマンドがあります。
その全貌はREPLに <code>:?</code> または <code>:help</code> と打つと表示されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :?
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Idris version 1.3.3
</span></span><span class="line"><span class="cl">-------------------
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   Command         Arguments   Purpose
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   &lt;expr&gt;                      Evaluate an expression
</span></span><span class="line"><span class="cl">   :t :type        &lt;expr&gt;      Check the type of an expression
</span></span><span class="line"><span class="cl">   :core           &lt;expr&gt;      View the core language representation of a term
</span></span><span class="line"><span class="cl">   :miss :missing  &lt;name&gt;      Show missing clauses
</span></span><span class="line"><span class="cl">   :doc            &lt;name&gt;      Show internal documentation
</span></span><span class="line"><span class="cl">   :mkdoc          &lt;namespace&gt; Generate IdrisDoc for namespace(s) and dependencies
</span></span><span class="line"><span class="cl">   :apropos        [&lt;package list&gt;] &lt;name&gt; Search names, types, and documentation
</span></span><span class="line"><span class="cl">   :s :search      [&lt;package list&gt;] &lt;expr&gt; Search for values by type
</span></span><span class="line"><span class="cl">   :wc :whocalls   &lt;name&gt;      List the callers of some name
</span></span><span class="line"><span class="cl">   :cw :callswho   &lt;name&gt;      List the callees of some name
</span></span><span class="line"><span class="cl">   :browse         &lt;namespace&gt; List the contents of some namespace
</span></span><span class="line"><span class="cl">   :total          &lt;name&gt;      Check the totality of a name
</span></span><span class="line"><span class="cl">   :r :reload                  Reload current file
</span></span><span class="line"><span class="cl">   :w :watch                   Watch the current file for changes
</span></span><span class="line"><span class="cl">   :l :load        &lt;filename&gt;  Load a new file
</span></span><span class="line"><span class="cl">   :!              &lt;command&gt;   Run a shell command
</span></span><span class="line"><span class="cl">   :cd             &lt;filename&gt;  Change working directory
</span></span><span class="line"><span class="cl">   :module         &lt;module&gt;    Import an extra module
</span></span><span class="line"><span class="cl">   :e :edit                    Edit current file using $EDITOR or $VISUAL
</span></span><span class="line"><span class="cl">   :m :metavars                Show remaining proof obligations (metavariables or holes)
</span></span><span class="line"><span class="cl">   :p :prove       &lt;hole&gt;      Prove a metavariable
</span></span><span class="line"><span class="cl">   :elab           &lt;hole&gt;      Build a metavariable using the elaboration shell
</span></span><span class="line"><span class="cl">   :a :addproof    &lt;name&gt;      Add proof to source file
</span></span><span class="line"><span class="cl">   :rmproof        &lt;name&gt;      Remove proof from proof stack
</span></span><span class="line"><span class="cl">   :showproof      &lt;name&gt;      Show proof
</span></span><span class="line"><span class="cl">   :proofs                     Show available proofs
</span></span><span class="line"><span class="cl">   :x              &lt;expr&gt;      Execute IO actions resulting from an expression using the interpreter
</span></span><span class="line"><span class="cl">   :c :compile     &lt;filename&gt;  Compile to an executable [codegen] &lt;filename&gt;
</span></span><span class="line"><span class="cl">   :exec :execute  [&lt;expr&gt;]    Compile to an executable and run
</span></span><span class="line"><span class="cl">   :dynamic        &lt;filename&gt;  Dynamically load a C library (similar to %dynamic)
</span></span><span class="line"><span class="cl">   :dynamic                    List dynamically loaded C libraries
</span></span><span class="line"><span class="cl">   :? :h :help                 Display this help text
</span></span><span class="line"><span class="cl">   :set            &lt;option&gt;    Set an option (errorcontext, showimplicits, originalerrors, autosolve, nobanner, warnreach, evaltypes, desugarnats)
</span></span><span class="line"><span class="cl">   :unset          &lt;option&gt;    Unset an option
</span></span><span class="line"><span class="cl">   :color :colour  &lt;option&gt;    Turn REPL colours on or off; set a specific colour
</span></span><span class="line"><span class="cl">   :consolewidth   auto|infinite|&lt;number&gt;Set the width of the console
</span></span><span class="line"><span class="cl">   :printerdepth   [&lt;number&gt;]  Set the maximum pretty-printer depth (no arg for infinite)
</span></span><span class="line"><span class="cl">   :q :quit                    Exit the Idris system
</span></span><span class="line"><span class="cl">   :version                    Display the Idris version
</span></span><span class="line"><span class="cl">   :warranty                   Displays warranty information
</span></span><span class="line"><span class="cl">   :let            (&lt;top-level declaration&gt;)...Evaluate a declaration, such as a function definition, instance implementation, or fixity declaration
</span></span><span class="line"><span class="cl">   :unlet :undefine(&lt;name&gt;)... Remove the listed repl definitions, or all repl definitions if no names given
</span></span><span class="line"><span class="cl">   :printdef       &lt;name&gt;      Show the definition of a function
</span></span><span class="line"><span class="cl">   :pp :pprint     &lt;option&gt; &lt;number&gt; &lt;name&gt;Pretty prints an Idris function in either LaTeX or HTML and for a specified width.
</span></span><span class="line"><span class="cl">   :verbosity      &lt;number&gt;    Set verbosity level
</span></span></code></pre></div><p>まだ紹介してない機能向けのコマンドなどもあるのでこれを見ただけだと混乱するかもしれません。
ゆっくり1つずつ試していきましょう。</p>
<h1 id="関数を定義する">関数を定義する</h1>
<p>REPLに打ち込んで評価できるのは式までで、 <code>foo = 1</code> のような変数定義は扱えません。
その代わり <code>:let</code> コマンドで定義できます。
試してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :let foo : Integer
</span></span><span class="line"><span class="cl">Idris&gt; foo
</span></span><span class="line"><span class="cl">foo : Integer
</span></span><span class="line"><span class="cl">Idris&gt; :let foo = 1
</span></span><span class="line"><span class="cl">Idris&gt; foo
</span></span><span class="line"><span class="cl">1 : Integer
</span></span></code></pre></div><p>定義できていますね。</p>
<p>関数も定義できますが、少し癖があるようです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :let add : Integer -&gt; Integer -&gt; Integer
</span></span><span class="line"><span class="cl">Idris&gt; :let add x y = x + y
</span></span><span class="line"><span class="cl">When checking an application of function Prelude.Interfaces.+:
</span></span><span class="line"><span class="cl">        No such variable x
</span></span><span class="line"><span class="cl">Idris&gt; :let add = \x, y =&gt; x + y
</span></span><span class="line"><span class="cl">Idris&gt; :t add
</span></span><span class="line"><span class="cl">add : Integer -&gt; Integer -&gt; Integer
</span></span></code></pre></div><p>関数は後述するファイルを読み込む方法を使った方がよさそうです。</p>
<p>定義した関数は <code>:unlet</code> （<code>:undefine</code>）で未定義に戻すことができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :undefine
</span></span><span class="line"><span class="cl">Undefined foo,foo,add,add.
</span></span></code></pre></div><h1 id="型の表示">型の表示</h1>
<p><code>:t</code> あるいは <code>:type</code> コマンドで式の型を表示できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :t 1
</span></span><span class="line"><span class="cl">1 : Integer
</span></span><span class="line"><span class="cl">Idris&gt; :t Integer
</span></span><span class="line"><span class="cl">Integer : Type
</span></span><span class="line"><span class="cl">Idris&gt; :t putStrLn
</span></span><span class="line"><span class="cl">putStrLn : String -&gt; IO ()
</span></span></code></pre></div><p>式の評価とあまり変わらなそうな気がしますが、評価に時間のかかる式で型情報だけほしい場合に便利です。</p>
<p>ここで例の <code>Type</code> の型を見てみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :t Type
</span></span><span class="line"><span class="cl">Type : Type 1
</span></span></code></pre></div><p><code>Type 1</code> と表示されました。
じゃあその型は…となると察しのとおり <code>Type 2</code> になるはずですが、今のところユーザが手で書く手段がないので実験的に確かめることはできません。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :t (Type 1)
</span></span><span class="line"><span class="cl">builtin:Type mismatch between
</span></span><span class="line"><span class="cl">        Type (Type of Type)
</span></span><span class="line"><span class="cl">and
</span></span><span class="line"><span class="cl">        _ -&gt; _ (Is Type applied to too many arguments?)
</span></span></code></pre></div><p>詳しくは省きますがIdrisの型システムはラッセルのパラドックスが起きなように設計されていて、型の型、型の型の型、型の型の型の型…はそれぞれ異なるようになっています。その階層を表わすのが <code>Type 1</code> についている1という数字です。</p>
<h1 id="ファイルを扱う">ファイルを扱う</h1>
<p>REPLにファイルを読み込んでみましょう。</p>
<p><code>recodr.idr</code> というファイルに以下の内容を書いて保存します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">record</span> <span class="kt">Person</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  constructor <span class="kt">MkPerson</span>
</span></span><span class="line"><span class="cl">  <span class="nf">age</span><span class="ow">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  <span class="kr">name</span><span class="ow">:</span> <span class="kt">String</span>
</span></span></code></pre></div><h2 id="ロード">ロード</h2>
<p><code>:cd</code> コマンドで <code>record.idr</code> を書いたディレクトリまで移動します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :cd ../Idris
</span></span></code></pre></div><p>そして <code>:l</code> （ <code>:load</code> ）コマンドでファイルを読み込みましょう。
ファイル名はTABによる補完が効きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :l record.idr
</span></span><span class="line"><span class="cl">Type checking ./record.idr
</span></span><span class="line"><span class="cl">*record&gt;
</span></span></code></pre></div><p>プロンプトの表示が変わりましたね。<code>record.idr</code> を読み込むとファイルの内容を型チェックし、REPLにロードしてくれます。</p>
<p>例えば <code>Person</code> 型のコンストラクタ <code>MkPerson</code> が読み込まれてるのが確認できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :t MkPerson
</span></span><span class="line"><span class="cl">MkPerson : Int -&gt; String -&gt; Person
</span></span></code></pre></div><h2 id="リロード">リロード</h2>
<p>次に <code>record.idr</code> を編集して <code>incAge</code> を追加してみましょう</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="c1">-- ...</span>
</span></span><span class="line"><span class="cl"><span class="nf">incAge</span><span class="ow">:</span> <span class="kt">Person</span> <span class="ow">-&gt;</span> <span class="kt">Person</span>
</span></span><span class="line"><span class="cl">incAge <span class="ow">=</span> <span class="kr">record</span> <span class="ow">{</span> age <span class="ow">$=</span> <span class="ow">(</span><span class="mi">1</span><span class="ow">+)</span> <span class="ow">}</span>
</span></span></code></pre></div><p>これにはやり方が2種類あります。
1つは普通にエディタで編集して、 IdrisのREPLで <code>:r</code> （ <code>:reload</code> ）するものです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">*record&gt;</span> <span class="ow">:</span>r
</span></span></code></pre></div><h2 id="編集">編集</h2>
<p>もう1つはターミナルにひきこもってる人向けにIdrisのREPLから <code>:e</code> （ <code>:edit</code> ） でファイルを編集するものです。
<code>EDITOR</code> または <code>VISUAL</code> 環境変数に設定されているエディタを起動し、ファイルを編集するよう促します。
編集し終わるとIdrisのREPLに戻ってきて、以下のように続きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :e
</span></span><span class="line"><span class="cl">Type checking ./record.idr
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Loading ./record.ibc failed: Module needs reloading:
</span></span><span class="line"><span class="cl">        SRC : &#34;./record.idr&#34;
</span></span><span class="line"><span class="cl">        Modified at: 2020-12-07 14:25:15.707323014 UTC
</span></span><span class="line"><span class="cl">        IBC : &#34;./record.ibc&#34;
</span></span><span class="line"><span class="cl">        Modified at: 2020-12-07 14:18:51.578095669 UTC
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">*record&gt; :r
</span></span><span class="line"><span class="cl">Type checking ./record.idr
</span></span></code></pre></div><p><code>:e</code> のあとに型チェックしてくれるんですが、何故かエラーになってしまいました。コンパイル結果の中間ファイル（<code>*.ibc</code>） が悪さをしたのかな？しかし慌てずに <code>:r</code> を打てば問題ありません。</p>
<p>では今読み込んだ <code>incAge</code> 関数を試してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; incAge (MkPerson 28 &#34;Tom&#34;)
</span></span><span class="line"><span class="cl">MkPerson 29 &#34;Tom&#34; : Person
</span></span></code></pre></div><p>こうやってファイルを編集しては試しての繰り返しの作業フローができました。</p>
<h2 id="継続的リロード">継続的リロード</h2>
<p>因みに型チェックしたいだけなら <code>:w</code> （ <code>:watch</code> ）でファイル変更を監視して継続的にリロードすることもできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :w
</span></span><span class="line"><span class="cl">record.idr
</span></span><span class="line"><span class="cl">Watching for .idr changes in [&#34;record.idr&#34;], press enter to cancel.
</span></span><span class="line"><span class="cl">Type checking ./record.idr
</span></span></code></pre></div><h1 id="探索する">探索する</h1>
<p>IdrisのREPLはIdrisが知っていることを教えてくれます。
例えば <code>:browse</code> は名前空間に定義されているシンボル一覧を教えてくれます。
名前空間はまだ出てきてない機能ですが、雰囲気で察して下さい。</p>
<p>今回の <code>record.idr</code> には名前空間を指定してなかったので <code>Main</code> という名前が割り当てられています。</p>
<h2 id="一覧する">一覧する</h2>
<p><code>:browse</code> コマンドで名前空間に定義されているアイテムを一覧することができます。<code>Main</code> で定義されているアイテムを表示してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :browse Main
</span></span><span class="line"><span class="cl">Namespaces:
</span></span><span class="line"><span class="cl">  Main.Person
</span></span><span class="line"><span class="cl">Names:
</span></span><span class="line"><span class="cl">  MkPerson : Int -&gt; String -&gt; Person
</span></span><span class="line"><span class="cl">  Person : Type
</span></span><span class="line"><span class="cl">  incAge : Person -&gt; Person
</span></span></code></pre></div><p>表示されましたね。因みに <code>Main.Person</code> という名前空間もあるようです。これも表示してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :browse Main.Person
</span></span><span class="line"><span class="cl">Namespaces:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Names:
</span></span><span class="line"><span class="cl">  age : Person -&gt; Int
</span></span><span class="line"><span class="cl">  name : Person -&gt; String
</span></span><span class="line"><span class="cl">  set_age : Int -&gt; Person -&gt; Person
</span></span><span class="line"><span class="cl">  set_name : String -&gt; Person -&gt; Person
</span></span></code></pre></div><p>これは <code>record</code> 構文で生成された関数が格納されています。</p>
<h2 id="ドキュメントを表示する">ドキュメントを表示する</h2>
<p>Idrisには言語組み込みでドキュメントの機能があります（基本文法のところでドキュメントコメント構文を紹介しましたね）。それをREPLから表示できます。</p>
<p>例えば標準ライブラリの <code>List</code> のドキュメントを表示してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :doc List
</span></span><span class="line"><span class="cl">Data type Prelude.List.List : (elem : Type) -&gt; Type
</span></span><span class="line"><span class="cl">    Generic lists
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    The function is: public export
</span></span><span class="line"><span class="cl">Constructors:
</span></span><span class="line"><span class="cl">    Nil : List elem
</span></span><span class="line"><span class="cl">        Empty list
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        The function is: public export
</span></span><span class="line"><span class="cl">    (::) : (x : elem) -&gt; (xs : List elem) -&gt; List elem
</span></span><span class="line"><span class="cl">        A non-empty list, consisting of a head element and the rest of the list.
</span></span><span class="line"><span class="cl">        infixr 7
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        The function is: public export
</span></span></code></pre></div><p>しっかりと表示できてますね。
見なれない記述があってもひとまず無視して自然言語だけでも理解するようにして下さい。
まだ説明してない機能もたくさんあるので分からないことがあっても当然です。</p>
<h2 id="探す">探す</h2>
<p>ほしい機能がないか探すこともできます。</p>
<p>例えば <code>List</code> を結合する関数を探しているとしましょう。
その関数は <code>List a -&gt; List a -&gt; List a</code> という型をしているはずです。これを検索してみましょう。
<code>:s</code> （ <code>:search</code> ） でその型を使って検索できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :s List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">= Prelude.List.(++) : List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">Append two lists
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">= Prelude.List.reverseOnto : List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">Reverse a list onto an existing tail.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Prelude.List.(\\) : Eq a =&gt; List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">The \\ function is list difference (non-associative). In the result of xs \\ ys, the first occurrence of each element of ys in turn
</span></span><span class="line"><span class="cl">(if any) has been removed from xs, e.g.,
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Prelude.List.union : Eq a =&gt; List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">Compute the union of two lists according to their Eq implementation.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&gt; Prelude.List.merge : Ord a =&gt; List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">Merge two sorted lists using the default ordering for the type of their elements.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">....
</span></span></code></pre></div><p>いくつか候補がで出てきました。
このうち、 先頭に <code>=</code> がついているものは完全一致、 <code>&gt;</code> がついているものはより狭い型、 <code>&lt;</code> がついているものはより広い型の関数のようです。</p>
<p>ひとまず最初の候補である <code>Prelude.List.(++)</code> に 「Append two lists」 と書かれているのでこれが求める演算子のようです。
使ってみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; [1, 2, 3] ++ [4, 5, 6]
</span></span><span class="line"><span class="cl">[1, 2, 3, 4, 5, 6] : List Intege
</span></span></code></pre></div><p>想定どおりですね。</p>
<p>もう1つ探し方があります。自然言語で全文検索する方法です。こちらは <code>:apropos</code> を使います。
同じく <code>List</code> を結合する関数を「append」 のキーワードで検索してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :apropos append
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.List.(++) : List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">Append two lists
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.Strings.(++) : String -&gt; String -&gt; String
</span></span><span class="line"><span class="cl">Appends two strings together.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.File.Append : Mode
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.File.ReadAppend : Mode
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.Strings.addToStringBuffer : StringBuffer -&gt; String -&gt; IO ()
</span></span><span class="line"><span class="cl">Append a string to the end of a string buffer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.List.appendAssociative : (l : List a) -&gt; (c : List a) -&gt; (r : List a) -&gt; l ++ c ++ r = (l ++ c) ++ r
</span></span><span class="line"><span class="cl">Appending lists is associative.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Prelude.List.appendCong2 : (x1 = y1) -&gt; (x2 = y2) -&gt; x1 ++ x2 = y1 ++ y2
</span></span><span class="line"><span class="cl">Appending pairwise equal lists gives equal lists
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><p>こちらの場合も <code>Prelude.List.(++)</code> が表示されていますね。</p>
<p>適宜2つを使い分けながらほしい関数を探してみて下さい。</p>
<h2 id="定義を表示する">定義を表示する</h2>
<p><code>:printdef</code> で関数の定義を表示することもできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*record&gt; :printdef Prelude.List.(++)
</span></span><span class="line"><span class="cl">(++) : List a -&gt; List a -&gt; List a
</span></span><span class="line"><span class="cl">[] ++ right = right
</span></span><span class="line"><span class="cl">(x :: xs) ++ right = x :: xs ++ right
</span></span></code></pre></div><p>恐らくソースコードに書いてあるものそのままではなくIdrisの内部表現をユーザが読める形に再出力してるんですかね？</p>
<h1 id="実行する">実行する</h1>
<p>一旦今開いてるREPLを閉じて、別のセッションを開くことにします。
REPLを閉じるには <code>:q</code> （ <code>:quit</code> ） を打ち込むかEOFを送り込む（Ctrl+D）かをします。</p>
<p>そして以下の内容の <code>hello_world.idr</code> を用意しておきます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> putStrLn <span class="s">&#34;Hello, World&#34;</span>
</span></span></code></pre></div><p>そして <code>idris</code> の引数に <code>hello_world.idr</code> を与えながら起動します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">$ idris hello_world.idr
</span></span><span class="line"><span class="cl">     ____    __     _
</span></span><span class="line"><span class="cl">    /  _/___/ /____(_)____
</span></span><span class="line"><span class="cl">    / // __  / ___/ / ___/     Version 1.3.3
</span></span><span class="line"><span class="cl">  _/ // /_/ / /  / (__  )      https://www.idris-lang.org/
</span></span><span class="line"><span class="cl"> /___/\__,_/_/  /_/____/       Type :? for help
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Idris is free software with ABSOLUTELY NO WARRANTY.
</span></span><span class="line"><span class="cl">For details type :warranty.
</span></span><span class="line"><span class="cl">Type checking ./hello_world.idr
</span></span><span class="line"><span class="cl">*hello_world&gt;
</span></span></code></pre></div><p>これでファイルの中身を読み込みながらREPLが起動してくれます。
一旦REPLを起動してから <code>:l</code> で読み込んでも同じですが、複数の方法を覚えておいて損はないでしょう。</p>
<p>さて、このファイルには <code>main</code> が定義されています。
つまり実行可能です。 <code>:exec</code> でファイルをコンパイ/実行できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*hello_world&gt; :exec
</span></span><span class="line"><span class="cl">Hello, World
</span></span></code></pre></div><p><code>:c</code> （ <code>:compile</code> ） でコンパイルするこもできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*hello_world&gt; :c hello_world
</span></span></code></pre></div><p>また、読み込んだ <code>main</code> の名前を指定して実行することもできます。
<code>:x</code> です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*hello_world&gt; :x main
</span></span><span class="line"><span class="cl">Hello, World
</span></span><span class="line"><span class="cl">MkIO (\w =&gt; prim_io_pure ()) : IO&#39; (MkFFI C_Types String String) ()
</span></span></code></pre></div><p>ちょっと見えちゃいけないものが見えてるような気がしますが、大丈夫です。</p>
<p>これだけ揃えば「あれIdrisでどう書くんだっけ」というのはなんとかなるんじゃないでしょうか。</p>
<h1 id="idris小旅行">Idris小旅行</h1>
<p>結果は貼りませんが、以下のようなコマンドでIdrisの基本の手札を確認できるんじゃないでしょうか。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :browse Builtins
</span></span><span class="line"><span class="cl">idris&gt; :browse Prelude
</span></span><span class="line"><span class="cl">Idris&gt; :browse Prelude.List
</span></span><span class="line"><span class="cl">Idris&gt; :doc Prelude.List.head&#39;
</span></span><span class="line"><span class="cl">Idris&gt; :printdef the
</span></span><span class="line"><span class="cl">Idris&gt; :printdef id
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- などなど
</span></span></code></pre></div><h1 id="まとめ">まとめ</h1>
<p>IdrisでのREPLの使い方、そしてそれを通じたIdrisの探索方法を紹介しました。
IdrisのREPLは非常に高機能で、それだけでプログラミングできてしまいます。
ぜひREPLを使いこなしましょう。</p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://KeenS.github.io/blog/2020/12/09/idrisnointafe_sutomonadonadonado/"> Idrisのインタフェースとモナドなどなど</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://KeenS.github.io/blog/2020/12/07/inkscapedeseiseisuruogpgazounokinsokushoriwochottodakeganbaru/"> Inkscapeで生成するOGP画像の禁則処理をちょっとだけ頑張る</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2023. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

