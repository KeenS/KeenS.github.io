<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="Idrisのパッケージとipkg | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="このエントリはIdris Advent Calendar 2020の14日目の記事です。

κeenです。今回はIdrisのパッケージ機能とipkgについて説明します。" />
        <meta property="og:title" content="Idrisのパッケージとipkg | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://KeenS.github.io/blog/2020/12/17/idrisnopakke_jitoipkg/" />
        <meta property="og:description" content="このエントリはIdris Advent Calendar 2020の14日目の記事です。

κeenです。今回はIdrisのパッケージ機能とipkgについて説明します。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/Idrisnopakke_jitoipkg.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/Idrisnopakke_jitoipkg.png" />
        
        <meta property="og:article:published_time" content="2020-12-17 06:45:33 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2020-12-17 06:45:33 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>Idrisのパッケージとipkg | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="https://KeenS.github.io/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://KeenS.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="https://KeenS.github.io/manifest.json">
        <link rel="mask-icon" href="https://KeenS.github.io/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="https://KeenS.github.io/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://KeenS.github.io/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="https://KeenS.github.io/about/"> About </a></li>
                        
                            <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                        
                            <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                        
                            <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                        
                            <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="https://KeenS.github.io/about/"> About </a></li>
                    
                        <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                    
                        <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                    
                        <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                    
                        <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">Idrisのパッケージとipkg</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2020-12-17</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="https://KeenS.github.io/categories/idris">Idris</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/idris-advent-calendar">Idris Advent Calendar</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/advent-calendar-2020">Advent Calendar 2020</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/advent-calendar">Advent Calendar</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>このエントリは<a href="https://qiita.com/advent-calendar/2020/idris">Idris Advent Calendar 2020</a>の14日目の記事です。</p>

<p>κeenです。今回はIdrisのパッケージ機能とipkgについて説明します。</p>

<p><code>idris</code> コマンドは単体でかなり高機能で、パッケージシステムも内包します。</p>

<p>標準ライブラリにpreludeとbaseがあるのは既に説明したとおりですが、他にもcontrib、effects、pruvilojというパッケージも添付されています。これらはパッケージシステムを使ってリンクしないと使えないようになっています。</p>

<p>これらの中でも<a href="https://www.idris-lang.org/docs/current/contrib_doc/">contrib</a>は重要です。
Idrisは標準ライブラリへの貢献に対してかなり保守的な態度を取っており、大抵のライブラリ強化の提案はcontribへとマージされることになっています。結果としてcontribがないとライブラリが貧弱な言語になってしまいます。</p>

<h1 id="contribを使う-アナグラム">contribを使う：アナグラム</h1>

<p>まずはパッケージを使ってみましょう。<a href="https://ja.wikipedia.org/wiki/アナグラム">アナグラム</a>を検知するプログラムです。例えば&rdquo;eat&rdquo;と&rdquo;ate&rdquo;は文字を並べ替えると互いに変換できるのでアナグラムの関係にあります。</p>

<p>実装方針としてはアナグラムの正規形、文字をアルファベット順に整列したものをキーとしてアナグラムの集合をバリューにもつマップを作ればよさそうです。上の例だと <code>&quot;aet&quot; -&gt; [&quot;eat&quot;, &quot;ate&quot;]</code> の関係を保持します。</p>

<p>キーバリューペアはcontribの <a href="https://www.idris-lang.org/docs/current/contrib_doc/docs/Data.SortedMap.html"><code>Data.SortedMap</code></a> にあり、集合は <a href="https://www.idris-lang.org/docs/current/contrib_doc/docs/Data.SortedSet.html"><code>Data.SortedSet</code></a>にあります。早速使っていきましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">module</span> <span class="nn">Anagram</span>

<span class="kr">import</span> <span class="nn">Data.SortedMap</span>
<span class="kr">import</span> <span class="nn">Data.SortedSet</span></code></pre></div>
<p>まずは <code>SortedMap</code> をインポートしました。</p>

<h2 id="最初の値">最初の値</h2>

<p>空のDBも定義しておきましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">export
<span class="nf">AnagramDB</span> <span class="ow">:</span> <span class="kt">Type</span>
<span class="kt">AnagramDB</span> <span class="ow">=</span> <span class="kt">SortedMap</span> <span class="kt">String</span> <span class="ow">(</span><span class="kt">SortedSet</span> <span class="kt">String</span><span class="ow">)</span>

export
<span class="nf">emptyDB</span> <span class="ow">:</span> <span class="kt">AnagramDB</span>
emptyDB <span class="ow">=</span> empty</code></pre></div>
<h2 id="単語の登録">単語の登録</h2>

<p>新しい値を登録する処理 <code>register</code> は、まずは登録する単語の正規形を計算して、それをキーにDBにエントリがあればリストにデータを加え、なければ新たにデータを登録すればよさそうです。</p>

<p>まずは正規形を計算する関数を。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">normalize</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
normalize <span class="ow">=</span> pack <span class="ow">.</span> sort <span class="ow">.</span> unpack</code></pre></div>
<p><code>normalize</code> は少し説明が必要でしょうか。ここで使っている <code>.</code> は関数の合成です。
そして <code>unpack: String -&gt; List Char</code> と <code>pack: List Char -&gt; String</code> はそれぞれ <code>String</code> &lt;-&gt; <code>List Char</code> の変換を担当します。</p>

<p>合成の様子を順番に見ると、以下のような動きをします。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; unpack &#34;eat&#34;
[&#39;e&#39;, &#39;a&#39;, &#39;t&#39;] : List Char
Idris&gt; (sort . unpack) &#34;eat&#34;
[&#39;a&#39;, &#39;e&#39;, &#39;t&#39;] : List Char
Idris&gt; (pack . sort . unpack) &#34;eat&#34;
&#34;aet&#34; : String</code></pre></div>
<p>あとの <code>register</code> は簡単に書けます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">export
<span class="nf">register</span><span class="ow">:</span> <span class="kt">AnagramDB</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">AnagramDB</span>
register db word <span class="ow">=</span>
  <span class="kr">let</span> key <span class="ow">=</span> normalize word <span class="kr">in</span>
  <span class="kr">case</span> lookup key db <span class="kr">of</span>
    <span class="kt">Just</span> set <span class="ow">=&gt;</span> insert key <span class="ow">(</span>insert word set<span class="ow">)</span> db
    <span class="kt">Nothing</span>   <span class="ow">=&gt;</span> insert key <span class="ow">(</span>insert word empty<span class="ow">)</span> db</code></pre></div>
<p><code>insert word set</code> と <code>insert word empty</code> をみてどうにか頑張れば1つにまとめられるのではと気付いた方、勘がいいです。 <code>SortedMap</code> と <code>union</code> 演算は（自由）半群なので多少楽に書けるAPIもありますが、今回はパッケージ以外はあんまり変なことをしない方針なので一旦スルーします。興味があればドキュメントを読んで別の実装を与えてみて下さい。</p>

<h2 id="単語のクエリ">単語のクエリ</h2>

<p>ある単語のアナグラムを検索する関数 <code>query</code> も作っておきましょう。
1つ注意しないといけないのが、その単語は自身のアナグラムなので必ずアナグラムは1つ以上あるということです。
さらに、その単語自体は登録されてなくてもアナグラムが登録されていれば返す値に検索ワードも入れないといけない点です。
それに注意して実装すると以下のようになります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">export
<span class="nf">query</span> <span class="ow">:</span> <span class="kt">AnagramDB</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">SortedSet</span> <span class="kt">String</span>
query db word <span class="ow">=</span>
  <span class="kr">let</span> key <span class="ow">=</span> normalize word <span class="kr">in</span>
  <span class="kr">case</span> lookup key db <span class="kr">of</span>
    <span class="kt">Just</span> set <span class="ow">=&gt;</span> insert word set
    <span class="kt">Nothing</span>   <span class="ow">=&gt;</span> insert word empty</code></pre></div>
<h2 id="パッケージのリンク">パッケージのリンク</h2>

<p>一旦REPLで様子を見たいんですが、REPLでcontribを使えるようにしないといけませんね。
<code>-p パッケージ名</code> でパッケージをロードした状態でREPLをはじめられます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ idris -p contrib Anagram.idr
...
Anagram*&gt; </code></pre></div>
<p>型チェックまで通ったら試してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">*Anagram&gt; :let db = register (register emptyDB &#34;eat&#34;) &#34;ate&#34;
*Anagram&gt; query db &#34;tea&#34;
SetWrapper (M 1 (Branch3 (Leaf &#34;ate&#34; ()) &#34;ate&#34; (Leaf &#34;eat&#34; ()) &#34;eat&#34; (Leaf &#34;tea&#34; ()))) : SortedSet String</code></pre></div>
<p>ちょっとみづらいですが  &ldquo;ate&rdquo; 、 &ldquo;eat&rdquo; 、 &ldquo;tea&rdquo; が含まれているのでよさそうです。</p>

<h2 id="ファイルからの読み込み">ファイルからの読み込み</h2>

<p>さっきまでの内容はライブラリとして、 <code>Main</code> を作っていきましょう</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">module</span> <span class="nn">Main</span>

<span class="kr">import</span> <span class="nn">Anagram</span></code></pre></div>
<p>さて、単語が沢山書かれているファイルから読み込んで、DBに登録してみましょう。
UNIX系OSを使っているなら <code>/usr/share/dict/words</code> というファイルがあるはずです。ここに10万くらいの単語が入っています。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ wc -l /usr/share/dict/words
102774 /usr/share/dict/words</code></pre></div>
<p>1/5000くらいランダムサンプリングしてみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ cat  /usr/share/dict/words | awk &#39;int(rand()*5000) == 1 { print $0 }&#39;
Chengdu&#39;s
Edinburgh
Poitier
aforementioned
ambulatory
busbies
confetti
courier&#39;s
cowslip
decorous
demurred
deviants
dotcom&#39;s
fabricates
freebasing
glorification
libellers
male
neocolonialism
plasticity&#39;s
reduces
sough
temptation&#39;s
wrapping&#39;s</code></pre></div>
<p>このように本当に単語が改行で並べられているだけのファイルです。
ここからアナグラムDBを作りましょう。
<code>/usr/share/dict/words</code> がなかった方は適当にファイルを用意して下さい。</p>

<p>もうそろそろ解説がなくても読めるようになった頃ですかね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">importFromFile</span> <span class="ow">:</span> <span class="ow">(</span>filename<span class="ow">:</span> <span class="kt">String</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">AnagramDB</span><span class="ow">)</span>
importFromFile filename <span class="ow">=</span> <span class="kr">do</span>
  <span class="kt">Right</span> file <span class="ow">&lt;-</span> openFile filename <span class="kt">Read</span>
    <span class="ow">|</span> <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
  loop file emptyDB
<span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">AnagramDB</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">AnagramDB</span><span class="ow">)</span>
  loop file db <span class="ow">=</span> <span class="kr">do</span>
    isEOF <span class="ow">&lt;-</span> fEOF file
    <span class="kr">if</span> isEOF
    <span class="kr">then</span> pure <span class="ow">$</span> <span class="kt">Right</span> db
    <span class="kr">else</span> <span class="kr">do</span>
      <span class="kt">Right</span> word <span class="ow">&lt;-</span> fGetLine file
        <span class="ow">|</span> <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
      <span class="kr">let</span> db <span class="ow">=</span> register db <span class="ow">(</span>trim word<span class="ow">)</span>
      loop file db</code></pre></div>
<p>これも一旦REPLにロードして実行してみましょう。
<code>-p contrib</code> を忘れずに。</p>

<p>ここで <code>/usr/share/dict/words</code> をロードしたいところですが問題があります。
今まで説明してませんでしたがREPLだとコンパイラを通さずインタプリタで実行するので遅いです。
そのREPLで10万語を読み込むのには不安があります。</p>

<p>ということで一旦100語くらいの辞書を作りましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">$ cat  /usr/share/dict/words <span class="p">|</span> awk <span class="s1">&#39;int(rand()*1000) == 1 { print $0 }&#39;</span> &gt; smalldict.txt</code></pre></div>
<p>これくらいだったらブログにも載るので付録に置いておきます。</p>

<p>では、これを実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">*AnagramMain&gt; :x (importFromFile &#34;smalldict.txt&#34;)
Can&#39;t convert handles back to TT after execution.</code></pre></div>
<p>成功したか分かりづらいですがエラーは出てないので大丈夫でしょう。</p>

<h2 id="表示-実行">表示、実行</h2>

<p>そろそろパッケージから離れてきたのでサクっといきましょう。</p>

<p><code>SortedSet</code> はそのままだと表示できないので加工する必要があります。 <code>Data.SortedSet</code> をいインポートしておきましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">import</span> <span class="nn">Data.SortedSet</span></code></pre></div>
<p>表示、 <code>main</code> は以下です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">showResult</span><span class="ow">:</span> <span class="kt">AnagramDB</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
showResult db word <span class="ow">=</span>
  <span class="kr">let</span> anagrams <span class="ow">=</span> <span class="kt">Anagram</span><span class="ow">.</span>query db word <span class="kr">in</span>
  printLn <span class="ow">$</span> <span class="kt">SortedSet</span><span class="ow">.</span>toList anagrams

<span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  <span class="ow">[</span><span class="kr">_</span>, key<span class="ow">]</span> <span class="ow">&lt;-</span> getArgs
  <span class="kt">Right</span> db <span class="ow">&lt;-</span> importFromFile <span class="s">&#34;/usr/share/dict/words&#34;</span>
  showResult db key</code></pre></div>
<p>今回はコンパイルして実行するので <code>/usr/share/dict/words</code> を読み込んでます。</p>

<p>以下のコマンドでコンパイル/実行します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="ow">$</span> idris <span class="ow">-</span>o <span class="kt">AnagramMain</span> <span class="ow">-</span>p contrib <span class="kt">AnagramMain</span><span class="ow">.</span>idr
<span class="ow">$</span> <span class="ow">./</span><span class="kt">AnagramMain</span> tea
<span class="ow">[</span><span class="s">&#34;ate&#34;</span>, <span class="s">&#34;eat&#34;</span>, <span class="s">&#34;eta&#34;</span>, <span class="s">&#34;tea&#34;</span><span class="ow">]</span></code></pre></div>
<p>多少時間がかかりますが、正しく動いています。</p>

<h1 id="パッケージを作る">パッケージを作る</h1>

<p>さきほどのアナグラムをパッケージにしてみましょう。
パッケージにすることでビルドが楽になります。</p>

<p>新しくディレクトリを作り、さらにその下に <code>src/</code> を作ります。
そして先程の <code>Anagram.idr</code> と <code>AnagramMain.idr</code> を <code>src</code> に入れます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ mkdir -p anagram/src
$ mv Anagram.idr anagram/src
$ mv AnagramMain.idr anagram/src
$ cd anagram</code></pre></div>
<h2 id="ipkg">ipkg</h2>

<p>Idrisにはパッケージ機構があるのは説明した通りです。そのためのファイルを書きましょう。
<code>anagram.ipkg</code> に以下の内容を書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">package anagram

version = &#34;0.1.0&#34;
author = your name

sourcedir = src
modules = Anagram
        , AnagramMain
main = AnagramMain
executable = anagram
pkgs = contrib</code></pre></div>
<p>少し解説しましょう。
ipkgはIdrisの独自フォーマットで、パッケージのメタデータやビルド情報などを記述します。</p>

<p>中身は <code>package</code> から始まります。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">package anagram</code></pre></div>
<p>そして <code>version</code> 、 <code>author</code> などのメタ情報を書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">version = &#34;0.1.0&#34;
author = your name</code></pre></div>
<p>ソースコード情報として <code>sourcedir</code> や <code>modules</code> も書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">sourcedir = src
modules = Anagram
        , AnagramMain</code></pre></div>
<p><code>main</code> のあるファイルや作成する実行可能ファイルも書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">main = AnagramMain
executable = anagram</code></pre></div>
<p>ビルドするときにリンクするパッケージを書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">pkgs = contrib</code></pre></div>
<p>詳細は<a href="http://docs.idris-lang.org/en/latest/reference/packages.html#ref-sect-packages">ドキュメント</a>を読んで下さい。</p>

<p>これをビルドしてみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ idris --build anagram.ipkg
$ ls
anagram  anagram.ipkg  src</code></pre></div>
<p>カレントディレクトリに <code>anagram</code> ができました。実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ ./anagram ocean
[&#34;canoe&#34;, &#34;ocean&#34;]</code></pre></div>
<p>正しく動いていますね。</p>

<p>このようにパッケージを作るとコマンド一発でビルドできるようになります。</p>

<h1 id="パッケージをインストールする">パッケージをインストールする</h1>

<p><code>idris --install IPKG</code> でライブラリをインストールすることもできます。
IdrisのWikiにはサードパーティのライブラリが載っていて、それをダウンロードしてインストールできる仕組みになっています。</p>

<p><a href="https://github.com/idris-lang/Idris-dev/wiki/Libraries">Libraries · idris-lang/Idris-dev Wiki</a></p>

<p>ライブラリを使わないまでも、インストールだけでも試してみましょう。<a href="https://github.com/ziman/lightyear">lightyear</a>をインストールしてみます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ git clone https://github.com/ziman/lightyear.git
$ cd lightyear
$ idris --install lightyear.ipkg
Type checking ./Lightyear/Position.idr
Type checking ./Lightyear/Core.idr
Type checking ./Lightyear/Combinators.idr
Type checking ./Lightyear.idr
Type checking ./Lightyear/Char.idr
Type checking ./Lightyear/Strings.idr
Type checking ./Lightyear/StringFile.idr
Type checking ./Lightyear/Testing.idr
Installing Lightyear.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear
Installing Lightyear/Position.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/Core.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/Combinators.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/StringFile.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/Strings.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/Char.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing Lightyear/Testing.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear/Lightyear
Installing 00lightyear-idx.ibc to /home/shun/.cabal/store/ghc-8.8.3/idris-1.3.3-0851a67ad4b1dcdc142d91174b2e9b6104a6df9b6243943de3f9ab0e56756b9a/share/libs/lightyear</code></pre></div>
<p>このようにインストールできます。インストールが済んでしまえば <code>idris -p lightyear</code> やipkgの <code>pkgs</code> に書くと使えるようになります。
シンプルながらも簡単に使えていいですね。</p>

<h1 id="ipkgの他の機能">ipkgの他の機能</h1>

<p><code>--build</code> や <code>--install</code> を紹介しましたが、REPLに読み込む <code>--repl</code> やドキュメントの作成などがあります。
<code>idris --help</code> などで確認してみて下さい。</p>

<h1 id="まとめ">まとめ</h1>

<p>Idrisのパッケージやipkgの紹介をしました。</p>

<p>ipkgは便利ですが、コマンドが長いのといつも <code>.ipkg</code> の書き方を忘れるので私は便利コマンドを作っていたりします。</p>

<p><a href="https://gitlab.com/blackenedgold/ipkg">blackenedgold/ipkg</a></p>

<p>もし興味があれば使ってみて下さい。</p>

<h1 id="付録">付録</h1>

<p>100語の辞書</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Alba&#39;s
Ceylon
Goddard&#39;s
Guggenheim
Ines
Kubrick&#39;s
Muslims
Paderewski&#39;s
Phillipa&#39;s
Reinhardt
Rumsfeld&#39;s
Salome&#39;s
Saudi&#39;s
Schlitz
Titanic
Waldheim&#39;s
Xi&#39;an&#39;s
abide
aborted
acceded
adaptability
affirm
amiability
asphalting
belligerency
blasphemed
boars
bowl
caldrons
carefullest
cesarian
commissioner
conciliators
conclusion&#39;s
constituents
cowardly
crush&#39;s
defender
dewy
downers
drabs
drouthes
finality&#39;s
gaskets
giggle
glamour&#39;s
greasy
grouting
headgear
hied
hookworm&#39;s
hurry
knot
lab
lavishest
louvered
mallet
markdown
minuscule
misdeals
misquote&#39;s
mitosis
mountaineers
objectionably
overawing
ovule
pertinacious
phototypesetting
phrased
polliwog
promiscuity
quadruplet
replete
repugnance&#39;s
safekeeping
salt&#39;s
spanks
spun
steamship&#39;s
supermen
suspenseful
suspicion&#39;s
taxidermists
teetotaller
testosterone&#39;s
tints
totalitarians
tramming
typography
wafers
wear
weasel
whined
workingman</code></pre></div>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://KeenS.github.io/blog/2020/12/19/idrisdocnotsukaikata/"> Idrisdocの使い方</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://KeenS.github.io/blog/2020/12/16/idrisnonamaetsukiparame_tatogadt/"> Idrisの名前つきパラメータとGADT</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2021. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

