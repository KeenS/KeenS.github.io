<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="論文メモの続き：The Third Homomorphism Theorem | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="前回の続きで実例を書いていきます。" />
        <meta property="og:title" content="論文メモの続き：The Third Homomorphism Theorem | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://KeenS.github.io/blog/2021/08/22/ronbunmemonotsuzuki_the_third_homomorphism_theorem/" />
        <meta property="og:description" content="前回の続きで実例を書いていきます。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/ronbunmemonotsuzuki_The_Third_Homomorphism_Theorem.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/ronbunmemonotsuzuki_The_Third_Homomorphism_Theorem.png" />
        
        <meta property="og:article:published_time" content="2021-08-22 15:01:49 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2021-08-22 15:01:49 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>論文メモの続き：The Third Homomorphism Theorem | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="https://KeenS.github.io/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://KeenS.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="https://KeenS.github.io/manifest.json">
        <link rel="mask-icon" href="https://KeenS.github.io/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="https://KeenS.github.io/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://KeenS.github.io/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="https://KeenS.github.io/about/"> About </a></li>
                        
                            <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                        
                            <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                        
                            <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                        
                            <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="https://KeenS.github.io/about/"> About </a></li>
                    
                        <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                    
                        <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                    
                        <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                    
                        <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">論文メモの続き：The Third Homomorphism Theorem</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2021-08-22</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="https://KeenS.github.io/categories/%e8%ab%96%e6%96%87%e3%83%a1%e3%83%a2">論文メモ</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p><a href="https://keens.github.io/blog/2020/12/27/ronbunmemo_the_third_homomorphism_theorem/">前回</a>の続きで実例を書いていきます。</p>
<p>$
\def\cat{\mathrm{++}}
\def\hom#1{{#1}\mathrm{-}準同型}
\def\leftwards#1{{#1}\mathrm{-}左方向}
\def\rightwards#1{{#1}\mathrm{-}右方向}
$</p>
<h2 id="おさらい">おさらい</h2>
<p>今回の導出を追う上で必要になる知識を思い出します。</p>
<p>リストの第三準同型定理はざっくりいうと「ある処理が <code>foldr</code> でも <code>foldl</code> でも書けるなら分割統治で書き換えられる」という定理なのでした。それを証明する道中でいくつかの性質も確認しました。</p>
<p>定義（リストの準同型）：
二項演算 $\odot$ に対してリスト上の $h$ 関数が以下の条件を満たすとき、 $h$ を $\hom{\odot}$ という</p>
<p>\[
h\ (x \cat y) = h\ x \odot h\ y
\]</p>
<p>結合的な演算子 $\odot$ とその単位元 $e$ に対して $hom\ (\odot)\ f\ e$ と書いて、 $\hom{\odot}$ な $h \circ [\cdot] = f$ である（一意な）関数 $h$ を表わす。</p>
<p>定義（左方向関数）：
$h: List a \to b$ が二項演算子 $\oplus: a \times b \to b$ に関して以下の条件を満たすとき、 $h$ を $\leftwards{\oplus}$ という。</p>
<p>\[
h ([a] \cat y) = a \oplus h\ y
\]</p>
<p>$\leftwards{\oplus}$ 関数 $h$ が $h\ [] = e$ を満たすとき、 $foldr\ (\oplus)\ e$ と書く。このとき $h$ は一意である。</p>
<p>ここで $foldr$ の重要な性質を提示します。
$\cat$ の $foldr$ は2つの $foldr$ に分解できるということ。</p>
<p>\[
foldr\ (\oplus)\ e\ (x \cat y) = foldr\ (\oplus)\ (foldr\ (\oplus)\ e\ y)\ x
\]</p>
<p>左方向関数と同様に、右方向関数も定義できます。</p>
<p>定義（右方向関数）：
$h: List\ a \to b$ が二項演算子 $\otimes: b \times a \to b$ に関して以下の条件を満たすとき、 $h$ を $\rightwards{\otimes}$ という。</p>
<p>\[
h\ (x \cat [a]) = h\ x \otimes a
\]</p>
<p>左方向関数と同様に $foldl$ も導入しましょう。
$\rightwards{\otimes}$ 関数 $h$ が $h\ [] = e$ を満たすとき、 $foldl\ (\otimes)\ e$ と書く。このとき $h$ は一意である。</p>
<p>左方向関数と同様に、 <code>foldl</code> には重要な性質があります。</p>
<p>\[
foldl\ (\otimes)\ e\ (x \cat y) = foldl\ (\otimes)\ (foldl\ (\otimes)\ e\ x)\ y
\]</p>
<p>です。</p>
<p>補題1：
全ての計算可能で全関数である、列挙可能な定義域をもつ $h$ に対して、
計算可能（だが部分関数である可能性もある）関数 $g$ が存在して $h \circ g \circ h = h$ を満たす。</p>
<p>定理（第三準同型定理）：
リスト上の関数 $h$ が左方向かつ右方向であるとき、 $h$ は準同型である。</p>
<p>それと前回の内容には含まれていませんが $foldr$ と $foldl$ の追加の性質についても確認しておきます。</p>
<p>\[
\begin{align}
foldr\ (\oplus)\  x\ (b:y) &amp; = b \oplus\ foldr\ (\oplus)\ x\ y \\\
foldl\ (\otimes)\ x\ (b:y) &amp; = foldl\ (\otimes)\ (x \otimes b)\ y
\end{align}
\]</p>
<p>これらを元に進めていきます</p>
<h2 id="実例ソート">実例：ソート</h2>
<p>挿入ソート（$O(n^2)$）をリストの第三準同型定理（など）を用いてマージソート（$O(n\log n)$）へと変換していきます。</p>
<h3 id="ソートは左方向かつ右方向">ソートは左方向かつ右方向</h3>
<p>ソートは $ins$ を用いて $foldr$ を使って実装できるので左方向です。</p>
<p>\[
sort\ = foldr\ ins\ []
\]</p>
<p>ここで $ins$ の定義は以下です。</p>
<p>\[
\begin{align}
ins\ a\ []    &amp; = [a] \\\
ins\ a\ (b:x) &amp; = \begin{cases}
a : ins\ b\ x   &amp;, \mathrm{if}\ a \le b \\\
b : ins\ a\ x &amp;, \mathrm{otherwise}
\end{cases}
\end{align}
\]</p>
<p>同時に右方向でもあります。 何故なら <code>ins</code> の引数を逆にした <code>ins'</code> を用いて <code>foldl</code> で書けるからです。</p>
<p>\[
\begin{align}
sort\ &amp;= foldl\ ins&rsquo;\ [] \\\
ins&rsquo;\ x\ a &amp;= ins\ a\ x
\end{align}
\]</p>
<h3 id="リストの第三準同型定理の適用">リストの第三準同型定理の適用</h3>
<p>$sort$ が右方向かつ左方向であることが分かったので、リストの第三準同型定理より $sort$ はリストの準同型です。つまり、ある二項演算 $\odot$ を用いて以下のように書けるということです。</p>
<p>\[
sort (x \cat y) = sort\ x \odot sort\ y
\]</p>
<p>リストの第三準同型定理を証明する中での補題1の使い方を思い出すと $\odot$ は $sort \circ unsort \circ sort$ を満たす関数 $unsort$ を用いた以下の定義が条件を満たします。</p>
<p>\[
u \odot v = sort (unsort\ u \cat unsort\ v)
\]</p>
<p>条件さえ満たせば $unsort$ は何でもいいので $id$ を選びます。すると $\odot$ が簡単になります。</p>
<p>\[
u \odot v = sort (u \cat v)
\]</p>
<p>まとめると、 リストの第三準同型定理を使えば $sort$ は以下の等式を満たすことが分かります。</p>
<p>\[
sort (x \cat y) = sort(sort\ x \cat sort\ y)
\]</p>
<p>…あれ？あんまり簡単になってる気がしませんね。実際効率は悪いです。そこでここから効率化していきます。
$\odot$ に渡るリストがソート済みであることに着目すれば効率化できそうです。</p>
<h3 id="odot-の効率化">$\odot$ の効率化</h3>
<p>リスト $u$ がソート済みである場合 $u = sort\ u$ であることに注目しましょう。
その上で $\odot$ への引数 $u$ と $v$ がソート済みであることに着目して式変形していきます。</p>
<p>\[
\begin{align}
u \odot v &amp; = sort (u \cat v)                 &amp; （定義より） \\\
&amp; = foldl\ ins&rsquo;\ []\ (u \cat v)     &amp; （sortは右方向より） \\\
&amp; = foldl\ ins&rsquo;\ (foldl\ ins&rsquo;\ u) v &amp; （foldlの性質より） \\\
&amp; = foldl\ ins&rsquo;\ (sort\ u) v        &amp; （sortは右方向より） \\\
&amp; = foldl\ ins&rsquo;\ u\ v               &amp; （uはソート済みより） \\\
&amp; = merge\ u\ v                     &amp; （merge = foldl\ ins&rsquo; と定義）
\end{align}
\]</p>
<p>最後に $foldl\ ins&rsquo;$ のことを $merge$ と呼ぶようにしました。この $merge$ はマージソートで使われるマージと同じ挙動をします。実際、以下の2つ事実から確認できます。</p>
<p>\[
\begin{align}
merge\ u\ []    &amp; = foldl\ ins&rsquo;\ u\ []           \\\
&amp; = []                           \\\
merge\ u\ (b:v) &amp; = foldl\ ins&rsquo;\ u\ (b:v)        \\\
&amp; = foldl\ ins&rsquo;\ (ins&rsquo;\ u\ b)\ v \\\
&amp; = merge\ (ins&rsquo;\ u\ b)
\end{align}
\]</p>
<p>これは $u$ がソート済みであるという仮定の下簡易的に使われる $merge$ の実装と同じものです。
ただし簡易的にと書いた通りこれまた効率は悪いので $merge$ も効率化しましょう。</p>
<h3 id="merge-の効率化">$merge$ の効率化</h3>
<p>$merge$ は $merge\ u\ v$ の形で使われていて、 $u$ がソート済みであれば正しい実装になっていそうなことを確認しました。ここでは $v$ もソート済みであることを用いて効率化します。</p>
<p>値 $a$ とリスト $v$ について $v$ の全ての要素が $a$ 以上であることを $a \le v$ と表わすことにします。</p>
<p>補題3： 値 $a$ 、 リスト $x$ 、 $y$ について $a \le x$ かつ $a \le y$ であるとき以下が成り立つ</p>
<p>\[
foldl\ ins&rsquo;\ (a : x)\ y = a : foldl\ ins&rsquo;\ x\ y
\]</p>
<p>証明：数学的帰納法による。
任意の値 $a$ リスト $x$ について考える。
$y = []$ の場合、両辺ともに $a:x$ になる。
$y&rsquo;$ の場合に成り立つとして $y = b : y&rsquo;$ の場合について考える。</p>
<p>\[
\begin{align}
foldl\ ins&rsquo;\ (a:x)\ (b:y&rsquo;)
&amp; = foldl\ ins&rsquo;\ (ins&rsquo;\ (a:x)\ b)\ y&rsquo; &amp; （foldlの性質より） \\\
&amp; = foldl\ ins&rsquo;\ (a : ins&rsquo;\ x\ b)\ y&rsquo; &amp; （ins&rsquo;のa \le bより） \\\
&amp; = a : foldl\ ins&rsquo;\ (ins&rsquo;\ x\ b)\ y&rsquo; &amp; （帰納法の仮定より） \\\
&amp; = a : foldl\ ins&rsquo;\ x\ (b:y&rsquo;)        &amp; （foldlの性質より）
\end{align}
\]</p>
<p>□</p>
<p>補題を証明したので $merge$ の性質を確認していきます。リスト$u$ 、 $v$ をソート済み、値 $a$ 、 $b$ を $a \le u$ 、 $b \le v$ を満たすとして $merge\ u\ []$ 、 $merge\ []\ v$ 、 $merge\ (a:u)\ (b:v)$ について考えます。</p>
<p>$merge\ u\ []$</p>
<p>\[
\begin{align}
merge\ u\ [] &amp; = foldl\ ins&rsquo;\ u\ [] &amp; （mergeの定義より） \\\
&amp; = u                  &amp; （foldlの定義より）
\end{align}
\]</p>
<p>$merge\ []\ v$</p>
<p>\[
\begin{align}
merge\ []\ v &amp; = foldl\ ins&rsquo;\ []\ v &amp; （mergeの定義より） \\\
&amp; = sort\ v            &amp; （sortは右方向より） \\\
&amp; = v                  &amp; （vはソート済みより）
\end{align}
\]</p>
<p>$merge\ (a:u)\ (b:v)$</p>
<p>\[
\begin{align}
merge\ (a:u)\ (b:v) &amp; = foldl\ ins&rsquo;\ (a:u)\ (b:v)        &amp; （mergeの定義より） \\\
&amp; = foldl\ ins&rsquo;\ (ins&rsquo;\ (a:u)\ b)\ v &amp; （foldlの性質より）
\end{align}
\]</p>
<p>ここから $a \le b$ と $a \gt b$ で場合分けします。</p>
<p>$a \le b$ の場合。
仮定より $a \le u$。$a \le b$ と仮定より $a \le v$。さらに $a \le ins&rsquo;\ u\ b$ がいえます。</p>
<p>\[
\begin{align}
foldl\ ins&rsquo;\ (ins&rsquo;\ (a:u)\ b) v
&amp; = foldl\ ins&rsquo;\ (a : ins&rsquo;\ u\ b)\ v &amp; （ins&rsquo;のa \le b）\\\
&amp; = a : foldl\ ins&rsquo;\ (ins&rsquo;\ u\ b)\ v &amp; （補題3より） \\\
&amp; = a : foldl\ ins&rsquo;\ u\ (b:v)        &amp; （foldlの性質より） \\\
&amp; = a : merge\ u\ (b:v)              &amp; （mergeの定義より）
\end{align}
\]</p>
<p>$a \gt b$の場合。
仮定より $b \le v$。 $b \lt a$ と仮定より $b \lt u$。</p>
<p>\[
\begin{align}
foldl\ ins&rsquo;\ (ins&rsquo;\ (a:u)\ b) v
&amp; = foldl\ ins&rsquo;\ (b:a:u)\ v   &amp; （ins&rsquo;のa \gt b）\\\
&amp; = b : foldl\ ins&rsquo;\ (a:u)\ v &amp; （補題3より） \\\
&amp; = b : merge\ (a:u)\ v       &amp; （mergeの定義より）
\end{align}
\]</p>
<p>総合すると、 $merge$ は引数が2つともソート済みである場合以下の性質を持つことが分かります。</p>
<p>\[
\begin{align}
merge\ []\ v        &amp; = v \\\
merge\ u\ []        &amp; = u \\\
merge\ (a:u)\ (b:v) &amp; = \begin{cases}
a : merge\ u\ (b:x) &amp;, \mathrm{if}\ a \le b \\\
b : merge\ (a:u)\ v &amp;, \mathrm{otherwise}
\end{cases}
\end{align}
\]</p>
<p>これはそのまま関数として定義できて、よくみるマージソートのマージ関数そのものですね。</p>
<p>こうして挿入ソートからマージソートが導出できました。</p>
<h2 id="まとめ">まとめ</h2>
<p>リストの第三準同型定理やらなんやらを使う実例として挿入ソートをマージソートに運算できることを示しました。</p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://KeenS.github.io/slide/pldironbunyomikai__perceus__garbage_free_reference_counting_with_reuse/"> PLDI論文読み会: Perceus: Garbage Free Reference Counting with Reuse</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://KeenS.github.io/blog/2021/08/22/konpairutokiniteisuuwoshorishiteshimauare/"> コンパイル時に定数を処理してしまうアレ</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2023. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

