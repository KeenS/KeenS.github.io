<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Emacs | κeenのHappy Hacκing Blog]]></title>
  <link href="http://KeenS.github.io/blog/categories/emacs/atom.xml" rel="self"/>
  <link href="http://KeenS.github.io/"/>
  <updated>2013-12-06T21:16:18+09:00</updated>
  <id>http://KeenS.github.io/</id>
  <author>
    <name><![CDATA[κeen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[UbuntuでEmacsからGPGを透過的に扱う]]></title>
    <link href="http://KeenS.github.io/blog/2013/12/04/emacs-gpg/"/>
    <updated>2013-12-04T22:52:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/12/04/emacs-gpg</id>
    <content type="html"><![CDATA[<p>暗号化といえばGPGですがEmacsからGPGで暗号化されたファイルを編集しようとすると毎回パスワードを訊かれて鬱陶しいです。これはキーリングを登録することで解決できました。</p>

<!-- more -->


<h2>Step1 Keyringに登録する</h2>

<p>Dashboardから[key]で検索すると[パスワードと鍵]が見付かります。
左上の[+]で新たにキーリングを追加します。</p>

<p><img src="/images/2013-12-04-1.png" title="&lsquo;keyring&rsquo; &ldquo;こんな感じ&rdquo;" ></p>

<p>GPGを選択します</p>

<p><img src="/images/2013-12-04-2.png" title="&lsquo;Selecting GPG&rsquo; &ldquo;こんな感じ&rdquo;" ></p>

<p>必要な情報を入力します。このメールアドレスは実在しなくても作れますが、ブルートフォースかけられたときの警告とかに使われそうなので実在した方が良い気がします。とりあえず後で使うので覚えておいて下さい。</p>

<p><img src="/images/2013-12-04-3.png" title="&lsquo;Input info &ldquo;こんな感じ&rdquo;" ></p>

<p>あとはパスワードのプロンプトが出るので入力して、エントロピーを発生させたら終わりです。</p>

<h2>Step2 ファイルを準備する</h2>

<p>ここが肝です。ファイルの先頭に</p>

<pre><code>-*- epa-file-encrypt-to: (my@mailaddress) -*-
</code></pre>

<p>を挿入します。既存の暗号化されたファイルでも同じです。</p>

<h2>Step3 暗号化する</h2>

<p><code>M-x epa-encrypt-file</code>で暗号化できます。暗号化するファイル名を指定したらキーリングを選べます</p>

<p><img src="/images/2013-12-04-4.png" title="&lsquo;Selecting GPG&rsquo; &ldquo;こんな感じ&rdquo;" ></p>

<h2>Step4 編集する</h2>

<p>あとはもう透過的に使えます。でもなんか実験してたらファイル保存できなかった。先にGPGで暗号化してたやつはできたのに。要調査です。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ここ１ヶ月くらいの近況]]></title>
    <link href="http://KeenS.github.io/blog/2013/11/13/what-recent/"/>
    <updated>2013-11-13T21:20:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/11/13/what-recent</id>
    <content type="html"><![CDATA[<p> #isucon 参戦記がフォロワーの多い@tagomorisさんとか@nitro_idiotさんとかにツイートされて普段の数十倍のアクセスが来てテンション上がったので近況書きますね。</p>

<!-- more -->


<h2>isuconの勉強</h2>

<p>件の記事でも書いてますけどMySQLとNginXとCapistranoの勉強しました。SQLって書けると案外楽しいですね。あとN+1問題を学んだり、<code>IF EXISTS TRRIGER</code>的な文がなくて殺そうかと思ったり。</p>

<p>NginXはキャッシュとかですね。キャッシュキーに<code>$cookie_isucon_session</code>とか入れてログインしてるユーザーが来ても対応できたので良かったです（小並感</p>

<p>Capistranoはどうせだからと3.0を使ったのですが調べても2.x時代の情報ばっかり引っ掛かって苦労しました。その代わり、isucon本戦では複数サーバーへのデプロイ機能を存分に使わせて頂きました。ほぼログインしなくても問題ないですね。</p>

<p>例えば</p>

<p>```ruby
set :application, &lsquo;my app&rsquo;
set :repo_url, &lsquo;git@bitbucket.org:me/myrepo.git&rsquo;
set :deploy_to, &lsquo;/home/me/app&rsquo;
set :scm, :git
set :deploy_via, :remote_cache</p>

<p>namespace :nginx do
  task :reload do</p>

<pre><code>on roles(:web) do
  execute :sudo, 'service nginx reload'
end
</code></pre>

<p>  end</p>

<p>  task :restart do</p>

<pre><code>on roles(:web) do
  execute :sudo, 'service nginx restart'
end
</code></pre>

<p>  end</p>

<p>  task :start do</p>

<pre><code>on roles(:web) do
  execute :sudo, 'service nginx start'
end
</code></pre>

<p>  end
end
```
こんな感じです。で、もう一つ</p>

<p>```ruby
set :stage, :production
server &lsquo;123.4.5.67&rsquo;, user: &lsquo;me&rsquo;, roles: &lsquo;web&rsquo;
server &lsquo;123.4.5.68&rsquo;, user: &lsquo;me&rsquo;, roles: &lsquo;web&rsquo;
server &lsquo;123.4.5.69&rsquo;, user: &lsquo;me&rsquo;, roles: &lsquo;web&rsquo;
set :ssh_options, {
  keys: %w(~/.ssh/id_rsa),
  forward_agent: true,
  auth_methods: %w(publickey)
}</p>

<p>```
を書いておけばこの3台のサーバーに一斉にデプロイしてくれます。(上の例だとnginxですが、まあいいでしょう。)</p>

<h2>Shibuya.lisp</h2>

<p>Lisp Meet Up #10で発表してきました。内容は<code>fluentd</code>をCommon Lispから使う話。<br/>
スライド</p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/27444839" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/blackenedgold/common-lisp-27444839" title="Common Lisp でビッグデータを作ろう" target="_blank">Common Lisp でビッグデータを作ろう</a> </strong> from <strong><a href="http://www.slideshare.net/blackenedgold" target="_blank">blackenedgold</a></strong> </div></p>

<p>Ustreamは見つかりませんでした。てへペロ</p>

<p>恐らく、<code>Log4CL</code>はやりたいことと目的が違いますね。全く別のロギングフレームワークを作るのが良さげな気がします。isuconの懇親会で開発者の@tagomorisさんにアドバイスも頂きましたし作るかもしれません。</p>

<h2>mpd</h2>

<p><a href="/blog/2013/09/29/mplayer/">以前、mplayer2が正常に動作しないとかぼやいて</a>ましたが、結局あきらめました。で、代わりに<a href="http://www.musicpd.org/">Music Player Daemon(MPD)</a>なるものを見付けて、しかもRaspberry Piで動き、iPod/Androidから操作できるとのことで、導入しました。</p>

<p>MPDはまさしくRaspberry Piのような機器向で、音楽を鳴らすサーバーと操作するクライアントが完全に分かれてます。</p>

<pre><code>$ sudo apg-get install mpd mpc
</code></pre>

<p>とかでRSPiに入れた気がします。クライアントはAndroidは<code>MPDroid</code>、iPodは<code>MPoD</code>っていうアプリです。</p>

<p><code>scp</code>で手元の曲をRSPiコピーし、iPodから繋ぐも曲が見えない。色々試した結果、<code>scp</code>でコピーしたときにパーミッションの問題が出てたようなのでそこを解決したらちゃんと動きました。</p>

<p>動画(iPod)</p>

<iframe width="560" height="315" src="http://KeenS.github.io//www.youtube.com/embed/x5CWtXbCkqo" frameborder="0" allowfullscreen></iframe>


<p>黒ばっかで見づらくて申し訳ありません。iPodからではなくスピーカから音が出てるのが分かりますかね？思ったより音が入ってないので分りづらいですね（汗</p>

<h2>CIM</h2>

<p><a href="https://github.com/fukamachi/shelly/">Shelly</a>を使って<a href="https://gist.github.com/KeenS/7059301">Common Lispスクリプトをexecutableにしよう</a>ってのをやってましたが少しshellyが求めているのと違うようだったので「シェルスクリプトでshelly的な物を実装しよう！ついでにrvmみたいにバージョン管理できたら嬉しいな！！」って思い付きで<a href="https://github.com/KeenS/CIM">Common Lisp Implementation Manager(CIM)</a>を作り始めました。まだCLISP, ECL, GCLのインストールぐらいしかできてません。</p>

<p>初めてシェルスクリプトを書き、初めてBourne Shellを触り(普段はzsh)、早くも挫折しそうです。今めっちゃシェルスクリプトの勉強してます。目的はImplementationの管理じゃなくて統一インターフェースの<code>cl</code>コマンドなのにそこが全然進んでないですね。<code>ql</code>に至っては1行も書いてない。まあ、<code>cl</code>を使って書くつもりなので<code>cl</code>が出来ないことにはどうしようもないんですが。</p>

<p><code>syset</code>とかネーミングセンスが無かったり(発音しずらい。シセット…サイセットって読もうかな)ダウンロードしたアーカイブのチェックサムとか全く見てなかったり色々ツッコみたくなりますが温かい目で見て下さい。気に入ったらpull-reqとかして下さい。</p>

<h2>Octomacs</h2>

<p>Octomacsに一回pull-req送ってからコミッタ気取りのκeenですが、<code>octomacs-preview</code>と<code>octomacs-deploy</code>を実装しました。<code>C-u</code>をつけると<code>generate</code>が付いてきます。テストをしてない（できない？）+サーバーを殺す(<code>octomacs-preview-quit</code>とかの名前かなあ。現状は<code>*octomacs preview*</code>バッファを<code>kill-buffer</code>すればいい)コマンドを実装してないのでpull-reqは投げてませんが使ってみたい方は<a href="https://github.com/KeenS/octomacs">こちら</a>をどうぞ。まあ、今からpushするんですがね。ちゃんとこの記事も<code>octomacs-new-post</code>から始まり、<code>octomacs-preview</code>で確認しつつ<code>octomacs-deploy</code>でデプロイしました。あとは過去の記事を編集する<code>octomacs-edit</code>を実装すれば完璧ですね。</p>

<p>こんなかんじです。<code>CIM</code>がんばります。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[tiarraにercで接続したときの/loadの問題]]></title>
    <link href="http://KeenS.github.io/blog/2013/10/06/tiarra-erc/"/>
    <updated>2013-10-06T00:35:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/10/06/tiarra-erc</id>
    <content type="html"><![CDATA[<p><a href="http://www.clovery.jp/tiarra/">tiarra</a>に<a href="http://www.emacswiki.org/ERC">erc</a>で接続したときの/loadの問題。</p>

<!-- more -->


<p>tiarraは有名なircプロキシ。ercはEmacs上で動くircクライアント。これらを使っているとtiarraが自動でログインしてくれないのでおかしいなと思っていたらtiarraの自動ログインモジュールを有効にしていなかった模様。</p>

<p>書き換えていざ設定を反映しようとすると若干困りました。どこに<code>/load</code>と打てばいいんだろ。</p>

<p>最初に誘導されるバッファ(ircバッファ名がプロキシサーバー名になってるやつ)に<code>/load</code>と打つと</p>

<pre><code>ERC&gt; /load
Incorrect arguments. Usage:
/LOAD line
Load the script provided in the LINE.
If LINE continues beyond the file name, the rest of
it is put in a (local) variable `erc-script-args',
which can be used in Emacs Lisp scripts.

The optional FORCE argument is ignored here - you can't force loading
a script after exceeding the flood threshold.
</code></pre>

<p>ですって。ああ…。<code>/load</code>コマンドがercに食われてる…</p>

<p>流石に解決策あるだろって思って調べたら</p>

<pre><code>/quote load
</code></pre>

<p>だそうです。</p>

<pre><code>ERC&gt; /quote load
-192.168.1.4- *** Reloaded configuration file.
-192.168.1.4- *** Module Channel::Join::Connect will be loaded newly.
</code></pre>

<p>はい。ちゃんとloadしてくれました。</p>

<p>以上小ネタでした。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Emacsのdired-modeを使い易くする]]></title>
    <link href="http://KeenS.github.io/blog/2013/10/04/emacs-dired/"/>
    <updated>2013-10-04T19:51:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/10/04/emacs-dired</id>
    <content type="html"><![CDATA[<p>Emacsの標準ライブラリ<code>dired.el</code>を読んでたら色々発見があったのでメモ兼dired-modeとはなんじゃらほいって方にも一から解説してみます。</p>

<!-- more -->


<p>とは言ってもいきなり解説しなくて申し訳ないのですが、最初に</p>

<pre><code>(ffap-bindings)
</code></pre>

<p>を設定しておきましょう。<code>C-x C-f</code>が非常に便利になります。
だいたいの方が設定してるかと思いますが、まだという方は<code>init.el</code>に書いて保存し、最後の<code>)</code>の後にカーソルを持っていって<code>C-x C-e</code>しましょう。設定が反映されます。
この設定で<code>C-x C-f</code>の入力がファイル以外も受け付けてくれますし、カーソルにポイントされてるファイルやURLをデフォルトで開こうとしてくれます。</p>

<p>…よし。じゃあ解説始めますよ。<code>C-x C-f ~/</code>してみて下さい。上の設定をしていたらディレクトリでも開ける筈です。するとホームディレクトリが<code>ls -al</code>された感じのバッファが出てくると思います。</p>

<p> <img src="/images/Screenshot_from_2013-10-04.png" title="&lsquo;dired-mode-screenshot&rsquo; &lsquo;私のホームはちょっとマズいのがあったので.emacs.dのスクリーンショット&rsquo;" ></p>

<p>これが<code>dired-mode</code>です。これは普通に<code>n</code>(<code>C-n</code>でも可)や<code>p</code>(<code>C-p</code>でも可)で移動して、Enterでそのファイルやディレクトリを開けます。これだけでも十分便利なのですが、ここからさらにファイル操作までできます。</p>

<p>適当なファイルにカーソルを合わせて<code>C</code>するとコピー先を聞かれるので、入力してあげるとコピーしてくれます。複数ファイルをコピーしたいなら、コピーしたいファイル上で<code>m</code>してマークを付けて、<code>C</code>すれば一括でコピーできます。</p>

<p>勿論、他にもコマンドはあります。同じような使い方のできる代表的なものを挙げると、</p>

<table>
<thead>
<tr>
<th></th>
<th> コマンド </th>
<th> 操作(実行されるLinuxコマンド)    </th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td> <code>C</code>      </td>
<td> コピー(<code>cp</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>R</code>      </td>
<td> リネーム/移動(<code>mv</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>D</code>      </td>
<td> 削除(<code>rm</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>M</code>      </td>
<td> 権限操作(<code>chmod</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>G</code>      </td>
<td> グループ変更(<code>chgrp</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>O</code>      </td>
<td> 所有権変更(<code>chown</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>Z</code>      </td>
<td> 圧縮/展開(<code>compress/uncompress/gunzip/bunzip/unzip</code>)</td>
</tr>
<tr>
<td></td>
<td> <code>B</code>      </td>
<td> (*.elファイルの)バイトコンパイル</td>
</tr>
<tr>
<td></td>
<td> <code>!</code>      </td>
<td> 任意のコマンドの実行。デフォルトで空気読んだコマンドになってる。</td>
</tr>
</tbody>
</table>


<p>他にも無数に操作はありますがファイル操作はこんなものでしょう。あとはバッファを閉じる<code>q</code>や親ディレクトリに移動する<code>^</code>、バッファの更新を行なう<code>g</code>、マークを外す<code>u</code>(<code>U</code>で全解除)を覚えていれば操作には困らない筈です。</p>

<p>が、頻繁に使っているとより良く使いたくなります。そこで今回見付けた設定を紹介します。</p>

<p>まず</p>

<pre><code>(add-hook 'dired-load-hook (lambda ()
                  (define-key dired-mode-map "r" 'wdired-change-to-wdired-mode)))
</code></pre>

<p>から。これはdired-modeで<code>r</code>するとバッファがエディタブルになり、ファイル名を普通に変更できます。そのまま<code>C-x C-s</code>すればリネームの終了です。<br/>
普通にEmacsの編集コマンドが使えるので <code>M-%</code>とかで一括拡張子変更とか<code>C-x r t</code>でファイル名にプリフィクスつけたり自由自在です。</p>

<p>次に</p>

<pre><code>(setq dired-listing-switches (purecopy "-Ahl"))
</code></pre>

<p>Emacsがdired-modeを表示するとき、実際に裏で <code>ls -al</code>を走らせているのですが、そのときのオプションを変更できます。但し内部で<code>-l</code>の結果を利用してるのでこれは必須です。しかしそれ以外は自由に設定できます。因みにWindowsでもEmacsがエミュレートしてくれるので設定可能ですが、一部未実装のものもあるそうです。</p>

<p>頻繁に使うなら</p>

<pre><code>(setq dired-dwim-target t)
</code></pre>

<p>もお勧めです。</p>

<p>これを設定しておくと、ウィンドウを分割して左右にdiredバッファを開いているとき、<code>R</code>や<code>C</code>のデフォルトの宛先がもう片方のディレクトリになります。伝わりますかね？</p>

<p> <img src="/images/Screenshot_from_2013-10-05.png" title="&lsquo;dired-mode in both of split window&rsquo; &lsquo;分割した両方のWindowでdired-modeを実行した状態。&rsquo;" ></p>

<p>のようにdiredでディレクトリA, Bを開いてるときにディレクトリAでファイルのコピーやら移動やらをするときにデフォルトでBに移動やコピーを行なうようになります。いくつかのファイルをディレクトリ間で移動させるときに非常に便利ですね。</p>

<p>あ、<code>C-x C-f /ftp:user@ftp-server:/path/to/dir</code>でFTPサーバーのディレクトリ/ファイルにもアクセスできるのは御存じですよね？これと組合せるとEmacsが割と使い易いFTPクライアントに大変身!</p>

<p>あとは私がどうしても欲しかったtarballですね。
 <div><script src='https://gist.github.com/KeenS/6828197.js?file=dired-tar.el'></script>
<noscript><pre><code>(defun dired-tar (tarname files &amp;optional arg)
  &quot;A dired-mode extension to archive files marked. With prefix argument, the tarball is gziped.&quot;
  (interactive (let ((files (dired-get-marked-files)))
		 (list (read-string &quot;Tarball name: &quot; (concat (file-relative-name (car files)) &quot;.tar.gz&quot;))
		       files &quot;P&quot;)))
  (let ((tar (if arg
		 (if dired-guess-shell-gnutar
		     (concat dired-guess-shell-gnutar &quot; zcf %s %s&quot;)
		   &quot;tar cf - %2s | gzip &gt; %1s&quot;)
	       &quot;tar cf %s %s&quot;)))
    (shell-command (format tar tarname (mapconcat 'file-relative-name files &quot; &quot;)))))
(add-hook 'dired-load-hook (lambda () (define-key dired-mode-map &quot;T&quot; 'dired-tar)))
</code></pre></noscript></div>

これでtarballにまとめたいファイルをマークして<code>T</code>すればまとめてくれます。<code>C-u T</code>するとgzip圧縮までしてくれます。因みに解凍/展開はファイル上で<code>!</code>するとデフォルトコマンドが展開(<code>tar xzvf</code>など)になってるので専用コマンドは必要ありません。補足ですが個人用なのでテストとかしてません。一旦御自身で動作テストなどをされてから実行されることをお勧めします。</p>

<p>他にも色々なコマンドがたくさんあったので興味のある方は探求してみて下さい。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[octomacs.elを修正しました]]></title>
    <link href="http://KeenS.github.io/blog/2013/09/16/octomacs-el/"/>
    <updated>2013-09-16T21:24:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/09/16/octomacs-el</id>
    <content type="html"><![CDATA[<p>EmacsからOctopressに投稿できるOctomacs.elが最新版のrvm.elに対応してないようだったので修正してみました。</p>

<!-- more -->


<p>原因はOctomacs.elがrvm.elの内部で使われている関数を使っていたのですが、その関数が最新版で削除されていたからだったみたいです。</p>

<p>結論として、
```
*** /home/kim/.emacs.d/lisp/octomacs/octomacs.el    2013-09-16 22:29:14.498296762 +0900
&mdash;&ndash; /home/kim/.emacs.d/elpa/octomacs-20121026.1649/octomacs.el  2013-08-31 23:54:13.044373498 +0900</p>

<hr />

<p><strong>* 4,10 </strong>**
  ;;
  ;; Author: Jacob Helwig <a href="&#109;&#97;&#x69;&#108;&#x74;&#x6f;&#x3a;&#x6a;&#97;&#x63;&#x6f;&#x62;&#64;&#116;&#x65;&#x63;&#x68;&#x6e;&#x6f;&#x73;&#x6f;&#114;&#99;&#101;&#114;&#x79;&#46;&#x6e;&#101;&#116;">&#x6a;&#97;&#99;&#111;&#98;&#x40;&#x74;&#x65;&#99;&#104;&#110;&#x6f;&#x73;&#111;&#x72;&#99;&#x65;&#x72;&#121;&#46;&#110;&#x65;&#x74;</a>
  ;; Homepage: <a href="http://technosorcery.net">http://technosorcery.net</a>
! ;; Version: 0.0.1
  ;; URL: <a href="https://github.com/jhelwig/octomacs">https://github.com/jhelwig/octomacs</a>
  ;;
  ;;; License:
&mdash;&ndash; 4,11 &mdash;&mdash;
  ;;
  ;; Author: Jacob Helwig <a href="&#109;&#x61;&#x69;&#x6c;&#x74;&#111;&#x3a;&#x6a;&#97;&#x63;&#x6f;&#98;&#64;&#116;&#101;&#x63;&#104;&#110;&#111;&#115;&#x6f;&#114;&#x63;&#x65;&#114;&#121;&#x2e;&#110;&#101;&#116;">&#x6a;&#97;&#x63;&#x6f;&#x62;&#x40;&#x74;&#101;&#99;&#x68;&#110;&#111;&#115;&#111;&#114;&#99;&#x65;&#x72;&#121;&#x2e;&#x6e;&#x65;&#116;</a>
  ;; Homepage: <a href="http://technosorcery.net">http://technosorcery.net</a>
! ;; Version: 20121026.1649
! ;; X-Original-Version: 0.0.1
  ;; URL: <a href="https://github.com/jhelwig/octomacs">https://github.com/jhelwig/octomacs</a>
  ;;
  ;;; License:</p>

<hr />

<p><strong>* 133,146 </strong>**
  (defun octomacs-format-rake-task-with-args (task &amp;optional arguments)</p>

<pre><code>"Build a shell suitable string of the rake TASK name with the specified ARGUMENTS."
(let ((arguments-string (if arguments
</code></pre>

<p>!                               (format &ldquo;[%s]&rdquo; (if (listp arguments) (mapconcat &lsquo;octomacs-shell-escape-string arguments &ldquo;, &rdquo;) arguments))</p>

<pre><code>                          "")))
  (format "'%s%s'" task arguments-string)))
</code></pre>

<p>  (defun octomacs-rake-with-rvm (directory task &amp;optional arguments)</p>

<pre><code>"Run rake task TASK with specified ARGUMENTS in DIRECTORY using rvm"
(let* ((default-directory (file-name-as-directory (expand-file-name directory)))
</code></pre>

<p>!          (rvmrc-info (or (rvm&mdash;load-info-rvmrc) (rvm&mdash;load-info-ruby-version) (rvm&mdash;load-info-gemfile)))</p>

<pre><code>       (rvm-command (if rvmrc-info
                        (concat "rvm " (mapconcat 'identity rvmrc-info "@") " do ")
                      "")))
</code></pre>

<p>&mdash;&ndash; 134,148 &mdash;&mdash;
  (defun octomacs-format-rake-task-with-args (task &amp;optional arguments)</p>

<pre><code>"Build a shell suitable string of the rake TASK name with the specified ARGUMENTS."
(let ((arguments-string (if arguments
</code></pre>

<p>!                               (format &ldquo;[%s]&rdquo; (mapconcat &lsquo;octomacs-shell-escape-string arguments &ldquo;, &rdquo;))</p>

<pre><code>                          "")))
  (format "'%s%s'" task arguments-string)))
</code></pre>

<p>  (defun octomacs-rake-with-rvm (directory task &amp;optional arguments)</p>

<pre><code>"Run rake task TASK with specified ARGUMENTS in DIRECTORY using rvm"
(let* ((default-directory (file-name-as-directory (expand-file-name directory)))
</code></pre>

<p>!          (rvmrc-path (rvm&mdash;rvmrc-locate directory))
!          (rvmrc-info (if rvmrc-path (rvm&mdash;rvmrc-read-version rvmrc-path) nil))</p>

<pre><code>       (rvm-command (if rvmrc-info
                        (concat "rvm " (mapconcat 'identity rvmrc-info "@") " do ")
                      "")))
</code></pre>

<p>```</p>

<p>こんな感じです。これでちゃんと<code>.rvmrc</code>やら<code>.ruby-version</code>やら<code>.ruby-gemset</code>やらを反映してくれます。<a href="https://github.com/jhelwig/octomacs/pull/2">pull-req投げてみました</a>。初pull-reqです。英語心配です。</p>

<p>俺、pull-reqとりこまれたら<code>rake gen_deploy</code>にも挑戦するんだ…</p>

<p>あ、因みにこの投稿は<code>init.el</code>に</p>

<pre><code>(setq octomacs-workdir-alist '(("default" . "~/Ruby/octopress")))
</code></pre>

<p>して<code>octomacs-new-post</code>から投稿してます。</p>
]]></content>
  </entry>
  
</feed>
