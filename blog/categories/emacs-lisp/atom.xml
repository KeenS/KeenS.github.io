<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Emacs Lisp | κeenのHappy Hacκing Blog]]></title>
  <link href="http://KeenS.github.io/blog/categories/emacs-lisp/atom.xml" rel="self"/>
  <link href="http://KeenS.github.io/"/>
  <updated>2013-09-26T22:20:58+09:00</updated>
  <id>http://KeenS.github.io/</id>
  <author>
    <name><![CDATA[κeen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[octomacs.elを修正しました]]></title>
    <link href="http://KeenS.github.io/blog/2013/09/16/octomacs-el/"/>
    <updated>2013-09-16T21:24:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/09/16/octomacs-el</id>
    <content type="html"><![CDATA[<p>EmacsからOctopressに投稿できるOctomacs.elが最新版のrvm.elに対応してないようだったので修正してみました。</p>

<!-- more -->


<p>原因はOctomacs.elがrvm.elの内部で使われている関数を使っていたのですが、その関数が最新版で削除されていたからだったみたいです。</p>

<p>結論として、
```
*** /home/kim/.emacs.d/lisp/octomacs/octomacs.el    2013-09-16 22:29:14.498296762 +0900
&mdash;&ndash; /home/kim/.emacs.d/elpa/octomacs-20121026.1649/octomacs.el  2013-08-31 23:54:13.044373498 +0900</p>

<hr />

<p><strong>* 4,10 </strong>**
  ;;
  ;; Author: Jacob Helwig <a href="&#x6d;&#97;&#105;&#108;&#x74;&#x6f;&#x3a;&#106;&#97;&#99;&#111;&#x62;&#64;&#116;&#101;&#x63;&#x68;&#x6e;&#x6f;&#x73;&#111;&#114;&#99;&#101;&#114;&#121;&#46;&#x6e;&#x65;&#x74;">&#106;&#97;&#x63;&#x6f;&#98;&#x40;&#116;&#x65;&#x63;&#104;&#x6e;&#x6f;&#x73;&#x6f;&#x72;&#x63;&#x65;&#114;&#121;&#46;&#x6e;&#x65;&#116;</a>
  ;; Homepage: <a href="http://technosorcery.net">http://technosorcery.net</a>
! ;; Version: 0.0.1
  ;; URL: <a href="https://github.com/jhelwig/octomacs">https://github.com/jhelwig/octomacs</a>
  ;;
  ;;; License:
&mdash;&ndash; 4,11 &mdash;&mdash;
  ;;
  ;; Author: Jacob Helwig <a href="&#109;&#x61;&#105;&#108;&#x74;&#111;&#x3a;&#x6a;&#97;&#x63;&#111;&#x62;&#64;&#x74;&#101;&#x63;&#104;&#110;&#x6f;&#115;&#111;&#114;&#x63;&#x65;&#x72;&#121;&#46;&#x6e;&#x65;&#x74;">&#106;&#x61;&#99;&#111;&#x62;&#64;&#116;&#101;&#x63;&#x68;&#110;&#x6f;&#115;&#111;&#x72;&#99;&#x65;&#x72;&#x79;&#46;&#x6e;&#x65;&#x74;</a>
  ;; Homepage: <a href="http://technosorcery.net">http://technosorcery.net</a>
! ;; Version: 20121026.1649
! ;; X-Original-Version: 0.0.1
  ;; URL: <a href="https://github.com/jhelwig/octomacs">https://github.com/jhelwig/octomacs</a>
  ;;
  ;;; License:</p>

<hr />

<p><strong>* 133,146 </strong>**
  (defun octomacs-format-rake-task-with-args (task &amp;optional arguments)</p>

<pre><code>"Build a shell suitable string of the rake TASK name with the specified ARGUMENTS."
(let ((arguments-string (if arguments
</code></pre>

<p>!                               (format &ldquo;[%s]&rdquo; (if (listp arguments) (mapconcat &lsquo;octomacs-shell-escape-string arguments &ldquo;, &rdquo;) arguments))</p>

<pre><code>                          "")))
  (format "'%s%s'" task arguments-string)))
</code></pre>

<p>  (defun octomacs-rake-with-rvm (directory task &amp;optional arguments)</p>

<pre><code>"Run rake task TASK with specified ARGUMENTS in DIRECTORY using rvm"
(let* ((default-directory (file-name-as-directory (expand-file-name directory)))
</code></pre>

<p>!          (rvmrc-info (or (rvm&mdash;load-info-rvmrc) (rvm&mdash;load-info-ruby-version) (rvm&mdash;load-info-gemfile)))</p>

<pre><code>       (rvm-command (if rvmrc-info
                        (concat "rvm " (mapconcat 'identity rvmrc-info "@") " do ")
                      "")))
</code></pre>

<p>&mdash;&ndash; 134,148 &mdash;&mdash;
  (defun octomacs-format-rake-task-with-args (task &amp;optional arguments)</p>

<pre><code>"Build a shell suitable string of the rake TASK name with the specified ARGUMENTS."
(let ((arguments-string (if arguments
</code></pre>

<p>!                               (format &ldquo;[%s]&rdquo; (mapconcat &lsquo;octomacs-shell-escape-string arguments &ldquo;, &rdquo;))</p>

<pre><code>                          "")))
  (format "'%s%s'" task arguments-string)))
</code></pre>

<p>  (defun octomacs-rake-with-rvm (directory task &amp;optional arguments)</p>

<pre><code>"Run rake task TASK with specified ARGUMENTS in DIRECTORY using rvm"
(let* ((default-directory (file-name-as-directory (expand-file-name directory)))
</code></pre>

<p>!          (rvmrc-path (rvm&mdash;rvmrc-locate directory))
!          (rvmrc-info (if rvmrc-path (rvm&mdash;rvmrc-read-version rvmrc-path) nil))</p>

<pre><code>       (rvm-command (if rvmrc-info
                        (concat "rvm " (mapconcat 'identity rvmrc-info "@") " do ")
                      "")))
</code></pre>

<p>```</p>

<p>こんな感じです。これでちゃんと<code>.rvmrc</code>やら<code>.ruby-version</code>やら<code>.ruby-gemset</code>やらを反映してくれます。<a href="https://github.com/jhelwig/octomacs/pull/2">pull-req投げてみました</a>。初pull-reqです。英語心配です。</p>

<p>俺、pull-reqとりこまれたら<code>rake gen_deploy</code>にも挑戦するんだ…</p>

<p>あ、因みにこの投稿は<code>init.el</code>に</p>

<pre><code>(setq octomacs-workdir-alist '(("default" . "~/Ruby/octopress")))
</code></pre>

<p>して<code>octomacs-new-post</code>から投稿してます。</p>
]]></content>
  </entry>
  
</feed>
