<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="κeenです。
Idrisの入門記事ってあまりないなと思ったので少し書いてみます。
私は別にIdrisに詳しいわけではないので間違っているかもしれないことに注意してください。" />
        <meta property="og:title" content="Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://KeenS.github.io/blog/2019/01/07/idrisnyuumon__kazuatege_mu/" />
        <meta property="og:description" content="κeenです。
Idrisの入門記事ってあまりないなと思ったので少し書いてみます。
私は別にIdrisに詳しいわけではないので間違っているかもしれないことに注意してください。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/Idrisnyuumon__kazuatege_mu.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/Idrisnyuumon__kazuatege_mu.png" />
        
        <meta property="og:article:published_time" content="2019-01-07 03:44:57 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2019-01-07 03:44:57 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="https://KeenS.github.io/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://KeenS.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="https://KeenS.github.io/manifest.json">
        <link rel="mask-icon" href="https://KeenS.github.io/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="https://KeenS.github.io/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://KeenS.github.io/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="https://KeenS.github.io/about/"> About </a></li>
                        
                            <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                        
                            <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                        
                            <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                        
                            <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="https://KeenS.github.io/about/"> About </a></li>
                    
                        <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                    
                        <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                    
                        <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                    
                        <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">Idris入門: 数当てゲーム</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2019-01-07</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="https://KeenS.github.io/categories/idris">Idris</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/idris%e5%85%a5%e9%96%80">Idris入門</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>κeenです。
Idrisの入門記事ってあまりないなと思ったので少し書いてみます。
私は別にIdrisに詳しいわけではないので間違っているかもしれないことに注意してください。</p>
<p><a href="https://www.idris-lang.org/">Idris</a> は依存型を持つ汎用プログラミング言語で、Haskellっぽい文法や機能を持ちます。
依存型を持っていてかつ汎用のプログラミング言語というのがめずらしいのでその手の文脈ではだいたい名前が上がります。
Idrisの型システムはものすごく雑にいうと型がプログラム可能です。型を書く位置に関数を書いたり逆に型を値としてプログラムに渡したり出来ます。
これらの機能を使って型を詳細に書けるので正しい入力しか受け付けないぜ！みたいなことが書けます。</p>
<p>ところでIdrisに入門しようとすると難解な記事が多いのが現状です。
Idrisの関連記事はどうしても依存型に目が行ってしまうので普通のプログラミング言語としての紹介が中々見当たらないのです。
そこで今回は依存型の部分を完全に無視してプログラムを書いてみます。</p>
<p>対象読者はプログラミング言語を最低1つは理解している人に設定しますが、ぶっちゃけHaskell読める人(書けなくてもいい)じゃないときついよなーと思いつつ書いてます。<code>IO</code> とか <code>do</code> とか。</p>
<p>因みに一次情報として<a href="http://docs.idris-lang.org/en/latest/tutorial/index.html">公式チュートリアル</a>もあります。
HaskellやOCamlに馴染んでいる人向けに高速で言語機能を1巡りしています。</p>
<p>この記事ではIdris 1.3.1を使ってコードを書いていきます。</p>
<h1 id="はじめに">はじめに</h1>
<p>このチュートリアルは正直なところ題材があまりチュートリアル向きでないです。
もちろん「数当てゲーム」自体は簡単なプログラムですし出来上がるアプリケーションも小さなものです。
しかし純粋関数型言語であるIdrisで、ユーザとの連携や乱数取得という副作用の多いプログラムを書こうとすると色々な機能を使わざるを得ません。
そのため、1つのコードを説明するのに出てくる概念が多くなります。Haskellの入門書でも &ldquo;Hello World&rdquo; は後の方に出てくることが多いようです。
それを承知の上で、やっぱり動くアプリケーションを作らないと気がすまない人向けに「数当てゲーム」を実装するチュートリアルがこれです。</p>
<p>数当てゲームを簡単に説明すると、ゲームが立ち上がると裏で1から100までの数値(答え)を1つ決めます。
そしてユーザがなにか数値を入力します。
ユーザの入力が答えと一致したらその場でゲーム終了、違えば入力が答えより大きいか小さいかを教えてくれ、また入力を促します。</p>
<p>こういうゲームを作りながらIdrisを学んでいきます。</p>
<h1 id="環境構築">環境構築</h1>
<p><a href="https://keens.github.io/blog/2019/01/06/idriskankyoukouchiku/">別記事</a> 参照</p>
<h1 id="hello-world">Hello World</h1>
<p>まずは動くものを作りましょう。
<code>hello.idr</code> に以下を書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span><span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> putStrLn <span class="s">&#34;Hello world&#34;</span>
</span></span></code></pre></div><p>コンパイル、実行してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> idris hello.idr -o hello
</span></span><span class="line"><span class="cl"><span class="gp">$</span> ./hello
</span></span><span class="line"><span class="cl"><span class="go">Hello world
</span></span></span></code></pre></div><p>ひとまず動きました。</p>
<h2 id="hello-world解剖">Hello World解剖</h2>
<p>Idrisの値/関数定義は以下のような形をしています。
型と値で2行に分けて書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">名前</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">名前 <span class="ow">[</span>引数 <span class="ow">...]</span> <span class="ow">=</span> 値
</span></span></code></pre></div><p>先のプログラムの例でいくと <code>main</code> が名前、 <code>IO ()</code> が型、 <code>putStrLn &quot;Hello world&quot;</code> が値です。
<code>putStrLn &quot;Hello world&quot;</code> は <code>putStrLn</code> 関数に <code>&quot;Hello world&quot;</code> という値を渡しています。関数呼び出しに括弧は不要なので注意してください。</p>
<p>Idrisのプログラムは <code>main</code> から実行されます。</p>
<p>Cの <code>main</code> の返り値は <code>int</code> ですしJavaの <code>main</code> の返り値は <code>void</code> ですね。
Idrisの <code>main</code> はおおむね <code>()</code> 型を返していますが、<code>IO</code>というのがついています。
<code>IO ()</code> という書き方はJavaでいう <code>IO&lt;()&gt;</code> のように型パラメータを渡す記法です。
<code>IO</code> というのは出入力をするプログラムであることを表しています。
今回は出力をしていますね。
これについて踏み込むと<a href="https://ja.wikipedia.org/wiki/%E3%83%A2%E3%83%8A%E3%83%89_(%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9F%E3%83%B3%E3%82%B0)">モで始まる名状し難いなにか</a>が出てくるのですがその前に次のプログラムに進みましょう。</p>
<h1 id="入力を得る">入力を得る</h1>
<p>次は世界ではなくユーザに挨拶してみましょう。先程のプログラムを以下のように書換えます。
インデントは大事ですので変えないで下さいね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span><span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;What&#39;s your name? &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">name</span> <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  putStrLn <span class="ow">(</span><span class="s">&#34;Hello &#34;</span> <span class="ow">++</span> name<span class="ow">)</span>
</span></span></code></pre></div><p>このコードも先程と同様にコンパイル、実行できますが、今度はインタラクティブシェル(REPL)を使ってみます。
<code>idris</code> コマンドでREPLを起動し、 <code>:load hello.idr</code> でロード、 <code>:exec main</code> で <code>main</code> を実行します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> idris
</span></span><span class="line"><span class="cl"><span class="go">     ____    __     _
</span></span></span><span class="line"><span class="cl"><span class="go">    /  _/___/ /____(_)____
</span></span></span><span class="line"><span class="cl"><span class="go">    / // __  / ___/ / ___/     Version 1.3.1-git:1510fce92
</span></span></span><span class="line"><span class="cl"><span class="go">  _/ // /_/ / /  / (__  )      http://www.idris-lang.org/
</span></span></span><span class="line"><span class="cl"><span class="go"> /___/\__,_/_/  /_/____/       Type :? for help
</span></span></span><span class="line"><span class="cl"><span class="go"></span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="go">Idris is free software with ABSOLUTELY NO WARRANTY.
</span></span></span><span class="line"><span class="cl"><span class="go">For details type :warranty.
</span></span></span><span class="line"><span class="cl"><span class="go">Idris&gt; :load hello.idr
</span></span></span><span class="line"><span class="cl"><span class="go">*hello&gt; :exec main
</span></span></span><span class="line"><span class="cl"><span class="go">What&#39;s your name? keen
</span></span></span><span class="line"><span class="cl"><span class="go">Hello keen
</span></span></span></code></pre></div><p><code>:</code> ではじまるのはREPLのコマンドです。 <code>:help</code> で一覧が見れます。 REPLを終了する <code>:quit</code> 、 ロードしたファイルの変更を監視してリロードする <code>:watch</code> などがあります。
今後は実行方法は指定しないので好きな方法で実行して下さい。</p>
<p>さて、先程のプログラムを解説しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span><span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;What&#39;s your name? &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">name</span> <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  putStrLn <span class="ow">(</span><span class="s">&#34;Hello &#34;</span> <span class="ow">++</span> name<span class="ow">)</span>
</span></span></code></pre></div><p>新しく登場した <code>putStr</code> 、 <code>getLine</code> の関数については説明不要ですかね。
<code>do</code> と <code>&lt;-</code> について解説します。</p>
<p><code>do</code> を正確に説明するにはそこそこの前提知識が必要なので雰囲気で説明します。
<code>do</code> はプログラムを連接するときに使う記法です。
<code>do</code> は<a href="https://ja.wikipedia.org/wiki/%E3%82%AA%E3%83%95%E3%82%B5%E3%82%A4%E3%83%89%E3%83%AB%E3%83%BC%E3%83%AB">オフサイドルール</a>でブロックが書けるのでここでは続く3行を連接しています。
以下のように波括弧で括ったりさらにセミコロンをつけても同じことです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span><span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> <span class="kr">do</span> <span class="ow">{</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;What&#39;s your name? &#34;</span>;
</span></span><span class="line"><span class="cl">  <span class="kr">name</span> <span class="ow">&lt;-</span> getLine;
</span></span><span class="line"><span class="cl">  putStrLn <span class="ow">(</span><span class="s">&#34;Hello &#34;</span> <span class="ow">++</span> name<span class="ow">)</span>;
</span></span><span class="line"><span class="cl"><span class="ow">}</span>
</span></span></code></pre></div><p>複数行のプログラムを書くだけでもったいぶってるようですが、Idrisは純粋関数型言語なのでIOのように純粋でない操作は特別な対処をしてあげないといけないのです。
Idrisは純粋なのでIOや値の変更などができません。
じゃあさっき書いたプログラムはどうなってるんだと思いますよね。
<code>main</code> に書いたのは「IOを行うプログラム」という <strong>値</strong> です。よく考えてみると <code>main</code> には引数がありませんでしたよね。 <code>main</code> は関数ではなく値です。
値を書いただけなので副作用はありません。
Idrisのランタイムが <code>main</code> に書いてある値を読み取って勝手にIOを実行しただけです。</p>
<p>屁理屈じみてますが、これで純粋性との折り合いが付いているようです。実際、<code>main</code> 以外ではIOを行えないので純粋性は保たれますしね。
しかし <code>main</code> に値として渡さないと実行されないので複数回IOをするときに困ります。値は1つだけなので複数のIOをするプログラムを1まとめにしてmainに渡さないといけません。
そこで <code>do</code> は複数の(ある条件を満たした)値を1つに連接する働きをします。</p>
<p>繰り返しますが、雰囲気で説明しています。いつか正確な説明を受けて下さい。</p>
<p>ここでの <code>do</code> が何を連接しているか確認するためにREPLで今回使った3つの関数の型を見てみましょう。
<code>:t &lt;expr&gt;</code> あるいは <code>:type &lt;expr&gt;</code> で式の型が見れます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*hello&gt; :t putStr
</span></span><span class="line"><span class="cl">putStr : String -&gt; IO ()
</span></span><span class="line"><span class="cl">*hello&gt; :t getLine
</span></span><span class="line"><span class="cl">getLine : IO String
</span></span><span class="line"><span class="cl">*hello&gt; :t putStrLn
</span></span><span class="line"><span class="cl">putStrLn : String -&gt; IO ()
</span></span></code></pre></div><p><code>-&gt;</code> は関数の型で、 <code>String -&gt; IO ()</code> は「<code>String</code> を受け取って <code>IO ()</code> を返す関数」という意味の型です。
引数を埋めたあとだと今回の <code>do</code> は <code>IO ()</code> 、 <code>IO String</code> 、 <code>IO ()</code> を繋げています。
<code>IO ()</code> は「IOをして <code>()</code> を返すプログラム」、 <code>IO String</code> は 「IOをして <code>String</code> を返すプログラム」です。</p>
<p>ここでようやく <code>&lt;-</code> の説明ができます。
プログラムを合成するときに前のプログラムが返した値を取り出したいですよね。
それをするのが <code>&lt;-</code> です。</p>
<p>ここまできたら先程のプログラムは理解できるかと思います。 因みに <code>++</code> はここでは文字列の連結です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span><span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;What&#39;s your name? &#34;</span>
</span></span><span class="line"><span class="cl">  <span class="kr">name</span> <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  putStrLn <span class="ow">(</span><span class="s">&#34;Hello &#34;</span> <span class="ow">++</span> name<span class="ow">)</span>
</span></span></code></pre></div><h1 id="ビルドシステム">ビルドシステム</h1>
<p>Idrisには一応<a href="http://docs.idris-lang.org/en/latest/reference/packages.html">パッケージシステム</a>が付いています。
パッケージシステムとはいってもインターネットから依存をダウンロードしたりはできません。しかしビルドだけならこれで十分です。</p>
<p>数当てゲームのパッケージを作りましょう。
プロジェクトテンプレートを作る機能はないので自分で作ります。
以下のようなディレクトリ構成でディレクトリを作りましょう。</p>
<pre tabindex="0"><code>├── idris-guessing-game.ipkg
└── src
    └── Main.idr
</code></pre><p>idris-guessing-game.ipkgには以下を書きます。内容はコメントから推察して下さい。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">package idris-guessing-game
</span></span><span class="line"><span class="cl">-- バッケージ名
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">-- ソースコードの場所
</span></span><span class="line"><span class="cl">sourcedir = src
</span></span><span class="line"><span class="cl">-- ビルドするモジュール(ファイル名)
</span></span><span class="line"><span class="cl">modules = Main
</span></span><span class="line"><span class="cl">-- 生成する実行可能ファイルの名前
</span></span><span class="line"><span class="cl">executable = &#34;guessing_game&#34;
</span></span><span class="line"><span class="cl">-- `Main.main` を定義するモジュール(ファイル名)
</span></span><span class="line"><span class="cl">main = Main
</span></span></code></pre></div><p>Main.idrには以下を書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">module</span> <span class="nn">Main</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> putStrLn <span class="s">&#34;Hello ipkg&#34;</span>
</span></span></code></pre></div><p>今まで出てこなかった <code>module</code> というのがでてきましたね。名前空間です。
なくても動きますし、ファイル名と関連づく必要もないです。しかしソースディレクトリの <code>Foo/Bar.idr</code> ファイル内には <code>module Foo.Bar</code> を書くことが多いようです。
モジュール名は自由ですが、バイナリを作る際は <code>Main</code> モジュールに <code>main</code> を書く必要があります。</p>
<p>さて、これをビルドしましょう。 <code>idris --build idris-guessing-game.ipkg </code> でできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> idris --build idris-guessing-game.ipkg
</span></span><span class="line"><span class="cl"><span class="go">Entering directory `./src&#39;
</span></span></span><span class="line"><span class="cl"><span class="go">Type checking ./Main.idr
</span></span></span><span class="line"><span class="cl"><span class="go">Leaving directory `./src&#39;
</span></span></span></code></pre></div><p>成功すれば <code>guessing_game</code> という名前で実行可能ファイルができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-console" data-lang="console"><span class="line"><span class="cl"><span class="gp">$</span> ./guessing_game
</span></span><span class="line"><span class="cl"><span class="go">Hello ipkg
</span></span></span></code></pre></div><p>ビルドできました。</p>
<p>因みに ipkg ファイルを書いておくとだいたいのエディタプラグインはそれを読み込んでくれるようです。
また、REPLを起動するのも <code>idris --repl hoge.ipkg</code> のようにipkgファイルを指定してプロジェクトを読み込めます。</p>
<p>さて、プロジェクトができたのでこのままゲームを開発していきます。</p>
<h1 id="数字を得る">数字を得る</h1>
<p>最初の例で文字列を取得できたので今度は文字列を数値にしてみます。
<a href="https://www.idris-lang.org/docs/current/base_doc/">base</a>ライブラリの<a href="https://www.idris-lang.org/docs/current/base_doc/docs/Data.String.html"><code>Data.String</code></a>にある<a href="https://www.idris-lang.org/docs/current/base_doc/docs/Data.String.html"><code>parsePositive</code></a>が目的のもののようです。
これは一度REPLで試した方が良いでしょう。
一旦REPLに <code>Data.String</code> をロードします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Idris&gt; :module Data.String
</span></span></code></pre></div><p><code>parsePositive</code> は <code>String</code> を受け取って <code>Maybe Integer</code> を返す関数です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">*Data/String&gt; parsePositive
</span></span><span class="line"><span class="cl">parsePositive : String -&gt; Maybe Integer
</span></span></code></pre></div><p><code>Maybe</code> は他言語で言うところのNullableとかOptionalとかに相当します。
値がある <code>Just</code> か、値がない <code>Nothing</code> のどちらかです。
REPLで入力を与えてみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="ow">*</span><span class="kt">Data</span><span class="ow">/</span><span class="kt">String</span><span class="ow">&gt;</span> parsePositive  <span class="s">&#34;10&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">10</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl"><span class="ow">*</span><span class="kt">Data</span><span class="ow">/</span><span class="kt">String</span><span class="ow">&gt;</span> parsePositive  <span class="s">&#34;-1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Nothing</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl"><span class="ow">*</span><span class="kt">Data</span><span class="ow">/</span><span class="kt">String</span><span class="ow">&gt;</span> parsePositive  <span class="s">&#34;0&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">0</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl"><span class="ow">*</span><span class="kt">Data</span><span class="ow">/</span><span class="kt">String</span><span class="ow">&gt;</span> parsePositive  <span class="s">&#34;100&#34;</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">100</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl"><span class="ow">*</span><span class="kt">Data</span><span class="ow">/</span><span class="kt">String</span><span class="ow">&gt;</span> parsePositive  <span class="s">&#34;hoge&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Nothing</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>これを使ってユーザから数値を得るプログラムを書きます。
ところで、 <code>parsePositive</code> の返り値が <code>Just</code> か <code>Nothing</code> かで場合分けが必要ですよね。
<code>case</code> 式をみてみましょう。</p>
<h2 id="case-による条件分岐"><code>case</code> による条件分岐</h2>
<p>Idrisには <code>if</code> 式もありますが <code>case</code> をみてみます。
<code>case</code> は以下のような構文で使います</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">case</span> 条件 <span class="kr">of</span>
</span></span><span class="line"><span class="cl">  パターン1 <span class="ow">=&gt;</span> 式1
</span></span><span class="line"><span class="cl">  パターン2 <span class="ow">=&gt;</span> 式2
</span></span><span class="line"><span class="cl">  <span class="ow">...</span>
</span></span></code></pre></div><p>ここでもオフサイドルールが適用されます。
これを使ってひとまず「ユーザから得た入力が正の数値ならそれを、そうでなければ<code>-1</code>を返す」アクションを作ってみましょう。
これは <code>IO</code> のアクションで、返り値が整数なので型は <code>IO Integer</code> になります。
素朴に書くとこうなりそうですかね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nn">Data.String</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- これはコンパイルエラー</span>
</span></span><span class="line"><span class="cl"><span class="nf">getInteger</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">getInteger <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;guess a number: &#34;</span>
</span></span><span class="line"><span class="cl">  n <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> parsePositive n <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Just</span> n <span class="ow">=&gt;</span> n
</span></span><span class="line"><span class="cl">    <span class="kt">Nothing</span> <span class="ow">=&gt;</span> <span class="ow">-</span><span class="mi">1</span>
</span></span></code></pre></div><p>しかしこれはエラーです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Entering directory `./src&#39;
</span></span><span class="line"><span class="cl">Type checking ./Main.idr
</span></span><span class="line"><span class="cl">Main.idr:10:15:
</span></span><span class="line"><span class="cl">   |
</span></span><span class="line"><span class="cl">10 |     Just n =&gt; n
</span></span><span class="line"><span class="cl">   |               ^
</span></span><span class="line"><span class="cl">When checking right hand side of Main.case block in getInteger at Main.idr:9:9-22 with expected type
</span></span><span class="line"><span class="cl">        IO Integer
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Type mismatch between
</span></span><span class="line"><span class="cl">        Integer (Type of n)
</span></span><span class="line"><span class="cl">and
</span></span><span class="line"><span class="cl">        IO Integer (Expected type)
</span></span></code></pre></div><p><code>do</code> 記法で <code>IO</code> アクションを合成しようとしているのに <code>case</code> から整数値を返しているのでエラーになっているのです。
これは整数値の方を <code>IO</code> に合わせてあげると解決します。純粋な値から <code>IO</code> に合わせるには <code>pure</code> 関数を使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getInteger</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">getInteger <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;guess a number: &#34;</span>
</span></span><span class="line"><span class="cl">  n <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> parsePositive n <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Just</span> n <span class="ow">=&gt;</span> pure n
</span></span><span class="line"><span class="cl">    <span class="kt">Nothing</span> <span class="ow">=&gt;</span> pure <span class="ow">(-</span><span class="mi">1</span><span class="ow">)</span>
</span></span></code></pre></div><p><code>-</code> が減算演算子と解釈されないように括弧が必要ですが素直にこれで動きます。</p>
<p>さて、取得はできたのですが数値以外が入力されたら <code>-1</code> が返ってしまいます。
数値以外が入力されたらもう一度入力を促すようにしましょう。これにはループが必要です。</p>
<h2 id="ループ">ループ</h2>
<p>Idrisは関数型言語なので制御構造のループはないです。関数をもう一度呼ぶとループになります。
<code>case</code> の <code>Nothing</code> の部分で <code>getInteger</code> を呼びましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getInteger</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">getInteger <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  putStr <span class="s">&#34;guess a number: &#34;</span>
</span></span><span class="line"><span class="cl">  n <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> parsePositive n <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Just</span> n <span class="ow">=&gt;</span> pure n
</span></span><span class="line"><span class="cl">    <span class="kt">Nothing</span> <span class="ow">=&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">      putStrLn <span class="ow">(</span>n <span class="ow">++</span> <span class="s">&#34; is not a number.&#34;</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">      getInteger
</span></span></code></pre></div><p>厳密にいうと <code>getInteger</code> は引数を取らないので関数ではなく値なのですが、まあ細かいことはいいですよね。</p>
<h1 id="ゲーム">ゲーム</h1>
<p>ここまできたら一気にゲームを書けそうです。
因みにユーザの入力値と秘密の値の比較結果には「小さい」、「合った」、「大きい」の3種類がありますね。そういう用途には <code>compare</code> 関数が便利です。2値を比較して <code>LT</code> 、 <code>EQ</code> 、 <code>GT</code> のいずれかを返してくれます</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">λΠ&gt; compare 1 1
</span></span><span class="line"><span class="cl">EQ : Ordering
</span></span><span class="line"><span class="cl">λΠ&gt; compare 1 2
</span></span><span class="line"><span class="cl">LT : Ordering
</span></span><span class="line"><span class="cl">λΠ&gt; compare  2 1
</span></span><span class="line"><span class="cl">GT : Ordering
</span></span></code></pre></div><p>これを使ってゲームはこう書けます。ただし秘密の数字は適当に渡ってくるものとします。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">game</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">game secret <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  n <span class="ow">&lt;-</span> getInteger
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> compare n secret <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">LT</span> <span class="ow">=&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">      putStrLn <span class="s">&#34;Too small&#34;</span>
</span></span><span class="line"><span class="cl">      game secret
</span></span><span class="line"><span class="cl">    <span class="kt">EQ</span> <span class="ow">=&gt;</span> putStrLn <span class="s">&#34;You got it&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">GT</span> <span class="ow">=&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">      putStrLn <span class="s">&#34;Too big&#34;</span>
</span></span><span class="line"><span class="cl">      game secret
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">-- 秘密の数字を適当に渡す</span>
</span></span><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> game <span class="mi">42</span>
</span></span></code></pre></div><p>これで秘密の数値が固定な以外はゲームが動くようになりました。
最後に秘密の数値を乱数にしましょう。これには一仕事必要です。</p>
<h1 id="ファイルio">ファイルIO</h1>
<p>UNIX系システムでは <code>/dev/random</code> ファイルを読むと乱数が得られます。Windowsは私は詳しくないので適当に調べてください。ここから4バイトほど読み出して乱数を取得しましょう。
ファイルIOは <code>Prelude.File</code> に多少の操作が定義されています。</p>
<p>今回使うのは <code>openFile</code> 、 <code>fGetChars</code> 、 <code>closeFile</code> です。REPLでドキュメントをみてみましょう。
ドキュメントを読んでびっくりしたのですがバイト(列)を読み出すAPIがないみたいなので <code>fGetChars</code> で文字として読み出してから数値に変換します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">λΠ&gt; :doc openFile
</span></span><span class="line"><span class="cl">Prelude.File.openFile : (f : String) -&gt; (m : Mode) -&gt; IO (Either FileError File)
</span></span><span class="line"><span class="cl">    Open a file
</span></span><span class="line"><span class="cl">    Arguments:
</span></span><span class="line"><span class="cl">        f : String  -- the filename
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        m : Mode  -- the mode; either Read, WriteTruncate, Append, ReadWrite,
</span></span><span class="line"><span class="cl">        ReadWriteTruncate, or ReadAppend
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    The function is Total
</span></span><span class="line"><span class="cl">λΠ&gt; :doc Mode
</span></span><span class="line"><span class="cl">Data type Prelude.File.Mode : Type
</span></span><span class="line"><span class="cl">    Modes for opening files
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">Constructors:
</span></span><span class="line"><span class="cl">    Read : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    WriteTruncate : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    Append : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    ReadWrite : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    ReadWriteTruncate : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    ReadAppend : Mode
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">λΠ&gt; :doc fGetChars
</span></span><span class="line"><span class="cl">Prelude.File.fGetChars : (h : File) -&gt;
</span></span><span class="line"><span class="cl">    (len : Int) -&gt; IO (Either FileError String)
</span></span><span class="line"><span class="cl">    Read up to a number of characters from a file
</span></span><span class="line"><span class="cl">    Arguments:
</span></span><span class="line"><span class="cl">        h : File  -- a file handle which must be open for reading
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">    The function is Total
</span></span><span class="line"><span class="cl">λΠ&gt; :doc closeFile
</span></span><span class="line"><span class="cl">Prelude.File.closeFile : File -&gt; IO ()
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    The function is Total
</span></span></code></pre></div><p><code>openFile</code> の返り値に出てくる <code>File</code> というのがファイルハンドルを表すデータ型です。 <code>FileError</code> は名前の通りエラーですね。
<code>Mode</code> はドキュメントの通りファイルを開く時のモードです。今回は <code>Read</code> が必要なもののようです。</p>
<p>ところで地味にここで初めて2引数関数がでてきましたね。
<code>T -&gt; U -&gt; S</code> で概ね「<code>T</code> 型の値と <code>U</code> 型の値を受け取って <code>S</code> 型の返り値を返す関数」の意味です。本当は違います。気になる人は「カリー化」でググってみて下さい。役に立たない情報がいくらでもでてきます。
2引数の関数を呼び出すときは <code>openFile &quot;/dev/random&quot; Read</code> のようにスペースを空けて引数を並べます。これも本当は違います。同様にググってみて下さい。</p>
<p>上記以外で初めて出てきたのは <code>Either</code> でしようか。それについて軽く紹介します。</p>
<h2 id="either"><code>Either</code></h2>
<p><code>Either</code> はパラメータを2つ取るデータ型です。 <code>Either E T</code> は Java風に書けばだいたい <code>Either&lt;E, T&gt;</code> になります。
この型は名前通りに「<code>E</code> 型の値、もしくは <code>T</code> 型の値」を表すデータ型です。
例えば <code>Integer</code> と <code>String</code> を混ぜて扱うことができるのです。以下の例を見てみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">tryParse</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Either</span> <span class="kt">String</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">tryParse input <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> parsePositive input <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- パースに失敗したら `String` 型の値。`Left` で `Either` にする</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Maybe</span> <span class="ow">=&gt;</span> <span class="kt">Left</span> input
</span></span><span class="line"><span class="cl">    <span class="c1">-- パースに成功したら `Integer` 型の値。 `Right` で `Either` にする</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Just</span> n <span class="ow">=&gt;</span> <span class="kt">Right</span> n
</span></span></code></pre></div><p>さて、この <code>Either</code> の使い道ですが、エラーの扱いでよくでてきます。
多くの関数は「失敗してエラー値を返す、または成功して正常値を返す」という挙動をするので <code>Either</code> がもってこいなのです。</p>
<p>元の <code>openFile</code> を見てみると <code>Either FileError File</code> とエラー値、または正常値を返していますね。例外ではないのでエラーも値として扱えます。
慣習的に左 (<code>Left</code>) がエラー値、 右 (<code>Right</code>) が正常値を表します。
一部のAPIも右だけ優遇されていたりします。</p>
<h2 id="読み出す">読み出す</h2>
<p><code>Either</code> について理解したのでひとまずファイルを開くところまでは一気に書けそうですね。
<code>openFile</code> の返り値が <code>Either</code> なので <code>case</code> で分岐してあげます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getRandom</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">getRandom <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  efile <span class="ow">&lt;-</span> openFile <span class="s">&#34;/dev/random&#34;</span> <span class="kt">Read</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> efile <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Right</span> file <span class="ow">=&gt;</span> <span class="ow">?</span><span class="kt">Unimplemented</span>
</span></span></code></pre></div><p>因みに <code>Int</code> は固定精度整数、 <code>Integer</code> は任意精度整数です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">λΠ&gt; :doc Int
</span></span><span class="line"><span class="cl">Primitive type Int : Type
</span></span><span class="line"><span class="cl">    Fixed-precision integers of undefined size
</span></span><span class="line"><span class="cl">λΠ&gt; :doc Integer
</span></span><span class="line"><span class="cl">Primitive type Integer : Type
</span></span><span class="line"><span class="cl">    Arbitrary-precision integers
</span></span></code></pre></div><p>流石に任意長の乱数を取得してると終わらないので固定長にします。あとで <code>Integer</code> に変換して使います。
さて、ここから処理が続きます。 <code>fGetChars</code> で読み出します。返り値の<code>Either</code>から同じく分岐で文字列を取り出します。
上の <code>?Unimplemented</code> の部分をこう書換えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">do</span>
</span></span><span class="line"><span class="cl">   echars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">   <span class="kr">case</span> echars <span class="kr">of</span>
</span></span><span class="line"><span class="cl">     <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">     <span class="kt">Right</span> chars <span class="ow">=&gt;</span> <span class="ow">?</span><span class="kt">Unimplemented</span>
</span></span></code></pre></div><p><code>Char</code> と <code>Int</code> のサイズはわからないのですが、 4文字くらい読んだらそれなりのサイズの乱数になるだろうという判断で4文字読み取ります。
文字列を取り出した後は普通の処理です。次に進みましょう。</p>
<h2 id="文字列処理">文字列処理</h2>
<p>文字列から数値に変換しましょう。
<code>unpack</code>, <code>ord</code> などで文字列から数値の列に変換します。
まずはREPLで挙動を試してみましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">λΠ&gt; unpack &#34;1234&#34;
</span></span><span class="line"><span class="cl">[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;] : List Char
</span></span><span class="line"><span class="cl">λΠ&gt; map ord (unpack &#34;1234&#34;)
</span></span><span class="line"><span class="cl">[49, 50, 51, 52] : List Int
</span></span></code></pre></div><p><code>map</code> が出てきましたがこれは多くの言語にも似たような関数があるので分かるかと思います。</p>
<p>次は数値の列をバイト列として結合して1つの数値にします。
Javaならだいたいこんな感じの処理になりますかね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kt">int</span><span class="w"> </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">0</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">intList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">acc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">acc</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">return</span><span class="w"> </span><span class="n">acc</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>関数型言語ではループは関数で書くのでした。
ループを関数で書くとこういう感じになりますかね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="c1">-- `loop 0 intList` と呼ばれることを想定</span>
</span></span><span class="line"><span class="cl"><span class="nf">loop</span> <span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">loop acc intList <span class="ow">=</span> <span class="kr">case</span> intList <span class="kr">of</span>
</span></span><span class="line"><span class="cl">  <span class="ow">[]</span> <span class="ow">=&gt;</span> acc
</span></span><span class="line"><span class="cl">  <span class="nf">i</span> <span class="ow">::</span> intList <span class="ow">=&gt;</span> loop <span class="ow">((</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> i<span class="ow">)</span> intList
</span></span></code></pre></div><p>しかしこういう処理はあまりに定形すぎます。そこで <code>foldl</code> という専用の関数が用意されています。
<code>loop 0 intList</code> 相当の処理はこう書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">foldl <span class="ow">(\</span>acc, i <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> i<span class="ow">)</span> <span class="mi">0</span> intList
</span></span></code></pre></div><p><code>\引数1, .. ,引数n =&gt; 本体</code> はクロージャの構文です。</p>
<p>これをREPLで試してみましょう</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">λΠ&gt; foldl (\acc, i =&gt; (shiftL acc 8) + i) 0 (map ord (unpack &#34;1234&#34;))
</span></span><span class="line"><span class="cl">825373492 : Int
</span></span></code></pre></div><p>結果、<code>getRandom</code> はこうなります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getRandom</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">getRandom <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  efile <span class="ow">&lt;-</span> openFile <span class="s">&#34;/dev/random&#34;</span> <span class="kt">Read</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> efile <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Right</span> file <span class="ow">=&gt;</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">      echars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">      <span class="kr">case</span> echars <span class="kr">of</span>
</span></span><span class="line"><span class="cl">        <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">        <span class="kt">Right</span> chars <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Right</span> <span class="ow">(</span>foldl <span class="ow">(\</span>acc, i <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> i<span class="ow">)</span> <span class="mi">0</span> <span class="ow">(</span>map ord <span class="ow">(</span>unpack chars<span class="ow">))))</span>
</span></span></code></pre></div><h2 id="結合">結合</h2>
<p><code>main</code> で <code>getRandom</code> を使いましょう。
<code>getRandom</code> はエラーを返す可能性がありますが、その場合は無言で終了しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">main : IO ()
</span></span><span class="line"><span class="cl">main = do
</span></span><span class="line"><span class="cl">  eint &lt;- getRandom
</span></span><span class="line"><span class="cl">  case eint of
</span></span><span class="line"><span class="cl">    -- エラーが起きたらそのまま終了する
</span></span><span class="line"><span class="cl">    Left _ =&gt; pure ()
</span></span><span class="line"><span class="cl">    Right int =&gt; game (cast (1 + (mod int 100)))
</span></span></code></pre></div><p>1から100までの数値が欲しいので <code>(1 + (mod int 100))</code> と計算しています。
<code>cast</code> は型変換をする関数です。ここでは <code>Int</code> から <code>Integer</code> に変換します。
これで動かしてみましょう。</p>
<p>1回目</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">guess a number: 50
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 25
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 12
</span></span><span class="line"><span class="cl">Too small
</span></span><span class="line"><span class="cl">guess a number: 16
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 14
</span></span><span class="line"><span class="cl">Too small
</span></span><span class="line"><span class="cl">guess a number: 15
</span></span><span class="line"><span class="cl">You got it
</span></span></code></pre></div><p>2回目</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">guess a number: 50
</span></span><span class="line"><span class="cl">Too small
</span></span><span class="line"><span class="cl">guess a number: 75
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 63
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 56
</span></span><span class="line"><span class="cl">Too small
</span></span><span class="line"><span class="cl">guess a number: 60
</span></span><span class="line"><span class="cl">Too big
</span></span><span class="line"><span class="cl">guess a number: 58
</span></span><span class="line"><span class="cl">Too small
</span></span><span class="line"><span class="cl">guess a number: 59
</span></span><span class="line"><span class="cl">You got it
</span></span></code></pre></div><p>うまく動いているようです。
ゲームは完成しました。
しかし少しコードが不格好ですね。それに開いた <code>/dev/random</code> を閉じ忘れてます。
もう少しIdrisの機能に踏み込んでリファクタリングしましょう。</p>
<h1 id="リファクタリング">リファクタリング</h1>
<p>いくつかのIdrisの構文や機能を使いながらリファクタリングしていきます。</p>
<h2 id="where"><code>where</code></h2>
<p>関数の中で使う関数を定義できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">関数定義
</span></span><span class="line"><span class="cl"><span class="kr">where</span>
</span></span><span class="line"><span class="cl">  サブ関数定義
</span></span></code></pre></div><p>の構文です。
<code>getRandom</code> の中で文字列から数値に変換する部分を関数として抜き出しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="c1">--  ...</span>
</span></span><span class="line"><span class="cl">        <span class="kt">Right</span> chars <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Right</span> <span class="ow">(</span>stringToInt chars<span class="ow">))</span>
</span></span><span class="line"><span class="cl"><span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stringToInt</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  stringToInt chars <span class="ow">=</span> foldl <span class="ow">(\</span>acc, int <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> int<span class="ow">)</span> <span class="mi">0</span> <span class="ow">(</span>map ord <span class="ow">(</span>unpack chars<span class="ow">))</span>
</span></span></code></pre></div><p>さらにファイルから数値を読み出す関数も用意しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">  <span class="nf">fGetInt</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">  fGetInt file <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">    echars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="kr">case</span> echars <span class="kr">of</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Right</span> chars <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Right</span> <span class="ow">(</span>stringToInt chars<span class="ow">))</span>
</span></span></code></pre></div><p>全体として <code>getRandom</code> はこうなります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getRandom</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">getRandom <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  efile <span class="ow">&lt;-</span> openFile <span class="s">&#34;/dev/random&#34;</span> <span class="kt">Read</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> efile <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Right</span> file <span class="ow">=&gt;</span> fGetInt file
</span></span><span class="line"><span class="cl"><span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stringToInt</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  stringToInt chars <span class="ow">=</span> foldl <span class="ow">(\</span>acc, int <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> int<span class="ow">)</span> <span class="mi">0</span> <span class="ow">(</span>map ord <span class="ow">(</span>unpack chars<span class="ow">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">fGetInt</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">  fGetInt file <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">    echars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">    <span class="kr">case</span> echars <span class="kr">of</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">      <span class="kt">Right</span> chars <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Right</span> <span class="ow">(</span>stringToInt chars<span class="ow">))</span>
</span></span></code></pre></div><p>これは <code>where</code> の紹介のために使ったので別にサブ関数にせずに独立した関数でもよかったかもしれません。</p>
<h2 id="ガード">ガード</h2>
<p>何箇所かで <code>case .. of Left e =&gt; pure (Left e)</code> と書かれていますね。これはもう少し楽に書けます。
<code>do</code> の中で <code>&lt;-</code> を取り出すときに同時にパターンマッチできるのです。そしてマッチに失敗したら即座に返ります。返るときの値も自分で指定できます。
<code>fGetInt</code> をこう書き直しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">  <span class="nf">fGetInt</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">  fGetInt file <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">    <span class="c1">-- Rightにマッチしたら値を取り出す。失敗したら(= Leftだったら) 別の値で即座に返る</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Right</span> chars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">      <span class="ow">|</span> <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    pure <span class="ow">(</span><span class="kt">Right</span> <span class="ow">(</span>stringToInt chars<span class="ow">))</span>
</span></span></code></pre></div><p>ネストが減って楽になりました。</p>
<h2 id="heading"><code>$</code></h2>
<p><code>stringToInt</code> 、括弧が多くてカッコ悪いですよね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">stringToInt chars <span class="ow">=</span> foldl <span class="ow">(\</span>acc, int <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> int<span class="ow">)</span> <span class="mi">0</span> <span class="ow">(</span>map ord <span class="ow">(</span>unpack chars<span class="ow">))</span>
</span></span></code></pre></div><p>idrisには <code>$</code> という演算子があります。これは末尾まで続く括弧を省略できる演算子です。
以下の2つの式は等価です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">map ord <span class="ow">(</span>unpack chars<span class="ow">)</span>
</span></span><span class="line"><span class="cl">map ord <span class="ow">$</span> unpack chars
</span></span></code></pre></div><p>括弧と違って「どこまで続くんだ」と考えながら読まなくていいので読みやすくなります。
ということで <code>stringToInt</code> はこう書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">stringToInt chars <span class="ow">=</span> foldl <span class="ow">(\</span>acc, int <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> int<span class="ow">)</span> <span class="mi">0</span> <span class="ow">$</span> map ord <span class="ow">$</span> unpack chars
</span></span></code></pre></div><p>同様に書換えられる箇所はいくつもあるでしょう。</p>
<h2 id="ファイルを閉じる">ファイルを閉じる</h2>
<p>閉じ忘れていたファイルを閉じましょう。
ファイル操作は例外を投げなかったのでシンプルに「開く→処理する→閉じる」でよさそうです。
これは一般的な操作なので関数として定義してしまいましょう。
「処理する」の部分だけ変えられるように関数で受け取ることにして、 <code>withOpenFile</code> 関数をこう定義しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">withOpenFile</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Mode</span> <span class="ow">-&gt;</span> <span class="ow">(</span><span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> a<span class="ow">))</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> a<span class="ow">)</span>
</span></span><span class="line"><span class="cl">withOpenFile filename mode f <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  <span class="kt">Right</span> file <span class="ow">&lt;-</span> openFile filename mode
</span></span><span class="line"><span class="cl">    <span class="ow">|</span> <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">  ret <span class="ow">&lt;-</span> f file
</span></span><span class="line"><span class="cl">  closeFile file
</span></span><span class="line"><span class="cl">  pure ret
</span></span></code></pre></div><p>説明がなくてもだいたい読めるようになったと思います。 <code>a</code> は型変数です。要するにジェネリクスですね。</p>
<p>さて、 <code>withOpenFile</code> を使って <code>getRandom</code> を書き直しましょう。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getRandom</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">getRandom <span class="ow">=</span> withOpenFile <span class="s">&#34;/dev/random&#34;</span> <span class="kt">Read</span> fGetInt
</span></span><span class="line"><span class="cl"><span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">stringToInt</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  stringToInt chars <span class="ow">=</span> foldl <span class="ow">(\</span>acc, int <span class="ow">=&gt;</span> <span class="ow">(</span>shiftL acc <span class="mi">8</span><span class="ow">)</span> <span class="ow">+</span> int<span class="ow">)</span> <span class="mi">0</span> <span class="ow">$</span> map ord <span class="ow">$</span> unpack chars
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nf">fGetInt</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">Int</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl">  fGetInt file <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Right</span> chars <span class="ow">&lt;-</span> fGetChars file <span class="mi">4</span>
</span></span><span class="line"><span class="cl">      <span class="ow">|</span> <span class="kt">Left</span> e <span class="ow">=&gt;</span> pure <span class="ow">(</span><span class="kt">Left</span> e<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    pure <span class="ow">$</span> <span class="kt">Right</span> <span class="ow">$</span> stringToInt chars
</span></span></code></pre></div><p>大分すっきりしましたね。</p>
<h2 id="中置記法">中置記法</h2>
<p>ある程度好みの問題になりますが、関数を中置で書けます。
<code>main</code> に <code>mod int 100</code> という部分があったかと思います。
関数を <code>`</code> で囲むとこれを中置で書けます。
以下は同等の表現です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">mod int <span class="mi">100</span>
</span></span><span class="line"><span class="cl">int `mod` <span class="mi">100</span>
</span></span></code></pre></div><p>同様に <code>stringToInt</code> 関数の <code>shiftL</code> も中置で書き直せます。</p>
<h1 id="結びに">結びに</h1>
<p>大体こんなところでしょうか。あんまり関数型言語っぽい部分に触れなかったので物足りない人もいるかもしれません。
今回のコードは<a href="https://github.com/KeenS/idris-guessing-game">こちら</a>に置いておくので参考にして下さい。</p>
<p>繰り返しますが、私も全然詳しくないので間違ったことを書いてるかもしれません。なんか深夜テンションで書き始めてしまったので最後まで書ききっただけです。
詳しい方、誤りなどあれば教えて下さい。</p>
<h1 id="その他の記事">その他の記事</h1>
<p>Idrisの特徴である依存型のチュートリアルは「こわくないIdris」シリーズなどがあります。
Idris 0.9.9時点での情報なので少し古いかもしれませんが。</p>
<ul>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/02/184831">こわくない Idris (1)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/03/162145">こわくない Idris (2)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/06/104042">こわくない Idris (3)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/14/082342">こわくない Idris (4)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/14/115924">こわくない Idris (5)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/14/153041">こわくない Idris (6)</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2014/10/05/233126">こわくない Idris (6) 補足</a></li>
<li><a href="http://mandel59.hateblo.jp/entry/2013/09/17/142709">こわくない Idris (7)</a></li>
</ul>
<p>他は証明の紹介だとこういうのがあります。</p>
<p><a href="http://wkwkes.hatenablog.com/entry/2016/12/17/000000">プログラミング言語 idris - wkwkesのやつ</a></p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://KeenS.github.io/slide/imadokitoiwarerugengokinounitsuite/"> イマドキと言われる言語機能について</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://KeenS.github.io/blog/2019/01/06/idriskankyoukouchiku/"> idris環境構築</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2024. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

