<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="Idris入門: リファレンス | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="κeenです。Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog、Idris入門: 二分木 | κeenのHappy Hacκing Blogで紹介したものをまとめつつ、適当に飛ばしていた部分を補います。" />
        <meta property="og:title" content="Idris入門: リファレンス | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https://KeenS.github.io/blog/2019/01/25/idrisnyuumon__rifarensu/" />
        <meta property="og:description" content="κeenです。Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog、Idris入門: 二分木 | κeenのHappy Hacκing Blogで紹介したものをまとめつつ、適当に飛ばしていた部分を補います。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/Idrisnyuumon__rifarensu.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/Idrisnyuumon__rifarensu.png" />
        
        <meta property="og:article:published_time" content="2019-01-25 00:00:30 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2019-01-25 00:00:30 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>Idris入門: リファレンス | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="https://KeenS.github.io/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="https://KeenS.github.io/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="https://KeenS.github.io/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="https://KeenS.github.io/manifest.json">
        <link rel="mask-icon" href="https://KeenS.github.io/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="https://KeenS.github.io/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="https://KeenS.github.io/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="https://KeenS.github.io/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="https://KeenS.github.io/about/"> About </a></li>
                        
                            <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                        
                            <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                        
                            <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                        
                            <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="https://KeenS.github.io/about/"> About </a></li>
                    
                        <li><a href="https://KeenS.github.io/post/"> Blog </a></li>
                    
                        <li><a href="https://KeenS.github.io/slide/"> Slide </a></li>
                    
                        <li><a href="https://KeenS.github.io/index.xml"> Atom </a></li>
                    
                        <li><a href="https://KeenS.github.io/search/"> Search </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">Idris入門: リファレンス</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2019-01-25</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="https://KeenS.github.io/categories/idris">Idris</a>
        </li>
    
        <li>
            <a href="https://KeenS.github.io/categories/idris%e5%85%a5%e9%96%80">Idris入門</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>κeenです。<a href="https://keens.github.io/blog/2019/01/07/idrisnyuumon__kazuatege_mu/">Idris入門: 数当てゲーム | κeenのHappy Hacκing Blog</a>、<a href="https://keens.github.io/blog/2019/01/17/idrisnyuumon__nibungi/">Idris入門: 二分木 | κeenのHappy Hacκing Blog</a>で紹介したものをまとめつつ、適当に飛ばしていた部分を補います。</p>
<p>ぶっちゃけ公式ドキュメント見れば良さそうなんですがself-containedでない記事も嫌なので2つのチュートリアルで出てきたものを拾います。
ここではチュートリアルに出てきた構文しか拾わないのでその他の構文は各自書きながら覚えて下さい。</p>
<p>念を押しますが私はIdrisにはそんなに詳しくないです。勢いで書いてるだけです。一次情報は<a href="http://docs.idris-lang.org/en/latest/">公式ドキュメント</a>です。</p>
<h1 id="構文">構文</h1>
<h2 id="変数と型の字句">変数と型の字句</h2>
<p>ドキュメントには書かれてないのですが、コンパイラのコードを見る限り識別子に使えるのは <code>[a-zA-Z][a-zA-Z'_.]*</code> のようです。
例えば <code>hog'.'e12_</code> は適格なIdrisの変数定義です。</p>
<p>変数に小文字始まり、型やバリアントには大文字始まりの識別子をつけるみたいです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Hoge</span> <span class="ow">=</span> <span class="kt">Fuga</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">piyo</span> <span class="ow">:</span> <span class="kt">Hoge</span> <span class="ow">-&gt;</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">piyo hoge <span class="ow">=</span> <span class="ow">()</span>
</span></span></code></pre></div><p>一応型やバリアントに小文字を使ったり変数に大文字を使ったりもできますが色々不都合が生じます。</p>
<h2 id="data"><code>data</code></h2>
<p>代数的データ型と呼ばれるものです。色々な使いみちがあります。
例えば、列挙型のように可能な値を列挙することができます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Direction</span> <span class="ow">=</span> <span class="kt">Up</span> <span class="ow">|</span> <span class="kt">Down</span> <span class="ow">|</span> <span class="kt">Right</span> <span class="ow">|</span> <span class="kt">Left</span>
</span></span></code></pre></div><p>ここでの <code>Up</code> 、 <code>Down</code> 、 <code>Right</code> 、 <code>Left</code> のように列挙されたものをバリアント(列挙子)と呼びます。
バリアントそれぞれがコンストラクタになっています。どのバリアントを書いても <code>Direciton</code> 型の値が作れます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">Up</span>
</span></span><span class="line"><span class="cl"><span class="nf">Up</span> <span class="ow">:</span> <span class="kt">Direction</span>
</span></span><span class="line"><span class="cl">λΠ&gt; <span class="kt">Down</span>
</span></span><span class="line"><span class="cl"><span class="nf">Down</span> <span class="ow">:</span> <span class="kt">Direction</span>
</span></span></code></pre></div><p>列挙子はそれぞれ値を持てます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Few</span> <span class="ow">=</span> <span class="kt">None</span>
</span></span><span class="line"><span class="cl">         <span class="ow">|</span> <span class="kt">One</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">         <span class="ow">|</span> <span class="kt">Two</span> <span class="kt">Int</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">         <span class="ow">|</span> <span class="kt">Three</span> <span class="kt">Int</span> <span class="kt">Int</span> <span class="kt">Int</span>
</span></span></code></pre></div><p>値を持つ列挙子は単体では関数のように振る舞います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">One</span>
</span></span><span class="line"><span class="cl"><span class="nf">One</span> <span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Few</span>
</span></span></code></pre></div><p>具体的な値を渡してあげると <code>Few</code> 型の値を作れます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">One</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="kt">One</span> <span class="mi">3</span> <span class="ow">:</span> <span class="kt">Few</span>
</span></span></code></pre></div><p>代数的データ型のバリアントを1つにすれば構造体のような使い方もできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Person</span> <span class="ow">=</span> <span class="kt">MkPerson</span> <span class="kt">Int</span> <span class="kt">String</span>
</span></span></code></pre></div><p><code>data</code> からデータを取り出すにはパターンマッチを使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getName</span> <span class="ow">:</span> <span class="kt">Person</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">getName <span class="ow">(</span><span class="kt">MkPerson</span> age name<span class="ow">)</span> <span class="ow">=</span> name
</span></span></code></pre></div><p>コンストラクタと同じ形でエクストラクタを書けるので視覚的に分かりやすいですね。</p>
<h3 id="ジェネリクス">ジェネリクス</h3>
<p><code>data</code> 文はジェネリクスにできます。つまり、型引数を取れます。
名前に続けて型引数を導入し、定義部分で使います。小文字で書くと型変数になるようです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Tree</span> a <span class="ow">=</span> <span class="kt">Leaf</span> <span class="ow">|</span> <span class="kt">Node</span> <span class="ow">(</span><span class="kt">Tree</span> a<span class="ow">)</span> a <span class="ow">(</span><span class="kt">Tree</span> a<span class="ow">)</span>
</span></span></code></pre></div><p>何も書いてませんでしたが型は自身を参照することもできます。
括弧は結合の優先順位を決めるのに使います。</p>
<p>複数の引数を受け取るときは空白で並べて書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Either</span> a b <span class="ow">=</span> <span class="kt">Left</span> a <span class="ow">|</span> <span class="kt">Right</span> b
</span></span></code></pre></div><h3 id="タプル">タプル</h3>
<p>タプルは組です。いくらでも異なる型のデータをまとめられます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  <span class="ow">(</span><span class="mi">1</span>, <span class="mf">2.0</span>, <span class="s">&#34;3&#34;</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="ow">(</span><span class="mi">1</span>, <span class="mf">2.0</span>, <span class="s">&#34;3&#34;</span><span class="ow">)</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Integer</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="ow">)</span>
</span></span></code></pre></div><p>その実はデータ型 <code>Pair</code> です。上記の定義は以下と同じです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  <span class="kt">MkPair</span> <span class="mi">1</span> <span class="ow">(</span><span class="kt">MkPair</span> <span class="mf">2.0</span> <span class="s">&#34;3&#34;</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="ow">(</span><span class="mi">1</span>, <span class="mf">2.0</span>, <span class="s">&#34;3&#34;</span><span class="ow">)</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Integer</span>, <span class="kt">Double</span>, <span class="kt">String</span><span class="ow">)</span>
</span></span></code></pre></div><p>ところで、二分木のところで</p>
<blockquote>
<p>今更ですが、ちょくちょく出てきていた () は空のタプルのことでした。</p>
</blockquote>
<p>と書きましたがこれは誤りでした。 <code>()</code> は明らかにペアじゃないですね。<code>()</code> はそれで1つのデータ型、 <code>Unit</code> 型です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">MkUnit</span>
</span></span><span class="line"><span class="cl"><span class="ow">()</span> <span class="ow">:</span> <span class="ow">()</span>
</span></span></code></pre></div><h3 id="gadt">GADT</h3>
<p><code>data</code> は別の記法もあります。
正式な呼び方がわからないのですが、<a href="http://docs.idris-lang.org/en/latest/reference/syntax-guide.html#data-types">ドキュメント</a>ではGADTスタイル構文と書かれています。以下のような構文です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> 名前 <span class="ow">:</span> カインド <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">バリアント1</span><span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">  <span class="nf">バリアント2</span><span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">  <span class="ow">...</span>
</span></span></code></pre></div><p>バリアントは関数としても振る舞うと説明しましたが、ここで書くバリアントの型は関数の型そのものなので分かりやすいですね。
因みにカインドとは型の型です。今回型を定義していて、その型を書くので型の型が必要になります。</p>
<p>先程の <code>Few</code> はGADTスタイル構文でこのようにも書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Few</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">None</span> <span class="ow">:</span> <span class="kt">Few</span>
</span></span><span class="line"><span class="cl">  <span class="nf">One</span> <span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Few</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Two</span> <span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Few</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Three</span> <span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Few</span>
</span></span></code></pre></div><p>カインドは今回は <code>Type</code> ですし、ジェネリクスのように型パラメータを取る型なら <code>Type -&gt; Type</code> にもなるでしょう。</p>
<p>Idrisは型の記述が柔軟なので明示的に型を書くこのスタイルだと都合が良いことが多いのです。</p>
<p>また、GADTだと各引数に名前を付けられるので構造体風定義もわかりやすくなります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Person</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">MkPerson</span><span class="ow">:</span>  <span class="ow">(</span>age <span class="ow">:</span> <span class="kt">Int</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>name <span class="ow">:</span> <span class="kt">String</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Person</span>
</span></span></code></pre></div><p>これに構文糖衣をかぶせると <a href="http://docs.idris-lang.org/en/latest/tutorial/typesfuns.html#records">レコード</a> 構文になります。</p>
<h2 id="値関数定義">値/関数定義</h2>
<p>最初のチュートリアルで紹介したように以下の構文で値を定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">名前</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">名前 <span class="ow">=</span> 式
</span></span></code></pre></div><p>関数の場合は引数を並べて書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">名前</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">名前 引数1 引数2 <span class="ow">..</span> 引数n <span class="ow">=</span> 式
</span></span></code></pre></div><p>Idrisは式指向ですので<code>return</code>文のようなものはありません。関数の本体は計算したい式だけ書けば十分です。</p>
<p>引数の位置ではパターンマッチができます。その際は節を並べます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">showDirection</span> <span class="ow">:</span> <span class="kt">Direction</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">showDirection <span class="kt">Up</span> <span class="ow">=</span>  <span class="s">&#34;Up&#34;</span>
</span></span><span class="line"><span class="cl">showDirection <span class="kt">Down</span> <span class="ow">=</span> <span class="s">&#34;Down&#34;</span>
</span></span><span class="line"><span class="cl">showDirection <span class="kt">Right</span> <span class="ow">=</span> <span class="s">&#34;Right&#34;</span>
</span></span><span class="line"><span class="cl">showDirection <span class="kt">Left</span> <span class="ow">=</span> <span class="s">&#34;Left&#34;</span>
</span></span></code></pre></div><p>小文字で始まる識別子だと変数になります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">moveHorizontal</span> <span class="ow">:</span> <span class="kt">Direction</span>  <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">moveHorizontal <span class="kt">Up</span> <span class="ow">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">moveHorizontal <span class="kt">Down</span> <span class="ow">=</span> <span class="ow">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">moveHorizontal other <span class="ow">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>マッチした変数を使わないなら特別なパターン <code>_</code> で無視することもできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">moveHorizontal</span> <span class="ow">:</span> <span class="kt">Direction</span>  <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">moveHorizontal <span class="kt">Up</span> <span class="ow">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">moveHorizontal <span class="kt">Down</span> <span class="ow">=</span> <span class="ow">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">moveHorizontal <span class="kr">_</span> <span class="ow">=</span> <span class="mi">0</span>
</span></span></code></pre></div><p>つまり、関数定義はもう少し複雑で、こういう構文です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">名前</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">名前 バターン1_1 バターン1_2 <span class="ow">..</span> バターン1_n <span class="ow">=</span> 値
</span></span><span class="line"><span class="cl">名前 バターン2_1 バターン2_2 <span class="ow">..</span> バターン2_n <span class="ow">=</span> 値
</span></span><span class="line"><span class="cl"><span class="ow">...</span>
</span></span><span class="line"><span class="cl">名前 バターンm_1 バターンm_2 <span class="ow">..</span> バターンm_n <span class="ow">=</span> 値
</span></span></code></pre></div><h2 id="中置演算子">中置演算子</h2>
<p>Idrisではユーザが任意の中置演算子を定義できます。 <code>:+-*\/=.?|&amp;&gt;&lt;!@$%^~#</code> の組み合わせを中置演算子に使えます。</p>
<p>中置演算子を宣言するには <code>infixl 優先度 記号</code> または <code>infixr 優先度 記号</code> を使います。それぞれ左結合、右結合の演算子を定義します。
例えば <code>+?</code> を左結合の優先度4の演算子として定義するには以下のように書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">4</span> <span class="ow">+?</span>
</span></span></code></pre></div><p>中置演算子を定義する時は括弧で包んで関数と同じように定義します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="ow">(+?):</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl"><span class="ow">(+?)</span> <span class="ow">(</span><span class="kt">Just</span> x<span class="ow">)</span> y <span class="ow">=</span> <span class="kt">Just</span> <span class="ow">(</span>x <span class="ow">+</span> y<span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="ow">(+?)</span>  <span class="kr">_</span>       <span class="kr">_</span> <span class="ow">=</span> <span class="kt">Nothing</span>
</span></span></code></pre></div><p>こう定義してしまえば自由に使えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span> <span class="ow">+?</span> <span class="mi">2</span> <span class="ow">+?</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">6</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">λΠ&gt;  <span class="ow">(</span><span class="kt">Nothing</span><span class="ow">)</span> <span class="ow">+?</span> <span class="mi">2</span> <span class="ow">+?</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl"><span class="nf">Nothing</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>また、括弧で包めば関数としても使えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  <span class="ow">(+?)</span>
</span></span><span class="line"><span class="cl"><span class="ow">(+?)</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>データ型のバリアントを中置演算子で定義することもできます。
これは標準ライブラリで定義されている例です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixr</span> <span class="mi">10</span> <span class="ow">::</span>
</span></span><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">List</span> a <span class="ow">=</span> <span class="kt">Nil</span> <span class="ow">|</span> <span class="ow">(::)</span> a <span class="ow">(</span><span class="kt">List</span> a<span class="ow">)</span>
</span></span></code></pre></div><h3 id="関数を中置で">関数を中置で</h3>
<p>任意の2引数関数を <code>`</code> で囲むと中置で書けます。バックティック記法と呼ばれるようです。
バリアントも関数でしたからこのようにも書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="mi">1</span> `Two` <span class="mi">2</span>
</span></span></code></pre></div><p>また、パターンマッチでも同様に中置記法で書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">sum</span> <span class="ow">:</span> <span class="kt">Few</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">sum <span class="kt">None</span> <span class="ow">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">sum <span class="ow">(</span><span class="kt">One</span> x<span class="ow">)</span> <span class="ow">=</span> x
</span></span><span class="line"><span class="cl"><span class="c1">-- 中置記法でパターンマッチ</span>
</span></span><span class="line"><span class="cl">sum <span class="ow">(</span>x `Two` y<span class="ow">)</span> <span class="ow">=</span> x <span class="ow">+</span> y
</span></span><span class="line"><span class="cl">sum <span class="ow">(</span><span class="kt">Three</span> x y z<span class="ow">)</span> <span class="ow">=</span> x <span class="ow">+</span> y <span class="ow">+</span> z
</span></span></code></pre></div><h2 id="case-とパターン"><code>case</code> とパターン</h2>
<p>関数の引数でパターンマッチができますが、<code>case</code> を使えばそれ以外の場所でもパターンマッチができます。</p>
<p>パターンはだいたいコンストラクタと1対1対応します。パターンはネスト可能です。
例えばFizz Buzz判定するパターンマッチはこう書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">fizzBuzz</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">fizzBuzz n <span class="ow">=</span> <span class="kr">case</span> <span class="ow">(</span>n `mod` <span class="mi">3</span>, n `mod` <span class="mi">5</span><span class="ow">)</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">             <span class="ow">(</span><span class="mi">0</span>, <span class="mi">0</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="s">&#34;FizzBuzz&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="ow">(</span><span class="mi">0</span>, <span class="kr">_</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="s">&#34;Fizz&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="ow">(</span><span class="kr">_</span>, <span class="mi">0</span><span class="ow">)</span> <span class="ow">=&gt;</span> <span class="s">&#34;Buzz&#34;</span>
</span></span><span class="line"><span class="cl">             <span class="kr">_</span>      <span class="ow">=&gt;</span> show n
</span></span></code></pre></div><p><code>case</code> 式があれば不要に思えますが <code>if</code> 式もあります。</p>
<h2 id="let"><code>let</code></h2>
<p>計算の途中式に名前をつける構文です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">let</span> パターン <span class="ow">=</span> 式 <span class="kr">in</span> 式
</span></span></code></pre></div><p>のように使います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">quadruple</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">quadruple x <span class="ow">=</span> <span class="kr">let</span> double <span class="ow">=</span> x <span class="ow">+</span> x <span class="kr">in</span> double <span class="ow">+</span> double
</span></span></code></pre></div><h2 id="インターフェース">インターフェース</h2>
<p>インターフェースはデータ型間で共通の操作を定義する機能です。 インターフェースは以下の構文で定義でます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="c1">-- わかりやすさのため微妙に嘘をついてます</span>
</span></span><span class="line"><span class="cl">interface インターフェース名 対象の型 <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">関数1</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">    <span class="nf">関数2</span> <span class="ow">:</span> 型
</span></span><span class="line"><span class="cl">    <span class="ow">...</span>
</span></span><span class="line"><span class="cl">    デフォルト実装<span class="ow">(</span>あれば<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    <span class="ow">...</span>
</span></span></code></pre></div><p><code>where</code> 以降はオフサイドルールですね。インターフェースの関数はメソッドと呼びます。</p>
<p>例えば同値比較のインターフェースはこう定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">interface <span class="kt">Eq</span> a <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(==)</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(/=)</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    x <span class="ow">/=</span> y <span class="ow">=</span> not <span class="ow">(</span>x <span class="ow">==</span> y<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    x <span class="ow">==</span> y <span class="ow">=</span> not <span class="ow">(</span>x <span class="ow">/=</span> y<span class="ow">)</span>
</span></span></code></pre></div><p>ジェネリクス型にインターフェース制約をつけるにはこう書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">インターフェース名 対象の型 <span class="ow">=&gt;</span> 型
</span></span></code></pre></div><p>複数のインターフェース制約はこうです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">インターフェース名 対象の型 <span class="ow">=&gt;</span> インターフェース名 対象の型 <span class="ow">=&gt;</span> <span class="ow">..</span> <span class="ow">=&gt;</span> 型
</span></span></code></pre></div><p>例えば <code>Either</code> 型の値を文字列にする関数はこう書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">showEither</span> <span class="ow">:</span> <span class="kt">Show</span> a <span class="ow">=&gt;</span> <span class="kt">Show</span> b <span class="ow">=&gt;</span> <span class="kt">Either</span> a b <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">showEither <span class="ow">(</span><span class="kt">Left</span> l<span class="ow">)</span> <span class="ow">=</span> <span class="s">&#34;Left &#34;</span> <span class="ow">++</span> show l
</span></span><span class="line"><span class="cl">showEither <span class="ow">(</span><span class="kt">Right</span> r<span class="ow">)</span> <span class="ow">=</span> <span class="s">&#34;Right &#34;</span> <span class="ow">++</span> show r
</span></span></code></pre></div><h2 id="do-記法"><code>do</code> 記法</h2>
<p><code>do</code> 記法は<a href="http://docs.idris-lang.org/en/latest/tutorial/interfaces.html#monads-and-do-notation"><code>Monad</code></a>インターフェースのための構文糖衣です。<code>IO</code> だけでなく <code>Monad</code> を実装している型ならなんでも <code>do</code> 記法が使えます。
インターフェースの構文糖衣なので <code>do</code> そのものには意味がないのですが、キモチとしては「中身を取り出す」ような働きをします。
例えば <code>Maybe</code> は <code>Monad</code> を実装しているのでこう使えます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">addMaybe</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">addMaybe x y <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  x&#39; <span class="ow">&lt;-</span> x
</span></span><span class="line"><span class="cl">  y&#39; <span class="ow">&lt;-</span> y
</span></span><span class="line"><span class="cl">  <span class="kt">Just</span> <span class="ow">$</span> x&#39; <span class="ow">+</span> y&#39;
</span></span></code></pre></div><p>このコードのキモチは <code>Maybe</code> に包まれた <code>x</code> と <code>y</code> から<code>Integer</code> 型の値 <code>x'</code>, <code>y'</code> を取り出し、足し算しています。もちろん取り出せるのは <code>Just</code> のときのみで、 <code>Nothing</code> のときはすぐさま <code>Nothing</code> が返ります。</p>
<h3 id="パターン">パターン</h3>
<p><code>&lt;-</code> で取り出した値に更にパターンマッチできます。
<code>パターン &lt;- 式 | パターン =&gt; 式 | パターン =&gt; 式 ...</code>の形です。</p>
<p>荒唐無稽な例ですが受け取った値が1と2だった場合だけ足し算するにはこう書きます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">addOneAndTwo</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">addOneAndTwo x y <span class="ow">=</span> <span class="kr">do</span>
</span></span><span class="line"><span class="cl">  <span class="mi">1</span> <span class="ow">&lt;-</span> x
</span></span><span class="line"><span class="cl">    <span class="ow">|</span> <span class="kr">_</span> <span class="ow">=&gt;</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl">  <span class="mi">2</span> <span class="ow">&lt;-</span> y
</span></span><span class="line"><span class="cl">    <span class="ow">|</span> <span class="kr">_</span> <span class="ow">=&gt;</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl">  <span class="kt">Just</span> <span class="ow">$</span> <span class="mi">1</span> <span class="ow">+</span> <span class="mi">2</span>
</span></span></code></pre></div><h2 id="コメントとドキュメントコメント">コメントとドキュメントコメント</h2>
<p><code>--</code> ではじまるのがコメント、 <code>|||</code> ではじまるのがドキュメントコメント。</p>
<p><a href="http://docs.idris-lang.org/en/latest/reference/documenting.html">ドキュメントコメント</a>は色々書式があるみたいです。</p>
<h2 id="名前空間">名前空間</h2>
<p>Idrisのコードは以下のような形になっています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">&lt;モジュールヘッダ&gt;?
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;インポート文&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">&lt;コード&gt;
</span></span></code></pre></div><h3 id="モジュールヘッダ">モジュールヘッダ</h3>
<p><code>module モジュール名</code> です。あってもなくてもいいです。1ファイル1モジュールです。
ドットで区切った階層構造です。一応ファイル名とは関連がないことになってますが、<code>Foo/Bar.idr</code> には <code>module Foo.Bar</code> モジュールを定義するのが通例です。たまに <code>Foo.Bar</code> と書いてモジュールではなくファイル <code>Foo/Bar.idr</code> のことを指す記法もあるので注意が必要です。</p>
<h3 id="インポート文">インポート文</h3>
<p><code>import モジュール名</code> です。人によっては混乱すると思いますが、 <code>import Data.Vect</code> で <code>Vect</code> モジュール内の全てのアイテムが今の名前空間にインポートされます。
単純にモジュール名を略記したいなら <code>import Data.Vect as V</code> などで別名をつけることになります。</p>
<h1 id="値と型">値と型</h1>
<h2 id="関数">関数</h2>
<p>関数も値です。気軽に変数を束縛できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">add</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">add <span class="ow">=</span> <span class="ow">(+)</span>
</span></span></code></pre></div><p>Idrisの関数は1引数をとり、1返り値を返します。複数の引数を受け取りたい時は関数をネストすると複数の引数を受け取れるように見えます。</p>
<p>例えば以下の2つの定義は同等です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">add</span><span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">add <span class="ow">=</span> <span class="ow">\</span>x <span class="ow">=&gt;</span> <span class="ow">\</span>y <span class="ow">=&gt;</span> x <span class="ow">+</span> y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">add</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">add x y <span class="ow">=</span>  x <span class="ow">+</span> y
</span></span></code></pre></div><p>同様に、関数適用も1引数の適用の連続です。
以下の2つは同等の表現です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">add <span class="mi">1</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="ow">(</span>add <span class="mi">1</span><span class="ow">)</span> <span class="mi">2</span>
</span></span></code></pre></div><p>型も、 <code>Integer -&gt; Integer -&gt; Integer</code> は <code>Integer -&gt; (Integer -&gt; Integer)</code> の意味です。</p>
<p>複数引数関数にみえるのは実は関数の集合体なので中途半端に使うこと(部分適用)もできます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">inc</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">inc <span class="ow">=</span> add <span class="mi">1</span>
</span></span></code></pre></div><h2 id="型の扱い">型の扱い</h2>
<p>Idrisでは型も第一級です。型の型は <code>Type</code> です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="nf">Int</span> <span class="ow">:</span> <span class="kt">Type</span>
</span></span></code></pre></div><p>ジェネリクスになっている型は引数を受け取ると型になる、要は型を受け取って型を返す関数なので<code>Type -&gt; Type</code> 型になります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">Maybe</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="kt">Maybe</span> <span class="kt">Int</span> <span class="ow">:</span> <span class="kt">Type</span>
</span></span><span class="line"><span class="cl">λΠ&gt; <span class="kt">Maybe</span>
</span></span><span class="line"><span class="cl"><span class="nf">Maybe</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
</span></span></code></pre></div><p>ジェネリクスと関数適用が同じ構文な理由が理解できたかと思います。
型エイリアスも値と同じように定義できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">Option</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
</span></span><span class="line"><span class="cl"><span class="kt">Option</span> <span class="ow">=</span> <span class="kt">Maybe</span>
</span></span></code></pre></div><p>余談ですが <code>Type</code> の型は <code>Type 1</code> です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">λΠ&gt;</span> <span class="ow">:</span>t <span class="kt">Type</span>
</span></span><span class="line"><span class="cl"><span class="nf">Type</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="mi">1</span>
</span></span></code></pre></div><p>あとは想像出来ますね。 <code>Type 1 : Type 2</code>, <code>Type 2 : Type 3</code>, .. とずっと続いていきます。</p>
<h2 id="プリミティブ型">プリミティブ型</h2>
<p>Idrisのプリミティブ型は思ったより少ないです。</p>
<ul>
<li><code>Int</code> : 固定長整数</li>
<li><code>Integer</code> : 多倍長整数</li>
<li><code>Double</code> : 倍精度浮動小数点数</li>
<li><code>Char</code> : 文字</li>
<li><code>String</code> : 文字列</li>
<li><code>Ptr</code> : FFI用</li>
</ul>
<p>あとは裏では8bitから64bitまでの整数もあるようですがドキュメントには載ってないです。</p>
<p>真偽値などはライブラリで定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Bool</span> <span class="ow">=</span> <span class="kt">False</span> <span class="ow">|</span> <span class="kt">True</span>
</span></span></code></pre></div><h1 id="ライブラリ">ライブラリ</h1>
<p>ドキュメントに記述が見つけられなかったのですが、Idrisはデフォルトでいくつかのライブラリをリンクしています。</p>
<ul>
<li>プリミティブ : 処理系組み込みの機能</li>
<li>ビルトイン : Idrisで書かれているが処理系が特別扱いする</li>
<li><a href="https://www.idris-lang.org/docs/current/prelude_doc/">プレリュード</a> : デフォルトでインポートされているライブラリ群</li>
<li><a href="https://www.idris-lang.org/docs/current/base_doc/">ベース</a> : インポートはされていないがいつでもインポートできるライブラリ群</li>
</ul>
<p>プリミティブは型のところで紹介したプリミティブ型の他に雑多な関数などがあるようです。ビルトインはタプルやユニット、 <code>ifThenElse</code> などです。</p>
<p>プレリュードはトップレベル関数相当で、例えば何気なく使っていた <code>putStrLn</code> は<a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Interactive.html"><code>Prelude.Interactive</code></a>で定義されています。</p>
<p>ベースはデフォルトでリンクするライブラリで、標準ライブラリ相当です。<a href="https://www.idris-lang.org/docs/current/base_doc/docs/Data.Complex.html"><code>Data.Complex</code></a>や<a href="https://www.idris-lang.org/docs/current/base_doc/docs/System.html"><code>System</code></a>のようなものがあります。</p>
<p>その他にもIdrisと一緒に配布されている <a href="https://www.idris-lang.org/docs/current/contrib_doc/">contrib</a>や<a href="https://www.idris-lang.org/docs/current/effects_doc/">effects</a>なんかもあります。<a href="https://www.idris-lang.org/docs/current/contrib_doc/docs/Data.SortedMap.html"><code>Data.SortedMap</code></a>なんかもcontribにあるのでcontribを使う機会は多いでしょう。</p>
<p>以下に、出てきた関数やデータ型を紹介します。</p>
<h2 id="プリミティブ">プリミティブ</h2>
<p><code>-</code> は負号ではなく、符号反転の前置演算子のようです。どのユーザ定義演算子より優先順位は高いです。</p>
<p><code>$</code> はプリミティブの中置演算子のようです。結合は右結合で、どのユーザ定義演算子より弱い優先順位を持ちます。
下記2式は等価です。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">f <span class="ow">(</span>g <span class="ow">(</span>h x<span class="ow">))</span>
</span></span><span class="line"><span class="cl">f <span class="ow">$</span> g <span class="ow">$</span> h x
</span></span></code></pre></div><h2 id="プレリュード">プレリュード</h2>
<h3 id="preludehttpswwwidris-langorgdocscurrentprelude_docdocspreludehtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.html"><code>Prelude</code></a></h3>
<p><code>Prelude</code> にはシンプルな関数が定義されています。</p>
<p>チュートリアルで使ったのは<code>shiftL</code> ですね</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">shiftL</span><span class="ow">:</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span></code></pre></div><h3 id="preludebasicshttpswwwidris-langorgdocscurrentprelude_docdocspreludebasicshtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Basics.html"><code>Prelude.Basics</code></a></h3>
<p><code>Prelude.Basics</code> には基本的な操作が定義されています。</p>
<h4 id="the"><code>the</code></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">the</span> <span class="ow">:</span> <span class="ow">(</span>a <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> a
</span></span></code></pre></div><p>型アノテーションを書く関数です。他言語なら型アノテーションは専用の構文になってますが、Idrisだと型も第一級なのでこういう関数が書けます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; the <span class="kt">Int</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">1</span> <span class="ow">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">λΠ&gt; the <span class="kt">Integer</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="nf">1</span> <span class="ow">:</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>指定した型になっているのが分かると思います。</p>
<h4 id="heading"><code>(.)</code></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="ow">(.)</span> <span class="ow">:</span> <span class="ow">(</span>b <span class="ow">-&gt;</span> c<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> c
</span></span></code></pre></div><p>一瞬混乱しますが、  <code>(.)</code> は関数を合成する関数(中置演算子)です。数学で $f(g(x))$ を $f \circ g (x)$ と書くのに似せた記法ですね。
実際にはこう定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixr</span> <span class="mi">9</span> <span class="ow">.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">||| Function composition</span>
</span></span><span class="line"><span class="cl"><span class="ow">(.)</span> <span class="ow">:</span> <span class="ow">(</span>b <span class="ow">-&gt;</span> c<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> c
</span></span><span class="line"><span class="cl"><span class="ow">(.)</span> f g <span class="ow">=</span> <span class="ow">\</span>x <span class="ow">=&gt;</span> f <span class="ow">(</span>g x<span class="ow">)</span>
</span></span></code></pre></div><h3 id="preludecasthttpswwwidris-langorgdocscurrentprelude_docdocspreludecasthtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Cast.html"><code>Prelude.Cast</code></a></h3>
<p><code>Prelude.Cast</code> には型変換を管理するインターフェース、 <code>Cast</code> が定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">interface <span class="kt">Cast</span> from to <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">cast</span> <span class="ow">:</span> <span class="ow">(</span>orig <span class="ow">:</span> from<span class="ow">)</span> <span class="ow">-&gt;</span> to
</span></span></code></pre></div><p>いくつかの変換が用意されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  the <span class="kt">String</span> <span class="ow">(</span>cast <span class="mi">1</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">&#34;1&#34;</span> <span class="ow">:</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">λΠ&gt;  the <span class="kt">Integer</span> <span class="ow">(</span>cast <span class="ow">(</span>the <span class="kt">Int</span> <span class="mi">1</span><span class="ow">))</span>
</span></span><span class="line"><span class="cl"><span class="nf">1</span> <span class="ow">:</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">λΠ&gt; the  <span class="kt">Double</span> <span class="ow">(</span>cast <span class="mi">1</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">1.0</span> <span class="ow">:</span> <span class="kt">Double</span>
</span></span></code></pre></div><p>びっくりなことに、文字列→数値の変換もあります。しかし無効な文字列を与えると0が返ってきてしまうようです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; the <span class="kt">Integer</span> <span class="ow">(</span>cast <span class="s">&#34;123abc&#34;</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">0</span> <span class="ow">:</span> <span class="kt">Integer</span>
</span></span></code></pre></div><h3 id="preludeinterfaceshttpswwwidris-langorgdocscurrentprelude_docdocspreludeinterfaceshtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Interfaces.html"><code>Prelude.Interfaces</code></a></h3>
<p><code>Prelude.Interfaces</code> には基本的な二項演算などのインターフェースが定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Ordering</span> <span class="ow">=</span> <span class="kt">LT</span> <span class="ow">|</span> <span class="kt">EQ</span> <span class="ow">|</span> <span class="kt">GT</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">infix</span> <span class="mi">6</span> <span class="ow">&lt;</span>, <span class="ow">&lt;=</span>, <span class="ow">&gt;</span>, <span class="ow">&gt;=</span>
</span></span><span class="line"><span class="cl">interface <span class="kt">Eq</span> ty <span class="ow">=&gt;</span> <span class="kt">Ord</span> ty <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">compare</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> <span class="kt">Ordering</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;)</span> x y <span class="kr">with</span> <span class="ow">(</span>compare x y<span class="ow">)</span>
</span></span><span class="line"><span class="cl">        <span class="ow">(&lt;)</span> x y <span class="ow">|</span> <span class="kt">LT</span> <span class="ow">=</span> <span class="kt">True</span>
</span></span><span class="line"><span class="cl">        <span class="ow">(&lt;)</span> x y <span class="ow">|</span> <span class="kr">_</span>  <span class="ow">=</span> <span class="kt">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;)</span> x y <span class="kr">with</span> <span class="ow">(</span>compare x y<span class="ow">)</span>
</span></span><span class="line"><span class="cl">        <span class="ow">(&gt;)</span> x y <span class="ow">|</span> <span class="kt">GT</span> <span class="ow">=</span> <span class="kt">True</span>
</span></span><span class="line"><span class="cl">        <span class="ow">(&gt;)</span> x y <span class="ow">|</span> <span class="kr">_</span>  <span class="ow">=</span> <span class="kt">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;=)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;=)</span> x y <span class="ow">=</span> x <span class="ow">&lt;</span> y <span class="ow">||</span> x <span class="ow">==</span> y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;=)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;=)</span> x y <span class="ow">=</span> x <span class="ow">&gt;</span> y <span class="ow">||</span> x <span class="ow">==</span> y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">max</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">    max x y <span class="ow">=</span> <span class="kr">if</span> x <span class="ow">&gt;</span> y <span class="kr">then</span> x <span class="kr">else</span> y
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nf">min</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">    min x y <span class="ow">=</span> <span class="kr">if</span> <span class="ow">(</span>x <span class="ow">&lt;</span> y<span class="ow">)</span> <span class="kr">then</span> x <span class="kr">else</span> y
</span></span></code></pre></div><p>チュートリアルでは <code>Ordering</code> と <code>compare</code> を使いましたがその他の演算子も用意されています。</p>
<p>同様に数値演算も定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">8</span> <span class="ow">+</span>
</span></span><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">9</span> <span class="ow">*</span>
</span></span><span class="line"><span class="cl">interface <span class="kt">Num</span> ty <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(+)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">    <span class="ow">(*)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">    <span class="nf">fromInteger</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">interface <span class="kt">Num</span> ty <span class="ow">=&gt;</span> <span class="kt">Neg</span> ty <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">negate</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">    <span class="ow">(-)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">9</span> `div`, `mod`
</span></span><span class="line"><span class="cl">interface <span class="kt">Num</span> ty <span class="ow">=&gt;</span> <span class="kt">Integral</span> ty <span class="kr">where</span>
</span></span><span class="line"><span class="cl">   <span class="nf">div</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span><span class="line"><span class="cl">   <span class="nf">mod</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty
</span></span></code></pre></div><p><code>mod</code> や <code>div</code> は <code>n `mod` m</code> の形で使われることを想定して演算子の結合性や優先順位が指定されています。</p>
<h3 id="preludestringshttpswwwidris-langorgdocscurrentprelude_docdocspreludestringshtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Strings.html"><code>Prelude.Strings</code></a></h3>
<p><code>Prelude.String</code> には文字列操作に関する関数が定義されています。
意外にもチュートリアルで使ったのは2つだけでした。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">7</span> <span class="ow">++</span>
</span></span><span class="line"><span class="cl"><span class="nf">unpack</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="kt">Char</span>
</span></span><span class="line"><span class="cl"><span class="ow">(++)</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
</span></span></code></pre></div><p>Idrisのようにデータ型が便利な言語だと文字列は人間とのやりとりくらいでしか使わないので思ったほど出番は多くないです。</p>
<h3 id="preludecharshttpswwwidris-langorgdocscurrentprelude_docdocspreludecharshtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Chars.html"><code>Prelude.Chars</code></a></h3>
<p><code>Prelude.Chars</code> には文字に関する関数が定義されています。文字を扱うことはあまりないと思いますが、Idrisでも操作はそんなに多くないです。</p>
<p>今回使ったのは文字→数値変換の <code>ord</code> ですね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">ord</span> <span class="ow">:</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Int</span>
</span></span></code></pre></div><p>Idrisはバックエンドが複数あるのでどう変換されるかはバックエンド依存としています。
が、REPLではユニコードのスカラ値が返っているようです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; ord <span class="sc">&#39;κ&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">954</span> <span class="ow">:</span> <span class="kt">Int</span>
</span></span></code></pre></div><h3 id="preludelisthttpswwwidris-langorgdocscurrentprelude_docdocspreludelisthtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.List.html"><code>Prelude.List</code></a></h3>
<p><code>Prelude.List</code> にはリストに対する操作が定義されています。
実はリストに固有の操作はチュートリアルでは使っていません。
<code>map</code> や <code>foldl</code> などはリストに限らない汎用の関数として定義されているのです。</p>
<p>リストはこのように定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixr</span> <span class="mi">7</span> <span class="ow">::</span>
</span></span><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">List</span> <span class="ow">:</span> <span class="ow">(</span>elem <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Nil</span> <span class="ow">:</span> <span class="kt">List</span> elem
</span></span><span class="line"><span class="cl">  <span class="ow">(::)</span> <span class="ow">:</span> <span class="ow">(</span>x <span class="ow">:</span> elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>xs <span class="ow">:</span> <span class="kt">List</span> elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">List</span> elem
</span></span></code></pre></div><p>関数型言語のユーザには馴染みの在る定義ですね。以下のようにいくつかの <code>(::)</code> と末尾の <code>Nil</code> で構成されます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="mi">1</span> <span class="ow">::</span> <span class="mi">2</span> <span class="ow">::</span> <span class="mi">3</span> <span class="ow">::</span> <span class="kt">Nil</span>
</span></span><span class="line"><span class="cl"><span class="ow">[</span><span class="mi">1</span>, <span class="mi">2</span>, <span class="mi">3</span><span class="ow">]</span> <span class="ow">:</span> <span class="kt">List</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>再帰関数を書くときも <code>(::)</code> と <code>Nil</code> で分岐します。分かりやすいですね。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">sum</span> <span class="ow">:</span> <span class="kt">List</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">sum <span class="kt">Nil</span> <span class="ow">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">sum <span class="ow">(</span>x<span class="ow">::</span>xs<span class="ow">)</span> <span class="ow">=</span> x <span class="ow">+</span> <span class="ow">(</span>sum xs<span class="ow">)</span>
</span></span></code></pre></div><h3 id="preludemaybehttpswwwidris-langorgdocscurrentprelude_docdocspreludemaybehtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Maybe.html"><code>Prelude.Maybe</code></a></h3>
<p><code>Prelude.Maybe</code> には <code>Maybe</code> 型とそれに関連する関数が定義されています。</p>
<p><code>Maybe</code> は以下のように定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Maybe</span> <span class="ow">:</span> <span class="ow">(</span>a <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">Nothing</span> <span class="ow">:</span> <span class="kt">Maybe</span> a
</span></span><span class="line"><span class="cl">    <span class="nf">Just</span> <span class="ow">:</span> <span class="ow">(</span>x <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> a
</span></span></code></pre></div><p><code>Maybe</code> はあるかないか分からない値を表すのに使います。
チュートリアルでは <code>Maybe</code> 本体しか触らず、他の関数は使いませんでした。
<code>do</code> 記法のところで紹介した通り、 <code>Maybe</code> にも <code>do</code> は使えますしその他 <code>map</code> なんかも使えます。</p>
<h3 id="preludeeitherhttpswwwidris-langorgdocscurrentprelude_docdocspreludeeitherhtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Either.html"><code>Prelude.Either</code></a></h3>
<p><code>Prelude.Either</code> には <code>Either</code> 型とそれに関連する関数が定義されています。</p>
<p><code>Either</code> は以下のように定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Either</span> <span class="ow">:</span> <span class="ow">(</span>a, b <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">Left</span> <span class="ow">:</span> <span class="ow">(</span>l <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Either</span> a b
</span></span><span class="line"><span class="cl">  <span class="nf">Right</span> <span class="ow">:</span> <span class="ow">(</span>r <span class="ow">:</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Either</span> a b
</span></span></code></pre></div><p><code>Either</code> もデータ型本体しか使わず、周辺の関数は使いませんでした。</p>
<p><code>Either</code> は2つの型をとるジェネリクスですが、関数と同じく部分適用できるので左の型だけ決めた <code>Either</code> なんかも作れます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; <span class="kt">Either</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="kt">Either</span> <span class="kt">Int</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
</span></span></code></pre></div><p>逆に右の型だけ決めた(左を自由にした) <code>Either</code> は作れません。
こういう事情があるので右の型のほうが少し扱いやすくなっています。</p>
<h3 id="preludefunctorhttpswwwidris-langorgdocscurrentprelude_docdocspreludefunctorhtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Functor.html"><code>Prelude.Functor</code></a></h3>
<p><code>Prelude.Functor</code> には <code>Functor</code> インターフェースが定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">interface <span class="kt">Functor</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">map</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f b
</span></span></code></pre></div><p><code>Functor</code> は 「<code>map</code> 可能な型」のイメージです。 <code>List</code> にある <code>map</code> を一般化して色々な型に使えるようにしたものです。</p>
<p><code>f</code> はカインド <code>Type -&gt; Type</code> を持ちます。<code>f</code> に <code>List</code> を当てはめると
<code>map : (func : a -&gt; b) -&gt; List a -&gt; List b</code> ですし、 <code>Maybe</code> をあてはめると <code>map : (func : a -&gt; b) -&gt; Maybe a -&gt; Maybe b</code> です。
左の型だけ決めた<code>Either Int</code> も <code>Type -&gt; Type</code> でしたので <code>Functor</code> の実装がされています。</p>
<p>因みに、 <code>map</code> を中置演算子にした <code>&lt;$&gt;</code> というのもあります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  negate <span class="ow">&lt;$&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="ow">-</span><span class="mi">1</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><h3 id="preludeapplicativehttpswwwidris-langorgdocscurrentprelude_docdocspreludeapplicativehtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Applicative.html"><code>Prelude.Applicative</code></a></h3>
<p><code>Prelude.Applicative</code> には <code>Applicative</code> インターフェース と <code>Alternative</code> インターフェースが定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">3</span> <span class="ow">&lt;*&gt;</span>
</span></span><span class="line"><span class="cl">interface <span class="kt">Functor</span> f <span class="ow">=&gt;</span> <span class="kt">Applicative</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">pure</span>  <span class="ow">:</span> a <span class="ow">-&gt;</span> f a
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;*&gt;)</span> <span class="ow">:</span> f <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f b
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">infixr</span> <span class="mi">2</span> <span class="ow">&lt;|&gt;</span>
</span></span><span class="line"><span class="cl">interface <span class="kt">Applicative</span> f <span class="ow">=&gt;</span> <span class="kt">Alternative</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="nf">empty</span> <span class="ow">:</span> f a
</span></span><span class="line"><span class="cl">    <span class="ow">(&lt;|&gt;)</span> <span class="ow">:</span> f a <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f a
</span></span></code></pre></div><p>チュートリアルで使ったのは<code>Applicative</code> の <code>pure</code> です。</p>
<p>すこし分かりづらいですが、 <code>Applicative</code> は1つの捉え方として <code>Functor</code> を多引数関数に拡張したものとみれます。
例えば<code>Maybe Integer</code> 同士を足し算するとしましょう。
<code>map</code> (<code>&lt;$&gt;</code>) を多引数関数に適用すると <code>Maybe (Integer -&gt; Integer)</code> と <code>Maybe</code> に包まれた関数がでてきてしまいます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  add <span class="ow">&lt;$&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="kt">Integer</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="ow">(</span><span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span><span class="ow">)</span>
</span></span></code></pre></div><p>そこで <code>Applicative</code> の <code>&lt;*&gt;</code> を使うと <code>Maybe</code> に包まれた関数と <code>Maybe</code> に包まれた値を計算できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; add <span class="ow">&lt;$&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span> <span class="ow">&lt;*&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">2</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">3</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p><code>pure</code> というのは何もしないコンストラクタです。<code>List</code> なら <code>pure x = [x]</code> ですし <code>Maybe</code> なら <code>pure x = Just x</code> です。
これがあると<code>Maybe</code> に包まれた型と包まれてない型を混ぜて計算できます。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt; add <span class="ow">&lt;$&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span> <span class="ow">&lt;*&gt;</span> <span class="ow">(</span>pure <span class="mi">2</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">3</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p><code>Alternative</code> にいついては説明を省きます。以下の例でなんとなく分かるかと思います。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">λΠ&gt;  <span class="kt">Nothing</span> <span class="ow">&lt;|&gt;</span> <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">1</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">λΠ&gt;  <span class="ow">(</span><span class="kt">Just</span> <span class="mi">1</span><span class="ow">)</span> <span class="ow">&lt;|&gt;</span> <span class="kt">Nothing</span>
</span></span><span class="line"><span class="cl"><span class="kt">Just</span> <span class="mi">1</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span><span class="line"><span class="cl">λΠ&gt; the <span class="ow">(</span><span class="kt">Maybe</span> <span class="kt">Integer</span><span class="ow">)</span> empty
</span></span><span class="line"><span class="cl"><span class="nf">Nothing</span> <span class="ow">:</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><h3 id="preludemonadhttpswwwidris-langorgdocscurrentprelude_docdocspreludemonadhtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Monad.html"><code>Prelude.Monad</code></a></h3>
<p><code>Prelude.Monad</code> には <code>Monad</code> インターフェースが定義されています。<code>do</code> 記法の中身ですね。
<code>join</code> または <code>&gt;&gt;=</code> で実装が与えられます。相互に変換できるので本質的には両者には代わりはありません。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">infixl</span> <span class="mi">1</span> <span class="ow">&gt;&gt;=</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">interface <span class="kt">Applicative</span> m <span class="ow">=&gt;</span> <span class="kt">Monad</span> <span class="ow">(</span>m <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;&gt;=)</span>  <span class="ow">:</span> m a <span class="ow">-&gt;</span> <span class="ow">((</span>result <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> m b<span class="ow">)</span> <span class="ow">-&gt;</span> m b
</span></span><span class="line"><span class="cl">    <span class="nf">join</span> <span class="ow">:</span> m <span class="ow">(</span>m a<span class="ow">)</span> <span class="ow">-&gt;</span> m a
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">-- default implementations</span>
</span></span><span class="line"><span class="cl">    <span class="ow">(&gt;&gt;=)</span> x f <span class="ow">=</span> join <span class="ow">(</span>f <span class="ow">&lt;$&gt;</span> x<span class="ow">)</span>
</span></span><span class="line"><span class="cl">    join x <span class="ow">=</span> x <span class="ow">&gt;&gt;=</span> id
</span></span></code></pre></div><p><code>join</code> は <code>flatten</code> というと分かりやすいでしょうか。<code>Functor</code> では包んでる型を変えず、<code>Applicative</code> では包んでる型を増やし (<code>pure</code>) 、 <code>Monad</code> になって型を減らす(<code>join</code>)操作がでてきました。</p>
<p><code>Monad</code> (<code>&gt;&gt;=</code>)のキモチは、「前のアクション(<code>m a</code>)から結果(<code>a</code>)を受け取って次のアクション(<code>m b</code>)を作る」操作です。
<code>getLine &gt;&gt;= putStrLn</code> とかですね。これを <code>do</code> 記法で書くとこうなります。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="kr">do</span>
</span></span><span class="line"><span class="cl">  input <span class="ow">&lt;-</span> getLine
</span></span><span class="line"><span class="cl">  putStrLn input
</span></span></code></pre></div><h3 id="preludefoldablehttpswwwidris-langorgdocscurrentprelude_docdocspreludefoldablehtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Foldable.html"><code>Prelude.Foldable</code></a></h3>
<p>チュートリアル中でも紹介したとおり、 <code>Foldable</code> は関数型的内部イテレータです。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl">interface <span class="kt">Foldable</span> <span class="ow">(</span>t <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="nf">foldr</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> elem <span class="ow">-&gt;</span> acc <span class="ow">-&gt;</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>init <span class="ow">:</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>input <span class="ow">:</span> t elem<span class="ow">)</span> <span class="ow">-&gt;</span> acc
</span></span><span class="line"><span class="cl">  <span class="nf">foldl</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> acc <span class="ow">-&gt;</span> elem <span class="ow">-&gt;</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>init <span class="ow">:</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>input <span class="ow">:</span> t elem<span class="ow">)</span> <span class="ow">-&gt;</span> acc
</span></span></code></pre></div><p>コレクションならだいたい実装できそうですよね。</p>
<p><code>Functor</code> , <code>Applicative</code> , <code>Monad</code>, <code>Foldable</code> あたりでコレクションというかジェネリックなデータ型の操作は一通りできるんじゃないでしょうか。あとは<a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Traversable.html"><code>Prelude.Traversable</code></a>にも多少操作があります。</p>
<p>例えば <code>for_</code> 。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl">main <span class="ow">=</span> for_ <span class="ow">[</span><span class="mi">1</span>, <span class="mi">2</span>, <span class="mi">3</span><span class="ow">]</span> <span class="ow">$</span> <span class="ow">\</span>x <span class="ow">=&gt;</span>
</span></span><span class="line"><span class="cl">  printLn x
</span></span></code></pre></div><h3 id="preludeinteractivehttpswwwidris-langorgdocscurrentprelude_docdocspreludeinteractivehtml"><a href="https://www.idris-lang.org/docs/current/prelude_doc/docs/Prelude.Interactive.html"><code>Prelude.Interactive</code></a></h3>
<p><code>Prelude.Interactive</code> には標準出入力に関わる関数が定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">putStr</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">putStrLn</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span></code></pre></div><p>見た目の通り文字列を表示します。<code>Ln</code> が付くと改行も表示します。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">getLine</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="kt">String</span>
</span></span></code></pre></div><p>標準入力から文字列を取得する IO アクションです。</p>
<h3 id="preludefilehttpswwwidris-langorgdocscurrentbase_docdocspreludefilehtml"><a href="https://www.idris-lang.org/docs/current/base_doc/docs/Prelude.File.html"><code>Prelude.File</code></a></h3>
<p><code>Prelud.File</code> にはァイル操作関連の関数が定義されています。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">openFile</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Mode</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">File</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">fGetChars</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">Either</span> <span class="kt">FileError</span> <span class="kt">String</span><span class="ow">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">closeFile</span> <span class="ow">:</span> <span class="kt">File</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
</span></span><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Mode</span> <span class="ow">=</span> <span class="kt">Read</span> <span class="ow">|</span> <span class="kt">WriteTruncate</span> <span class="ow">|</span> <span class="kt">Append</span> <span class="ow">|</span> <span class="kt">ReadWrite</span> <span class="ow">|</span> <span class="kt">ReadWriteTruncate</span> <span class="ow">|</span> <span class="kt">ReadAppend</span>
</span></span></code></pre></div><p>特筆することはないですね。</p>
<h2 id="base">Base</h2>
<p>Idrisはプレリュードがリッチすぎるのでチュートリアルの範囲ではBaseはほとんど使いませんでしたね。</p>
<h3 id="datastringhttpswwwidris-langorgdocscurrentbase_docdocsdatastringhtml"><a href="https://www.idris-lang.org/docs/current/base_doc/docs/Data.String.html"><code>Data.String</code></a></h3>
<p>ほんの少しだけ文字列操作関数が定義されています。
チュートリアルではこの関数を使いました。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-idris" data-lang="idris"><span class="line"><span class="cl"><span class="nf">parsePositive</span> <span class="ow">:</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
</span></span></code></pre></div><p>なんか<a href="https://github.com/idris-lang/Idris-dev/issues/4637">バグってるくさい</a> のですが直される気配なし</p>
<h1 id="その他">その他</h1>
<p>ひとまずこれでチュートリアルシリーズは締めようと思います。
気が向いたらEffective Idrisとかそういうのを書くかもしれません。</p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="https://KeenS.github.io/blog/2019/02/03/gitlab_ciderustnocitokurosukonpairu__otegaruhen/"> GitLab CIでRustのCIとクロスコンパイル: お手軽編</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="https://KeenS.github.io/blog/2019/01/24/gitnorebasedesquashwowanraina_de/"> gitのrebaseでsquashをワンライナーで</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2022. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

