<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Fresh勉強会 on κeenのHappy Hacκing Blog</title>
    <link>/categories/fresh%E5%8B%89%E5%BC%B7%E4%BC%9A/</link>
    <description>Recent content in Fresh勉強会 on κeenのHappy Hacκing Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Mon, 22 Jun 2015 22:53:39 +0900</lastBuildDate>
    <atom:link href="/categories/fresh%E5%8B%89%E5%BC%B7%E4%BC%9A/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Clojureおじさん</title>
      <link>/slide/Clojureojisan/</link>
      <pubDate>Mon, 22 Jun 2015 22:53:39 +0900</pubDate>
      
      <guid>/slide/Clojureojisan/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n\n&#34;
    data-vertical=&#34;\n\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# Clojureおじさん
----------------------
サイバーエージント新卒  
第5回 Fresh勉強会

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + 渋谷のエンジニア
 + Lisp, ML, Shell Scriptあたりを書きます

# Clojure 
---------

* 2007年から
* JVMで動くLisp系言語
* 函数型
* 動的型付き
* 値は基本immutable
* 遅延シーケンス
* STMがあり、並列処理に強い


# Hello World
-------------

```clojure
(println &#34;Hello, World&#34;)
```
&lt;!-- .slide: class=&#34;center&#34; --&gt;

# JVM
------
## Javaのコードをシームレスに呼べる

* `obj.method()` ではなく `(.method obj)`
* `Class.staticField` ではなく `Class/staticField`
* `obj.method1().method2()` ではなく `(.. obj method1 method2)`


# JVM
-----

```clojure
(.println System/out &#34;Hello JVM&#34;)
```

```clojure
(Math/random)
```
&lt;!-- .slide: class=&#34;center&#34; --&gt;


# Immutable
-----------

* 状態を持たないのでコードの見通しが良い
  + 並列で考える時には重要
  + 複雑さだけでなく不整合などバグの原因になりやすい
* 変更可能な値もある
  + それらはトランザクション内でのみ変更可能
  + 不整合が起きない


# 函数型
--------

```clojure
(filter odd? (map #(+ 1 %) &#39;(1 2 3)))
```
&lt;!-- .slide: class=&#34;center&#34; --&gt;


# 遅延シーケンス
---------------

```clojure
(def natural_number (iterate inc 1))
(take 5 natural_number) ;=&gt; (1 2 3 4 5)
```
&lt;!-- .slide: class=&#34;center&#34; --&gt;


# リスト内包表記
----------------

```clojure
(for [x (range 5)] (* x x))
;=&gt; (1 4 9 16 25)
```

&lt;!-- .slide: class=&#34;center&#34; --&gt;


#並列処理に強い
---------------

* 簡単にはJavaのスレッドを呼べばいい
  + Clojureの関数は全てCallableでRunnablea

```clojure
(.start (Thread. (fn [] 
                   (Thread/sleep 1000)
                   (println &#39;foo))))
```


#並列処理に強い
---------------
## core.async

* goroutineとgochannelが使える


## core.async
-------------

```clojure
(require &#39;[clojure.core.async :as async :refer :all])
(let [c (chan)]
  (go (&gt;! c &#34;hello&#34;))
  (assert (= &#34;hello&#34; (&lt;!! (go (&lt;! c)))))
  (close! c))
```

```clojure
(require &#39;[clojure.core.async :as async :refer :all])
(let [c (chan)]
  (thread (&gt;!! c &#34;hello&#34;))
  (assert (= &#34;hello&#34; (&lt;!! c)))
  (close! c))
```
&lt;!-- .slide: class=&#34;center&#34; --&gt;


# 今回紹介し切れなかったの
-------------------------

* マクロ
* メタデータ
* protocolとかの多態性
* ClojureScript/Om
* Typed Clojure


# まとめ
--------

* Clojureを使えばJavaが使える
* Clojureを使えばPythonのリスト内包表記が使える
* Clojureを使えばGoのgoroutine/gochannelが使える



&lt;span style=&#34;font-size:200%;&#34;&gt;Why not start Clojure?&lt;/span&gt;
&lt;!-- .slide: class=&#34;center&#34; --&gt;

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>ボトルネックのイイ話</title>
      <link>/slide/botorunekkunoiihanashi/</link>
      <pubDate>Thu, 04 Jun 2015 00:03:14 +0900</pubDate>
      
      <guid>/slide/botorunekkunoiihanashi/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n\n&#34;
    data-vertical=&#34;\n\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# ボトルネックのイイ話
----------------------
サイバーエージェント15新卒  
FRESH勉強会

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + 渋谷のエンジニア
 + Lisp, ML, Shell Scriptあたりを書きます

# ボトルネック
-------------

&gt; ボトルネック (bottleneck) とは、システム設計上の制約の概念。英語の「瓶の首」の意。一部（主に化学分野）においては律速（りっそく、「速さ」を「律する（制御する）」要素を示すために使われる）、また『隘路（あいろ）』と言う同意語も存在する。 


# Webアプリの主な登場人物
------------------------

* リバースプロキシ
* アプリケーションサーバ
* データベース


![relation of reverse proxy, app and DB](/images/webapp.png)

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# レスポンスタイムとスループット
------------------------------

* レスポンスタイム 
  + リクエストを投げてレスポンスが返ってくるまでの時間
  + ユーザから見たメトリクス
* スループット&lt;!-- .element: class=&#34;fragment highlight-red&#34;--&gt;
  + 一定時間内にシステムがどれだけのリクエストを捌けるか
  + 中の人から見たメトリクス


# スループット
-------------

* スループットの最大 ≒ リソースの限界
  + ネットワーク帯域
  + ディスクIO
  + メモリ使用量
  + CPU負荷
* リソースのどれか1つでも限界になったらそれ以上パフォーマンスは上がらない

# パフォマンスの目安
-------------------

* ネットワーク帯域: bpsで表わす。NICによるが 1Gbpsとか
* CPU: パーセンテージで表わす。100xコア数が最大マシンに依る。
* メモリ: Bで表わす。ピンキリだが1GB ~ 128GBくらい？
* ディスクIO: Bpsで表わす。HDDなら 100Bpsとか。SSDなら10倍くらい。

テキトーに調べたので間違ってるかも

# 誰が何を
---------

* リバースプロキシ: ネットワーク、メモリ、CPUなど
* アプリケーションサーバl: CPU、メモリなど
* データベース: CPU、ディスクIOなど


&lt;span style=&#34;font-size: 200%&#34;&gt;「CPUは100%に行ってないのにアプリケーションが遅いんだよ」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* ボトルネックはCPUとは限らない
* 他のメトリクスも一緒に見るべき


# 推測するな。計測せよ
---------------------

* 実際に測ってみないとどこがボトルネックか分からない
* 何をしてどれくらいパフォーマンスが上がったのかも分からない
  + コストパフォーマンスも重要


&lt;span style=&#34;font-size: 200%&#34;&gt;「パフォーマンスが悪いからCPUをグレードアップしよう」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* ボトルネックはCPUとは限らない
* 例えばネットワーク帯域が詰まっているのにCPUを改善しても意味がない
* 帯域が詰まってるならデータを減らす、NIC（マシン）を増やすなどをする


&lt;span style=&#34;font-size: 200%&#34;&gt;「多分アプリケーションを高速化したよ」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* 計測せずに高速化しても意味がない
  + テストの無いリファクタリングがただの破壊なのと同じ
* 高速化した気になって実際はコードが汚なくなっただけの可能性もある

# ボトルネックは変わりうる
------------------------

* 一箇所をずっと改善してても意味がない
* ある程度改善したら次のリソースの限界がきてるかもしれない

&lt;span style=&#34;font-size: 200%&#34;&gt;「アプリケーションを10倍高速化したのにあんまり速くなってない」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* 10倍くらい極端に高速化すると次のリソースがボトルネックになる
* ディスクやネットワークの改善を考えるべき

# リソースの食い合い
-------------------

* 1マシンで完結している場合、リソースの食い合いが発生しうる
  + リバースプロキシとアプリケーションがCPUを食い合うとか
* この時、どのようにして解決するのが適切か？

# 例題
------

* アプリが80%くらいの負荷
* Rプロキシが20%くらいの負荷


# 例題
------

1. アプリが多くCPUを喰ってるからアプリを高速化すべき
2. アプリが多くCPUを必要としてるからRプロキシはアプリにCPUを譲るべき

# 例題
------

1. アプリが多くCPUを喰ってるからアプリを高速化すべき
2. &lt;span style=&#34;color: #aaa;&#34;&gt;アプリが多くCPUを必要としてるからRプロキシはアプリにCPUを譲るべき&lt;/span&gt;

# アムダールの法則
-----------------

* [アムダールの法則 - Wikipedia](http://ja.wikipedia.org/wiki/%E3%82%A2%E3%83%A0%E3%83%80%E3%83%BC%E3%83%AB%E3%81%AE%E6%B3%95%E5%89%87)
* ざっくり言うと比率の小さな部分を高速化しても全体の高速化は高が知れてる

&lt;span style=&#34;font-size: 200%&#34;&gt;「ORマッパ使うと遅そうだから生のSQL使おう」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* ORマッピングにかかるコストは微小
* 他にもっと効率的に改善出来る部分に手をつけるべき

# リソースの配分
---------------

* 逆に、与えられたリソースからどれをどこに割り当てるかの問題もある
* 理論的には負荷の高い部分に多くリソースを割り当てれば良い。
* しかしアプリケーションの構成を先に決めないといけないので事前に計測は出来ない
  + 知識と経験と勘

# 例題
------

* 画像配信アプリケーション
* VPS5台 
  + ネット1Mbps/メモリ1G/CPU4コア/HDD
* Rプロキシ、アプリ、DBにそれぞれ何台割り当てる？
  + 1つのマシンに複数機能を持たせても良い。

# チューニングは難しい
---------------------

* 様々な部分の知識が必要
* システム全体を見渡した設計力も大事
* 細かなチューニングテクニックも一杯
  + 今回話してないが、キャッシュ戦略とかも
  + Cache-Control
* 知識がないと計測しても数値の意味が分からない

&lt;span style=&#34;font-size: 200%&#34;&gt;「やった。5%高速化した」&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 誤り
------

* パフォーマンスは計測の度にゆらぎがある
* 5%くらいなら普通に測定誤差の範囲内
* 逆に、5%くらいの改善をしても意味がない

# チューニングは楽しい
---------------------

* パズルゲームみたいな部分もある
* チューニング次第でスループット何十倍とかいく
* 難しい分一気にパフォーマンスが上がると喜びも一入

# ISUCON

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# ISUCON
--------

* [ISUCON公式Blog](http://isucon.net/)
* Webアプリケーションチューニングコンテスト
* 優勝賞金100万円
* 何でもアリ。どこをいじってもいい。
* 要はさっきの知識をフルで活用出来る


# ISUCON
--------

* 何でもアリは実は珍しい。
  + 他はデータベースのみ、とかアプリは触っちゃだめ、とか雁字搦め
* 前回は185組（1チーム2~3人）の大きな大会
  + 予選で27チームに絞られる
* 界隈の有名人が揃う天下一武闘会の様相
* 楽しい


# 良質な問題
-----------

* 過去問は教育的な問題が多数。
* 過去問は全て公開。
* 腕試しに丁度良い。

# 今年のISUCON
--------------

* 予選 9/26,27
* 本戦 10/31
* 2~3人のチーム
* Google Cloud Platform
* 出題は[@tagomoris](https://twitter.com/tagomoris)さんと[@kamipo](https://twitter.com/kamipo)さん


&lt;span style=&#34;font-size: 300%&#34;&gt;Let&#39;s ISUCON&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

# 参考
------
* [ISUCONで学ぶ Webアプケーションのパフォーマンス向上のコツ 実践編 完全版](http://www.slideshare.net/kazeburo/isucon-summerclass2014action2final)
* [ISUCONの話(夏期講習2014)](http://www.slideshare.net/tagomoris/isucon2014)
* [kamipoさんはすごい人](https://twitter.com/search?q=kamipo%E3%81%95%E3%82%93%E3%81%AF%E3%81%99%E3%81%94%E3%81%84%E4%BA%BA&amp;src=typd&amp;vertical=default&amp;f=tweets)

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
  </channel>
</rss>