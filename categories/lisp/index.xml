<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>κeenのHappy Hacκing Blog</title>
    <link>/categories/lisp/index.xml</link>
    <description>Recent content on κeenのHappy Hacκing Blog</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-jp</language>
    <atom:link href="/categories/lisp/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Rustの型レベルLispっぽいの作った</title>
      <link>/blog/2016/11/06/rustnokatareberulispppoinotsukutta</link>
      <pubDate>Sun, 06 Nov 2016 11:49:43 +0900</pubDate>
      
      <guid>/blog/2016/11/06/rustnokatareberulispppoinotsukutta</guid>
      <description>&lt;p&gt;κeenです。ふとした気紛れでRustの型レベルLispっぽいの作りました。&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;実装自体は&lt;a href=&#34;https://adtech.cyberagent.io/scalablog/2015/12/05/scala-lisp/&#34;&gt;去年Scalaで作た時&lt;/a&gt;とほぼ同じ。
ただしRustでコンパイル時に文字列を処理しようとするとコンパイラプラグインが必要になるので今回はあきらめて素のRustの式のまま。&lt;/p&gt;

&lt;p&gt;こんな感じです。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-rust&#34;&gt;println!(&amp;quot;{}&amp;quot;, eval!(List3&amp;lt;Add, _2, _3&amp;gt;));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Lisp…？感ありますがLispと言い張ります。&lt;/p&gt;

&lt;p&gt;少しだけ工夫した点はシンボルをアルファベットのListにすることで任意の文字列を表現出来るようにした点、関数を&lt;code&gt;Fun&lt;/code&gt; 、 &lt;code&gt;Fun2&lt;/code&gt; といったトレイトで抽象化することでユーザも関数を定義出来るようにした点です。&lt;/p&gt;

&lt;p&gt;例えばフィボナッチ数列は&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-rust&#34;&gt;pub type Fib = Symbol&amp;lt;Sym3&amp;lt;F, I, B&amp;gt;&amp;gt;;

impl Fun1&amp;lt;_0&amp;gt; for Fib {
    type Out = _1;
}

impl Fun1&amp;lt;_1&amp;gt; for Fib {
    type Out = _1;
}

impl &amp;lt;T1N: Num, N1_O: Num, N2_O: Num, NO: Num&amp;gt;Fun1&amp;lt;Number&amp;lt;Succ&amp;lt;Succ&amp;lt;T1N&amp;gt;&amp;gt;&amp;gt;&amp;gt; for Fib
    where Fib: Fun1&amp;lt;Number&amp;lt;Succ&amp;lt;T1N&amp;gt;&amp;gt;, Out = Number&amp;lt;N1_O&amp;gt;&amp;gt;,
          Fib: Fun1&amp;lt;Number&amp;lt;     T1N &amp;gt;, Out = Number&amp;lt;N2_O&amp;gt;&amp;gt;,
          Add: Fun2&amp;lt;Number&amp;lt;N1_O&amp;gt;, Number&amp;lt;N2_O&amp;gt;, Out = Number&amp;lt;NO&amp;gt;&amp;gt;
{
    type Out = Number&amp;lt;NO&amp;gt;;
}

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;と定義出来ます。&lt;/p&gt;

&lt;p&gt;ただし、Rustの型検査が許す再帰深度がかなり小さいため、&lt;code&gt;List2&amp;lt;Fib, _6&amp;gt;&lt;/code&gt;で音を上げます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;   Compiling rustlisp v0.1.0 (file:///home/kim/Rust/rustlisp)
error[E0275]: overflow evaluating the requirement `_: std::marker::Sized`
 --&amp;gt; &amp;lt;rustlisp macros&amp;gt;:1:20
  |
1 | ( $ t : ty ) =&amp;gt; { &amp;lt;&amp;lt; $ t as Eval &amp;gt; :: Out as Expr &amp;gt; :: to_string (  ) }
  |                    ^^^^^^^^^^^^^^^^^^^^^^
src/main.rs:18:20: 18:41 note: in this expansion of eval! (defined in &amp;lt;rustlisp macros&amp;gt;)
&amp;lt;std macros&amp;gt;:2:27: 2:58 note: in this expansion of format_args!
&amp;lt;std macros&amp;gt;:3:1: 3:54 note: in this expansion of print! (defined in &amp;lt;std macros&amp;gt;)
src/main.rs:18:5: 18:43 note: in this expansion of println! (defined in &amp;lt;std macros&amp;gt;)
  |
  = note: consider adding a `#![recursion_limit=&amp;quot;128&amp;quot;]` attribute to your crate
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun2&amp;lt;rustlisp::num::Number&amp;lt;_&amp;gt;, rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::A, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::D, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::fun::Fun1&amp;lt;rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;` for `rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::F, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::I, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::B, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;`
  = note: required because of the requirements on the impl of `rustlisp::eval::Eval` for `rustlisp::cons::ConsCell&amp;lt;rustlisp::symbol::Symbol&amp;lt;rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::F, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::I, rustlisp::symbol::SymCons&amp;lt;rustlisp::symbol::B, rustlisp::symbol::Eos&amp;gt;&amp;gt;&amp;gt;&amp;gt;, rustlisp::cons::ConsCell&amp;lt;rustlisp::num::Number&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Succ&amp;lt;rustlisp::num::Zero&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;&amp;gt;, rustlisp::cons::Nil&amp;gt;&amp;gt;`

error: aborting due to previous error

error: Could not compile `rustlisp`.

To learn more, run the command again with --verbose.

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;スタックを作ってどうこう、とかも考えたのですが上手くいきませんでした。悲しい。&lt;/p&gt;

&lt;p&gt;ということで小ネタでした。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>高速な継続ライブラリに向けて</title>
      <link>/slide/kousokunakeizokuraiburarinimukete/</link>
      <pubDate>Sun, 08 May 2016 21:26:32 +0900</pubDate>
      
      <guid>/slide/kousokunakeizokuraiburarinimukete/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# 高速な継続ライブラリに向けて
----------------------
[継続勉強会](http://connpass.com/event/28150/) 2016-05-22
&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + サイバーエージェントのエンジニア
 + Lisp, ML, Rust, Shell Scriptあたりを書きます
===
# 継続欲しい
-----------

* 色々な場面で便利
* Schemeで使い回してるのうらやましい
* Common Lispでも使いたい
* 現実には限定継続が欲しい
  +  Common Lispには大域脱出はある

===
# 限定継続を使う例
-----------------
## 非同期プログラミング

* コールバック形式だと厳しい
* 限定継続を使うと綺麗に書き直せる

===
# 限定継続を使う例
-----------------
## ゲームのコルーチン

* 複数のオブジェクトを制御するのにコルーチンが欲しい
* cf [コルーチンをCommon Lispで簡単に定義 - さくらんぼのlambda日記](http://lambdasakura.hatenablog.com/entry/20111026/1319598590)

===
# 限定継続を使う例
-----------------
## do記法

* モナドのdo記法は限定継続を使って実装出来る
* [Operational monad in scheme](http://www.slideshare.net/yuichinishiwaki/operational-monad-in-scheme)


===
# Common Lispでの限定継続の実現
---------------

1. 仕様に入れてもらう
2. 処理系に手を入れる
3. ユーザレベルで(限定)継続ライブラリを作る
   + 柔軟なCommon Lispでは可能

===
# CPS変換
---------

* (限定)継続の実現方法の1つ
  + スタックを切り取る方式とかもある
* 機械的にも出来る
* グローバルな変換なのとプリミティブな式しか書けないでコンパイラ内部でやることが多い
  + 継続関係なしに中間形式として採用されることが多い
* 関数定義/呼び出し以外にも諸々の構文とかに対しても定義が必要

===
# CPS変換
----------

Q. Common Lispだといくつの構文に対して定義が必要?

1. 1つ
2. 26つ
3. 42つ
4. 無数


===
# CPS変換
----------

A. 26つ (スペシャルフォーム25+funcall)

===
# Common Lispのプリミティブ
--------------------------

* スペシャルフォームと呼ばれる
* 仕様で25個定められている
* [CLHS: Section 3.1.2.1.2.1](http://www.lispworks.com/documentation/HyperSpec/Body/03_ababa.htm)
* この中に関数定義だとか例外だとかは入っていない
  + マクロで定義されている

===
# マクロ
--------

* 構文木 to 構文木(S式to S式)変換器( = 普通のLispの関数)
* 新しい構文を作れる
* CPS変換は?????

===
# `macroexpand`
-------------

* [CLHS: Function MACROEXPAND, MACROEXPAND-1](http://clhs.lisp.se/Body/f_mexp_.htm)
* マクロを手動展開する関数
* 雑にいうと普段pre-orderなマクロ展開をin-orderやpost-orderにする時に使う
* 本来はあまり使いたくない
  + 処理系の展開器に任せた方が間違いが少ない
* これでマクロを排したプリミティブのCommon Lispの構文木にアクセス出来る

===
# cl-cont
---------

* 上記のことを全てやったライブラリ
* デファクトというか唯一のライブラリ
* [Common Lispで限定継続と遊ぶ | κeenのHappy Hacκing Blog](http://keens.github.io/slide/Common_Lispdegenteikeizokutoasobu_/)

===
&lt;blockquote class=&#34;twitter-tweet&#34; data-lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;「shift/resetがわからない時にあげる声」&lt;/p&gt;&amp;mdash; かず(原材料に小麦粉を含む) (@kazzna) &lt;a href=&#34;https://twitter.com/kazzna/status/674026894602309632&#34;&gt;2015年12月8日&lt;/a&gt;&lt;/blockquote&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# cl-contの使用例

``` common-lisp
(with-call/cc
  (+ 1 (call/cc
        (lambda (k)
          (funcall k 2)))))
```

===
# cl-contの使用例

``` common-lisp
(FUNCALL
 (LAMBDA (&amp;OPTIONAL #:G542 &amp;REST #:G543)
   (DECLARE (IGNORABLE #:G542))
   (DECLARE (IGNORE #:G543))
   (FUNCALL
    (LAMBDA (&amp;OPTIONAL #:G544 &amp;REST #:G545)
      (DECLARE (IGNORABLE #:G544))
      (DECLARE (IGNORE #:G545))
      (FUNCALL (LAMBDA (K) (FUNCALL K 1))
               (LAMBDA (&amp;OPTIONAL #:G546 &amp;REST #:G547)
                 (DECLARE (IGNORABLE #:G546))
                 (DECLARE (IGNORE #:G547))
                 (FUNCALL (CL-CONT::FDESIGNATOR-TO-FUNCTION/CC #:G542) #&#39;VALUES
                          #:G544 #:G546))))
    1))
 #&#39;+)
```


===
# cl-contへの不満
-----------------

* 遅い
* lambda多い。
  + 多分コンパイラと相性が悪い
* lambda禁止おじさんと分かりあえる

===
# cl-fast-cont


&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# cl-fast-cont
--------------

* [KeenS/cl-fast-cont: faster partial contiuation library of common lisp](https://github.com/KeenS/cl-fast-cont)
* とりあえずレポジトリ作っただけ
* 完成させたい…

===
# アプローチ1
&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# SSA使う
---------

* CPSと等価
* だけどSSAだったらlambda出てこない
* Common Lispならgotoあるしいけるんじゃね？

===
```common-lisp
(let (x y z)
 (tagbody
    (setq x 1)
  :call/cc
    (setq y 1)
    (setq z (+ x y))))
```


===
# 問題
-------

* ネイティブスタックとは別に自分でスタック作らないといけない
  + 例外とかでスタック巻き戻されるとつらい
* gotoのタグをtagbodyの外に持ち出せない(=継続を外に持ち出せない)
* 変数を準備するのが面倒orパフォーマンスに影響しそう
* そもそもtagbodyそこまで柔軟じゃなかった
* 関数が消し飛ぶ

===
# アプローチ2
&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# SSA+CPS
---------

* SSAとCPSを組み合わせる
* 基本はSSA
* スタックを使う/継続が必要な所でだけCPS
===
# 問題
-------

* SSAの部分意味なくね？
* そもそも継続を取り出すのが目的なので関係ない所で変換しても意味がない

===
# アプローチ3
&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# Selective CPS
----------------

* 継続が必要な部分でのみ変換
* 2 pass transformation
* [A Selective CPS Transformation](http://www.sciencedirect.com/science/article/pii/S1571066104809691)
===

```common-lisp
(with-call/cc
  (let ((x 3) y)
    (setq y (* x x))
    (+ 1 (call/cc
          (lambda (k)
            (funcall k y))))))

```

===

```common-lisp
(with-call/cc
  (let ((x 3) y)
    (setq y (* x x))
    (+ 1 @(call/cc
          (lambda (k)
            (funcall k y))))))

```

===

```common-lisp
(with-call/cc
  (let ((x 3) y)
    (setq y (* x x))
    @(+ 1 @(call/cc
          (lambda (k)
            (funcall k y))))))

```

===

```common-lisp
(with-call/cc
  @(let ((x 3) y)
    (setq y (* x x))
    @(+ 1 @(call/cc
          (lambda (k)
            (funcall k y))))))

```

===
# そもそもCommon Lispのつらい話
-------------------------------
* セマンティクスが動的
  + catch, block, tagbody
  + special variable
  + 変換は静的なのでどう頑張っても追い付かない
* multiple valueが面倒


===
# ダイナミック!!
----------------

``` common-lisp
(block name
 (let ((f
        (lambda (x) (return-from name x))))
   (with-call/cc
       (funcall
        f
        (call/cc
         (lambda (k)
           (funcall k 2)))))))
```

===
# スペシャル変数
---------------

* Common Lispにはレキシカルスコープとダイナミックスコープ両方ある
* CPS変換すると継続の全てがスコープ下に入る
  + 関数の呼び出し関係が木だったのが線型になる
  + ダイナミックスコープだと困る
===
![CPS前のAST](/images/cps/pre-cps.png)


===
![CPS後のAST](/images/cps/post-cps.png)


===
```
(defvar *x* 1)
(with-call/cc
  (progn
    (let ((*x* 2))
      (call/cc ..)
      (format t &#34;~a~%&#34; *x*)) ; *x* = 2
    (format t &#34;~a~%&#34; *x*))) ; *x* = 1

```

===

```
(defvar *x* 1)
(with-call/cc
  (progn
    (let ((*x* 2))
      (...
       (lambda (ignore)
         ((lambda (ignore)
            (format t &#34;~a~%&#34; *x*)) ; *x* = 2!!
          (format t &#34;~a~%&#34; *x*))))))) ; *x* = 1
```

===
# 多値
------

* Common Lispの多値はGoと違って無視出来る
* 変換が空気読む必要がある
* 下手するとプログラムを壊す
  1. 本当は多値を返してるのに変換で無視された
  2. 意図的に無視してるのに変換で加えられた

===
# 関数定義と引数の数
-----------------

* **Selective** CPS
* 関数をCPS変換するときとしない時がある
* 呼び出す時にどっちか分かんなくね？
  1. 統一的に変換してしまう
  2. Selectiveに変換して関数にメタデータつける

-&gt; まだ決めきれてない

===
# パフォーマンス
----------------


&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# フィボナッチ数列
-----------------
* とりえあずのフィボナッチ数列で計測
  + Full CPS変換に割と不利
  + 何も考えずにライブラリを使うとこうなるよって例
* Selective CPSは何もしない=普通の定義と同じ


===
```common-lisp
(defun fib (n)
  (if (&lt;= n 1)
      1
      (+ (fib (- n 1)) (fib (- n 2)))))
```

``` common-lisp
(defun/cc fib-cont (n)
  (if (&lt;= n 1)
      1
      (+ (fib-cont (- n 1)) (fib-cont (- n 2)))))
```

===
# Selective


```
Evaluation took:
  1.517 seconds of real time
  1.516000 seconds of total run time (1.516000 user, 0.000000 system)
  99.93% CPU
  4,388,993,782 processor cycles
  0 bytes consed
```

===
# Full

```
Evaluation took:
  18.347 seconds of real time
  18.576000 seconds of total run time (18.248000 user, 0.328000 system)
  [ Run times consist of 1.396 seconds GC time, and 17.180 seconds non-GC time. ]
  101.25% CPU
  53,149,416,888 processor cycles
  22,922,853,904 bytes consed
```
===
# コルーチン
------------

* そこまでFull CPSに不利じゃない
* 割と実用しそうな例
* Selective CPSは少しだけラムダが少ない

===
# Selective

``` common-lisp
(let (c)
  (setf c ((lambda ()
             (write-line &#34;in thread A 1&#34;)
             (lambda ()
              (write-line &#34;in thread A 2&#34;)
              (lambda ()
                (write-line &#34;in thread A 3&#34;))))))
  (write-line &#34;in main thread 1&#34;)
  (setq c (funcall c))
  (write-line &#34;in main thread 2&#34;)
  (setq c (funcall c))
  (write-line &#34;in main thread 3&#34;))
```


===
# full

```common-lisp
(let (c)
  (setf c (with-call/cc
            (write-line &#34;in thread A 1&#34;)
            (let/cc k k)
            (write-line &#34;in thread A 2&#34;)
            (let/cc k k)
            (write-line &#34;in thread A 3&#34;)))
  (write-line &#34;in main thread 1&#34;)
  (setq c (funcall c))
  (write-line &#34;in main thread 2&#34;)
  (setq c (funcall c))
  (write-line &#34;in main thread 3&#34;))
```
===
# Selective

```
Evaluation took:
  0.905 seconds of real time
  0.904000 seconds of total run time (0.904000 user, 0.000000 system)
  99.89% CPU
  2,617,396,241 processor cycles
  0 bytes consed

```

===
# full

```
Evaluation took:
  1.272 seconds of real time
  1.272000 seconds of total run time (1.272000 user, 0.000000 system)
  100.00% CPU
  3,681,362,466 processor cycles
  0 bytes consed
```

===
# まとめ
--------

* 限定継続便利だよ
* マクロを使えばCPS変換で限定継続実装出来るよ
* でもパフォーマンや言語の問題もあるよ
* Selective CPSを使えばパフォーマンスの問題解決出来るよ

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>ClojureでSSPを作った話</title>
      <link>/slide/ClojuredeSSPwotsukuttahanashi/</link>
      <pubDate>Mon, 22 Feb 2016 20:19:11 +0900</pubDate>
      
      <guid>/slide/ClojuredeSSPwotsukuttahanashi/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# ClojureでSSPを作った話
----------------------

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + サイバーエージェントのエンジニア
 + Lisp, ML, Rust, Shell Scriptあたりを書きます

===
# SSPとは
-------
※今回作ったものの話なので実際は少し違う

* Supplier Side Platform
* メディアからの広告リクエストを受けて表示権をオークションに掛け、落札された広告を表示する
  0. 広告リクエストを受け取って
  1. 各DSPに競りの通知を投げて
  2. 入札を受け取って
  3. 落札者と落札価格を決めて
  4. 落札通知を出す

===
# アドテクコンペ
---------------

* [ビジネスモデルもエンジニアリングも学べるアドテクスタジオの育成プログラムとは | 株式会社サイバーエージェント](https://www.cyberagent.co.jp/techinfo_detail/id=11380)
* サイバーエージェントの学生向けインターン
* 3日間、3、4人のチームで **DSP** を作る
* 学生は7チーム、1チームあたり2000q/sを捌くことになってる
* 学生のDSPを繋ぐための **SSP** が必要になったので作ることに。

===
&lt;iframe src=&#34;//www.slideshare.net/slideshow/embed_code/key/92I5tQt6q6IjII&#34; width=&#34;425&#34; height=&#34;355&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34; style=&#34;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&#34; allowfullscreen&gt; &lt;/iframe&gt; &lt;div style=&#34;margin-bottom:5px&#34;&gt; &lt;strong&gt; &lt;a href=&#34;//www.slideshare.net/prir/ss-35918532&#34; title=&#34;日本におけるアドテク市場とサイバーエージェントのアドテク事業について&#34; target=&#34;_blank&#34;&gt;日本におけるアドテク市場とサイバーエージェントのアドテク事業について&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&#34;//www.slideshare.net/prir&#34; target=&#34;_blank&#34;&gt;CyberAgent, Inc.&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;

===
# 作るもの
----------

* 各DSPに競りの通知(HTTPリクエスト)を投げる大規模HTTPクライアント
  + 各DSPが2000q/s x 7チーム + 落札通知 = 16000q/s
  + 丁度2000q/sになるような制御も必要
* 入札を受けてのオークション、結果のロギングなど
* 管理画面

===
# s7pについて
-------------

* 今回作ったSSP
* [KeenS/s7p](https://github.com/KeenS/s7p)
* Clojure製
* 3日くらいで作った
* やや粗い部分も

===
# 今日話すこと
--------------

* なぜClojureか
* 16000q/s出すための工夫
* 16000q/sに抑えるための制御
* 運用して困った話とか

===

# なぜClojureか

&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# なぜClojureか
---------------

* リクエストの数が多いので非同期IOは必須
* 100msでタイムアウトする仕様なのでタイムアウト処理も
* もともとはScala(akka)で作ったs6pがあった
* Actorの設計が良くなかったので遅かった
* あと非同期HTTPクライアントにタイムアウトがなかった
* プロダクションコードを流用したのでインターンが終わった後公開出来なかった
* 別言語で書き直すにあたってGo, Clojure, Common Lisp, Rust, Erlangが検討された
===
# なぜClojureか
---------------

* Common Lisp: 一番慣れてるが、非同期HTTPクライアント(とfutureライブラリ)が使いづらそうなのでやめた
* Rust: とりあえずパフォーマンスは出そうだし使いたかったが非同期HTTPクライアントが見付からなかった
* Clojure: そこそこ慣れてるし速そうな非同期HTTPクライアントがあった。core.asyncで非同期プログラミングもし易い
* Erlang: 恐らく一番向いてるが、ほとんど経験がない
* Go: 結構向いてそうだがあまり経験がないのでClojureを選んだ

===
# 16kq/s出すための工夫
&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# 16kq/s出すための工夫
------------------------
非同期IO（一部同期しちゃったけど）

``` clojure
(defn work [test req result]
  (-&gt;&gt; @dsps
       (sequence (comp
       ;; 全DSPにPOSTしてから(timeout 100ms)
                  (map (fn [dsp] {:dsp dsp :response (http/post (:url dsp) (json-request-option req))}))
       ;; 結果を待ち合わせる
                  (map destruct)
                  ...))
       ...))
    ....
```

===
# 16kq/s出すための工夫2
------------------------
一部同期したのでとにかくスレッド。スレッドへのディスパッチはチャネルで一発解決。

``` clojure
(defn worker [c]
  (thread
   ...))
```

```clojure
(defn make-workers [ch n]
  (doall (map (fn [_] (core/worker ch)) (range n))))
```

``` clojure
 workers (manage/make-workers ch 1024)
```

===
# 16kq/s出すための工夫3
------------------------
ZeroMQを使ったmaster-slave構成
(最終的にSlave18台)

![master-slave構成図](/images/s7p/s7p.svg)


===
# &lt;span style=&#34;font-size: 90%&#34;&gt;16kq/sに抑えるための制御&lt;/span&gt;
&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# &lt;span style=&#34;font-size: 90%&#34;&gt;16kq/sに抑えるための制御&lt;/span&gt;
---------------------------

* DSPの買い付け能力というビジネス的な問題ではなくサーバの負荷という技術的な問題による制御
* 1秒で160kクエリ投げて9秒休むとかは出来ない。もう少し細かく制御する必要がある。
* しかし制御をあまり細かくしすぎると今度はそこで遅くなりそう。
* リクエストを実際に投げるSlaveは分散してるけど統一した制御が必要

===
# &lt;span style=&#34;font-size: 90%&#34;&gt;16kq/sに抑えるための制御&lt;/span&gt;
---------------------------
Master側で100ms毎にに200個だけZeroMQのキューに積む

![QPS制御の図](/images/s7p/qps_control.svg)

===
# &lt;span style=&#34;font-size: 90%&#34;&gt;16kq/sに抑えるための制御&lt;/span&gt;
---------------------------
実装にはcore.asyncの `chan` と `timeout` を使用。(非同期プログラミング便利!)

```Clojure
(defn start-query [sender reqs]
  (let [timer (timer 100)]
    (go-loop []
      (let [t (&lt;! timer)
            took (take @qp100ms @reqs)]
        (doall
         (doseq [req took]
           (zmq/send-str sender (json/generate-string req))))
        (swap! reqs #(drop @qp100ms %))
        (if (and t (not (empty? took)))
          (recur)
          (println &#34;request done&#34;))))
    timer))
```

===
# 運用して困った話とか
&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# 運用して困った話とか
---------------------
## &lt;span style=&#34;font-size: 50%&#34;&gt;レスポンスが遅いDSPにSSPのパフォーマンスが引き摺られる&lt;/span&gt;
* DSPが速ければ余裕を見ても10台あれば十分だった
* DSPのパフォーマンスに仮定をおけないので上限ギリギリの18台
* 同期: 「DSP作ってる時はちょっとくらい待ってくれよ、って思ってたけどSSP運用したら遅いDSPガンガン切りたくなる気持分かった」
===
# 運用して困った話とか
---------------------
## パフォーマンス検証が大変
* リクエストを捌くサーバのパフォーマンスをどうするか悩む
* サーバをチューニングすればSSPも速くなるが、検証にならない
* かといって投げたクエリを捌けないサーバに対して検証する訳にもいかない
* 結局安全側に倒したパフォーマンス見積りに。

===
# 運用して困った話とか
---------------------
## &lt;span style=&#34;font-size: 80%&#34;&gt;Masterがログ吐きすぎてDisk Full&lt;/span&gt;
* 最初の予定ではMasterはディスクをそんなに使わなかったのでディスクの小さいインスタンスだった
* ディスクスペース空けてMaster再起動で復旧。焦った。
===
# 運用して困った話とか
---------------------
## &lt;span style=&#34;font-size: 60%&#34;&gt;timeoutし続けるDSPがいてSlave完全沈黙&lt;/span&gt;
* コネクションのクローズ待ちで固まってた
* 該当DSPを切った上でSlaveの再起動で復旧
  * カーネルのチューニングかtimeout頻度の検知が必要そう
* timeoutを考慮に入れた構成にしてた筈なので想定外だった
===
# まとめ
---------

* ClojureでSSP作ったよ
* Clojure使えば非同期プログラミングが簡単に出来るよ
* 運用って大変だよ

===
# 参考
-------

* [KeenS/s7p: sexp version of s6p; a toy SSP.](https://github.com/KeenS/s7p)
* [ClojureでDSPを作った話 | κeenのHappy Hacκing Blog](http://keens.github.io/slide/ClojuredeDSPwotsukuttahanashi/)
* [KeenS/b11d: A toy DSP](https://github.com/KeenS/b11d)
* [アドテクコンペ | 株式会社サイバーエージェント](https://www.cyberagent.co.jp/recruit/fresh/program_detail/id=11303&amp;season=2016)
* [ビジネスモデルもエンジニアリングも学べるアドテクスタジオの育成プログラムとは | 株式会社サイバーエージェント](https://www.cyberagent.co.jp/techinfo_detail/id=11380)

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>readlineの作り方</title>
      <link>/blog/2016/02/14/readlinenotsukurikata</link>
      <pubDate>Sun, 14 Feb 2016 22:37:35 +0900</pubDate>
      
      <guid>/blog/2016/02/14/readlinenotsukurikata</guid>
      <description>&lt;p&gt;κeenです。なんか伏線っぽいもの回収しといた方が良いかなと思ってLinuxっぽい話でも。
&lt;/p&gt;

&lt;p&gt;readlineって便利ですよね。
でもCで書かれているから他の言語から使おうと思うと面倒だったり使えなかったりGPLv3の所為で使えなかったりしますよね。
そこである程度POSIXのインターフェースを扱わせてくれる言語でのreadlineの作り方でも。&lt;/p&gt;

&lt;h1 id=&#34;カノニカルモードとエコーモード&#34;&gt;カノニカルモードとエコーモード&lt;/h1&gt;

&lt;p&gt;readlineの仕組み自体は簡単で、全ての文字入力を受け取って、&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;readlineの制御キーシーケンスなら指定の制御を行なう&lt;/li&gt;
&lt;li&gt;普通の文字ならそのまま画面に表示する&lt;/li&gt;
&lt;li&gt;コントロールシーケンスなら &lt;code&gt;^W&lt;/code&gt; などとエスケープ表示する&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;これだけです。しかしそう簡単ではありません。
あなたのお気に入りの言語で &lt;code&gt;readchar&lt;/code&gt; っぽい関数を実行してみると分かるかと思いますが、&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;一文字入力しただけではプログラムに入力文字が渡されない。エンターキーを押して初めてプログラムの &lt;code&gt;readchar&lt;/code&gt; 関数が返る。&lt;/li&gt;
&lt;li&gt;入力した文字がそのままエコーバックされる。すなわち、 &lt;code&gt;←&lt;/code&gt; を押しても &lt;code&gt;^[[D&lt;/code&gt; が入力されてしまい、制御上不都合。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;私は昔はこれらの挙動が適切な関数がないからだと思ってました。しかし、そうではありません。
このような挙動をするのはプログラムの責任でもでもシェルの責任でもなくターミナルの責任です。&lt;/p&gt;

&lt;p&gt;ターミナルには多彩なモードがあり、それによって挙動が変わるのです。
つまり、1.の挙動をするのはカノニカルモードの挙動、2.の挙動をするのはエコーモードの挙動なのです。&lt;/p&gt;

&lt;h1 id=&#34;tcgetattr-と-tcsetattr&#34;&gt;&lt;code&gt;tcgetattr&lt;/code&gt; と &lt;code&gt;tcsetattr&lt;/code&gt;&lt;/h1&gt;

&lt;p&gt;さて、ターミナルのモードはプログラム側から変更出来ます。それを行なうのが &lt;code&gt;tcgetattr(3)&lt;/code&gt; と &lt;code&gt;tcsetattr(3)&lt;/code&gt; です。
ざっくり言うと &lt;code&gt;tcgetattr&lt;/code&gt; で現在のターミナルのコンフィグレーションを取得して、それを所望のモードに書き換え、 &lt;code&gt;tcsetattr&lt;/code&gt; を使って反映出来ます。&lt;/p&gt;

&lt;p&gt;今回はカノニカルモードとエコーモードをoffにしたいのですごい雑なコードだとこう書けるでしょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(require &#39;sb-posix)
(let* ((stdin 0)
       (termios (sb-posix:tcgetattr stdin))
       (lflag (sb-posix:termios-lflag termios)))
  (setf lflag (logand lflag (lognot sb-posix:icanon)))
  (setf lflag (logand lflag (lognot sb-posix:echo)))
  (setf (sb-posix:termios-lflag termios) lflag)
  (sb-posix:tcsetattr stdin sb-posix:tcsadrain termios))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;しかし、これは雑すぎます。なぜならreadlineを実行し終わった後にターミナルを元の状態に復元する必要があるからです。
そうしないとreadlineするつもりのない入力関数が予期せぬ挙動をするでしょう。
あるいはLispプロセスを終了した後のターミナルにまで影響が及びます。
なので &lt;strong&gt;必ず&lt;/strong&gt; 処理が終わったらターミナルの状態を復元する必要があります。&lt;/p&gt;

&lt;p&gt;さて、Common Lispではこの「必ず」は &lt;code&gt;unwind-protect&lt;/code&gt; を使った &lt;code&gt;with-&lt;/code&gt; マクロで実現するのが常套手段です。
コードはこのようになるでしょうか。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defmacro with-readline-mode (&amp;amp;body body)
  (let ((stdin       (gensym &amp;quot;stdin&amp;quot;))
        (old-termios (gensym &amp;quot;old-termios&amp;quot;))
        (new-termios (gensym &amp;quot;new-termios&amp;quot;))
        (lflag       (gensym &amp;quot;lflag&amp;quot;)))
    `(let* ((,stdin 0)
            (,old-termios (sb-posix:tcgetattr ,stdin))
            (,new-termios (sb-posix:tcgetattr ,stdin))
            (,lflag (sb-posix:termios-lflag ,new-termios)))
       (unwind-protect
            (progn
              (setf ,lflag (logand ,lflag (lognot sb-posix:icanon)))
              (setf ,lflag (logand ,lflag (lognot sb-posix:echo)))
              (setf (sb-posix:termios-lflag ,new-termios) ,lflag)
              (sb-posix:tcsetattr ,stdin sb-posix:tcsadrain ,new-termios)
              ,@body)
        (sb-posix:tcsetattr ,stdin sb-posix:tcsadrain ,old-termios)))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;これで&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(with-readline-mode
  (format t &amp;quot;~a~%&amp;quot; (read-char)))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;などとするとターミナルのモードが変わったことが実感出来るでしょう。&lt;/p&gt;

&lt;p&gt;尚、繰り返すとこれはターミナルの設定の話なのでEmacs内から試そうとしても正常に動作しない筈です。&lt;/p&gt;

&lt;h1 id=&#34;コントロールシーケンス&#34;&gt;コントロールシーケンス&lt;/h1&gt;

&lt;p&gt;さて、Common Lispの標準にない拡張機能が必要なのはターミナルのモード変更だけで、あとは好き勝手出来るのですが私も少し嵌った部分があるのでそこだけ。&lt;/p&gt;

&lt;p&gt;readlineに欲しい機能はなんでしょうか。色々あるかと思いますが、まずは &lt;code&gt;←&lt;/code&gt; 、 &lt;code&gt;→&lt;/code&gt; でカーソル移動をしたいのではないでしょうか。
実はこれが大落し穴。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;←&lt;/code&gt; キーを押すとターミナルにはなんと3文字入力されます。すなわち、 Esc文字の &lt;code&gt;^[&lt;/code&gt; 、普通のASCII文字の &lt;code&gt;[&lt;/code&gt; 、そして大文字の &lt;code&gt;D&lt;/code&gt; です。&lt;/p&gt;

&lt;p&gt;そしてカーソルの移動文字を受けてカーソルを移動するにはターミナルにそのままEsc文字の &lt;code&gt;^[&lt;/code&gt; 、普通のASCII文字の &lt;code&gt;[&lt;/code&gt; 、そして大文字の &lt;code&gt;D&lt;/code&gt; を入力してあげれば出来ます。&lt;/p&gt;

&lt;p&gt;なのでこのようなコードになるでしょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defconstant left &amp;quot;[d&amp;quot;)
(defconstant right &amp;quot;[c&amp;quot;)

(defun left ()
  (format t &amp;quot;~a&amp;quot; left)
  (force-output))

(defun right ()
  (format t &amp;quot;~a&amp;quot; right)
  (force-output))


(defun readline ()
  (let ((line &#39;()))
    (flet ((self-insert (char)
             (format t &amp;quot;~c&amp;quot; char)
             (setf line (cons char line))
             (force-output)))
      (with-readline-mode
       (loop
          (let* ((char (read-char))
                 (code (char-code char)))
            (case code
              ; escape
              ((#b11011)
               (let* ((char (read-char))
                      (code (char-code char)))
                 ;; (write-line &amp;quot;called&amp;quot;)
                 ;; (format t &amp;quot;~a~%&amp;quot; char)
                 ;; (format t &amp;quot;~a~%&amp;quot; code)
                 (case char
                   ((#\[)
                    (let* ((char (read-char))
                           (code (char-code char)))
                      (case char
                        ((#\c) (right))
                        ((#\d) (left)))))
                   ((t)
                    (self-insert #\escape)
                    (self-insert char)))))
              ((#b1010)
               (return-from readline (coerce (reverse line) &#39;string)))
              (t (self-insert char)))))))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;case&lt;/code&gt; をネストしていくのはダルいし拡張性がないので現実的にはtrie木を使うことになるかと思いますが単純にはこのようなコードでreadlineを作れます。&lt;/p&gt;

&lt;p&gt;Let&amp;rsquo;s Happy Hacκking!&lt;/p&gt;

&lt;h1 id=&#34;付録a-伏線&#34;&gt;付録A: 伏線&lt;/h1&gt;

&lt;blockquote class=&#34;twitter-tweet&#34; data-lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;適当に魚と野菜炒めたらオサレっぽくなった &lt;a href=&#34;https://t.co/9IIzhIGjzd&#34;&gt;pic.twitter.com/9IIzhIGjzd&lt;/a&gt;&lt;/p&gt;&amp;mdash; κeen (@blackenedgold) &lt;a href=&#34;https://twitter.com/blackenedgold/status/698821538686984192&#34;&gt;2016, 2月 14&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; data-lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; 魚は何？タラ？だったら季節物だし、旬の鱈と野菜のソテー、詳解Linuxカーネルを添えて。と命名しよう&lt;/p&gt;&amp;mdash; Shinnosuke Takeda (@cnosuke) &lt;a href=&#34;https://twitter.com/cnosuke/status/698824048319410176&#34;&gt;2016, 2月 14&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;h1 id=&#34;付録b-pure-rubyなreadlineのソースコード&#34;&gt;付録B: Pure Rubyなreadlineのソースコード&lt;/h1&gt;

&lt;p&gt;努力が必要ということが読み解ければ幸いです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/ConnorAtherton/rb-readline/blob/master/lib/rbreadline.rb&#34;&gt;rb-readline/rbreadline.rb at master · ConnorAtherton/rb-readline&lt;/a&gt;&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Common Lispで高速行列演算</title>
      <link>/blog/2016/02/04/common_lispdekousokugyouretsuenzan</link>
      <pubDate>Thu, 04 Feb 2016 23:47:34 +0900</pubDate>
      
      <guid>/blog/2016/02/04/common_lispdekousokugyouretsuenzan</guid>
      <description>&lt;p&gt;κeenです。Common Lispから線形代数ライブラリを使うポストで比較にCommon Lispのコードが出されていたのですがもう少し改良出来そうだったので少しばかり高速化してみました。&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;そのポストはこちら。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://d.hatena.ne.jp/masatoi/20160204/1454519281&#34;&gt;Common Lispで行列演算: LLA(Lisp Linear Algebra)を使う - 翡翠はコンピュータに卵を生むか&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;圧倒的にCommon Lispが遅いですね。そのコードはこちらから。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://tanakahx.hatenablog.com/entry/2015/09/25/070000&#34;&gt;Python (NumPy) と Common Lisp (LLA) で行列積の実行速度を比較する - 不確定特異点&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;行列計算(GEMM)部分を抜き出すとこうなっています。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun simple-gemm (ma mb)
  &amp;quot;Common Lispのみを使った行列積の計算&amp;quot;
  (declare (optimize (speed 3) (debug 0) (safety 0)))
  (declare (type (simple-array single-float (* *)) ma mb))
  (let ((rows (array-dimension ma 0))
        (cols (array-dimension mb 1)))
    (declare (type fixnum rows cols))
    (let ((result (make-matrix rows cols)))
      (declare (type (simple-array single-float (* *)) result))
      (dotimes (row rows)
        (dotimes (col cols)
          (dotimes (k cols)
            (incf (aref result row col)
                  (* (aref ma row k) (aref mb k col))))))
      result)))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;これを&lt;code&gt;*N*&lt;/code&gt; = 256, で100回繰り返したら&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; Evaluation took:
;;   4.688 seconds of real time
;;   4.692000 seconds of total run time (4.688000 user, 0.004000 system)
;;   100.09% CPU
;;   13,564,728,093 processor cycles
;;   26,216,000 bytes consed

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;とのこと。まあ、まだ高速化の余地はありそうです。&lt;/p&gt;

&lt;h1 id=&#34;キャッシュする&#34;&gt;キャッシュする&lt;/h1&gt;

&lt;p&gt;内側のループをみるとこうなっています。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;          (dotimes (k cols)
            (incf (aref result row col)
                  (* (aref ma row k) (aref mb k col))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;incf&lt;/code&gt;をばらすとこうなります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;          (dotimes (k cols)
            (setf (aref result row col)
                  (+ (aref result row col) (* (aref ma row k) (aref mb k col)))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;値として参照している方の&lt;code&gt;(aref result row col)&lt;/code&gt;は&lt;code&gt;k&lt;/code&gt;に依存しないのでループの外に出せます。
書き込んでいる方は場所だから仕方ない。&lt;/p&gt;

&lt;p&gt;これをキャッシュするようにすると&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun caching-gemm (ma mb)
  &amp;quot;Common Lispのみを使った行列積の計算&amp;quot;
  (declare (optimize (speed 3) (debug 0) (safety 0)))
  (declare (type (simple-array single-float (* *)) ma mb))
  (let ((rows (array-dimension ma 0))
        (cols (array-dimension mb 1)))
    (declare (type fixnum rows cols))
    (let ((result (make-matrix rows cols)))
      (declare (type (simple-array single-float (* *)) result))

      (dotimes (row rows)
        (dotimes (col cols)
          (let ((cell (aref result row col)))
           (dotimes (k cols)
             (setf (aref result row col)
              (+ cell (* (aref ma row k) (aref mb k col)))))
           )))
      result)))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;同じパラメータでベンチマークをとると&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; 3.971 seconds of real time
;; 3.972000 seconds of total run time (3.972000 user, 0.000000 system)
;; 100.03% CPU
;; 11,491,319,119 processor cycles
;; 26,216,000 bytes consed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;2016-02-28 追記:&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; data-lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; キャッシュのところ、resultのインデックスにkは使ってないけど、kが進むごとに対象の要素は変化してるはずなので、このキャッシュのしかたはまずいのでは?&lt;/p&gt;&amp;mdash; goskevich (@gos_k) &lt;a href=&#34;https://twitter.com/gos_k/status/700622885933613056&#34;&gt;2016年2月19日&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;ということでこれは間違ってました。&lt;/p&gt;

&lt;h1 id=&#34;ループアンローリング&#34;&gt;ループアンローリング&lt;/h1&gt;

&lt;p&gt;さて、先程の内側のループ、仕事が少ないですね。小さな仕事をチマチマループしてるとイテレーションコストが嵩みます。
1回のイテレーションでの仕事を増やすべく、ループアンローリングをしましょう。&lt;/p&gt;

&lt;p&gt;コピペはダルいのでまずはマクロを。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defmacro dotimes-unroll ((i n unroll) &amp;amp;body body)
  (let ((n_      (gensym &amp;quot;n&amp;quot;)))
    `(let ((,n_ ,n))
       (do ((,i 0))
           ((&amp;lt; ,n_ (the fixnum (+ ,unroll ,i)))
            (do ((,i ,i (the fixnum (1+ ,i))))
                ((&amp;lt; ,n_ (the fixnum (1+ ,i))))
              ,@body
              ))
         ,@(loop :repeat unroll :append (append body `((setq ,i (the fixnum (1+ ,i))))))))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;少し試してみましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(dotimes-unroll (i 10 3)
  (format t &amp;quot;~%~a&amp;quot;) i)
0
1
2
3
4
5
6
7
8
9
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;よしよし。&lt;/p&gt;

&lt;p&gt;それではこれを使ってアンロールします。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun loop-unroll-gemm (ma mb)
  &amp;quot;Common Lispのみを使った行列積の計算&amp;quot;
  (declare (optimize (speed 3) (debug 0) (safety 0)))
  (declare (type (simple-array single-float (* *)) ma mb))
  (let ((rows (array-dimension ma 0))
        (cols (array-dimension mb 1)))
    (declare (type fixnum rows cols))
    (let ((result (make-matrix rows cols)))
      (declare (type (simple-array single-float (* *)) result))

      (dotimes (row rows)
        (dotimes (col cols)
          (let ((cell (aref result row col)))
           (dotimes-unroll (k cols 16)
             (setf (aref result row col)
              (+ cell (* (aref ma row k) (aref mb k col))))))))
      result)))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;アンロール数は16が一番パフォーマンス出たようでした。&lt;/p&gt;

&lt;p&gt;さて、ベンチマークをしてみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; Evaluation took:
;;   3.847 seconds of real time
;;   3.848000 seconds of total run time (3.848000 user, 0.000000 system)
;;   [ Run times consist of 0.012 seconds GC time, and 3.836 seconds non-GC time. ]
;;   100.03% CPU
;;   11,128,993,432 processor cycles
;;   26,216,000 bytes consed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;辛うじて速くなってる…。因みにこれのパフォーマンスはCPUの命令キャッシュの状況に依存するので何度か試すとこれより速いスコアが出ることもあります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;Evaluation took:
  3.338 seconds of real time
  3.340000 seconds of total run time (3.332000 user, 0.008000 system)
  [ Run times consist of 0.020 seconds GC time, and 3.320 seconds non-GC time. ]
  100.06% CPU
  9,657,259,219 processor cycles
  26,248,768 bytes consed
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;メモリアクセスしない&#34;&gt;メモリアクセスしない&lt;/h1&gt;

&lt;p&gt;さて、最初にキャッシュした時に書き込まれている方の &lt;code&gt;(aref result row col)&lt;/code&gt; は場所だからキャッシュ出来ないといいました。まあ、それは正しいのですがループの中で毎回書き込む必要はありません。&lt;/p&gt;

&lt;p&gt;レジスタ上で計算を済ませて最後に書き込んであげれば十分です。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun on-register-gemm (ma mb)
  &amp;quot;Common Lispのみを使った行列積の計算&amp;quot;
  (declare (optimize (speed 3) (debug 0) (safety 0)))
  (declare (type (simple-array single-float (* *)) ma mb))
  (let ((rows (array-dimension ma 0))
        (cols (array-dimension mb 1)))
    (declare (type fixnum rows cols))
    (let ((result (make-matrix rows cols)))
      (declare (type (simple-array single-float (* *)) result))

      (dotimes (row rows)
        (dotimes (col cols)
          (let ((res (aref result row col)))
           (dotimes-unroll (k cols 16)
             (setf res
                   (the single-float (+ res (* (aref ma row k) (aref mb k col))))))
           (setf (aref result row col) res))))
      result)))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;これを試してみます。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;;; Evaluation took:
;;   2.302 seconds of real time
;;   2.304000 seconds of total run time (2.300000 user, 0.004000 system)
;;   [ Run times consist of 0.008 seconds GC time, and 2.296 seconds non-GC time. ]
;;   100.09% CPU
;;   6,662,273,812 processor cycles
;;   26,216,000 bytes consed
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;わお！急に速くなりました。 &lt;code&gt;(* 100 (- (/ 4.688 2.302) 1))&lt;/code&gt; ≒ 103、 100%近い高速化です。&lt;/p&gt;

&lt;h1 id=&#34;おわりに&#34;&gt;おわりに&lt;/h1&gt;

&lt;p&gt;特に深い意味はなかったのですがパタヘネに載っていたやつを試してみたくて遊んでみました。&lt;/p&gt;

&lt;p&gt;普通に行列計算したいなら線形代数ライブラリ使った方が良いと思います。&lt;/p&gt;

&lt;h1 id=&#34;ノート&#34;&gt;ノート&lt;/h1&gt;

&lt;ul&gt;
&lt;li&gt;ループアンローリングの部分をイテレーションコストで説明しましたが他にも1ループ内の命令数が増えると組み合わせパズルのピースが増えるので最適化されやすくなります。まあ、SBCLは覗き穴最適化をほとんどしないのであまり意味ありませんが。気になる方はディスアセンブルしてみて下さい。&lt;/li&gt;
&lt;li&gt;このあと、 &lt;code&gt;(aref mb k col)&lt;/code&gt; がCPUキャッシュを無駄にしているという話からキャッシュサイズ毎に行、列を分けて計算するやり方を紹介しようとしたのですが逆に遅くなってしまいました。付録Aにコードを置いておきます。うーむ。&lt;/li&gt;
&lt;li&gt;本当はさらにこのセグメント毎にスレッドに計算を投げて並列化したかったのですがセグメントで高速化しなかったので萎えて諦めました。&lt;/li&gt;
&lt;li&gt;パタヘネ的にはSIMDも使うのですが深夜に近付いてきて面倒になったのでこの辺でやめました。Common Lisp(SBCL)からSIMD命令を使うには&lt;a href=&#34;http://keens.github.io/blog/2014/12/02/vopdeyou-bu/&#34;&gt;私の過去のエントリ&lt;/a&gt;を参照して下さい。&lt;/li&gt;
&lt;li&gt;本気で行列計算をしたいなら今回の $O(n^3)$ のアルゴリズムだけでなくStrassenのアルゴリズムやCoppersmith-Winogradのアルゴリズムも検討すべきです。&lt;/li&gt;
&lt;/ul&gt;

&lt;h1 id=&#34;付録a&#34;&gt;付録A&lt;/h1&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun segmented-gemm (ma mb)
  &amp;quot;Common Lispのみを使った行列積の計算&amp;quot;
  (declare (optimize (speed 3) (debug 0) (safety 0)))
  (declare (type (simple-array single-float (* *)) ma mb))
  (let* ((segment 16)
         (rows (array-dimension ma 0))
         (cols (array-dimension mb 1))
         (colseg (floor cols segment))
         ktmp coltmp
         k col
         )
    (declare (type fixnum rows cols))
    (let ((result (make-matrix rows cols)))
      (declare (type (simple-array single-float (* *)) result))

      (dotimes (row rows)
        (dotimes (ci colseg)
          (setf coltmp (the fixnum (* ci segment)))
          (dotimes (ki colseg)
            (setf ktmp (the fixnum (* ki segment)))
           (dotimes (cs segment)
             (setf col (the fixnum (+ coltmp cs)))
             (let ((res (aref result row col)))
               (dotimes (ks segment)
                 (setf k (the fixnum (+ ktmp ks)))
                 (setf res
                       (the single-float (+ res (* (aref ma row k) (aref mb k col))))))
               (setf (aref result row col) res))))))
      result)))
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Lisp Meetup3周年に寄せて</title>
      <link>/blog/2016/01/27/lisp_meetup3shuunenniyosete</link>
      <pubDate>Wed, 27 Jan 2016 23:40:11 +0900</pubDate>
      
      <guid>/blog/2016/01/27/lisp_meetup3shuunenniyosete</guid>
      <description>&lt;p&gt;κeenです。昨日、&lt;a href=&#34;http://lisp.connpass.com/event/25546/&#34;&gt;Lisp Meetup #36&lt;/a&gt;が行なわれました。1回テックトークを挟んでるのでこれでちょうど丸3年、毎月Lisp Meetupが行われたことになります。

Lisp Meetupは&lt;a href=&#34;http://shibuya.lisp-users.org/&#34;&gt;Shibuya.lisp&lt;/a&gt;が基本、毎月開催している草の根活動で、Lisper同士の交流を目的として主に希望者によるトークをメインとした会です。&lt;/p&gt;

&lt;p&gt;毎月Common Lisp、Clojure、Scheme回でローテーションしていて、近頃はScheme回にSchemerが来ないことからScheme回を減らして運用されています。
最初に述べた通りLisp Meetupだけで36回、丸3年活動してきました。ここ最近は定員にギリギリまで人が集まるくらいの盛況で何よりです。
ここまで継続したことを祝って記念ステッカーを作りました。私はほとんど何もしてませんが。@potix2さんに感謝。&lt;/p&gt;

&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;今日のLisp Meet Upは3周年記念ですね。先程ステッカー届きました。 &lt;a href=&#34;https://t.co/IRKkKVnkeU&#34;&gt;pic.twitter.com/IRKkKVnkeU&lt;/a&gt;&lt;/p&gt;&amp;mdash; κeen (@blackenedgold) &lt;a href=&#34;https://twitter.com/blackenedgold/status/691875297940148224&#34;&gt;2016, 1月 26&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;私が初めて参加したのは第7回から、運営になったのが1年後の第19回から(の筈)。
2年半サイバーエージェントの会場に通って気付いたらサイバーエージェントの社員になって、一勉強会がここまで大きく人生に影響するのかと感慨に耽る次第です。
何を大袈裟に、と思うかもしれませんがプログラミング経験が調子に乗ってきた時とLisp Meetupに参加し始めた時期が重なるので個人的には感慨に耽るだけのものがあるのです。&lt;/p&gt;

&lt;p&gt;さて、他のメジャーな言語の勉強会でも中々聞かない3周年ともなるとまた別種の問題も出てくる訳です。
その1つが「固定化」問題です。1度もLisp Meetupに来たことのない方はこう思う訳です: 何度も回を重ねる内にメンバーが固定化されて一見さんお断りな雰囲気になってるんじゃないかと。
実際のところLisp Meetupにはそんな雰囲気はなく、何度も来てる人もいれば久しぶりに来た人、最近よく来る人、初めて来る人色々いる訳です。
実情がどうあれ、お尻の数字が大きいだけで一番来て欲しい初心者が来なくなるならと、一度は名前を変えて連番をリセットしようかとも話されましたが結局今のLisp Meetupのままでいます。
Lisp Meetupといえば私のようによく分からない発表をしてても暖かく受け入れてくれる優しい人達の集りなのですが、とはいえ外から見て「初めての勉強会でLisp Meetupは怖い」などと言われると中々考えることがあります。
まあ、それでも初心者や初参加の人は毎回数人は来てるのでこれ以上増やそうとするとこれより大きな会場を確保する必要があって中々ハードルは高いのですが。初心者は大歓迎ということは伝えておこうかと思います。&lt;/p&gt;

&lt;p&gt;さて、次回はClojure回です。そろそろScheme回を…と思ったのですが発表者が集りそうにないので見送られました。&lt;/p&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;少し気の早い話ですが来月2月の &lt;a href=&#34;https://twitter.com/hashtag/lispmeetup?src=hash&#34;&gt;#lispmeetup&lt;/a&gt; でSchemeをテーマにするとしたらみなさんどうですか&lt;/p&gt;&amp;mdash; κeen (@blackenedgold) &lt;a href=&#34;https://twitter.com/blackenedgold/status/688627343112278017&#34;&gt;2016, 1月 17&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;3月には開催しようかと話し合われている最中なのでSchemer各位、SICP読書中の各位は準備をして開催して欲しいオーラを出して頂けると開催決定の後押しになります。&lt;/p&gt;

&lt;p&gt;ということで来月以降もLisp Meetupをよろしくお願いします。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>最近作ってるLispの話</title>
      <link>/blog/2015/12/20/saikintsukutterulispnohanashi</link>
      <pubDate>Sun, 20 Dec 2015 22:40:16 +0900</pubDate>
      
      <guid>/blog/2015/12/20/saikintsukutterulispnohanashi</guid>
      <description>&lt;p&gt;このエントリは&lt;a href=&#34;http://qiita.com/advent-calendar/2015/lisp&#34;&gt;Lisp Advent Calendar 2015&lt;/a&gt;21日目の記事です。&lt;/p&gt;

&lt;p&gt;κeenです。最近あまりLispを書いてなくてネタがないので最近作ってるLispの話でもしようかと。&lt;/p&gt;

&lt;p&gt;
&lt;a href=&#34;https://github.com/KeenS/kappaLisp&#34;&gt;κLisp&lt;/a&gt;といいます。まだまだ完成には程遠いです。現在、&lt;a href=&#34;https://github.com/KeenS/kappaLisp/blob/master/src/eval.rs#L378&#34;&gt;ここら辺&lt;/a&gt;くらいの式なら評価出来ます。&lt;/p&gt;

&lt;p&gt;このLispはSKK辞書に使われているS式を評価するために作られました。
SKKは様々な場所に移植されているのでマルチプラットフォームで動いて他の言語と協調が出来る言語で作るのが望ましいのですが、今回はRustを選びました。
最初はCにしようかと思ったのですがちょいとRustを試してみようかと(当時Rustほとんど書いたことがない初心者)。&lt;/p&gt;

&lt;p&gt;SKKに書かれているS式を処理出来るLisp処理系はあるのですがGPLでライセンスされており、それを使ったiOSアプリをAppStoreに登録出来ないという問題があるそうです。
なのでMITライセンスで作り始めました。&lt;/p&gt;

&lt;p&gt;さて、Lisp処理系くらい簡単に作れそうなものですが、いくつかの点で詰まっています。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;そもそもRustが難しい&lt;/li&gt;
&lt;li&gt;関数ポインタが思うように扱えない&lt;/li&gt;
&lt;li&gt;やろうとした事がborrow checkに引っ掛かって出来なかった&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;この詰まった点はRustが悪い訳ではなくて単に私がRustに合わせた設計が出来なかっただけですね。そろそろRustにも少しづつですが慣れて来たのでどこかのタイミングでリファクタリングして進めていきたいですね。&lt;/p&gt;

&lt;p&gt;一応現状でも進めようと思えば進めれるのですが&lt;a href=&#34;https://github.com/KeenS/kappaLisp/blob/master/src/eval.rs#L232&#34;&gt;ここ&lt;/a&gt;のように明らかにイケてないコードが続くので進めるモチベーション起きませんよね。&lt;/p&gt;

&lt;p&gt;設計とかの話をすると、最終的にはC APIでS式の文字列を受け取ったらそれを評価した結果の文字列を返す関数を晒せばいいかな、と思ってます。
ちゃんとiOSへのクロスコンパイルも出来ますしObj-C, Swift双方C FFIがあるのでそれで十分でしょう。(CF &lt;a href=&#34;http://qiita.com/moriturus/items/1190614dcbbe31ecfc2f&#34;&gt;http://qiita.com/moriturus/items/1190614dcbbe31ecfc2f&lt;/a&gt; , &lt;a href=&#34;http://safx-dev.blogspot.jp/2014/06/rustios.html&#34;&gt;http://safx-dev.blogspot.jp/2014/06/rustios.html&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;パーサは手書きで、実行はインタプリタ、Emacs Lispに則ってLisp2のダイナミックスコープです。設計がクソなのでメモリ管理らしいメモリ管理はやってませんがRustのメモリ管理のお陰でメモリリークはしてません。
ちゃんと設計してReference Countなメモリ管理でもしようかと。フットプリントの軽さ大事。&lt;/p&gt;

&lt;p&gt;全然まとまりませんがいつか使えるようになってAquaSKKやFlickSKKに取り込まれるかもしれないのでその時には裏でこのLispが動いてるかもと思い出してあげて下さい。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ClojureでReactive Messaging Pattern</title>
      <link>/blog/2015/12/19/clojuredereactive_messaging_pattern</link>
      <pubDate>Sat, 19 Dec 2015 22:30:19 +0900</pubDate>
      
      <guid>/blog/2015/12/19/clojuredereactive_messaging_pattern</guid>
      <description>&lt;p&gt;このエントリは&lt;a href=&#34;http://qiita.com/advent-calendar/2015/clojure&#34;&gt;Clojure Advent Calendar 2015&lt;/a&gt;の16日目の記事です（大遅刻）&lt;/p&gt;

&lt;p&gt;κeenです。ここのところ体調優れず、また、特に面白いネタもなくClojure Advent Calendarに遅刻したことをお詫び申し上げます。&lt;/p&gt;

&lt;p&gt;さて、今日はReactive Messaging PatternをClojureのcore.asyncでやってみたいと思います。Reactive Messaging Pattersは、Java/Scala向けActorシステムの&lt;a href=&#34;http://akka.io/&#34;&gt;Akka&lt;/a&gt;の作者が著した本、&lt;a href=&#34;http://www.amazon.co.jp/Reactive-Messaging-Patterns-Actor-Model-ebook/dp/B011S8YC5G&#34;&gt;Amazon.co.jp: Reactive Messaging Patterns with the Actor Model: Applications and Integration in Scala and Akka&lt;/a&gt;で書かれているデザインパターンです。&lt;/p&gt;

&lt;p&gt;非常に興味深い本なのですがScala及びAkka初心者の私には中々辛いので一旦Clojureで試してみようかと。

ところで、AkkaとClojureのcore.asynkには若干のモデルの違いがあります。詳しくは&lt;a href=&#34;http://blog.paralleluniverse.co/2015/05/21/quasar-vs-akka/&#34;&gt;ここ&lt;/a&gt;とかにあるのですが、一番大きくは非同期/同期モデルの違いがあります。
Akkaの場合はActorにメッセージを送っても届いたという保障はなく(「その瞬間に」届いてないだけでなく、届く前にActorが再起動したらメッセージがロストしてしまう!)、また、メッセージの受信も&lt;code&gt;receive&lt;/code&gt;というコールバック用のメソッドを用意してそこでハンドルすることになります。&lt;/p&gt;

&lt;p&gt;そういう違いがある中でどれだけClojureに翻訳出来るか多少不安ですがチャレンジしてみます。尚、原書には様々なパターンがあるのですが流石に本一冊分全部は紹介し切れないので面白そうでかつClojureでも役立ちそうなものだけ紹介することにします。このコードは原書のものをClojureに翻訳したものではなく、私が勝手に書いたものです。コードを参考にするのは雰囲気程度に留めて、実際を知りたかったら原書を読みましょう。&lt;/p&gt;

&lt;p&gt;今回、&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;(defproject reactive-message-patterns &amp;quot;0.1.0-SNAPSHOT&amp;quot;
  :description &amp;quot;FIXME: write description&amp;quot;
  :url &amp;quot;http://example.com/FIXME&amp;quot;
  :license {:name &amp;quot;Eclipse Public License&amp;quot;
            :url &amp;quot;http://www.eclipse.org/legal/epl-v10.html&amp;quot;}
  :dependencies [[org.clojure/clojure &amp;quot;1.7.0&amp;quot;]
                 [org.clojure/core.async &amp;quot;0.2.374&amp;quot;]])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;というプロジェクト設定で試しました。また、ソースコードは&lt;a href=&#34;https://github.com/KeenS/reactive-message-patterns&#34;&gt;こちら&lt;/a&gt;で公開しています。&lt;/p&gt;

&lt;h1 id=&#34;messaging-with-actors&#34;&gt;Messaging With Actors&lt;/h1&gt;

&lt;h2 id=&#34;pipes-and-filters&#34;&gt;Pipes And Filters&lt;/h2&gt;

&lt;p&gt;メッセージが来る際に、そのまま受け取るのではなく一旦Filter用のActorで変換やvalidationをかけて本処理に入ります。&lt;/p&gt;

&lt;p&gt;&lt;del&gt;Clojureなら&lt;code&gt;filter&amp;lt;&lt;/code&gt;/&lt;code&gt;filter&amp;gt;&lt;/code&gt;/ transducerで瞬殺&lt;/del&gt; Filter処理をActorに分離することで並列性やモジュール性が上がります。原書の例ではまずDecrypt Filterを噛ませてAuthenticate Filterで認証出来たら De-dup Filterで重複を取り除いてメッセージをクリーンにしてから処理を始める、とういうように非常に実用的な例が出ています。&lt;/p&gt;

&lt;p&gt;また、(transformでなく、篩い分けの)Filterを分離することでFilterした後の処理、例えばinvalidなメッセージが来たらログに出すなどの柔軟性を得ることが出来ます。&lt;/p&gt;

&lt;p&gt;これを実装してみましょう。すごい適当ですがメッセージが来たらそれを2倍するfilterを作ってみます。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;(use &#39;clojure.core.async)

(defn filter-actor
  ([f]
   (let [in (chan)
         out (chan)]
     (do
       (filter-actor f in out)
       [in out])))
  ([f in out]
   (go-loop []
     (if-let [v (&amp;lt;! in)]
       (if-let [ret (f v)]
         (if (&amp;gt;! out ret)
           (recur)))
       (close! out)))))

(let [[in out] (filter-actor (fn [x] (* x 2)))]
  (go
    ;; producer
    (doseq [v (range 1 10)]
      (&amp;gt;! in v))
    (close! in))
  (go-loop []
    ;; consumer
    (if-let [v (&amp;lt;! out)]
      (do
        (println v)
        (recur))
      (close! out))))

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;簡単ですね。チャネルが終わったかどうか調べるのに一々&lt;code&gt;if-let&lt;/code&gt;を使うのが面倒ですがリストに対する再帰関数もそんな感じなのでまあ、こういうもんなんでしょう。&lt;/p&gt;

&lt;h2 id=&#34;その他&#34;&gt;その他&lt;/h2&gt;

&lt;p&gt;他にもMessaging With ActorsにはMessage Router, Message Translator, Message Endpointsなどのパターンが載っているのですが割愛します。特にMessage Translatorは外部システム(HTTPリクエスト、MQ, SQLなど)とのやりとりの話なので簡単に試すには少し重すぎるようです。&lt;/p&gt;

&lt;h1 id=&#34;messaging-channels&#34;&gt;Messaging Channels&lt;/h1&gt;

&lt;p&gt;この章にはActor同士のメッセージのやりとりの方法が色々書かれています。
Point-to-Point Channel, Publish-Subscribe Channel, Datatype Channel, Invalid Message Channel, Dead Letter Channel, Guaranteed Delivery, Channel Adapter, Message Bridge, Message Bus。
中々多くのパターンが載っているのですが一部はAkka固有であったりClojureには必要なかったりしますので、私が興味を持ったものを紹介します。&lt;/p&gt;

&lt;h2 id=&#34;publish-subscribe&#34;&gt;Publish-Subscribe&lt;/h2&gt;

&lt;p&gt;定番ですね。概念自体の説明は不要と思います。core.asyncだとどうなるのかを見てみます。&lt;code&gt;pub&lt;/code&gt;と&lt;code&gt;sub&lt;/code&gt;を使います。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;(let [publisher (chan)
      publication (pub publisher :topic)
      subscriber1 (chan)
      subscriber2 (chan)]
  (sub publication :delete subscriber1)
  (sub publication :create subscriber1)

  (sub publication :update subscriber2)
  (sub publication :read subscriber2)

  ;; start subscribers before publish start
  (go-loop [] (when-let [v (&amp;lt;! subscriber1)] (printf &amp;quot;I&#39;m One, got %s\n&amp;quot; (:type v)) (recur)))
  (go-loop [] (when-let [v (&amp;lt;! subscriber2)] (printf &amp;quot;I&#39;m Two, got %s\n&amp;quot; (:type v)) (recur)))

  (go (onto-chan publisher [{:topic :update, :type &amp;quot;dog&amp;quot;}
                            {:topic :create, :type &amp;quot;cat&amp;quot;}
                            {:topic :read  , :type &amp;quot;fox&amp;quot;}]))
  )
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;おもちゃのような例ですがこれで動くようです。因みに原書ではここに結構なページ数が割かれていて、分散システムを念頭に、異なるシステムにメッセージを送る話なども扱っています。core.asyncだとそこまでは出来そうにないですね。&lt;/p&gt;

&lt;h2 id=&#34;invalid-message-channel&#34;&gt;Invalid Message Channel&lt;/h2&gt;

&lt;p&gt;とあるActorに予期しないメッセージが届いたらどうしましょうか。そのまま捨てますか？もしかしたらバグを潰せる好機かもしれないのにそのまま捨てるには勿体なすぎます。
かといって全てのActorにデバッグ用のコードを入れていては埒が明かないどころかコードが複雑化してしまいます。そこでInvalid Massage Channelを使いましょう。&lt;/p&gt;

&lt;p&gt;あるActorに予期しないメッセージが届いた時に、全てを放り投げるチャネルを用意しておいて、その先のActorでログを出すなりするのです。&lt;/p&gt;

&lt;p&gt;今回は&lt;code&gt;:price&lt;/code&gt;タグのついていないメッセージが届いた時にinvalid actorに放り投げ、ログを出すものを作りました。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;(defn invalid [data]
  {:data data
   :from (Thread/currentThread)})

(let [invalid-chan (chan)
      in (chan)
      tax 0.08]
  ;; invalid message processor
  (go-loop []
    (when-let [{data :data from :from} (&amp;lt;! invalid-chan)]
      (printf &amp;quot;invalid data %s from %s from\n&amp;quot; data from)
      (recur)))

  ;; main processing actor
  (go-loop []
    (when-let [v (&amp;lt;! in)]
      (if-let [price (:price v)]
        (printf &amp;quot;price: %f\n&amp;quot; (* price (+ 1 tax)))
        (&amp;gt;! invalid-chan (invalid v)))
      (recur)))

  (go (onto-chan in [{:goods &amp;quot;はじめてのClojure&amp;quot;
                      :price 1900}
                     {:goods &amp;quot;プログラミングClojure&amp;quot;
                      :price 3400}
                     {:goods &amp;quot;へび&amp;quot;
                      :description &amp;quot;にょろにょろ&amp;quot;}])))

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;from&lt;/code&gt;についてはActorならアクターオブジェクトに対してリフレクションかけて何かしらの情報をとれるのですが&lt;code&gt;go&lt;/code&gt;に対するリフレクションが分からなかったので代わりにスレッド情報を使いました。
私はこの章を読んだ時にいたく完動しました。ログの扱いを集約出来るし地味にIOして非同期モデルのアクターの邪魔になるログをそれぞれのアクターに持たなくて済む。
しかしこれのActorが落ちたら、とかこのActor自身にinvalidなメッセージが来たら、とか色々考えたくなります。詳しくは原書を読みましょう。&lt;/p&gt;

&lt;h2 id=&#34;その他-1&#34;&gt;その他&lt;/h2&gt;

&lt;p&gt;この章には他にも外部システムと連携するMessage Adapter、外部のメッセージングシステムと連携するMessage Bridge、複数のシステム間でメッセージをやりとりするMessage Busなどが載っていますが割愛します。&lt;/p&gt;

&lt;h1 id=&#34;message-construction&#34;&gt;Message Construction&lt;/h1&gt;

&lt;p&gt;この章にはCommand Message, Document Message, Event Message, Request-Reply, Return Address, Correlation Identifire, Message Sequence, Message Expiration, Format Indicatorなどのメッセージ自体にまつわる話題が載っています。&lt;/p&gt;

&lt;p&gt;&lt;del&gt;疲れてきたため&lt;/del&gt; AkkaやScala特有の話題が多いので1つだけに絞ります。。まあ、だいたいErlangとかやってたら自然と覚えるやつらです。&lt;/p&gt;

&lt;h2 id=&#34;document-message&#34;&gt;Document Message&lt;/h2&gt;

&lt;p&gt;Command MessageやEvent Messageは良く見ますが、Document Messageとはどのようなものでしょうか。原書にはこう書いてあります&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Use a Document Message to convey information to a receiver, but without indicating how the data should be used.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;「受取側に情報を伝えはするが、その情報がどのように扱われるべきかを指示しない時にDocument Messageを使います」Command Messageに付随する情報でもなくEvent Messageに付随する情報でもなくただ単なる情報です。&lt;/p&gt;

&lt;p&gt;これは例えばデータベースアダプタのような所で使うことになります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;(let [db [{:id 1 :name &amp;quot;Aho&amp;quot;} {:id 2 :name &amp;quot;Ulman&amp;quot;} {:id 3 :name &amp;quot;Sethi&amp;quot;}]
      in (chan)]
  (go-loop []
    (when-let [[id return] (&amp;lt;! in)]
      (&amp;gt;! return (some #(when (= id (:id %) ) %) db))
      (recur)))

  (let [chan-cache (chan)]
    (go-loop [id 1]
      (&amp;gt;! in [id chan-cache])
      (when-let [res (&amp;lt;! chan-cache)]
        (println res)
        (recur (+ id 1))))))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;複数のアクセスがあることを考えると双方向チャネルがあるからといってそれ1つを使うのは良くないでしょう。混線してしまいます。今回は返信用のチャネル自身も一緒に送ってしまってそこにDocumentを貰うことにしました。
ActorならActor ID(Ref)を送ることになるでしょう。&lt;/p&gt;

&lt;h1 id=&#34;message-routing&#34;&gt;Message Routing&lt;/h1&gt;

&lt;p&gt;この章は主にAkkaのクラスタ、分散実行に関る内容です。それ自体非常に興味深いのですがClojureだと試せないので飛ばします。
まあ、実際にはクラスタを組まなくてもいくつかのactorを使ってactor群同士でやりとりをすればいいのですが準備が中々面倒ですね。&lt;/p&gt;

&lt;p&gt;一応扱われているトピックを拾うとContent Based Router, Message Filter, Dynamic Router, Recipient List, Splitter,
Aggregator, Resequencer, Composed Message Processor, Scatter-Gather, Routing-Slip, Process Manager, Message Brokerです。
見ての通り非常に数が多く、ページ数もかなり割かれています。そして、よく使いそうなパターンが多く載っています。Scatter-Gatherとか重い処理する時に使いそうなんですけどね。&lt;/p&gt;

&lt;h1 id=&#34;などなど&#34;&gt;などなど&lt;/h1&gt;

&lt;p&gt;ここまでで、4~7章を紹介しました。原書は10章まで続きます(1-3章は何故Actorが必要なのかなどを延々語ってます)が私はこの辺で筆を置くことにします。続きが気になる方は原書をお読み下さい。&lt;/p&gt;

&lt;p&gt;Advent Calendar遅刻して大変申し分けありませんでした。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>ClojureでDSPを作った話</title>
      <link>/slide/ClojuredeDSPwotsukuttahanashi/</link>
      <pubDate>Tue, 27 Oct 2015 21:04:20 +0900</pubDate>
      
      <guid>/slide/ClojuredeDSPwotsukuttahanashi/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# ClojureでDSPを作った話
----------------------
Lisp Meet Up #3
&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + サイバーエージェントのエンジニア
 + Lisp, ML, Shell Scriptあたりを書きます

===
# DSPとは
--------

* Demand Side Platform
* 広告主から広告を集めて広告の表示権を競り落し、適切な広告を出す
  0. 広告主を集めて
  1. 競りの通知を受け取って
  2. 一番コスパが良さそうな広告を選んで
  3. 入札して
  4. 落札通知を受け取る
  5. 落札したら広告を出す

===

# ひとりDSP
----------

* AdTech Studioの新卒研修
* 2ヶ月間、業務時間の20%を使ってDSPを作る
  + 実質8営業日
* 業務ロジックを理解することが目的
* 最後に新卒の作ったDSP同士で競争、利益が得点になる
* 他には最終発表での得点も
* **研修なので好きにやっていい**
  + Clojureで書くことに
* サーバーの他は広告主データと学習用データが与えられる


===
&lt;iframe src=&#34;//www.slideshare.net/slideshow/embed_code/key/92I5tQt6q6IjII&#34; width=&#34;425&#34; height=&#34;355&#34; frameborder=&#34;0&#34; marginwidth=&#34;0&#34; marginheight=&#34;0&#34; scrolling=&#34;no&#34; style=&#34;border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;&#34; allowfullscreen&gt; &lt;/iframe&gt; &lt;div style=&#34;margin-bottom:5px&#34;&gt; &lt;strong&gt; &lt;a href=&#34;//www.slideshare.net/prir/ss-35918532&#34; title=&#34;日本におけるアドテク市場とサイバーエージェントのアドテク事業について&#34; target=&#34;_blank&#34;&gt;日本におけるアドテク市場とサイバーエージェントのアドテク事業について&lt;/a&gt; &lt;/strong&gt; from &lt;strong&gt;&lt;a href=&#34;//www.slideshare.net/prir&#34; target=&#34;_blank&#34;&gt;CyberAgent, Inc.&lt;/a&gt;&lt;/strong&gt; &lt;/div&gt;

===
# 作るもの
---------

* 競りの通知を受け取って入札するJSON REST API
* 落札の通知を受け取るJSON REST API
  + 割とシンプル
* 「一番コスパが良さそうな広告を選ぶ」部分は色々と工夫する
* 今回は広告を出すところまではやらない
* クリック情報は落札通知に入ってる

===
# b11dについて
-------------

* 今回作ったDSP
* [KeenS/b11d](https://github.com/KeenS/b11d)
* Clojure製
* 5日くらいで作った
* あまりゴテゴテしない方針
  + 今回パフォーマンスは無視していい
  + Clojureに慣れてないので学習コストも抑えたい
* NginXとAppとMySQL構成+α
* DBは綺麗に設計したい
* 1リクエスト毎にDBを引きにいく素敵仕様

===
# WAP
-----

* Compojure
* Sinatra likeなやつ
* ringの上に乗っかてる
* かなりシンプルな部類だがJSON REST API程度ならこれで十分
* ringミドルウェアのでJSON部分も抽象化
* 学習コストが低いので気軽に始められる

===
# JSONライブラリ
--------------

* ring.middleware.json/wrap-json-{body, response}
  + JSON-&gt;マップとマップ-&gt;JSON
  + bodyの方はキーがStringになるのが微妙
    - セキュリティ的に仕方ない
  + Content-Typeを指定しないと動かない罠
* cheshire
  + 事前データをインポートするのに使った
  + ringのJSONミドルウェアの依存なのでそのまま使った
  + 自然で使い易いAPI

===
# データベース接続
----------------

* java.jdbc
* JDBCのClojure向けラッパ?
* DataSourceを自分で渡すのでコネクションプールも簡単
* SQL手書きしたら良い感じにマップを返してくれる
* Storeはカラムと値の対応を手書き
* 便利マクロもいくつか

===
# データベース接続
----------------

* eager loading面倒問題
  + 入れ子オブジェクトを保存する方も面倒だった
  + ORMの便利さを実感。
* bulk insert難しい問題
  + 実行時可変長引数難しい
* ORMはXXXを使うかJavaのやつをそのまま使う?
* JavaはXMLさえ我慢すれば割と良い奴揃ってる
* しかしレスポンスはマップで欲しいかも

===
# 運用
-----

* warに固めてTomcat vs スタンドアロンなfat jar
* 今回はfat jarを選択
* スタンドアロンだとsupervisordとかでの管理が楽
* Tomcatの運用経験がない
* Jetty中々優秀らしい
* jstatを使ってMackerelでメトリクス取った

===
# 非同期化
---------

* core.async/goで手軽に非同期
* DBへの書き込みを非同期にした
* DB書き込みでエラーが出ても500にならない恐怖
* 最初の方で支払いを記録出来てなくて予算管理が死亡
  + 予算管理失敗ペナルティで、大分点数引かれたらしい
* goroutineでの例外処理どうやるんだろう。

===
# 開発環境
---------

* nREPL + Emacs + CIDER
* 補完の設定上手くいかなかった
* 諸々地味に不便
* 起動遅い
* Emacs側からnREPL立ち上げたい
* サーバーのライブリロード欲しい
* 正解が欲しい


===
# その他Clojureについて
---------------------

* コンスのCarを取るのに`hd`か`head`か`car`か分かんなかった
  + 結局どれでもなくて`first`だった
* 引数のパターンマッチが便利
  + JSON REST APIだとリクエストに何を期待してるのか分かりづらい
  + パターンマッチがドキュメントになる
* やっぱJavaのライブラリ使えるの便利

===
# 落穂拾い
---------

* デプロイにはシェルスクリプト
  + お家芸
* 「一番コスパが良さそうな広告を選んで入札」で統計か機械学習が必要
  + 1回表示した時の収益の期待値を計算する
* 今回は事前データの統計を使った
  + 理想的には機械学習。時間変化についていける
* In Appでオンライン学習出来るライブラリが思ったよりない
  + 分散処理向けの大袈裟なのが多い
  + Weka? liblinear-java?
* 後で考えたらIncanter使えばよかった

===
# まとめ
-------

* 給料貰いながらLisp書いた
* ClojureでDSP作った
* Clojureで機械学習したかったけど間に合わなかった

===
# 参考
------

* [Internal of b11d | κeenのHappy Hacκing Blog](//KeenS.github.io/slide/Internal_of_b11d/)

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>Internal of b11d</title>
      <link>/slide/Internal_of_b11d/</link>
      <pubDate>Mon, 19 Oct 2015 21:33:00 +0900</pubDate>
      
      <guid>/slide/Internal_of_b11d/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# Internal of b11d
----------------------
サイバーエージェント新卒研修  
ひとりDSP最終発表会

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + AMoAdのサーバーサイド（？）エンジニア
 + 趣味でLisp, ML, Shell Scriptあたりを書きます
 + 仕事でScalaとShell Scriptあたりを書きます

===
# 今回作ったもの
----------------

* b11d (ぶらっくんどごーるど)
* Clojure (compojure + middleware)製
  + + NginX + MySQL + Supervisord
* 出来る限りシンプルになるように作った
  + 310行
* デプロイその他はシェルスクリプト
* 監視はmackerel

===
# シンプルということ
-------------------

* アプリケーションは状態を持たない
* IO以外副作用を持たない
* つまり、キャッシュを持たない
  + キャッシュはパフォーマンス上の意味しかない
  + 早過ぎる最適化は諸悪の根源
* スケールアウトが容易
* compojureのミドルウェアを上手く使った

===
# シンプルということ2
--------------------

* データベースはだいたい第4正規形（ﾀﾌﾞﾝ）
  + 全てのカラムは`NOT NULL`
  + 広告主の所だけ拡張性を持たせるために第1正規形に落とした
  + 1広告主に対して複数の広告が持てるようになる
* 外部キー制約も全部付ける
* データが綺麗なのでアプリケーション側でのやることが少ない
* 分析する時にも活きる筈

===
# デプロイ
---------

* 全てシェルスクリプトでオペレーション出来る
* 手作業を無くしてミスを無くす
  + 「あれ？設定書き換えたのに反映されてない」 → 「再起動忘れてた」とかを防ぐ
* ☆秘伝☆のシェルテクニック満載！ 
* アプリケーションが1jarに収まるのでデプロイが楽。

===
# 監視
------

* mackerelで色々モニタリング
* Linux, NginX, MySQL, JVM, レスポンスステータス
* ほとんどMackerelに乗っかることで本質的でないことに労力を割かない
  + 本質 = 業務ロジックを理解すること
* アプリケーションの死活監視にはsupervisord
  + 本当はsystemdでやりたかったけどUbuntuのバージョンが古かった

===
# 落穂拾い
----------

* DBへの書き込みは非同期。Clojureなら簡単に書ける
  + `(go ...)` で囲むだけ
* だいたい1700qps。データが増えると多分もうちょい下がる。
  + キャッシュすればデータに依存しない速度。もう少しパフォーマンスも出る。
* アプリケーションサーバには組込みjettyを使った。
  + War + Tomcatでも出来るがデプロイ/運用が楽なのでこちらを採用
* コア数に対してスケールするのでスケールアップも出来る
* CTR予測は訓練データを 広告主xサイトxUA で統計を取って使う
  + 途中からシグモイド関数で変化をつける

===
# 改善点とか今後とか
---------

* win rate, 入札/落札価格, CTRとかをmackerelでモニタリングしたかった
* 管理画面的なの必要？
* フォールトトラレンス性はないのでその辺
  + MySQLが死ぬとヤバい。
* ホットデプロイしたかった
* 折角JVMだし機械学習したかった
* Unix Domain Socket使うの忘れてた
* データベースにタイムスタンプ入れるの忘れてた………orz

&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>マクロについて整理してみる</title>
      <link>/blog/2015/07/04/makuronitsuiteseirishitemiru</link>
      <pubDate>Sat, 04 Jul 2015 15:34:46 +0900</pubDate>
      
      <guid>/blog/2015/07/04/makuronitsuiteseirishitemiru</guid>
      <description>&lt;p&gt;何故Lisperがマクロについて語るのか。Lisperと議論してみても満足のいく答を得た人はそんなにいないと思う。
それはLisper自身便利とは思っていても何が便利なのかを意識してなくて他人に上手く説明出来ないからじゃないかと思った。
ちょっと思いついた範囲でまとめてみる。

最近ではマクロシステムを持つ言語は珍しくない。Rust, Scala, Template Haskell, Mirahなどなど。最初にCommon Lispのマクロと他の言語のマクロとの違いを少し考えてみたい。&lt;/p&gt;

&lt;h1 id=&#34;unless&#34;&gt;Unless&lt;/h1&gt;

&lt;p&gt;まず、unlessをマクロで書くことを考えてみたい。単純にifにnotをつければいい。&lt;/p&gt;

&lt;p&gt;Common Lispではこうなる。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(if (not foo-p)
    bar)

(defmacro unless (cond then)
  `(if (not ,cond)
       ,then))

(unless foo-p
  bar)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Rustだとこうなるだろうか。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-rust&#34;&gt;
if ! isFoo {
    bar;
}

macro_rules! unless {
    ($cond:expr, $then:stmt) =&amp;gt; {{
        if ! $cond {
            $then
        }
    }};
}

unless!(isFoo, {
    bar;
})
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;あるいはmirahだとこうなる。unlessが予約語なので_unlessにした。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-ruby&#34;&gt;if ! isFoo
  bar
end

macro def _unless(cond, block:Block)
  quote{
    if ! `cond`
      `block.body`
    end
  }
end

_unless isFoo do
  bar
end
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ちなみにCだとこう出来る。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-C&#34;&gt;if(! is_foo)
  bar;

#define unless(cond) if(!(cond))

unless(is_foo)
  bar;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;さて、上のマクロたちを見比べて欲しい。Common LispのマクロとCのマクロは違和感なく新たな制御構造を作れたのに対してRustとMirahはマクロ呼び出しが剥き出しになっている。&lt;/p&gt;

&lt;p&gt;ここで注意して欲しいのはCはともかくCommon Lisp、Rust、Mirahのマクロは全て引数に必要な構文木をとってそのまま用意したテンプレートにあてはめているだけだ。やっていることに違いはない。
何が違うかというとマクロ呼び出しの構文が制御構造の構文と同じか違うかという点だけだ。私の知る範囲ではそのような構文をした言語はLispしかない。だから「Lispの」マクロなのだ。&lt;/p&gt;

&lt;p&gt;もう一つ。どのマクロ定義も十分直感的に読めたと思う。この範囲なら &lt;strong&gt;S式だからマクロが簡単になるということはない&lt;/strong&gt; と思う。別にS式でなくてもquasiquoteがあれば十分読み易いマクロが書ける。&lt;/p&gt;

&lt;h1 id=&#34;case&#34;&gt;Case&lt;/h1&gt;

&lt;p&gt;caseを生成することを考えよう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defun fun1 (x)
  (let ((y (case x
             ((:foo) (hoge &amp;quot;foo&amp;quot;))
             ((:bar) (hoge &amp;quot;bar!&amp;quot;)))))
    ...))


(defun fun2 (x)
 (let ((y (case x
            ((:foo) (hoge &amp;quot;foo&amp;quot;))
            ((:baz) (hoge &amp;quot;baz!&amp;quot;)))))
   ...))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;のように似たような、しかし微妙に違うcaseが必要になったような時に必要だろう。この時、&lt;code&gt;&#39;(:foo (hoge &amp;quot;foo&amp;quot;) :bar (hoge &amp;quot;bar!&amp;quot;))&lt;/code&gt;のようにリテラルでそのまま書いてしまっては抽象化する意味がなくなる。例えばハッシュテーブルにKey-Valueペアを入れて必要な時に入れたり削除したりすればよい。そのようなマクロはこう書ける。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;(defmacro case-table (key hash)
  `(case ,key
     ,@(loop
          :for k :being :the :hash-key :of hash :using (hash-value v)
          :collect `((,k) ,v))))

(defparameter *table*)
(setf (gethash :foo *table*) &#39;(hoge &amp;quot;foo&amp;quot;))
(setf (gethash :bar *table*) &#39;(hoge &amp;quot;bar!&amp;quot;))

(defun fun1 (x)
  (let ((y (case-table x #.*table*)))
    ...))

(remhash :bar *table*)
(setf (gethash :baz &#39;(hoge &amp;quot;baz!&amp;quot;)))


(defun fun2 (x)
  (let ((y (case-table x #.*table*)))
    ...))
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ハッシュテーブルを受け取ってリストを返す普通のloopマクロの力をマクロ展開時にも使える。また、ハッシュテーブルには&lt;code&gt;&#39;(hoge &amp;quot;foo&amp;quot;)&lt;/code&gt;などのただのリストを突っ込んだがそれをそのままASTとしても使っている。
Common Lispのマクロのもう1つの良いところはマクロの展開時にもCommon Lispの機能がフルで使えるところであり、マクロの引数に受け取るのが構文木でありデータ構造でもあるS式なところだ。ここでは &lt;strong&gt;S式の同図像性が重要なファクターになっている&lt;/strong&gt; 。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;(case-table x #.*table*)&lt;/code&gt; で使っている &lt;code&gt;#.&lt;/code&gt; は &lt;em&gt;リードマクロ&lt;/em&gt; といってマクロ展開(コンパイル時)より前(リード時、構文解析時)に動作するマクロだ。このリードマクロはeval-when-readといってリード時に
値を評価する。その結果、&lt;code&gt;case-table&lt;/code&gt;に渡るのが &lt;code&gt;&#39;*table*&lt;/code&gt;というシンボルでなく&lt;code&gt;*table*&lt;/code&gt;に束縛されているハッシュテーブルになる。因みに &lt;em&gt;コンパイラマクロ&lt;/em&gt; というマクロ展開が終わった後に動作するマクロもある。&lt;/p&gt;

&lt;p&gt;マクロ1つではなくマクロの前後に動作するマクロもあってこそ初めて柔軟性を手にしている。あまりその点は議論されてないのではないだろうか。&lt;/p&gt;

&lt;h1 id=&#34;common-lispの設計&#34;&gt;Common Lispの設計&lt;/h1&gt;

&lt;p&gt;さて、各々言語には予約語や~構文というものがあると思う。メソッド定義構文など。Common Lispにもスペシャルフォームという名前で&lt;a href=&#34;http://www.lispworks.com/documentation/HyperSpec/Body/03_ababa.htm&#34;&gt;25&lt;/a&gt;個存在する。
驚くべきことに、ここまでに出てきたCommon Lispのコードにはスペシャルフォームは3つしか出てこない。ifとletとquoteだ。setfやloop、defun、defmacro、case、defparameterなんかはマクロで出来ている。&lt;/p&gt;

&lt;p&gt;defunまでマクロで出来ているということはユーザがその気になれば関数定義の構文に手を入れたりも出来るということだ。
普通、そんなことをしたら阿鼻叫喚だがCommon Lispなら安全に出来る。マクロもシンボルに束縛されているので新たにマクロで上書きしたシンボルを名前空間にインポートしなければ今まで通りのdefunやloopが使える。&lt;/p&gt;

&lt;p&gt;もう1つ、普段使うものがマクロで出来ているということはマクロを被せてない機能は相当低レベルだということだ。マクロさえ書けば全く新しい言語機能を追加出来るということであり、あるいは&lt;a href=&#34;http://cl21.org/&#34;&gt;全く新しい言語も作れてしまう&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;このような設計はマクロで制御構造までも作れるから出来るのだ。関数定義構文をマクロで定義している言語はLisp以外に私は知らない。&lt;/p&gt;

&lt;h1 id=&#34;メタプログラミングとcommon-lisp&#34;&gt;メタプログラミングとCommon Lisp&lt;/h1&gt;

&lt;p&gt;ところで、マクロに限らないメタプログラミングについて考えてみたい。メタプログラミングとは、プログラムを書くプログラムを書くことだ。プログラムはテキスト形式のソースコードから実行形式に至るまでの間に様々な中間形式から中間形式に変換される。メタプログラミングはそのどこかの形式を生成することと同義になる。通常、処理系内部で使う形式は変なことをされると困るのであまり外部に公開したくない。メタプログラミングを許すとしても構文解析などのフロントエンドに近い部分になるだろう。&lt;/p&gt;

&lt;p&gt;例えばyaccやlexのようなソースコードジェネレータ、rubyやDのような文字列ベースのメタプログラミングは公開APIであるところのパーサだけを使っているので安全性は高い。しかし文字列だけだと構造がないので書く側はつらい。一応、Common Lispにもread関数とeval関数があるのでCommon Lispのソースコード文字列を吐いてreadしてevalすれば文字列メタプログラミングは出来る。特に嬉しくないのでやらないが。&lt;/p&gt;

&lt;p&gt;次はトークンベースのメタプログラミングがある。Cのプリプロセッサなど。Common Lispでもリードマクロで可能だ。例えば正規表現リテラルを作ったりとかの例がある。&lt;/p&gt;

&lt;p&gt;次はASTベースのメタプログラミングがある。マクロだ。これは今まで見てきた。&lt;/p&gt;

&lt;p&gt;これより先はメタプログラミングとはあまり言わない気がする。JITと呼ぶのではないか。Common Lispにもeval関数やcompile関数があるからそういうことも出来る。正規表現ライブラリなんかが使っている。&lt;/p&gt;

&lt;p&gt;私が言いたいのはCommon Lispにはメタプログラミングの機構が一杯あるということではない。read, eval, compile…。気付いたかもしれないが、LispはLisp自身で出来ている。
Lispを書くとき、Lispを書いてるかもしれないしLispを構成するLispを書いているかもしれない。いくらでもメタプログラミングが出来るということだ。&lt;/p&gt;

&lt;h1 id=&#34;まとめ&#34;&gt;まとめ&lt;/h1&gt;

&lt;p&gt;何やらCommon Lisp賛美歌になってしまったが一応まとめておく。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;簡単なマクロ定義ならS式である必要はない&lt;/li&gt;
&lt;li&gt;複雑なマクロ定義ならS式であると書き易い。恐らく他の構文でも書けないことはない。&lt;/li&gt;
&lt;li&gt;マクロ呼び出し構文はS式でないと重大な違いがある。&lt;/li&gt;
&lt;li&gt;マクロ以外にもリードマクロやパッケージなど他の言語機能があってこそマクロが活きる。&lt;/li&gt;
&lt;li&gt;言語機能だけでなくマクロを前提とした設計も重要である。&lt;/li&gt;
&lt;li&gt;LispはS式で出来ている以前にLispで出来ている。&lt;/li&gt;
&lt;/ul&gt;</description>
    </item>
    
    <item>
      <title>あなたの知らないShebang</title>
      <link>/blog/2015/06/26/anatanoshiranaishebang</link>
      <pubDate>Fri, 26 Jun 2015 23:24:44 +0900</pubDate>
      
      <guid>/blog/2015/06/26/anatanoshiranaishebang</guid>
      <description>&lt;p&gt;κeenです。最近は何故かBlack君って呼ばれます。Shebangの書き方にはいくつかあって、それを利用したふと面白い方法を思い付いたので共有を。
&lt;/p&gt;

&lt;p&gt;さて、ご存知Shebangといえば&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;#!/bin/sh
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;のようにファイルの1行目が&lt;code&gt;#!&lt;/code&gt;から始まっているとシェルがそれ以降の文字列を実行可能ファイルのパス名として捜して実行してくれるものですが、実は&lt;code&gt;#!&lt;/code&gt;は唯一のフォーマットではありません。&lt;/p&gt;

&lt;p&gt;&lt;code&gt;#!&lt;/code&gt;がデファクトになる前なのかそもそもシェルにコメントがなかった時代のものなのかは知りませんが昔は&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;: /bin/sh
...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;と&lt;code&gt;:&lt;/code&gt;で始めていたらしいです。因みに&lt;code&gt;:&lt;/code&gt;は「何もしないコマンド」です。実質的にコメントとして扱ったり副作用のある変数展開だけを行なったりプログラマティックコメントアウトだったりの用途で使われてます。&lt;/p&gt;

&lt;p&gt;さて、シェルは全て文字列なのでクォートしてもしなくても構いません。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-sh&#34;&gt;&amp;quot;:&amp;quot; &amp;quot;/bin/sh&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;としてもちゃんと動いてくれます。なぜわざわざクォートするかというと&lt;a href=&#34;//KeenS.github.io/blog/2014/12/08/ge-tochu-li-xi-potaburunacommon-lispshi-xing-ke-neng-huairuwozuo-ru/&#34;&gt;割と処理系ポータブルなCommon Lisp実行可能ファイルを作る | κeenのHappy Hacκing Blog&lt;/a&gt;のように別の言語のスクリプトとして実行される時に文字列リテラルになってくれると単純に無視されるので互換性が高まるのです。&lt;/p&gt;

&lt;p&gt;ということで完全版ポータブルなCommon Lisp実行可能ファイルはこうなります。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;&amp;quot;:&amp;quot; &amp;quot;/bin/sh&amp;quot;

#|
run_if_exists(){
 command -v $1 &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&amp;amp; exec &amp;quot;$@&amp;quot;
}
 run_if_exists cl &amp;quot;$0&amp;quot; &amp;quot;$@&amp;quot;
 run_if_exists sbcl --noinform --no-sysinit --no-userinit --script &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists clisp -norc --quiet --silent -on-error exit  &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists ecl -norc -q -shell &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists mkcl -norc -q -shell &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists alisp -qq -#! &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists ccl --no-init --quiet --batch --load &amp;quot;$0&amp;quot;  --eval &#39;(quit)&#39; -- &amp;quot;$@&amp;quot;
 run_if_exists abcl --noinform --noinit --nosystem --batch --load &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists lisp -quiet -noinit -batch -load &amp;quot;$0&amp;quot; -eval &#39;(quit)&#39; -- &amp;quot;$@&amp;quot;
 echo &amp;quot;No lisp implementation found&amp;quot;
 exit 1
|#

(write-line (lisp-implementation-type))
(force-output)

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;abclとcclが利用可能になりました。あとCIMも捜すようにしました。roswellは作者に訊いて下さい。&lt;/p&gt;

&lt;p&gt;ちなみに、shebangの解釈はシェルに依存するのですが、B Shell, csh, tcsh, dash, Bash, zshで動作確認しました。古い機能なので新しいシェルほど切り捨てている可能性があったのですがBashやzshが大丈夫だったので良かったです。
一応非推奨な気がしますがこれしか方法がないので仕方ないですね。&lt;/p&gt;

&lt;p&gt;ということでみなさんスクリプト書きましょう。&lt;/p&gt;

&lt;h1 id=&#34;追記&#34;&gt;追記&lt;/h1&gt;

&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; shebangの解釈はシェルじゃなくてOSのexec()がやります。で、#!や認識できるバイナリ以外は、exec()がエラーを返した後でシェルがファイルを見て、テキストファイルならシェルスクリプトとして実行ってやってます。なので先頭が:の場合は(続&lt;/p&gt;&amp;mdash; Kilo Kawai (@anohana) &lt;a href=&#34;https://twitter.com/anohana/status/614551978526445570&#34;&gt;2015, 6月 26&lt;/a&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; shebangとしてではなく、シェルがシェルスクリプトとして読んでるだけなので、その後に/bin/shとか書いてあっても関係ないはず (シェルによってはそこも見るかもしれませんが)&lt;/p&gt;&amp;mdash; Kilo Kawai (@anohana) &lt;a href=&#34;https://twitter.com/anohana/status/614552151759589376&#34;&gt;2015, 6月 26&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src=&#34;//platform.twitter.com/widgets.js&#34; charset=&#34;utf-8&#34;&gt;&lt;/script&gt;&lt;/p&gt;

&lt;p&gt;ということで実験してみたところ、先頭の&lt;code&gt;&amp;quot;:&amp;quot; &amp;quot;/bin/sh&amp;quot;&lt;/code&gt;はどのシェルも読み飛ばす模様(つまり、&lt;code&gt;&amp;quot;:&amp;quot; &amp;quot;/usr/bin/ruby&amp;quot;&lt;/code&gt;と書いてもrubyが実行される訳ではない)。&lt;/p&gt;

&lt;p&gt;で、先程の 完全版から&lt;code&gt;&amp;quot;:&amp;quot; &amp;quot;/bin/sh&amp;quot;&lt;/code&gt;を取り除いて&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-lisp&#34;&gt;#|
run_if_exists(){
 command -v $1 &amp;gt; /dev/null 2&amp;gt;&amp;amp;1 &amp;amp;&amp;amp; exec &amp;quot;$@&amp;quot;
}
 run_if_exists cl &amp;quot;$0&amp;quot; &amp;quot;$@&amp;quot;
 run_if_exists sbcl --noinform --no-sysinit --no-userinit --script &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists clisp -norc --quiet --silent -on-error exit  &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists ecl -norc -q -shell &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists mkcl -norc -q -shell &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists alisp -qq -#! &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists ccl --no-init --quiet --batch --load &amp;quot;$0&amp;quot;  --eval &#39;(quit)&#39; -- &amp;quot;$@&amp;quot;
 run_if_exists abcl --noinform --noinit --nosystem --batch --load &amp;quot;$0&amp;quot; -- &amp;quot;$@&amp;quot;
 run_if_exists lisp -quiet -noinit -batch -load &amp;quot;$0&amp;quot; -eval &#39;(quit)&#39; -- &amp;quot;$@&amp;quot;
 echo &amp;quot;No lisp implementation found&amp;quot;
 exit 1
|#

(write-line (lisp-implementation-type))
(force-output)

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;としても動いたのでこれが最終版ということになります。&lt;/p&gt;

&lt;p&gt;大学の講究でMINIX本やったどころかexecのところ自分の担当だったのに恥かしい。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Common Lisp処理系拡張の探求 SBCLのマルチスレッドサポート</title>
      <link>/slide/Common_Lispshorikeikakuchounotankyuu_SBCLnomaruchisureddosapo_to/</link>
      <pubDate>Sat, 20 Jun 2015 18:30:52 +0900</pubDate>
      
      <guid>/slide/Common_Lispshorikeikakuchounotankyuu_SBCLnomaruchisureddosapo_to/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
### Common Lisp 処理系拡張の探求
SBCLのマルチスレッドサポート

----------------------
Lisp Meet Up #29

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + 渋谷のエンジニア
 + Lisp, ML, Shell Scriptあたりを書きます
===
# CLのマルチスレッド
----------------------------
## [bordeaux-threads](https://trac.common-lisp.net/bordeaux-threads/wiki/ApiDocumentation)
* 色々な処理系のマルチスレッドサポートの抽象レイヤー
* デファクトスタンダード
  + スレッド
  + ロック
  + コンディションヴァリアル

===
# SBLCのマルチスレッド

&lt;!-- .slide: class=&#34;center&#34; --&gt;

===
# SBLCのマルチスレッド
----------------------------

* スレッド
  + スレッド内エラー
* アトミック操作&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;
  + CAS&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;
* 排他制御（ロック）
* セマフォ
* コンディションヴァリアル
* バリア
* キュー&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;
* メールボックス&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;
* ゲート&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;
* frlock&lt;!-- .element: class=&#34;fragment highlight-red&#34; data-fragment-index=&#34;1&#34; --&gt;

===
# アトミック操作

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# アトミック操作
----------------
複雑な動作は同じデータに並行に動かすと壊れうる

```
        [var = 1]
[incf]      |      [decf]
 [1]&lt;-------|
  |         |------&gt;[1]
 [2]---&gt;[var = 2]    |
            |        | 
        [var = 0]&lt;--[0]
```
===
# アトミック操作
----------------

* `atomic-{incf, decf}`
  + 動作出来る場所が限られている
* `atomic-{pop, push, update}`
  + CASプロトコルを実装していればどこでも

===
# CASプロトコル
---------------
* compare and swap
* アトミック操作の基本中の基本
  + ハードウェアレベルのサポート
* ざっくり言うと並行版setf
* `(cas place old new env)`
  + もし`place`が`old`に等しければ`new`を代入
* `(defun (cas foo) (old new))`
  + `cas`版の`setf`定義
* 他にも`setf`相当の機能は揃ってる
===
# CASプロトコル
---------------

```lisp
(defvar *foo* nil)

(defun (cas foo) (old new)
  (cas (symbol-value &#39;*foo*) old new))
```

===
# キュー
--------

* 普通のキュー
* スレッドセーフ
* `enqueue`, `dequeue`が基本操作
* `dequeue`が多値で、ブロックしない
  + 空なら第二値がnilになる

===
# メールボックス
---------------

* キューとほぼ同じ
* スレッドセーフ
* `send-message`, `recieve-message`が基本操作
* `recieve-message`はブロックする
  + タイムアウトも設定出来る
* `recieve-message-no-hangはdequeue`と同じ挙動
* `recieve-pending-messages`もある

===
# ゲート
--------

* 複数のスレッドが1つのイベントを待つ時に使う
* `wait-on-gate`, `open-gate`, `close-gate`が基本操作

===
```
[gate (closed)]  [T1] [T2] [T3]
     |            |    |    |
     |     wait   |    |    |
     |&lt;----------------+----+
     |            |    .    .
     |     open   |    .    .
[gate (opened)]&lt;--+    .    .
     +----------------&gt;+---&gt;+
         go            |    |
                       V    V
```

===
# frlock
--------

* Fast Read Lock
* またの名をRead-Write Lock
* Read Lockは多重に取れる。Write Lockは1つしか取れない。
* 基本操作は`frlock-read`と`frlock-write`
* 普通のlockと違って複数のReadが速くなる

===
# まとめ
--------

* SBCLのマルチスレッドサポートはbordeaux-threadsよりもリッチ
* 処理系の独自サポート面白い
* 処理系に依存してしまってもいいんじゃないだろうか
&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>ClojureでOpenCV 3.0と戯れる</title>
      <link>/blog/2015/06/07/clojuredeopencv3_0totawamureru</link>
      <pubDate>Sun, 07 Jun 2015 16:56:51 +0900</pubDate>
      
      <guid>/blog/2015/06/07/clojuredeopencv3_0totawamureru</guid>
      <description>&lt;p&gt;κeenです。先日OpenCV 3.0がリリースされましたね。
ちょっと触ってみようと思ったのですが公式バインディングがC++、C、Java、Pythonと中々つらい言語ばっかりなので扱いやすいClojureから触った時のメモです。&lt;/p&gt;

&lt;p&gt;2系とはAPIが変わってる部分もあるらしく、苦労しました。
UbuntuでやってるのでMacの人は適当に読み替えて下さい。
&lt;/p&gt;

&lt;h1 id=&#34;準備&#34;&gt;準備&lt;/h1&gt;

&lt;h2 id=&#34;opencv&#34;&gt;OpenCV&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://opencv.org/&#34;&gt;公式&lt;/a&gt;からOpenCV 3.0をダウンロードしてきましょう。展開してからは&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cd opencv-3.0.0
$ cmake .
$ make -j4
$ sudo make -j4 install
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;でインストールまでしてくれます。&lt;/p&gt;

&lt;h2 id=&#34;imshow&#34;&gt;ImShow&lt;/h2&gt;

&lt;p&gt;どうも3.0からHighguiというQtベースのGUIツール群のJavaバインディングが作られなくなったそうです。Swing使えと。&lt;/p&gt;

&lt;p&gt;ということでOpenCVとSwingのブリッジしてくれる軽いライブラリが&lt;a href=&#34;https://github.com/master-atul/ImShow-Java-OpenCV&#34;&gt;ImShow-Java-OpenCV&lt;/a&gt;
です。.javaファイル1枚なので本当に軽いです。&lt;/p&gt;

&lt;p&gt;.jarもレポジトリに入ってるのですがソースコードより古いらしく、自分でビルドする必要があります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ git clone git@github.com:master-atul/ImShow-Java-OpenCV.git
$ cd ImShow-Java-OpenCV/ImShow_JCV/src
$ javac com/atul/JavaOpenCV/Imshow.java
$ jar -cf Imshow.jar com/atul/JavaOpenCV/Imshow.class
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;lein-プロジェクト&#34;&gt;lein プロジェクト&lt;/h2&gt;

&lt;p&gt;Clojureのプロジェクト管理ツールの&lt;a href=&#34;http://leiningen.org/&#34;&gt;Leiningen&lt;/a&gt;を使います。知らない人は適当にググって下さい。&lt;/p&gt;

&lt;p&gt;まずプロジェクトを作ります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ lein new opencv-play
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;んで、mavenでいうところのpom.xmlにあたるproject.cljをいじります。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ cd opencv-play
$ cat project.clj
(defproject opencv-play &amp;quot;0.1.0-SNAPSHOT&amp;quot;
  :description &amp;quot;FIXME: write description&amp;quot;
  :url &amp;quot;http://example.com/FIXME&amp;quot;
  :license {:name &amp;quot;Eclipse Public License&amp;quot;
            :url &amp;quot;http://www.eclipse.org/legal/epl-v10.html&amp;quot;}
  :dependencies [[org.clojure/clojure &amp;quot;1.6.0&amp;quot;]])
$ edit project.clj
$ cat project.clj
(defproject opencv-play &amp;quot;0.1.0-SNAPSHOT&amp;quot;
  :description &amp;quot;FIXME: write description&amp;quot;
  :url &amp;quot;http://example.com/FIXME&amp;quot;
  :license {:name &amp;quot;Eclipse Public License&amp;quot;
            :url &amp;quot;http://www.eclipse.org/legal/epl-v10.html&amp;quot;}
  :dependencies [[org.clojure/clojure &amp;quot;1.6.0&amp;quot;]
                 [cider/cider-nrepl &amp;quot;0.9.0-SNAPSHOT&amp;quot;]]
  :jvm-opts [&amp;quot;-Djava.library.path=./lib&amp;quot;]
  :resource-paths [&amp;quot;./lib/opencv-300.jar&amp;quot;
                   &amp;quot;./lib/Imshow.jar&amp;quot;]
  :injections [(clojure.lang.RT/loadLibrary org.opencv.core.Core/NATIVE_LIBRARY_NAME)])
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;そしたら先程のライブラリ達を配置します。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ mkdir lib
$ cp /usr/local/share/OpenCV/java/* lib
$ cp /path/to/ImShow-Java-OpenCV/ImShow_JCV/src/Imshow.jar lib
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ついでにlenaも呼びましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ mkdir img
$ cp /path/to/src/of/opencv-3.0.0/samples/data/lena.jpg img
&lt;/code&gt;&lt;/pre&gt;

&lt;h1 id=&#34;遊ぶ&#34;&gt;遊ぶ&lt;/h1&gt;

&lt;p&gt;準備完了ってことでREPLを起動しましょう。ちょっと遅いですが我慢。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;$ lein repl
Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/share/java/jayatanaag.jar 
Picked up JAVA_TOOL_OPTIONS: -javaagent:/usr/share/java/jayatanaag.jar 
nREPL server started on port 52301 on host 127.0.0.1 - nrepl://127.0.0.1:52301
REPL-y 0.3.5, nREPL 0.2.6
Clojure 1.6.0
Java HotSpot(TM) 64-Bit Server VM 1.8.0_25-b17
    Docs: (doc function-name-here)
          (find-doc &amp;quot;part-of-name-here&amp;quot;)
  Source: (source function-name-here)
 Javadoc: (javadoc java-object-or-class-here)
    Exit: Control+D or (exit) or (quit)
 Results: Stored in vars *1, *2, *3, an exception in *e

user=&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;このままREPLを使ってもいいですが私はEmacsから&lt;a href=&#34;https://github.com/clojure-emacs/cider&#34;&gt;CIDER&lt;/a&gt;でnREPLにつなぎます。
REPLでも補完は効くのでEmacsやらのエディタの設定が面倒ならこのままでも十分ですよ。&lt;/p&gt;

&lt;p&gt;まずは画像のロードから。2系とは違ってImagecodecを使うようです。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (import [org.opencv.imgcodecs Imgcodecs])
org.opencv.imgcodecs.Imgcodecs
user&amp;gt; (def lena (Imgcodecs/imread &amp;quot;img/lena.jpg&amp;quot;))
#&#39;user/lena
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;いじる前に表示してみましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (import [com.atul.JavaOpenCV Imshow])
com.atul.JavaOpenCV.Imshow
user&amp;gt; (def is (Imshow. &amp;quot;Lena&amp;quot;))
#&#39;user/is
user&amp;gt; (.showImage is lena)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/images/clojure-opencv/show-lena.png&#34; alt=&#34;lena&#34; /&gt;&lt;/p&gt;

&lt;p&gt;よしよし。表示されましたね。ではこの辺を参考に顔認識してみましょう。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://qiita.com/woxtu/items/bf39e3d53cbf60396d2c&#34;&gt;Clojure - 二次元絵の顔を検出する - Qiita&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;まずは必要なパッケージの読み込み&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (import [org.opencv.core Mat CvType])
org.opencv.core.CvType
user&amp;gt; (import [org.opencv.imgproc Imgproc])
org.opencv.imgproc.Imgproc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;前処理のグレースケール変換からヒストグラムの均一化まで一気にやってしまいましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (def buffer (Mat. 512 512 CvType/CV_8UC3))
#&#39;user/buffer
user&amp;gt; (Imgproc/cvtColor lena buffer Imgproc/COLOR_RGB2GRAY)
nil
user&amp;gt; (Imgproc/equalizeHist buffer buffer)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ここで一旦画像の確認。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (.showImage is buffer)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;img src=&#34;/images/clojure-opencv/gray-hist-lena.png&#34; alt=&#34;gray-hist-lena&#34; /&gt;&lt;/p&gt;

&lt;p&gt;ふむふむ。ではでは顔を認識しますか。&lt;/p&gt;

&lt;p&gt;まずは色々準備します。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (import [org.opencv.core MatOfRect])
org.opencv.core.MatOfRect
user&amp;gt; (import [org.opencv.objdetect CascadeClassifier])
org.opencv.objdetect.CascadeClassifier
user&amp;gt; (def faces (MatOfRect.))
#&#39;user/faces
user&amp;gt; (def classifier (CascadeClassifier.))
#&#39;user/classifier
user&amp;gt; (.load classifier &amp;quot;/usr/local/share/OpenCV/haarcascades/haarcascade_frontalface_default.xml&amp;quot;)
true
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;因みに分類器のデータのロードは成功がtrueで失敗がfalseだそうです。例外投げないんですね。ハマった。パス名に&lt;code&gt;~&lt;/code&gt;を使うと(ホームを省略表記すると)ロードに失敗するようなのでお気をつけて。&lt;/p&gt;

&lt;p&gt;それでは実行。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (.detectMultiScale classifier buffer faces)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;さて、顔の位置がとれたので画像に重ねるのですがここではSwing(AWT)の描画を使ってみましょう。
OpenCVの描画は画像に描画するのでファイルに書き出しても残っているのに対してSwingのだと表示しているフレームに描画するので書き出した画像には残りません。また、リフレッシュすれば消えるのでインタラクティブに実験するのに向いてます。&lt;/p&gt;

&lt;p&gt;一旦準備。フレームをレナの元画像に戻しておきましょう。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (import [java.awt Rectangle Color])
java.awt.Color
user&amp;gt; (.showImage is lena)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;ImshowのWndowというパブリックなメンバにJFrameが入ってるのでそれを操作します。&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (def g2 (.getGraphics (.Window is)))
#&#39;user/g2
user&amp;gt; (.setColor g2 Color/GREEN)
nil
user&amp;gt; (doseq [face (.toList faces)]
  (let [rect (Rectangle.)]
    (do
      (.setRect rect (.width face) (.height face) (.x face) (.y face))
      (.draw g2 rect))))
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;はい。&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;/images/clojure-opencv/face-recognized-lena.png&#34; alt=&#34;face recognized lena&#34; /&gt;&lt;/p&gt;

&lt;p&gt;パチパチパチ&lt;/p&gt;

&lt;p&gt;因みに四角形を消すには&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-clojure&#34;&gt;user&amp;gt; (.showImage is lena)
nil
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;で十分です。ミスっても何回でもやり直せますね。&lt;/p&gt;

&lt;h1 id=&#34;まとめ&#34;&gt;まとめ&lt;/h1&gt;

&lt;p&gt;因みに3.0のドキュメントが探しづらいのですが、masterにあるようです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://docs.opencv.org/master/&#34;&gt;OpenCV: OpenCV&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;OpenCVをインタラクティブに扱えると楽しいのでみなさんClojure使いましょう。&lt;/p&gt;</description>
    </item>
    
    <item>
      <title>Transducerについて</title>
      <link>/slide/transducernitsuite/</link>
      <pubDate>Wed, 03 Jun 2015 22:29:50 +0900</pubDate>
      
      <guid>/slide/transducernitsuite/</guid>
      <description>&lt;section data-markdown
    data-separator=&#34;\n===\n&#34;
    data-vertical=&#34;\n---\n&#34;
    data-notes=&#34;^Note:&#34;&gt;
&lt;script type=&#34;text/template&#34;&gt;
# Transducerについて
----------------------
サイバーエージェント  
朝の3分スピーチ
&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# About Me
---------
![κeenのアイコン](/images/icon.png) &lt;!-- .element: style=&#34;position:absolute;right:0;z-index:-1&#34; --&gt;

 + κeen
 + [@blackenedgold](https://twitter.com/blackenedgold)
 + Github: [KeenS](https://github.com/KeenS)
 + 渋谷のエンジニア
 + Lisp, ML, Shell Scriptあたりを書きます
===
# Transducerって？
------------------

* Clojure 1.7で入るフレームワーク
* 関数のパイプライン化を簡単にする
* 入力、出力には依存しない

===
# Reduce関数について
-------------------

* `reduce: (&#39;a -&gt; &#39;b -&gt; &#39;a) &#39;a -&gt; &#39;b list`
* `(&#39;a -&gt; &#39;b -&gt; &#39;a)` でシーケンスを集約する
* `(reduce + 0 &#39;(1 2 3)) ;=&gt; 6`
* 要はreduceは関数を使って集約する。
===
# Transducerについて
-------------------

* `transduce:((&#39;a -&gt; &#39;b -&gt; &#39;a) -&gt; (&#39;a -&gt; &#39;b -&gt; &#39;a)) (&#39;a -&gt; &#39;b -&gt; &#39;a) &#39;a -&gt; &#39;b list`
* 集約関数を変換する関数もとる
* `(transduce xf + 0 &#39;(1 2 3))`
* transducerで集約する前に処理を挟める
===
# すごいところ
-------------------------
## コンポーサビリティ

* `((&#39;a -&gt; &#39;b -&gt; &#39;a) -&gt; (&#39;a -&gt; &#39;b -&gt; &#39;a))`
* 変換関数は入力と出力が同じ。
* つまり変換関数を合成出来る
* ex) `(comp (filter odd?) (map inc))`

===
# すごいところ2
--------------------------
## 汎用性

* 各関数は入力や出力について知る必要はない
  + シーケンスではなく要素に対して定義される
* シーケンスだけでなく遅延シーケンス、ストリーム、チャネルなどなどにも使える
* 中間シーケンスを作らない
  + 遅延シーケンスやストリームには大きなメリット
* 集約先をシーケンスなどにすることも出来る
  + 関数の汎用性が上がる
===
# すごいところ3
--------------
## 並列/非同期

* core.asyncもtransducerをサポート
* 各変換関数を並列/非同期に実行が可能
* さらに各関数に割り当てるプロセッサの数も細かく制御出来る

===
&lt;span style=&#34;font-size: 500%;&#34;&gt;変換して&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;span style=&#34;font-size: 500%;&#34;&gt;集約する&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;span style=&#34;font-size: 300%;&#34;&gt;何かに似てない？&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;span style=&#34;font-size: 600%;&#34;&gt;MapReduce&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/oza_x86&#34;&gt;@oza_x86&lt;/a&gt; ozaさんの近しい環境というとHadoop...多段Mapreduceをtransdecerみたいにしようってはなしとかですか？&lt;/p&gt;&amp;mdash; κeen (@blackenedgold) &lt;a href=&#34;https://twitter.com/blackenedgold/status/605368356393218048&#34;&gt;2015, 6月 1&lt;/a&gt;&lt;/blockquote&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; まさにその通りです．MapReduce には Combiner という中間集約をする API があるのですが，それをもっと汎用的にしようという話です． &lt;a href=&#34;http://t.co/injEiPjePG&#34;&gt;http://t.co/injEiPjePG&lt;/a&gt;&lt;/p&gt;&amp;mdash; oza (@oza_x86) &lt;a href=&#34;https://twitter.com/oza_x86/status/605369771505221633&#34;&gt;2015, 6月 1&lt;/a&gt;&lt;/blockquote&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/oza_x86&#34;&gt;@oza_x86&lt;/a&gt; すごい楽しそうですね。Clojure向けのAPIがtransducerのバッグエンドになって普段書いてるコードがそのままHadoopで動いたりしたら、とか夢が無限に広がります&lt;/p&gt;&amp;mdash; κeen (@blackenedgold) &lt;a href=&#34;https://twitter.com/blackenedgold/status/605370461476646912&#34;&gt;2015, 6月 1&lt;/a&gt;&lt;/blockquote&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;blockquote class=&#34;twitter-tweet&#34; data-conversation=&#34;none&#34; lang=&#34;ja&#34;&gt;&lt;p lang=&#34;ja&#34; dir=&#34;ltr&#34;&gt;&lt;a href=&#34;https://twitter.com/blackenedgold&#34;&gt;@blackenedgold&lt;/a&gt; おお，その案は良いですね！！&lt;/p&gt;&amp;mdash; oza (@oza_x86) &lt;a href=&#34;https://twitter.com/oza_x86/status/605370619509637121&#34;&gt;2015, 6月 1&lt;/a&gt;&lt;/blockquote&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;span style=&#34;font-size: 200%;&#34;&gt;Clojure 1.7 + Transducer&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
&lt;span style=&#34;font-size: 400%;&#34;&gt;Comming Soon&lt;/span&gt;

&lt;!-- .slide: class=&#34;center&#34; --&gt;
===
# 参考
------
* [Clojure 1.7のtransducersを動かしてみよう - Qiita](http://qiita.com/tokomakoma123/items/1ca3fb0dddc5b901b032)
* [core.async+transducers Shibuya.lisp #21](http://www.slideshare.net/ktsujister/coreasynctransducers-shibuyalisp-21)
* [Hadoop Combinerメモ(Hishidama&#39;s Hadoop Combiner Memo)](http://www.ne.jp/asahi/hishidama/home/tech/apache/hadoop/Combiner.html)
&lt;/script&gt;
&lt;/section&gt;
</description>
    </item>
    
  </channel>
</rss>