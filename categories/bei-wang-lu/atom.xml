<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 備忘録 | κeenのHappy Hacκing Blog]]></title>
  <link href="http://KeenS.github.io/categories/bei-wang-lu/atom.xml" rel="self"/>
  <link href="http://KeenS.github.io/"/>
  <updated>2014-09-30T11:14:27+09:00</updated>
  <id>http://KeenS.github.io/</id>
  <author>
    <name><![CDATA[κeen]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[パーティションテーブルとか色々吹っ飛ばした話]]></title>
    <link href="http://KeenS.github.io/blog/2014/06/12/partision-table/"/>
    <updated>2014-06-12T12:12:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2014/06/12/partision-table</id>
    <content type="html"><![CDATA[<p>ご不沙汰しております、κeenです。先日（と言ってもしばらく前）、安いHDDを買ってきてFreeBSDでも入れて遊ぼうかとしていました。</p>

<!-- more -->


<p>そうするとインストールは正常に終わるのにリブートするとブートローダが見付からないとか怒られます。おかしいな〜と思って元のHDDに付け替えてインストールメディアをごちゃごちゃしてまたHDDを付け替えてインストールしてを10回くらい繰り返したでしょうか。</p>

<p>はい、挿さってるHDD勘違いして元のHDDにFreeBSD焼いちゃいました。パーティションテーブルとかHDDの先頭にあったWindowsのパーティションとか全滅です。しかもまだFreeBSD起動しない。どうするよこれ。</p>

<p>USBに焼いてたArchがあったのでどうにかUbuntuを落してきてOS自体は復旧出来ました。因みにFreeBSDが起動しなかった理由はハードウェアがBSDだとかGPTだとかのパーティションテーブルに対応してなかったのが原因っぽいです。尚、LinuxもBSDのパーティションテーブルを理解しないので一旦ddとかで強制的にパーティションテーブルを上書きしないと正常にインストール出来ませんでした。</p>

<p>で、ですよ。問題は飛んだデータです。Windowsの方はどうでも良くてUbuntuの方もほとんどの重要なソースコードはgithubやgitbreakで管理してたので問題無くて、重要でないソースコードは仕方無いとして、LTの資料はまあ、SlideShareにあるし良いとして、KVMイメージはそんなに育ててなかったのでまた作り直すことにして、その他のデータはDropBoxに逃がしてて、残り、<code>cl21-datacollections</code>とこのブログのソースはgitで管理してなかったので消えてしまいました。</p>

<p><code>cl21-datacollections</code>は書き直すより他ないので図書館でアルゴリズムイントロダクションを借りてきました。まあ、そのうち出現すると思います。Lisp Meet UpでTOYOZUMIさんにそそのかされたCSB+木も実装してみるつもりです。</p>

<p>ブログの方はソースが無いと流石につらいので掘り起こしたデータの受け皿に新たに500GのHDDと外付け用のカバーを買ってきて<br/>
<img src="/images/HDD.jpg" title="HDD" alt="買ってきたHDDたち" /><br/>
<code>test-disk</code>や<code>photorec</code>といったパーティション、データ復旧ツールで復旧を試みました。</p>

<p>パーティション再認識ツールの<code>test-disk</code>は全然駄目で、わずかに<code>/</code>を認識するだけでその下のファイル情報は全く読み出せませんでした。</p>

<p>しゃあないのでデータ復旧ツールの<code>photorec</code>を一晩回してみると…800万くらいのファイルが掘り起こされました。因みにファイル名は機械的につけられたものです。<br/>
ザーっと眺めてみるとほとんどブラウザキャッシュの残骸ですね。因みに拡張子はすっげー適当につけられてるのでせいぜいバイナリかテキストかを見分けられる程度でした。</p>

<p>流石に人力で捜すのは無理なのでOctopress用のマークダウンを拾ってくるスクリプト書いてまた一晩回してみたものの、集まったのは何故かRubiniusのブログばかりでこのブログのデータはゼロ。どうしようもなく、githubに上がってるHTMLから復旧することにしました。</p>

<p>Nokogiri使ってHTMLのタグをちまちまMarkdownに直すスクリプト書いてる途中で「これ、他にもやってる人いるんじゃね？」という思いが。<br/>
調べてみると、ありました。<a href="https://github.com/xijo/reverse_markdown">Reverse Markdown</a>というそうです。ここまでくればあとはNokogiri使ってメタデータとメインの部分抜き出してくるだけなので楽勝ですね。まあ、 <code>{%</code> や<code>#</code>をスケープするなどの作業もあるのですが。#をエスケープしなきゃいけないのはreverse_markdownのバグっぽそうですね。<br/>
画像はディレクトリごとコピーし、Sassはcleanpressを再度インストール、その他自分で手を加えた部分はこのブログに残してあったのでそこを参照しました。</p>

<p>ブログ更新出来なかった間になにしてたかは別記事にしますね</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Tiarraにercで接続したときの/loadの問題]]></title>
    <link href="http://KeenS.github.io/blog/2013/10/06/tiarra-erc/"/>
    <updated>2013-10-06T00:35:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/10/06/tiarra-erc</id>
    <content type="html"><![CDATA[<p><a href="http://www.clovery.jp/tiarra/">tiarra</a>に <a href="http://www.emacswiki.org/ERC">erc</a>で接続したときの/loadの問題。</p>

<!-- more -->


<p>tiarraは有名なircプロキシ。ercはEmacs上で動くircクライアント。これらを使っているとtiarraが自動でログインしてくれないのでおかしいなと思っていたらtiarraの自動ログインモジュールを有効にしていなかった模様。</p>

<p>書き換えていざ設定を反映しようとすると若干困りました。どこに<code>/load</code>と打てばいいんだろ。</p>

<p>最初に誘導されるバッファ(ircバッファ名がプロキシサーバー名になってるやつ)に<code>/load</code>と打つと</p>

<pre><code>ERC&gt; /load
Incorrect arguments. Usage:
/LOAD line
Load the script provided in the LINE.
If LINE continues beyond the file name, the rest of
it is put in a (local) variable `erc-script-args',
which can be used in Emacs Lisp scripts.


The optional FORCE argument is ignored here - you can't force loading
a script after exceeding the flood threshold.
</code></pre>

<p>ですって。ああ…。<code>/load</code>コマンドがercに食われてる…</p>

<p>流石に解決策あるだろって思って調べたら</p>

<pre><code>/quote load
</code></pre>

<p>だそうです。</p>

<pre><code>ERC&gt; /quote load
-192.168.1.4- *** Reloaded configuration file.
-192.168.1.4- *** Module Channel::Join::Connect will be loaded newly.
</code></pre>

<p>はい。ちゃんとloadしてくれました。</p>

<p>以上小ネタでした。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Gitあれこれ]]></title>
    <link href="http://KeenS.github.io/blog/2013/09/18/some-git-matters/"/>
    <updated>2013-09-18T15:13:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/09/18/some-git-matters</id>
    <content type="html"><![CDATA[<p>githubで共同作業してたらいろいろ困ったことがあったのでそのときのメモ。はじめてやって困ったことなので経験ある人には常識なのかもしれません。</p>

<!-- more -->


<h2>マスターリポジトリに追従する</h2>

<p>マスターをフォークして自分のレポジトリで作業、終ったらマスターにpull-reqという流れで作業してました。するとマスターが変更されたときに自分のリポジトリに反映させる必要があります。そのときは <a href="http://qiita.com/xtetsuji/items/555a1ef19ed21ee42873">http://qiita.com/xtetsuji/items/555a1ef19ed21ee42873</a>を参考に、</p>

<pre><code>$ git remote add upstream git@github.com:g000001/google-common-lisp-style-guide-ja.git
$ git fetch upstream
$ git merge upstream/master
</code></pre>

<p>でできました。</p>

<h2>Pull-Reqを正しく送る</h2>

<p>まず、masterでpull-req送るととりこまれるまで自分のマスターへのコミットが反映され続けるんですね。それで一回失敗。</p>

<p>じゃあ、ということでブランチを切ることに。するとまた問題が。まあ、自分がアホっていったらアホなんですけど</p>

<pre><code>_A_ _B_ _C_
*_/ ___\A'/___ \B'/___\C'_HEAD
</code></pre>

<p>みたいなブランチの作り方してしまいました。<code>A</code>,<code>B</code>,<code>C</code>それぞれでpull-req送ったんですけど当然</p>

<pre><code>A : A
B : B-A'
C : C-B'-A'
</code></pre>

<p>みたいなヒストリのまま送られるわけです。<code>A</code>,<code>B</code>,<code>C</code>は同じファイルの違う箇所への変更なのでヒストリを</p>

<pre><code>_C_
      /_B_
     /_A_ 
*_/ ______ HEAD
</code></pre>

<p>のようにしたいわけです。<code>magit.el</code>さんにお助け願おうかと思いましたが、そもそも出来るか分らないのでTwitterで投げてみたところ、@mod_poppo氏に助けていただきました。<code>git reset</code>と<code>git cherry-pick</code>でできます。</p>

<p><code>A</code>のブランチは問題ないので<code>B</code>でやると、まず私は<code>magit.el</code>で必要な<code>B</code>のコミットを調べておいて</p>

<pre><code>$ git reset --hard *
</code></pre>

<p>で<code>*</code>に<code>HEAD</code>を戻して<code>A</code>, <code>B</code>で加えた変更を全て破棄。</p>

<pre><code>$ git cherry-pick B-commits
</code></pre>

<p>で<code>B</code>での変更のみ適用</p>

<pre><code>$ git push -f origin branch
</code></pre>

<p>で自分のリポジトリに反映(=pull-reqにも反映)<br/>
としました。<code>*</code>と<code>B-commits</code>はそれぞれリビジョンIDを調べて下さいね。</p>

<p>私の説明じゃ分りづらいと思うので <a href="http://d.hatena.ne.jp/murank/20110327/1301224770">http://d.hatena.ne.jp/murank/20110327/1301224770</a>にあるすばらしい図を参考にして下さい。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FreeBSD10でちょっとこけた]]></title>
    <link href="http://KeenS.github.io/blog/2013/09/12/error-on-svn/"/>
    <updated>2013-09-12T23:21:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/09/12/error-on-svn</id>
    <content type="html"><![CDATA[<p>FreeBSD10をインストールしてたときにちょっとつまったところがあったのでメモ。</p>

<!-- more -->


<h2>(前回までのあらすじ)</h2>

<p>FreeBSD10をインストールしたkvmのイメージでFreeBSDのソースをコンパイルできなくなっていたのでκeenはイメージに最新のFreeBSDを上書きインストールすることを決意したのであった</p>

<h2>今回</h2>

<p><a href="https://pub.allbsd.org/FreeBSD-snapshots/">https://pub.allbsd.org/FreeBSD-snapshots/</a>から最新版isoをダウンロードして</p>

<pre><code>$ kvm -cdrom ~/Download/FreeBSD-10.0-HEAD-r255472-JPSNAP-i386-i386-disc1.iso -boot d -m 2048 -smp 3 FreeBSD10.img
</code></pre>

<p>でブート&amp;インストール。普通にインストーラに従って問題無し。<br/>
もう一度</p>

<pre><code>$ kvm -m 2048 -smp 3 FreeBSD10.img
</code></pre>

<p>でブート。<code>/usr/src</code>が空なのを確認して、最近標準添付になったsvnliteでソースをチェックアウト。</p>

<pre><code># cd /usr
# rmdir src
# svnlite co https://svn0.us-west.FreeBSD.org/base/head src
</code></pre>

<p>で、エラー。<br/>
内容は</p>

<blockquote><p>server sent a truncated http response body.</p></blockquote>

<p>不明。<code>svn(lite)</code>のエラーらしいことは分った。<code>https:</code>が悪い気がするので<code>http:</code>にしようかと思ったけど、ふとダメ元で以前はできなかった<code>svn:</code>のスキーマにしてみた。</p>

<pre><code># svnlite co svn://svn0.us-west.FreeBSD.org/base/head src
</code></pre>

<p>できた。なんだよ。</p>

<h3>蛇足</h3>

<p>このあと</p>

<pre><code># svnlite co svn://svn0.us-west.FreeBSD.org/ports/head ports
</code></pre>

<p>でportsもチェックアウトしましたよ</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Redmineのインストール]]></title>
    <link href="http://KeenS.github.io/blog/2013/09/05/install-redmine/"/>
    <updated>2013-09-05T16:35:00+09:00</updated>
    <id>http://KeenS.github.io/blog/2013/09/05/install-redmine</id>
    <content type="html"><![CDATA[<p>私はバイトではプロジェクト管理に <a href="http://backlog.jp">Backlog</a>のサービスを利用してますが、同様のOSSに <a href="http://redmine.jp">Redmine</a>なるものがあると聞いて動かしてみたときのメモ。</p>

<!-- more -->


<p>以下、公式の引用。</p>

<blockquote><p>Redmineはオープンソースのプロジェクト管理ソフトウェアです。</p>

<p>プロジェクトのタスク管理、進捗管理、情報共有が行えます。SubversionやGitなどのバージョン管理システムとの連携機能も備えており、ソフトウェア開発やwebサイト制作などのITプロジェクトで特に威力を発揮します。</p></blockquote>

<p>Redmineの管理団体(？)が <a href="http://hosting.redmine.jp/">MyRedmine</a>というホスティングサービスを提供してたりしますが、今回はこれをローカルで動かします。</p>

<p><a href="http://redmine.jp/guide/RedmineInstall/">公式ドキュメント</a>を参考に作業していきます。</p>

<p>まずはダウンロード。現在の最新版は2.3.2だそうです。</p>

<pre><code>$cd ~/Ruby
$svn checkout http://svn.redmine.org/redmine/branches/2.3-stable redmine
</code></pre>

<p>んで、グローバルの空間を汚したくないので新たにGemsetを作ります。本来ならbundler仕事なのですが、railsのバージョンとか仕組みの問題が面倒臭そうだったのでGemsetで管理。</p>

<pre><code>$rvm use --create 1.9.3@redmine
$cd redmine
$echo ruby-1.9.3-p448 &gt; .ruby-version
$echo redmine &gt; .ruby-gemset
</code></pre>

<p>これで~/Ruby/redmineにcdすると自動的にrvmが1.9.3@redmineに切り替えてくれます。<br/>
※注意<br/>
<code>.rvmrc</code>に<code>rvm use 1.9.3@redmine</code>と書いてたら怒られます。<code>.ruby-version</code>と<code>.ruby-gemset</code>がバージョン管理システムに依存しない新しい書き方だそうです。</p>

<p>データベースはデフォルトだとMySQLを使う設定になってますがこんなお試しにのためにMySQLを動かしたくないのでSQLiteに変更。</p>

<pre><code>$cp config/{database.yml.example, database.yml}
</code></pre>

<p>のあと、database.ymlのproductionの部分を以下のように変更。</p>

<p><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr>
<td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td>
<td class="code"><pre><code class="yaml"><span class="line"><span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
</span><span class="line"><span class="err"> </span><span class="l-Scalar-Plain">adapter</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">sqlite3</span>
</span><span class="line"><span class="err"> </span><span class="l-Scalar-Plain">database</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">db/redmine.sqlite3</span>
</span></code></pre></td>
</tr></table></div></figure></p>

<p>あとは<code>bundle install</code>。(bundlerはインストールされてる前提です)</p>

<pre><code>$bundle install --without development test
</code></pre>

<p>すると…あれ？RMagickでコケる…。公式ドキュメントには <code>bundle</code>の<code>--without</code>に<code>rmagick</code>を加えろと書いてますが画像扱えないのは悔しいので色々調べた結果、</p>

<pre><code>$sudo apt-get install libmagic-dev libmagickwand-dev
</code></pre>

<p>で依存関係を満せるようです。これでようやく<code>bundle install</code>が通ります。</p>

<p>ここまできたらあとはドキュメント通り。</p>

<pre><code>$rake generate_secret_token
$RAILS_ENV=production rake db:migrate
$RAILS_ENV=production rake redmine:load_default_data
$rails s
</code></pre>

<p>…あれ？<code>rails s</code>でコケる。<br/>
これは自分がrailsに慣れてなかったのが問題のようで、正しくは</p>

<pre><code>$rails s -e production
</code></pre>

<p>だそうです。</p>

<pre><code>$RAILS_ENV=production rails s
</code></pre>

<p>としても同じ。これで <a href="http://localhost:3000">localhost:3000</a>にアクセスするとRedmineが開きます。</p>

<p><img src="/images/redmine-home.png" title="redmine-home" alt="Redmineのホーム画面" /></p>

<p>因みにAdminのID、パスワードはadminだそうです。</p>

<p>データベースの設定のexample部分にjenkinsとかいう文字列があったけど連携できるのかなぁ。要調査。</p>

<hr />

<h3>補足</h3>

<p>デフォルトのWEBrickだと遅いのでGemfileに</p>

<p><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr>
<td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td>
<td class="code"><pre><code class="ruby"><span class="line"><span class="n">gem</span> <span class="s2">&ldquo;thin&rdquo;</span>
</span></code></pre></td>
</tr></table></div></figure></p>

<p>を加えて、<code>bundle install</code>し直すと自動的にThinを使ってくれるそうです。</p>
]]></content>
  </entry>
  
</feed>
