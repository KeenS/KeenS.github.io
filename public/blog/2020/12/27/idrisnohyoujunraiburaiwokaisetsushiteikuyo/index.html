<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="Idrisの標準ライブライを解説していくよ | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="κeenです。俺たちのAdvent Calendarはまだまだ続くぜ！
Idrisの標準ライブラリ、preludeとbaseをサクっと解説していきます。" />
        <meta property="og:title" content="Idrisの標準ライブライを解説していくよ | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https:///blog/2020/12/27/idrisnohyoujunraiburaiwokaisetsushiteikuyo/" />
        <meta property="og:description" content="κeenです。俺たちのAdvent Calendarはまだまだ続くぜ！
Idrisの標準ライブラリ、preludeとbaseをサクっと解説していきます。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/Idrisnohyoujunraiburaiwokaisetsushiteikuyo.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/Idrisnohyoujunraiburaiwokaisetsushiteikuyo.png" />
        
        <meta property="og:article:published_time" content="2020-12-27 21:15:10 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2020-12-27 21:15:10 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>Idrisの標準ライブライを解説していくよ | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="/manifest.json">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="/about/"> About </a></li>
                        
                            <li><a href="/index.xml"> Atom </a></li>
                        
                            <li><a href="/post/"> Blog </a></li>
                        
                            <li><a href="/slide/"> Slide </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="/about/"> About </a></li>
                    
                        <li><a href="/index.xml"> Atom </a></li>
                    
                        <li><a href="/post/"> Blog </a></li>
                    
                        <li><a href="/slide/"> Slide </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">Idrisの標準ライブライを解説していくよ</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2020-12-27</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="/categories/idris">Idris</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>κeenです。俺たちのAdvent Calendarはまだまだ続くぜ！
Idrisの標準ライブラリ、preludeとbaseをサクっと解説していきます。</p>

<h1 id="prelude">prelude</h1>

<h2 id="builtins"><code>Builtins</code></h2>

<p>コンパイラから特別扱いされている型などが入っています。</p>

<p>例えば <code>()</code> に対応する <code>Unit</code> 型や <code>(A, B)</code> に対応する <code>Pair</code> 型など。</p>

<p>まだ紹介していないものをいくつか紹介しましょう。</p>

<dl>
<dt><code>replace : {a:_} -&gt; {x:_} -&gt; {y:_} -&gt; {P : a -&gt; Type} -&gt; x = y -&gt; P x -&gt; P y</code></dt>
<dd><code>x = y</code>ならば <code>P x</code> を <code>P y</code> に書き換えられるよね。</dd>
<dt><code>sym : {left:a} -&gt; {right:b} -&gt; left = right -&gt; right = left</code></dt>
<dd>等式の左右を入れ替える。 <code>rewrite sym $ ... in ...</code> の形で使うことが多い</dd>
<dt><code>Inf : Type -&gt; Type</code></dt>
<dd>（遅延した）無限の計算を表わす。<code>Stream</code> ででてくる。</dd>
</dl>

<h2 id="io"><code>IO</code></h2>

<p>IOモナド関連の内部実装。直接お世話になることは少ないですかね。</p>

<h2 id="prelude-algebra"><code>Prelude.Algebra</code></h2>

<p>2つのインタフェースが定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Semigroup</span> ty <span class="kr">where</span>
  <span class="ow">(&lt;+&gt;)</span> <span class="ow">:</span> ty <span class="ow">-&gt;</span> ty <span class="ow">-&gt;</span> ty

interface <span class="kt">Semigroup</span> ty <span class="ow">=&gt;</span> <span class="kt">Monoid</span> ty <span class="kr">where</span>
  <span class="nf">neutral</span> <span class="ow">:</span> ty</code></pre></div>
<p>それぞれ<a href="https://ja.wikipedia.org/wiki/半群">半群</a>と<a href="https://ja.wikipedia.org/wiki/モノイド">モノイド</a>です。</p>

<p>特に <code>Semigroup</code> に定義されている二項演算は強力で、リストの結合など、色々な操作を抽象化しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; [1, 2, 3] &lt;+&gt; [4, 5, 6]
[1, 2, 3, 4, 5, 6] : List Integer</code></pre></div>
<h2 id="prelude-functor"><code>Prelude.Functor</code></h2>

<p>ファンクタが定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Functor</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
    <span class="nf">map</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f b</code></pre></div>
<h2 id="prelude-applicative"><code>Prelude.Applicative</code></h2>

<p>既に紹介した <code>Applicative</code> が定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixl</span> <span class="mi">3</span> <span class="ow">&lt;*&gt;</span>

interface <span class="kt">Functor</span> f <span class="ow">=&gt;</span> <span class="kt">Applicative</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
    <span class="nf">pure</span>  <span class="ow">:</span> a <span class="ow">-&gt;</span> f a
    <span class="ow">(&lt;*&gt;)</span> <span class="ow">:</span> f <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f b</code></pre></div>
<p>もう1つ重要なのが、 <code>Alternative</code> です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixr</span> <span class="mi">2</span> <span class="ow">&lt;|&gt;</span>
interface <span class="kt">Applicative</span> f <span class="ow">=&gt;</span> <span class="kt">Alternative</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
    <span class="nf">empty</span> <span class="ow">:</span> f a
    <span class="ow">(&lt;|&gt;)</span> <span class="ow">:</span> f a <span class="ow">-&gt;</span> f a <span class="ow">-&gt;</span> f a</code></pre></div>
<p>例えば <code>Maybe</code> のように失敗するかもしれない計算上で <code>||</code> 演算子のような働きをします。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; Just 1 &lt;|&gt; Just 2
Just 1 : Maybe Integer
Idris&gt; Just 1 &lt;|&gt; Nothing
Just 1 : Maybe Integer
Idris&gt; Nothing &lt;|&gt; Just 1
Just 1 : Maybe Integer
Idris&gt; the (Maybe Int) Nothing &lt;|&gt; Nothing
Nothing : Maybe Int</code></pre></div>
<p>他には <code>guard</code> や <code>when</code> などの処理もあります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">guard</span> <span class="ow">:</span> <span class="kt">Alternative</span> f <span class="ow">=&gt;</span> <span class="kt">Bool</span> <span class="ow">-&gt;</span> f <span class="ow">()</span>
guard a <span class="ow">=</span> <span class="kr">if</span> a <span class="kr">then</span> pure <span class="ow">()</span> <span class="kr">else</span> empty

<span class="nf">when</span> <span class="ow">:</span> <span class="kt">Applicative</span> f <span class="ow">=&gt;</span> <span class="kt">Bool</span> <span class="ow">-&gt;</span> <span class="kt">Lazy</span> <span class="ow">(</span>f <span class="ow">())</span> <span class="ow">-&gt;</span> f <span class="ow">()</span>
when <span class="kt">True</span> f <span class="ow">=</span> <span class="kt">Force</span> f
when <span class="kt">False</span> f <span class="ow">=</span> pure <span class="ow">()</span></code></pre></div>
<p>これらはモナドと一緒に使うと便利です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">do</span>
  n <span class="ow">&lt;-</span> <span class="ow">[</span><span class="mi">1</span><span class="ow">..</span><span class="mi">10</span><span class="ow">]</span>
  guard <span class="ow">$</span> n `mod` <span class="mi">2</span> <span class="ow">==</span> <span class="mi">0</span>
  pure n
<span class="c1">-- [2, 4, 6, 8, 10] : List Integer</span></code></pre></div>
<h2 id="prelude-monad"><code>Prelude.Monad</code></h2>

<p>モナドが定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixl</span> <span class="mi">1</span> <span class="ow">&gt;&gt;=</span>

interface <span class="kt">Applicative</span> m <span class="ow">=&gt;</span> <span class="kt">Monad</span> <span class="ow">(</span>m <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
    <span class="ow">(&gt;&gt;=)</span>  <span class="ow">:</span> m a <span class="ow">-&gt;</span> <span class="ow">((</span>result <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> m b<span class="ow">)</span> <span class="ow">-&gt;</span> m b

    <span class="nf">join</span> <span class="ow">:</span> m <span class="ow">(</span>m a<span class="ow">)</span> <span class="ow">-&gt;</span> m a

    <span class="c1">-- default implementations</span>
    <span class="ow">(&gt;&gt;=)</span> x f <span class="ow">=</span> join <span class="ow">(</span>f <span class="ow">&lt;$&gt;</span> x<span class="ow">)</span>
    join x <span class="ow">=</span> x <span class="ow">&gt;&gt;=</span> id</code></pre></div>
<h2 id="prelude-foldable"><code>Prelude.Foldable</code></h2>

<p><code>foldl</code> と <code>foldr</code> 、他の言語でいうイテラブル相当のインタフェースを提供します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Foldable</span> <span class="ow">(</span>t <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">foldr</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> elem <span class="ow">-&gt;</span> acc <span class="ow">-&gt;</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>init <span class="ow">:</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>input <span class="ow">:</span> t elem<span class="ow">)</span> <span class="ow">-&gt;</span> acc

  <span class="nf">foldl</span> <span class="ow">:</span> <span class="ow">(</span>func <span class="ow">:</span> acc <span class="ow">-&gt;</span> elem <span class="ow">-&gt;</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>init <span class="ow">:</span> acc<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>input <span class="ow">:</span> t elem<span class="ow">)</span> <span class="ow">-&gt;</span> acc
  foldl f z t <span class="ow">=</span> foldr <span class="ow">(</span>flip <span class="ow">(.)</span> <span class="ow">.</span> flip f<span class="ow">)</span> id t z</code></pre></div>
<p>イテレータにありがちな操作も提供しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">concat</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Foldable</span> t, <span class="kt">Monoid</span> a<span class="ow">)</span> <span class="ow">=&gt;</span> t a <span class="ow">-&gt;</span> a
concat <span class="ow">=</span> foldr <span class="ow">(&lt;+&gt;)</span> neutral

<span class="nf">concatMap</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Foldable</span> t, <span class="kt">Monoid</span> m<span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> m<span class="ow">)</span> <span class="ow">-&gt;</span> t a <span class="ow">-&gt;</span> m
concatMap f <span class="ow">=</span> foldr <span class="ow">((&lt;+&gt;)</span> <span class="ow">.</span> f<span class="ow">)</span> neutral

<span class="nf">and</span> <span class="ow">:</span> <span class="kt">Foldable</span> t <span class="ow">=&gt;</span> t <span class="ow">(</span><span class="kt">Lazy</span> <span class="kt">Bool</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
and <span class="ow">=</span> foldl <span class="ow">(&amp;&amp;)</span> <span class="kt">True</span>

<span class="nf">or</span> <span class="ow">:</span> <span class="kt">Foldable</span> t <span class="ow">=&gt;</span> t <span class="ow">(</span><span class="kt">Lazy</span> <span class="kt">Bool</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
or <span class="ow">=</span> foldl <span class="ow">(||)</span> <span class="kt">False</span>

<span class="nf">any</span> <span class="ow">:</span> <span class="kt">Foldable</span> t <span class="ow">=&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="ow">)</span> <span class="ow">-&gt;</span> t a <span class="ow">-&gt;</span> <span class="kt">Bool</span>
any p <span class="ow">=</span> foldl <span class="ow">(\</span>x,y <span class="ow">=&gt;</span> x <span class="ow">||</span> p y<span class="ow">)</span> <span class="kt">False</span>

<span class="nf">all</span> <span class="ow">:</span> <span class="kt">Foldable</span> t <span class="ow">=&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="ow">)</span> <span class="ow">-&gt;</span> t a <span class="ow">-&gt;</span> <span class="kt">Bool</span>
all p <span class="ow">=</span> foldl <span class="ow">(\</span>x,y <span class="ow">=&gt;</span> x <span class="ow">&amp;&amp;</span> p y<span class="ow">)</span>  <span class="kt">True</span></code></pre></div>
<p><code>concat</code> は先程紹介したとおり <code>List</code> なんかが <code>Monoid</code> を実装しているので以下のように使えます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; concat [[1, 2, 3], [4, 5, 6], [7, 8, 9]]
[1, 2, 3, 4, 5, 6, 7, 8, 9] : List Intege</code></pre></div>
<p>あとは <code>Alternative</code> を使ったAPIもあります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">choice</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Foldable</span> t, <span class="kt">Alternative</span> f<span class="ow">)</span> <span class="ow">=&gt;</span> t <span class="ow">(</span>f a<span class="ow">)</span> <span class="ow">-&gt;</span> f a
choice x <span class="ow">=</span> foldr <span class="ow">(&lt;|&gt;)</span> empty x

<span class="nf">choiceMap</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Foldable</span> t, <span class="kt">Alternative</span> f<span class="ow">)</span> <span class="ow">=&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> f b<span class="ow">)</span> <span class="ow">-&gt;</span> t a <span class="ow">-&gt;</span> f b
choiceMap f x <span class="ow">=</span> foldr <span class="ow">(\</span>elt, acc <span class="ow">=&gt;</span> f elt <span class="ow">&lt;|&gt;</span> acc<span class="ow">)</span> empty x</code></pre></div>
<p>これは最初の成功した値を取り出します。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; choice [Nothing, Nothing, Just 1, Nothing, Just 2]
Just 1 : Maybe Integer
Idris&gt; the (Maybe Int) $ choice [Nothing, Nothing, Nothing]
Nothing : Maybe Int</code></pre></div>
<h2 id="prelude-basics"><code>Prelude.Basics</code></h2>

<p>かなり基本的な操作が入っています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">Not</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
<span class="kt">Not</span> a <span class="ow">=</span> a <span class="ow">-&gt;</span> <span class="kt">Void</span>

<span class="nf">id</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> a
id x <span class="ow">=</span> x

<span class="nf">the</span> <span class="ow">:</span> <span class="ow">(</span>a <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>value <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> a
the <span class="kr">_</span> <span class="ow">=</span> id

<span class="nf">const</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> b <span class="ow">-&gt;</span> a
const x <span class="ow">=</span> <span class="ow">\</span>value <span class="ow">=&gt;</span> x

<span class="nf">fst</span> <span class="ow">:</span> <span class="ow">(</span>a, b<span class="ow">)</span> <span class="ow">-&gt;</span> a
fst <span class="ow">(</span>x, y<span class="ow">)</span> <span class="ow">=</span> x

<span class="nf">snd</span> <span class="ow">:</span> <span class="ow">(</span>a, b<span class="ow">)</span> <span class="ow">-&gt;</span> b
snd <span class="ow">(</span>x, y<span class="ow">)</span> <span class="ow">=</span> y</code></pre></div>
<p><code>(.)</code> は関数合成をします。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixr</span> <span class="mi">9</span> <span class="ow">.</span>

<span class="ow">(.)</span> <span class="ow">:</span> <span class="ow">(</span>b <span class="ow">-&gt;</span> c<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> c
<span class="ow">(.)</span> f g <span class="ow">=</span> <span class="ow">\</span>x <span class="ow">=&gt;</span> f <span class="ow">(</span>g x<span class="ow">)</span></code></pre></div>
<p><code>flip</code> は2引数関数の引数の順序を入れ替えます。
<code>(.)</code> と組み合わせて使うときなんかに便利ですね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">flip</span> <span class="ow">:</span> <span class="ow">(</span>f <span class="ow">:</span> a <span class="ow">-&gt;</span> b <span class="ow">-&gt;</span> c<span class="ow">)</span> <span class="ow">-&gt;</span> b <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> c
flip f x y <span class="ow">=</span> f y x</code></pre></div>
<p>ちょっと変わったものとしては証明用途のデータ型があります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="c1">||| Decidability. A decidable property either holds or is a contradiction.</span>
<span class="kr">data</span> <span class="kt">Dec</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="c1">||| The case where the property holds</span>
  <span class="c1">||| @ prf the proof</span>
  <span class="nf">Yes</span> <span class="ow">:</span> <span class="ow">(</span>prf <span class="ow">:</span> prop<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Dec</span> prop

  <span class="c1">||| The case where the property holding would be a contradiction</span>
  <span class="c1">||| @ contra a demonstration that prop would be a contradiction</span>
  <span class="nf">No</span>  <span class="ow">:</span> <span class="ow">(</span>contra <span class="ow">:</span> prop <span class="ow">-&gt;</span> <span class="kt">Void</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Dec</span> prop</code></pre></div>
<p>気持としては <code>Bool</code> に近いんですが、「なぜTrueなのか」、「なぜFalse」なのかの証明つきです。</p>

<p><code>the (Dec 1 = 1) (Yes Refl)</code> や <code>the (Dec (1 = 0)) (No SIsNotZ)</code> など。</p>

<h2 id="prelude-bits"><code>Prelude.Bits</code></h2>

<p><code>Bits8</code> などのビット数指定の型の軽い処理が入っています。</p>

<h2 id="prelude-cast"><code>Prelude.Cast</code></h2>

<p><code>Cast</code> インタフェースが定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Cast</span> from to <span class="kr">where</span>
    <span class="nf">cast</span> <span class="ow">:</span> <span class="ow">(</span>orig <span class="ow">:</span> from<span class="ow">)</span> <span class="ow">-&gt;</span> to</code></pre></div>
<p>以外な型同士にも <code>Cast</code> が定義されているのは紹介したとおりです。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kt">Cast</span> <span class="kt">Double</span> <span class="kt">String</span> <span class="kr">where</span>
   <span class="c1">-- ...</span></code></pre></div>
<h2 id="データ型">データ型</h2>

<p><code>Prelude.Bool</code>, <code>Prelude.Chars</code> <code>Prelude.Either</code>, <code>Prelude.Double</code>, <code>Prelude.List</code>, <code>Prelude.Maybe</code>, <code>Prelude.Nat</code>, <code>Prelude.Stream</code>, <code>Prelude.String</code></p>

<p>それぞれのデータ型や関連するコードが定義されています。
このうち <code>Stream</code> だけ触れてないので紹介します。</p>

<h3 id="stream"><code>Stream</code></h3>

<p>リストと似ていますが、終わりのないデータ型です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">Stream</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="ow">(::)</span> <span class="ow">:</span> <span class="ow">(</span>value <span class="ow">:</span> elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Inf</span> <span class="ow">(</span><span class="kt">Stream</span> elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Stream</span> elem</code></pre></div>
<p>例えば無限に1が続くデータ型なんかを作れます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">Idris&gt;</span> <span class="ow">:</span><span class="kr">let</span> ones <span class="ow">=</span> the <span class="ow">(</span><span class="kt">Stream</span> <span class="kt">Int</span><span class="ow">)</span> <span class="ow">$</span> repeat <span class="mi">1</span>
<span class="kt">Idris</span><span class="ow">&gt;</span> take <span class="mi">10</span> ones
<span class="ow">[</span><span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span>, <span class="mi">1</span><span class="ow">]</span> <span class="ow">:</span> <span class="kt">List</span> <span class="kt">Int</span></code></pre></div>
<p>素数一覧みたいに無限に続くデータ型をひとまず作っておいて、必要になったら <code>take</code> や <code>index</code> などで取り出すのが主な使い方ですかね。</p>

<p>それこそFizzBuzzなんかもそうですね。</p>

<h2 id="prelude-file"><code>Prelude.File</code></h2>

<p>ファイル操作が入っています。</p>

<h2 id="prelude-interactive"><code>Prelude.Interactive</code></h2>

<p><code>putStrLn</code> などが入っています。</p>

<h2 id="prelude-interfaces"><code>Prelude.Interfaces</code></h2>

<p><code>Eq</code> などの基本的なインタフェースが入っています。</p>

<h2 id="prelude-pairs"><code>Prelude.Pairs</code></h2>

<p>タプル系の操作かと思いきや依存ペア系の補助データ構造が入っています。</p>

<h2 id="prelude-providers"><code>Prelude.Providers</code></h2>

<p>まだ紹介していないIdris面白機能の1つ、Type Providerで使うデータ型が入っています。</p>

<h2 id="prelude-show"><code>Prelude.Show</code></h2>

<p><code>Show</code> インタフェースが定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Show</span> ty <span class="kr">where</span>
  <span class="kr">partial</span>
  <span class="nf">show</span> <span class="ow">:</span> <span class="ow">(</span>x <span class="ow">:</span> ty<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
  show x <span class="ow">=</span> showPrec <span class="kt">Open</span> x <span class="c1">-- Eta expand to help totality checker</span>

  <span class="kr">partial</span>
  <span class="nf">showPrec</span> <span class="ow">:</span> <span class="ow">(</span>d <span class="ow">:</span> <span class="kt">Prec</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>x <span class="ow">:</span> ty<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
  showPrec <span class="kr">_</span> x <span class="ow">=</span> show x</code></pre></div>
<h2 id="prelude-traversable"><code>Prelude.Traversable</code></h2>

<p><code>Foldable</code> と <code>Applicative</code> を組み合わせるときに使います。 <code>Foldable</code> の要素の1つ1つに操作を加えます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="ow">(</span><span class="kt">Functor</span> t, <span class="kt">Foldable</span> t<span class="ow">)</span> <span class="ow">=&gt;</span> <span class="kt">Traversable</span> <span class="ow">(</span>t <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">traverse</span> <span class="ow">:</span> <span class="kt">Applicative</span> f <span class="ow">=&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> f b<span class="ow">)</span> <span class="ow">-&gt;</span> t a <span class="ow">-&gt;</span> f <span class="ow">(</span>t b<span class="ow">)</span></code></pre></div>
<p>まあ、一番分かりやすいのは <code>for_</code> 関数ですかね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">for_</span> <span class="ow">:</span> <span class="ow">(</span><span class="kt">Foldable</span> t, <span class="kt">Applicative</span> f<span class="ow">)</span> <span class="ow">=&gt;</span> t a <span class="ow">-&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> f b<span class="ow">)</span> <span class="ow">-&gt;</span> f <span class="ow">()</span>
for_ <span class="ow">=</span> flip traverse_</code></pre></div>
<p>こう使います。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">Idris&gt;</span> <span class="ow">:</span>exec for_ <span class="ow">[</span><span class="mi">1</span><span class="ow">..</span><span class="mi">10</span><span class="ow">]</span> <span class="ow">$</span> <span class="ow">\</span>n <span class="ow">=&gt;</span> printLn n
<span class="mi">1</span>
<span class="mi">2</span>
<span class="mi">3</span>
<span class="mi">4</span>
<span class="mi">5</span>
<span class="mi">6</span>
<span class="mi">7</span>
<span class="mi">8</span>
<span class="mi">9</span>
<span class="mi">10</span></code></pre></div>
<h2 id="prelude-uninhabited"><code>Prelude.Uninhabited</code></h2>

<p>証明で使うインタフェースが入っています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Uninhabited</span> t <span class="kr">where</span>
  <span class="kr">total</span> uninhabited <span class="ow">:</span> t <span class="ow">-&gt;</span> <span class="kt">Void</span></code></pre></div>
<h2 id="prelude-wellfounded"><code>Prelude.WellFounded</code></h2>

<p><a href="https://ja.wikipedia.org/wiki/数学的帰納法#整礎帰納法">整礎帰納法</a>をします。</p>

<h2 id="decidable-equality"><code>Decidable.Equality</code></h2>

<p>等値関係に絞った <code>Dec</code> の補助パッケージですかね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">DecEq</span> t <span class="kr">where</span>
  <span class="kr">total</span> decEq <span class="ow">:</span> <span class="ow">(</span>x1 <span class="ow">:</span> t<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>x2 <span class="ow">:</span> t<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Dec</span> <span class="ow">(</span>x1 <span class="ow">=</span> x2<span class="ow">)</span></code></pre></div>
<h2 id="language"><code>Language</code></h2>

<p>リフレクション系のAPIが揃っています。</p>

<h1 id="base">base</h1>

<p>baseの方が複雑なんですが便利なライブラリがあるんですよね。頑張って紹介します。</p>

<h2 id="data-morphisms"><code>Data.Morphisms</code></h2>

<p>モーフィズム（射）が定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">record</span> <span class="kt">Morphism</span> a b <span class="kr">where</span>
  constructor <span class="kt">Mor</span>
  <span class="nf">applyMor</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> b
<span class="kr">infixr</span> <span class="mi">1</span> <span class="ow">~&gt;</span>
<span class="ow">(~&gt;)</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
<span class="ow">(~&gt;)</span> <span class="ow">=</span> <span class="kt">Morphism</span>

<span class="kr">record</span> <span class="kt">Endomorphism</span> a <span class="kr">where</span>
  constructor <span class="kt">Endo</span>
  <span class="nf">applyEndo</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> a

<span class="kr">record</span> <span class="kt">Kleislimorphism</span> <span class="ow">(</span>f <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> a b <span class="kr">where</span>
  constructor <span class="kt">Kleisli</span>
  <span class="nf">applyKleisli</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> f b</code></pre></div>
<p>射、自己準同型、クライスリ射です。
まあ、これは射に色々便利なインタフェースを定義するためのデータ型ですね。</p>

<h2 id="control-category"><code>Control.Category</code></h2>

<p>圏の定義があります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Category</span> <span class="ow">(</span>cat <span class="ow">:</span> k <span class="ow">-&gt;</span> k <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">id</span>  <span class="ow">:</span> cat a a
  <span class="ow">(.)</span> <span class="ow">:</span> cat b c <span class="ow">-&gt;</span> cat a b <span class="ow">-&gt;</span> cat a c</code></pre></div>
<p>射は圏になりますね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">implementation <span class="kt">Category</span> <span class="kt">Morphism</span> <span class="kr">where</span>
  id                <span class="ow">=</span> <span class="kt">Mor</span> id
  <span class="ow">(</span><span class="kt">Mor</span> f<span class="ow">)</span> <span class="ow">.</span> <span class="ow">(</span><span class="kt">Mor</span> g<span class="ow">)</span> <span class="ow">=</span> <span class="kr">with</span> <span class="kt">Basics</span> <span class="ow">(</span><span class="kt">Mor</span> <span class="ow">(</span>f <span class="ow">.</span> g<span class="ow">))</span></code></pre></div>
<p>これは $\mathbf{Set}$ 圏であってるかな？</p>

<p>射の合成の別記法も用意されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixr</span> <span class="mi">1</span> <span class="ow">&gt;&gt;&gt;</span>
<span class="ow">(&gt;&gt;&gt;)</span> <span class="ow">:</span> <span class="kt">Category</span> cat <span class="ow">=&gt;</span> cat a b <span class="ow">-&gt;</span> cat b c <span class="ow">-&gt;</span> cat a c
f <span class="ow">&gt;&gt;&gt;</span> g <span class="ow">=</span> g <span class="ow">.</span> f</code></pre></div>
<h2 id="control-arrow"><code>Control.Arrow</code></h2>

<p>arrow系の定義がいっぱいあります。
arrowは矢印のことで、要するに射の合成とかその辺を担当します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infixr</span> <span class="mi">5</span> <span class="ow">&lt;++&gt;</span>
<span class="kr">infixr</span> <span class="mi">3</span> <span class="ow">***</span>
<span class="kr">infixr</span> <span class="mi">3</span> <span class="ow">&amp;&amp;&amp;</span>
<span class="kr">infixr</span> <span class="mi">2</span> <span class="ow">+++</span>
<span class="kr">infixr</span> <span class="mi">2</span> <span class="ow">\|/</span>

interface <span class="kt">Category</span> arr <span class="ow">=&gt;</span> <span class="kt">Arrow</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">arrow</span>  <span class="ow">:</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> arr a b
  <span class="nf">first</span>  <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr <span class="ow">(</span>a, c<span class="ow">)</span> <span class="ow">(</span>b, c<span class="ow">)</span>

  <span class="nf">second</span> <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr <span class="ow">(</span>c, a<span class="ow">)</span> <span class="ow">(</span>c, b<span class="ow">)</span>
  second f <span class="ow">=</span> arrow swap <span class="ow">&gt;&gt;&gt;</span> first f <span class="ow">&gt;&gt;&gt;</span> arrow swap

  <span class="ow">(***)</span>  <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr a&#39; b&#39; <span class="ow">-&gt;</span> arr <span class="ow">(</span>a, a&#39;<span class="ow">)</span> <span class="ow">(</span>b, b&#39;<span class="ow">)</span>
  f <span class="ow">***</span> g <span class="ow">=</span> first f <span class="ow">&gt;&gt;&gt;</span> second g

  <span class="ow">(&amp;&amp;&amp;)</span>  <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr a b&#39; <span class="ow">-&gt;</span> arr a <span class="ow">(</span>b, b&#39;<span class="ow">)</span>
  f <span class="ow">&amp;&amp;&amp;</span> g <span class="ow">=</span> arrow dup <span class="ow">&gt;&gt;&gt;</span> f <span class="ow">***</span> g <span class="kr">where</span>
    <span class="nf">dup</span> <span class="ow">:</span> x <span class="ow">-&gt;</span> <span class="ow">(</span>x,x<span class="ow">)</span>
    dup x <span class="ow">=</span> <span class="ow">(</span>x,x<span class="ow">)</span>

interface <span class="kt">Arrow</span> arr <span class="ow">=&gt;</span> <span class="kt">ArrowZero</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">zeroArrow</span> <span class="ow">:</span> arr a b

interface <span class="kt">ArrowZero</span> arr <span class="ow">=&gt;</span> <span class="kt">ArrowPlus</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="ow">(&lt;++&gt;)</span> <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr a b <span class="ow">-&gt;</span> arr a b

interface <span class="kt">Arrow</span> arr <span class="ow">=&gt;</span> <span class="kt">ArrowChoice</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">left</span>  <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr <span class="ow">(</span><span class="kt">Either</span> a c<span class="ow">)</span> <span class="ow">(</span><span class="kt">Either</span> b c<span class="ow">)</span>

  <span class="nf">right</span> <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr <span class="ow">(</span><span class="kt">Either</span> c a<span class="ow">)</span> <span class="ow">(</span><span class="kt">Either</span> c b<span class="ow">)</span>
  right f <span class="ow">=</span> arrow mirror <span class="ow">&gt;&gt;&gt;</span> left f <span class="ow">&gt;&gt;&gt;</span> arrow mirror

  <span class="ow">(+++)</span> <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr c d <span class="ow">-&gt;</span> arr <span class="ow">(</span><span class="kt">Either</span> a c<span class="ow">)</span> <span class="ow">(</span><span class="kt">Either</span> b d<span class="ow">)</span>
  f <span class="ow">+++</span> g <span class="ow">=</span> left f <span class="ow">&gt;&gt;&gt;</span> right g

  <span class="ow">(\|/)</span> <span class="ow">:</span> arr a b <span class="ow">-&gt;</span> arr c b <span class="ow">-&gt;</span> arr <span class="ow">(</span><span class="kt">Either</span> a c<span class="ow">)</span> b
  f <span class="ow">\|/</span> g <span class="ow">=</span> f <span class="ow">+++</span> g <span class="ow">&gt;&gt;&gt;</span> arrow fromEither

interface <span class="kt">Arrow</span> arr <span class="ow">=&gt;</span> <span class="kt">ArrowApply</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">app</span> <span class="ow">:</span> arr <span class="ow">(</span>arr a b, a<span class="ow">)</span> b

interface <span class="kt">Arrow</span> arr <span class="ow">=&gt;</span> <span class="kt">ArrowLoop</span> <span class="ow">(</span>arr <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> <span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> arr <span class="ow">(</span><span class="kt">Pair</span> a c<span class="ow">)</span> <span class="ow">(</span><span class="kt">Pair</span> b c<span class="ow">)</span> <span class="ow">-&gt;</span> arr a b</code></pre></div>
<p>記号だらけで、個人的にこれを本当に全部覚えてつかいこなしている人がいるのかは疑問に思ってます。</p>

<h2 id="control-isomorphism"><code>Control.Isomorphism</code></h2>

<p>同型を表わすデータ型です。
ちゃんと証明オブジェクトもついていてえらいですね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">record</span> <span class="kt">Iso</span> a b <span class="kr">where</span>
  constructor <span class="kt">MkIso</span>
  <span class="nf">to</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> b
  <span class="nf">from</span> <span class="ow">:</span> b <span class="ow">-&gt;</span> a
  <span class="nf">toFrom</span> <span class="ow">:</span> <span class="ow">(</span>y <span class="ow">:</span> b<span class="ow">)</span> <span class="ow">-&gt;</span> to <span class="ow">(</span>from y<span class="ow">)</span> <span class="ow">=</span> y
  <span class="nf">fromTo</span> <span class="ow">:</span> <span class="ow">(</span>x <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> from <span class="ow">(</span>to x<span class="ow">)</span> <span class="ow">=</span> x</code></pre></div>
<p><code>Category</code> などいくつかのインタフェースも実装されています。
基本は証明用かな？</p>

<h2 id="control-catchable"><code>Control.Catchable</code></h2>

<p>失敗するかもしれない計算の失敗を処理する機能を提供します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">interface <span class="kt">Catchable</span> <span class="ow">(</span>m <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span><span class="ow">)</span> t <span class="ow">|</span> m <span class="kr">where</span>
    <span class="nf">throw</span> <span class="ow">:</span> t <span class="ow">-&gt;</span> m a
    <span class="nf">catch</span> <span class="ow">:</span> m a <span class="ow">-&gt;</span> <span class="ow">(</span>t <span class="ow">-&gt;</span> m a<span class="ow">)</span> <span class="ow">-&gt;</span> m a</code></pre></div>
<p><code>catch</code> を 中置記法で使うとそれっぽいですかね。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">*Control/Catchable&gt; Right &#34;Correct&#34; `catch` \_ =&gt; Left &#34;Failed&#34;
Right &#34;Correct&#34; : Either String String
*Control/Catchable&gt; the (Either String String) $ Left &#34;Incorrect&#34; `catch` \_ =&gt; Left &#34;Failed&#34;
Left &#34;Failed&#34; : Either String String</code></pre></div>
<h2 id="control-ioexcept"><code>Control.IOExcept</code></h2>

<p><code>IO (Either err a)</code> のパターンが頻出なのでそれをまとめた型です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">record</span> <span class="kt">IOExcept&#39;</span> <span class="ow">(</span>f<span class="ow">:</span><span class="kt">FFI</span><span class="ow">)</span> err a <span class="kr">where</span>
     constructor <span class="kt">IOM</span>
     <span class="nf">runIOExcept</span> <span class="ow">:</span> <span class="kt">IO&#39;</span> f <span class="ow">(</span><span class="kt">Either</span> err a<span class="ow">)</span></code></pre></div>
<h2 id="data-ioref"><code>Data.IORef</code></h2>

<p>変更可能な変数のデータ型を定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="c1">||| A mutable variable in the IO monad.</span>
export
<span class="kr">data</span> <span class="kt">IORef</span> a <span class="ow">=</span> <span class="kt">MkIORef</span> a</code></pre></div>
<p>APIは以下です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">newIORef</span> <span class="ow">:</span> a <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">IORef</span> a<span class="ow">)</span>
<span class="nf">readIORef</span> <span class="ow">:</span> <span class="kt">IORef</span> a <span class="ow">-&gt;</span> <span class="kt">IO</span> a
<span class="nf">writeIORef</span> <span class="ow">:</span> <span class="kt">IORef</span> a <span class="ow">-&gt;</span> a <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
<span class="nf">modifyIORef</span> <span class="ow">:</span> <span class="kt">IORef</span> a <span class="ow">-&gt;</span> <span class="ow">(</span>a <span class="ow">-&gt;</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span></code></pre></div>
<p>以下のようにして使います。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">do</span>
  result <span class="ow">&lt;-</span> newIORef <span class="mi">0</span>
  for_ <span class="ow">[</span><span class="mi">0</span><span class="ow">..</span><span class="mi">10</span><span class="ow">]</span> <span class="ow">$</span> <span class="ow">\</span>n <span class="ow">=&gt;</span>
    modifyIORef result <span class="ow">(+</span>n<span class="ow">)</span>
  readIORef result
<span class="c1">-- 55</span></code></pre></div>
<h2 id="data-buffer"><code>Data.Buffer</code></h2>

<p>バッファが定義されています。
主にファイルとの一括IOで使うのが用途のよう。</p>

<p>IdrisでバイナリIOをしたくなると使うことになると思います。</p>

<h2 id="data-complex"><code>Data.Complex</code></h2>

<p>複素数を定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">infix</span> <span class="mi">6</span> <span class="ow">:+</span>
<span class="kr">data</span> <span class="kt">Complex</span> a <span class="ow">=</span> <span class="ow">(:+)</span> a a</code></pre></div>
<h2 id="data-vect"><code>Data.Vect</code></h2>

<p>長さの決まっているリストを定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">Vect</span> <span class="ow">:</span> <span class="ow">(</span>len <span class="ow">:</span> <span class="kt">Nat</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>elem <span class="ow">:</span> <span class="kt">Type</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="nf">Nil</span>  <span class="ow">:</span> <span class="kt">Vect</span> <span class="kt">Z</span> elem
  <span class="ow">(::)</span> <span class="ow">:</span> <span class="ow">(</span>x <span class="ow">:</span> elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">(</span>xs <span class="ow">:</span> <span class="kt">Vect</span> len elem<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Vect</span> <span class="ow">(</span><span class="kt">S</span> len<span class="ow">)</span> elem</code></pre></div>
<h2 id="data-fin"><code>Data.Fin</code></h2>

<p>有限の自然数を定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">Fin</span> <span class="ow">:</span> <span class="ow">(</span>n <span class="ow">:</span> <span class="kt">Nat</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
    <span class="nf">FZ</span> <span class="ow">:</span> <span class="kt">Fin</span> <span class="ow">(</span><span class="kt">S</span> k<span class="ow">)</span>
    <span class="nf">FS</span> <span class="ow">:</span> <span class="kt">Fin</span> k <span class="ow">-&gt;</span> <span class="kt">Fin</span> <span class="ow">(</span><span class="kt">S</span> k<span class="ow">)</span></code></pre></div>
<p>例えば <code>Fin 3</code> なら3未満の整数しかとれません。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; :module Data.Fin
*Data/Fin&gt; the (Fin 3) 0
FZ : Fin 3
*Data/Fin&gt; the (Fin 3) 1
FS FZ : Fin 3
*Data/Fin&gt; the (Fin 3) 2
FS (FS FZ) : Fin 3
*Data/Fin&gt; the (Fin 3) 3
(input):1:13:When checking argument prf to function Data.Fin.fromInteger:
        When using 3 as a literal for a Fin 3
                3 is not strictly less than 3</code></pre></div>
<p><code>Vect</code> に対するインデックスのように <code>len</code> 未満の値を指定したいときに便利ですね。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">index</span> <span class="ow">:</span> <span class="kt">Fin</span> len <span class="ow">-&gt;</span> <span class="kt">Vect</span> len elem <span class="ow">-&gt;</span> elem
index <span class="kt">FZ</span>     <span class="ow">(</span>x<span class="ow">::</span>xs<span class="ow">)</span> <span class="ow">=</span> x
index <span class="ow">(</span><span class="kt">FS</span> k<span class="ow">)</span> <span class="ow">(</span>x<span class="ow">::</span>xs<span class="ow">)</span> <span class="ow">=</span> index k xs</code></pre></div>
<h2 id="data-hvect"><code>Data.HVect</code></h2>

<p>ヘテロジーニアスなベクタ型を定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">HVect</span> <span class="ow">:</span> <span class="kt">Vect</span> k <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="nf">Nil</span> <span class="ow">:</span> <span class="kt">HVect</span> <span class="ow">[]</span>
  <span class="ow">(::)</span> <span class="ow">:</span> t <span class="ow">-&gt;</span> <span class="kt">HVect</span> ts <span class="ow">-&gt;</span> <span class="kt">HVect</span> <span class="ow">(</span>t<span class="ow">::</span>ts<span class="ow">)</span></code></pre></div>
<p>以下のように異なる型の値を格納できます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">*Data/HVect&gt; the (HVect [Integer, Bool, String]) [1, False, &#34;hetero&#34;]
[1, False, &#34;hetero&#34;] : HVect [Integer, Bool, String]</code></pre></div>
<h2 id="data-bits"><code>Data.Bits</code></h2>

<p><code>Prelude.Bits</code> に加えてもう少し操作を定義しています。</p>

<h2 id="data-list"><code>Data.List</code></h2>

<p><code>Preldhude.List</code> に加えてもう少し操作を定義しています。
<code>intersect</code> などもありますが、主に証明用ですね。</p>

<h2 id="data-string"><code>Data.String</code></h2>

<p><code>Preldhude.String</code> に加えてもう少し操作を定義しています。</p>

<h2 id="data-list-quantifiers"><code>Data.List.Quantifiers</code></h2>

<p><code>List</code> の証明に使えそうな量化子が定義されています。</p>

<h2 id="data-list-views"><code>Data.List.Views</code></h2>

<p><code>List</code> に対するビューが定義されています。</p>

<h2 id="data-vect-quantifiers"><code>Data.Vect.Quantifiers</code></h2>

<p><code>Vect</code> の証明に使えそうな量化子が定義されています。</p>

<h2 id="data-vect-views"><code>Data.Vect.Views</code></h2>

<p><code>Vect</code> に対するビューが定義されています。</p>

<h2 id="data-nat-views"><code>Data.Nat.Views</code></h2>

<p><code>Nat</code> に対するビューが定義されています。</p>

<h2 id="data-primitives-views"><code>Data.Primitives.Views</code></h2>

<p><code>Interger</code> などのプリミティブに対するビューが定義されています。</p>

<h2 id="data-erased"><code>Data.Erased</code></h2>

<p>実行時に消去された値を表現できるデータ型を定義しています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">Erased</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
    <span class="nf">Erase</span> <span class="ow">:</span> <span class="ow">.(</span>x <span class="ow">:</span> a<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Erased</span> a</code></pre></div>
<p>Idrisでは引数の前に <code>.</code> があるとそれは消去されているようです。</p>

<h2 id="data-mod2"><code>Data.Mod2</code></h2>

<p>2^n で割った値を保持する <code>Mod2 n</code> が定義されています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">public</span> export
<span class="kr">data</span> <span class="kt">Mod2</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
    <span class="nf">MkMod2</span> <span class="ow">:</span> <span class="ow">{</span>n <span class="ow">:</span> <span class="kt">Nat</span><span class="ow">}</span> <span class="ow">-&gt;</span> <span class="kt">Bits</span> n <span class="ow">-&gt;</span> <span class="kt">Mod2</span> n</code></pre></div>
<h2 id="data-so"><code>Data.So</code></h2>

<p>型レベル <code>Bool</code> 相当の機能を提供します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">So</span> <span class="ow">:</span> <span class="kt">Bool</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="kr">where</span>
  <span class="nf">Oh</span> <span class="ow">:</span> <span class="kt">So</span> <span class="kt">True</span></code></pre></div>
<p>公式ライブラリだと <code>usleep</code> なんかで使われています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">usleep</span> <span class="ow">:</span> <span class="ow">(</span>i <span class="ow">:</span> <span class="kt">Int</span><span class="ow">)</span> <span class="ow">-&gt;</span> <span class="ow">{</span> <span class="kr">auto</span> prf <span class="ow">:</span> <span class="kt">So</span> <span class="ow">(</span>i <span class="ow">&gt;=</span> <span class="mi">0</span><span class="ow">)</span> <span class="ow">}</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span></code></pre></div>
<p><code>=</code> なら型にあるんですが、 <code>&gt;=</code> はありません。
こういう計算で結果を求めるタイプの証明に便利ですね。</p>

<h2 id="debug"><code>Debug.*</code></h2>

<p><code>Debug.Error</code> と <code>Debug.Trace</code>はそれぞれデバッグ用に使います。
<code>IO</code> 文脈でなくてもIO処理ができてしまう魔法の関数です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">import</span> <span class="nn">Debug.Trace</span>

<span class="nf">add</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
add x y <span class="ow">=</span> trace <span class="s">&#34;debbuging&#34;</span> <span class="ow">$</span> x <span class="ow">+</span> y

<span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> printLn <span class="ow">$</span> <span class="mi">3</span> <span class="ow">*</span> <span class="ow">(</span>add <span class="mi">1</span> <span class="mi">2</span><span class="ow">)</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="ow">$</span> idris <span class="ow">-</span>o add add<span class="ow">.</span>idr
<span class="ow">$</span> <span class="ow">./</span>add
debbuging
<span class="mi">9</span></code></pre></div>
<p>中身は <code>unsafePerformIO</code> というヤバい機能で実装されているのでデバッグ用途以外では使わないようにしましょう。</p>

<h2 id="language-reflection-utils"><code>Language.Reflection.Utils</code></h2>

<p>証明とかに便利そうな関数がちょこっと実装されています。
他はElabに色々なインタフェースを実装する役割。</p>

<h2 id="system"><code>System</code></h2>

<p><code>getEnv</code> や  <code>exit</code> などのシステム関連の機能です。</p>

<h2 id="system-info"><code>System.Info</code></h2>

<p><code>backend</code> などの処理系情報です。</p>

<h2 id="system-concurrency"><code>System.Concurrency.*</code></h2>

<p><code>System.Concurrency.Raw</code> と <code>System.Concurrency.Channels</code> プロセスとチャネルを使ったコミュニケーションを提供します。 <code>Raw</code> は低レベルで型安全でないAPIなので <code>Channels</code> の方を使いましょう。</p>

<p><code>&quot;PING&quot;</code> を送ったら <code>&quot;PONG&quot;</code> を返してくれるプロセスを立ち上げてみます。
<code>spawn</code> に <code>IO ()</code> の値を渡すとプロセスをスタートしてくれます。その他チャネルのAPIはドキュメントとか見て下さい。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">import</span> <span class="nn">System.Concurrency.Channels</span>

<span class="nf">pong</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
pong <span class="ow">=</span> <span class="kr">do</span>
  <span class="kt">Just</span> channel <span class="ow">&lt;-</span> listen <span class="mi">10</span>
  req <span class="ow">&lt;-</span> unsafeRecv <span class="kt">String</span> channel
  <span class="kr">if</span> req <span class="ow">==</span> <span class="kt">Just</span> <span class="s">&#34;PING&#34;</span>
  <span class="kr">then</span> ignore <span class="ow">$</span> unsafeSend channel <span class="s">&#34;PONG&#34;</span>
  <span class="kr">else</span> pure <span class="ow">()</span>

<span class="nf">ping</span> <span class="ow">:</span> <span class="kt">PID</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
ping pid <span class="ow">=</span> <span class="kr">do</span>
  <span class="kt">Just</span> channel <span class="ow">&lt;-</span> connect pid
  unsafeSend channel <span class="s">&#34;PING&#34;</span>
  <span class="kt">Just</span> resp <span class="ow">&lt;-</span> unsafeRecv <span class="kt">String</span> channel
  putStrLn resp

<span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  <span class="c1">-- spawnを呼ぶ</span>
  <span class="kt">Just</span> pongPid <span class="ow">&lt;-</span> spawn pong
  putStrLn <span class="s">&#34;pong spawned&#34;</span>
  ping pongPid
  pure <span class="ow">()</span></code></pre></div>
<p><code>unsafeRecv</code> の引数に型をとるので1つのチャネルで任意の型の値をやりとりできるのがポイントですね。</p>

<p>プロセス内部はCバックエンドではpthreadが立ち上がっているようです。
ただしプロセスという名前だけあってメモリは共有していないようです。
以下のようにクロージャに持たせた <code>IORef</code> を通じてメモリを共有するコードを書いてみました。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">import</span> <span class="nn">System.Concurrency.Channels</span>
<span class="kr">import</span> <span class="nn">Data.IORef</span>


<span class="nf">countDown</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IORef</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
countDown <span class="kt">Z</span>     <span class="kr">_</span> <span class="ow">=</span> pure <span class="ow">()</span>
countDown <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> v <span class="ow">=</span> <span class="kr">do</span>
  writeIORef v <span class="ow">(</span>cast n<span class="ow">)</span>
  countDown n v

<span class="nf">polling</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IORef</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
polling <span class="kt">Z</span>     <span class="kr">_</span> <span class="ow">=</span> pure <span class="ow">()</span>
polling <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> v <span class="ow">=</span> <span class="kr">do</span>
  i <span class="ow">&lt;-</span> readIORef v
  printLn i
  polling n v


<span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  v <span class="ow">&lt;-</span> newIORef <span class="mi">100</span>
  spawn <span class="ow">$</span> countDown <span class="mi">100</span> v
  polling <span class="mi">20</span> v</code></pre></div>
<p>これは実行時に処理系が落ちました。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">channel_ioref: idris_rts.c:912: doCopyTo: Assertion `0&#39; failed.
zsh: abort (core dumped)  ./channel_ioref</code></pre></div>
<p>同じくクロージャではなくチャネルを介しても同様でした。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">import</span> <span class="nn">System.Concurrency.Channels</span>
<span class="kr">import</span> <span class="nn">Data.IORef</span>


<span class="nf">countDown</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
countDown n <span class="ow">=</span> <span class="kr">do</span>
  <span class="kt">Just</span> channel <span class="ow">&lt;-</span> listen <span class="mi">100</span>
  <span class="kt">Just</span> v <span class="ow">&lt;-</span> unsafeRecv <span class="ow">(</span><span class="kt">IORef</span> <span class="kt">Int</span><span class="ow">)</span> channel
  loop n v
<span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IORef</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
  loop <span class="kt">Z</span>     <span class="kr">_</span> <span class="ow">=</span> pure <span class="ow">()</span>
  loop <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> v <span class="ow">=</span> <span class="kr">do</span>
    writeIORef v <span class="ow">(</span>cast n<span class="ow">)</span>
    loop n v

<span class="nf">polling</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">PID</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
polling n pid <span class="ow">=</span> <span class="kr">do</span>
  v <span class="ow">&lt;-</span> newIORef <span class="ow">(</span>the <span class="kt">Int</span> <span class="mi">100</span><span class="ow">)</span>
  <span class="kt">Just</span> channel <span class="ow">&lt;-</span> connect pid
  unsafeSend channel v
  loop n v
<span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IORef</span> <span class="kt">Int</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">()</span>
  loop <span class="kt">Z</span>     <span class="kr">_</span> <span class="ow">=</span> pure <span class="ow">()</span>
  loop <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> v <span class="ow">=</span> <span class="kr">do</span>
    i <span class="ow">&lt;-</span> readIORef v
    printLn i
    loop n v


<span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  <span class="kt">Just</span> pid <span class="ow">&lt;-</span> spawn <span class="ow">$</span> countDown <span class="mi">100</span>
  polling <span class="mi">20</span> pid</code></pre></div>
<p>コンパイル時に防げる仕組みがあったらよかったんですが残念ですね。</p>

<h1 id="まとめ">まとめ</h1>

<p>Idrisの標準ライブラリをさっくり解説しました。</p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="/blog/2020/12/28/smlnoshorikeikumikomireigaittenanda/"> SMLの処理系組み込み例外ってなーんだ</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="/blog/2020/12/27/ronbunmemo_the_third_homomorphism_theorem/"> 論文メモ：The Third Homomorphism Theorem</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2020. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

