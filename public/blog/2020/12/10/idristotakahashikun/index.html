<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
    <head>
        
        
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-43779888-1"></script>
        <script>
         window.dataLayer = window.dataLayer || [];
         function gtag(){dataLayer.push(arguments);}
         gtag('js', new Date());

         gtag('config', 'UA-43779888-1');
        </script>
        

        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

        <meta name="twitter:site" content="@blackenedgold" />
        <meta name="twitter:title" content="Idrisと高橋君 | κeenのHappy Hacκing Blog"/>
        <meta name="twitter:description" content="このエントリはIdris Advent Calendar 2020の10日目の記事です。

κeenです。
今回はIdrisで簡単な競技プログラミングの問題を解いてみたいと思います。" />
        <meta property="og:title" content="Idrisと高橋君 | κeenのHappy Hacκing Blog" />
        <meta property="og:type" content="article" />
        <meta property="og:url" content="https:///blog/2020/12/10/idristotakahashikun/" />
        <meta property="og:description" content="このエントリはIdris Advent Calendar 2020の10日目の記事です。

κeenです。
今回はIdrisで簡単な競技プログラミングの問題を解いてみたいと思います。" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta property="og:image" content="https://KeenS.github.io/images/ogp/post/Idristotakahashikun.png" />
        <meta name="twitter:image" content="https://KeenS.github.io/images/ogp/post/Idristotakahashikun.png" />
        
        <meta property="og:article:published_time" content="2020-12-10 02:18:48 &#43;0900 JST" />
        <meta property="og:article:modified_time" content="2020-12-10 02:18:48 &#43;0900 JST" />
        
        <meta property="og:article:author" content="κeen" />

        <title>Idrisと高橋君 | κeenのHappy Hacκing Blog</title>
        <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Open+Sans:400,300,600' type='text/css' />
        <link rel="stylesheet" href="/libraries/normalize.3.0.1.css" />
        <link rel="stylesheet" href="/css/liquorice.css" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="/manifest.json">
        <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">
        <link rel="apple-touch-icon-precomposed" href="/apple-touch-icon-144-precomposed.png" sizes="144x144" />
        <link rel="stylesheet" href="/css/syntax-monokai.css" />
<script type="text/x-mathjax-config">
 MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ["\\(","\\)"]] } });
</script>
<script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_CHTML"></script>
</script>
<meta http-equiv="X-UA-Compatible" CONTENT="IE=EmulateIE7" />
<link rel="stylesheet" href="//unpkg.com/mermaid@7.0.4/dist/mermaid.forest.min.css">

    </head>
    <body class="li-body">

<header class="li-page-header" id="page-header">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-brand li-left">
                <a href="/">κeenのHappy Hacκing Blog</a> | Lispエイリアンの狂想曲</div>
                <div class="li-menu li-right">
                    <span class="li-menu-icon" onclick="javascript:toggle('menu');">&#9776;</span>
                    <ul id="menu2" class="li-menu-items">
                        
                            <li><a href="/about/"> About </a></li>
                        
                            <li><a href="/index.xml"> Atom </a></li>
                        
                            <li><a href="/post/"> Blog </a></li>
                        
                            <li><a href="/slide/"> Slide </a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="sixteen columns">
                <ul id="menu" class="li-menu-items li-menu-mobile">
                    
                        <li><a href="/about/"> About </a></li>
                    
                        <li><a href="/index.xml"> Atom </a></li>
                    
                        <li><a href="/post/"> Blog </a></li>
                    
                        <li><a href="/slide/"> Slide </a></li>
                    
                </ul>
            </div>
        </div>
    </div>
</header>






    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <article class="li-article">
                    <header class="li-article-header">
                        <h1 class="li-article-title">Idrisと高橋君</h1>
                        <div class="li-article-meta">
    <time class="li-article-date">2020-12-10</time>
    <ul class="li-article-tag">
    
        <li>
            <a href="/categories/idris">Idris</a>
        </li>
    
        <li>
            <a href="/categories/idris-advent-calendar">Idris Advent Calendar</a>
        </li>
    
        <li>
            <a href="/categories/advent-calendar-2020">Advent Calendar 2020</a>
        </li>
    
        <li>
            <a href="/categories/advent-calendar">Advent Calendar</a>
        </li>
    
</ul>

</div>

                    </header>
                    <section>
                        <p>このエントリは<a href="https://qiita.com/advent-calendar/2020/idris">Idris Advent Calendar 2020</a>の10日目の記事です。</p>

<p>κeenです。
今回はIdrisで簡単な競技プログラミングの問題を解いてみたいと思います。</p>

<p>参考にしたのは以下の記事です。</p>

<p><a href="https://qiita.com/drken/items/fd4e5e3630d0f5859067">AtCoder に登録したら次にやること ～ これだけ解けば十分闘える！過去問精選 10 問 ～ - Qiita</a></p>

<p>競技プログラミングというのは与えられた問題を解くプログラムをできるだけ速く書くコンテストです。
入力と出力にあまり凝ったものがなく、プログラミングの技法よりもどちらかというと解く方針を考える方に重点が置かれるのが特徴です。
であれば慣れてないプログラミング言語の練習の題材に丁度いいのでここで採り上げることとします。</p>

<p>AtCoderというのは国内最大手の競技プログラミングのサイトです。</p>

<p>今回は練習問題として採り上げるだけで特に競技には参加しません（そもそもAtCoderはIdrisでの提出を受け付けていないようです）。
なので競技プログラミング風の速く解く書き方ではなくできる限りIdris風になるような書き方をします。</p>

<h1 id="第1問">第1問</h1>

<h2 id="問題">問題</h2>

<p><a href="https://atcoder.jp/contests/abc086/tasks/abc086_a">A - Product</a></p>

<blockquote>
<p>$a$ 、 $b$ の2つの入力が与えられるのでその積が偶数か奇数かを判定して下さい</p>

<h2 id="制約">制約</h2>

<ul>
<li>$1 ≤ a,b ≤ 10000$</li>
<li>$a,b$ は整数</li>
</ul>

<h2 id="入力">入力</h2>

<p>入力は以下の形式で標準入力から与えられる。</p>

<p>a b</p>

<h2 id="出力">出力</h2>

<p>積が奇数なら <code>Odd</code> と、 偶数なら <code>Even</code> と出力する</p>
</blockquote>

<p>例えば入力が以下の場合</p>
<pre><code>3 4</code></pre>
<p>$3 \times 4 = 12$ は偶数なので出力は以下になります。</p>
<pre><code>Even</code></pre>
<h2 id="コード">コード</h2>

<p>まず、問題を解く <code>solve</code> という関数を定義しましょう。
そして出入力を担当するコードを書きます。</p>

<p>結果は <code>Even</code> または <code>Odd</code> なのでそのデータ型を定義しましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">data</span> <span class="kt">Result</span> <span class="ow">=</span> <span class="kt">Even</span> <span class="ow">|</span> <span class="kt">Odd</span></code></pre></div>
<p>これを表示するときは <code>Even</code> または <code>Odd</code> とするのでした。
<code>Show</code> を実装しましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kt">Show</span> <span class="kt">Result</span> <span class="kr">where</span>
  show <span class="kt">Even</span> <span class="ow">=</span> <span class="s">&#34;Even&#34;</span>
  show <span class="kt">Odd</span>  <span class="ow">=</span> <span class="s">&#34;Odd&#34;</span></code></pre></div>
<p>さて、 <code>solve</code> です。 <code>a</code> 、 <code>b</code> を受け取って <code>Even</code> または <code>Odd</code> を返します。</p>

<p>こう書けるでしょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">solve</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Result</span>
solve a b <span class="ow">=</span>
  <span class="kr">if</span> a <span class="ow">*</span> b `mod` <span class="mi">2</span> <span class="ow">==</span> <span class="mi">0</span>
  <span class="kr">then</span> <span class="kt">Even</span>
  <span class="kr">else</span> <span class="kt">Odd</span></code></pre></div>
<p>これを一旦REPLにロードして動作を確認してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">λΠ&gt; solve 3 4
Even : Result
λΠ&gt; solve 1 21
Odd : Result
λΠ&gt; solve 1000 101
Even : Result</code></pre></div>
<p>よさそうです。それでは出入力を担当するコードを書いてみます。
いくつか新要素が出てきます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  line <span class="ow">&lt;-</span> getLine
  <span class="kr">let</span> <span class="ow">[</span>a, b<span class="ow">]</span> <span class="ow">=</span> words line
  printLn <span class="ow">(</span>solve <span class="ow">(</span>cast a<span class="ow">)</span> <span class="ow">(</span>cast b<span class="ow">))</span></code></pre></div>
<p>まず <code>main : IO ()</code> から <code>line &lt;- getLine</code> まではいいでしょう。今まで出てきました。</p>

<p><code>let [a, b] = words line</code> の行は新要素が3つあります。
1つずつやっていきましょう。</p>

<h3 id="words-関数"><code>words</code> 関数</h3>

<p><code>words</code> は文字列を空白で分解する関数です。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; :doc words
Prelude.Strings.words : String -&gt; List String
    Splits a string into a list of whitespace separated strings.
    
        &gt; words &#34; A B C  D E   &#34;
        [&#34;A&#34;, &#34;B&#34;, &#34;C&#34;, &#34;D&#34;, &#34;E&#34;]
    
    The function is: Total &amp; public export
Idris&gt; words &#34;1 2 3&#34;
[&#34;1&#34;, &#34;2&#34;, &#34;3&#34;] : List String</code></pre></div>
<p>この関数は <code>String -&gt; List String</code> で <code>:search</code> すると2番目に出てきます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; :search String -&gt; List String
= Prelude.Strings.lines : String -&gt; List String
Splits a string into a list of newline separated strings.

= Prelude.Strings.words : String -&gt; List String
Splits a string into a list of whitespace separated strings.
...</code></pre></div>
<h3 id="do-記法内の-let-行"><code>do</code> 記法内の <code>let</code> 行</h3>

<p>普通の <code>let</code> と同様に変数を束縛します。ただし末尾の <code>in</code> が不要です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">do</span>
  l1 <span class="ow">&lt;-</span> getLine
  l2 <span class="ow">&lt;-</span> getLine
  <span class="kr">let</span> twoLines <span class="ow">=</span> l1 <span class="ow">++</span> l2
  <span class="ow">...</span></code></pre></div>
<p><code>do</code> 記法内ではオフサイドルールが適用されているのでそれに合わせた構文になっているんですね。</p>

<h3 id="let-でのパターンマッチ"><code>let</code> でのパターンマッチ</h3>

<p><code>let [a, b] = ...</code> の部分です。
パターンマッチできる構文として既に <code>case</code> と関数定義の引数を紹介しました。
それらに <code>let</code> が加わります。</p>

<p>しかしこの <code>let</code> 、パターンが網羅的ではありません。
<code>words line</code> の結果が <code>[]</code> や <code>[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;]</code> の場合にマッチしません。
マッチしない入力がきた場合はどうなるのでしょうか？答えはIdrisのプログラムが終了します。
ちょっと激しいですが、競技プログラミングでは変な入力がこない想定でプログラムを組めるのでまあ、許容範囲でしょう。
とはいえ安全にプログラムを組めるならそれに越したことはないので次の問題でもう少し安全にプログラムを組める方法も紹介します。</p>

<p>ということで <code>let [a, b] = words line</code> の行で入力の行を空白で分割し、それが2要素であった場合にのみ取り出していることになります。</p>

<p>最終行は以下のようになっています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"> printLn <span class="ow">(</span>solve <span class="ow">(</span>cast a<span class="ow">)</span> <span class="ow">(</span>cast b<span class="ow">))</span></code></pre></div>
<p>文字列から数値に変換するには <code>Cast</code> インタフェースの <code>cast</code> 関数が使えます。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; the Integer (cast &#34;1&#34;)
1 : Integer
Idris&gt; the Integer (cast &#34;-1&#34;)
-1 : Integer
Idris&gt; the Integer (cast &#34;hoge&#34;)
0 : Integer</code></pre></div>
<p>これも <code>:search String -&gt; Integer</code> すると出てきます。</p>

<p><code>printLn: Show ty =&gt; ty -&gt; IO ()</code> は <code>Show</code> を実装した値を出力できます。</p>

<p>全体の解説が終わったのでプログラムをコンパイル・実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ idris -o Product Product.idr
$ ./Product
1 2
Even
$ ./Product
3 4
Even
$ ./Product
1 21
Odd</code></pre></div>
<p>正しく動作しているようです。</p>

<p>正しくない入力を与えたらどうなるか見てみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ ./Product
1
*** Product.idr:17:16-25:unmatched case in Main.case block in main at Product.idr:17:16-25 ***
$ ./Product
1 2 3
*** Product.idr:17:16-25:unmatched case in Main.case block in main at Product.idr:17:16-25 ***</code></pre></div>
<p>見事にクラッシュしていますね。
次の問題ではもう少しまともにします。</p>

<h1 id="第2問">第2問</h1>

<h2 id="問題-1">問題</h2>

<p><a href="https://atcoder.jp/contests/abc081/tasks/abc081_a">A - Placing Marbles</a></p>

<blockquote>
<p>1、2、3の番号のついたマス目があります。各マスには <code>0</code> か <code>1</code> が書かれています。
マス $i$ には $s_i$ が書かれています。
<code>1</code> が書かれたマスにビー玉を起きます。ビー玉が置かれるマスがいくつあるか求めて下さい。</p>

<h2 id="制約-1">制約</h2>

<p>$s1,s2,s3$ は <code>1</code> あるいは <code>0</code></p>

<h2 id="入力-1">入力</h2>

<p>入力は以下の形式で標準入力から与えられる。</p>

<p>s1s2s3</p>

<h2 id="出力-1">出力</h2>

<p>答えを出力する</p>
</blockquote>

<p>例えば入力が以下の場合</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">101</code></pre></div>
<p>1が2つあるので出力は2です。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">2</code></pre></div>
<h2 id="コード-1">コード</h2>

<p>まずは <code>solve</code> を書きましょう。
$s_1$ 、 $s_2$ 、 $s_3$ と3つの数値を引数で取ってもいいんですが、せっかく $s_i$ と一般化してくれているのでリストで引数をとることにしましょう。
また、各マス目に書かれているものが何なのか難しいですがここでは文字 <code>Char</code> ということにしておきます。</p>

<p>すると <code>solve</code> は文字のリストを受け取って、 <code>1</code> が含まれている数をカウントする関数ということになります。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">solve</span><span class="ow">:</span> <span class="kt">List</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
solve ss <span class="ow">=</span> cast <span class="ow">(</span>length <span class="ow">(</span>filter <span class="ow">(==</span> <span class="sc">&#39;1&#39;</span><span class="ow">)</span> ss<span class="ow">))</span></code></pre></div>
<p><code>filter : (a -&gt; Bool) -&gt; List a -&gt; List a</code> は引数の関数の条件にマッチする要素だけ集めてくる関数です。</p>

<p><code>(== '1')</code> 、あるいは度々出てきている <code>(演算子 引数)</code> や <code>(引数 演算子)</code> はセクションという機能です。
演算子に引数を部分適用します。<code>(+1)</code> は何度か出てきましたね。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; :t (+ 1)
\ARG =&gt; ARG + 1 : Integer -&gt; Integer
Idris&gt; :t (== &#39;1&#39;)
\ARG =&gt; ARG == &#39;1&#39; : Char -&gt; Bool</code></pre></div>
<p>ということで <code>(== '1')</code> は 「引数が <code>'1'</code> なら <code>True</code> を返しそれ以外なら <code>False</code> を返す関数」ということになります。
紹介してませんでしたがIdrisの文字リテラルは <code>'文字'</code> です。</p>

<p><code>length</code> のあとに <code>cast</code> がついているのは <code>length</code> の返り値が <code>Nat</code> だからです。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; :t length
Prelude.List.length : List a -&gt; Nat</code></pre></div>
<p>ところで、今回の <code>solve</code> は括弧が多いですね。
括弧を減らせる便利演算子 <code>$</code> を紹介しておきます。
<code>func $ arg</code> は <code>func arg</code> と同じ意味なのですが、 <code>$</code> の優先順位が低いので事実上 <code>$</code> から式の末尾までの括弧のように振舞います。
例えば先程の <code>solve</code> は以下のように書き換えられます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">solve</span><span class="ow">:</span> <span class="kt">List</span> <span class="kt">Char</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
solve ss <span class="ow">=</span> cast <span class="ow">$</span> length <span class="ow">$</span> filter <span class="ow">(==</span> <span class="sc">&#39;1&#39;</span><span class="ow">)</span> ss</code></pre></div>
<p>出入力の部分は以下です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  line <span class="ow">&lt;-</span> getLine
  <span class="kr">let</span> ss <span class="ow">=</span> unpack line
  printLn <span class="ow">$</span> solve ss</code></pre></div>
<p>今回はパターンマッチは出てきませんでしたね。</p>

<p><code>unpack: String -&gt; List Char</code> は文字列を1文字ずつに分解する関数です。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; unpack &#34;101&#34;
[&#39;1&#39;, &#39;0&#39;, &#39;1&#39;] : List Char</code></pre></div>
<p>それではこのプログラムをコンパイル・実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ idris -o PlacingMarbles PlacingMarbles.idr
$ ./PlacingMarbles
101
2
$ ./PlacingMarbles
000
0</code></pre></div>
<p>動いているようです。</p>

<h1 id="第3問">第3問</h1>

<h2 id="問題-2">問題</h2>

<p><a href="https://atcoder.jp/contests/abc081/tasks/abc081_b">B - Shift only</a></p>

<blockquote>
<p>$A_1$ から $A_N$ までの $N$ 個の整数があります。
これらの整数が全て偶数であるとき、次の操作を行うことができます</p>

<ul>
<li>全ての整数を2で割ったものに置き換える</li>
</ul>

<p>この操作は最大で何回行うことができるか求めて下さい。</p>

<h2 id="制約-2">制約</h2>

<ul>
<li>$ 1 \le N   \le 200$</li>
<li>$ 1 \le A_i \le 10^9$</li>
</ul>

<h2 id="入力-2">入力</h2>

<p>入力は以下の形式で標準入力から与えられる</p>

<p>$N$<br />
$A_1$ $A_2$ &hellip; $A_n$</p>

<h2 id="出力-2">出力</h2>

<p>最大で何回操作を行うことができるかを出力せよ</p>
</blockquote>

<p>例えば以下の入力が与えられたとき</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">3
8 12 40</code></pre></div>
<p>結果は以下です。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">2</code></pre></div>
<h2 id="コード-2">コード</h2>

<p>各整数の素因数に2が何個含まれるか数えて、その最小値を答えればよいですね。</p>

<p>素因数に2が何個含まれるかはビット操作に強い言語ならCTZ（count trailing zeros）で一発で出せたりするんですが、Idrisにはないのでまずは素因数に2が何個含まれるか数える関数を作るところからはじめましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">isEven</span><span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span>
isEven n <span class="ow">=</span> n `mod` <span class="mi">2</span> <span class="ow">==</span> <span class="mi">0</span>

<span class="nf">countTwos</span> <span class="ow">:</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Nat</span>
countTwos n <span class="ow">=</span>
  <span class="kr">if</span> isEven n
  <span class="kr">then</span> <span class="mi">1</span> <span class="ow">+</span> <span class="ow">(</span>countTwos <span class="ow">(</span>n `div` <span class="mi">2</span><span class="ow">))</span>
  <span class="kr">else</span> <span class="mi">0</span></code></pre></div>
<p><code>n</code> が偶数であれば <code>n / 2</code> の素因数に含まれる2の数を数えて、それに1を足してあげればよいです。</p>

<p>これを使って <code>solve</code> は以下のように書けます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">solve</span><span class="ow">:</span> <span class="kt">List</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
solve l <span class="ow">=</span> cast <span class="ow">$</span> foldl min <span class="mi">100</span> <span class="ow">$</span> map countTwos l</code></pre></div>
<p>最初の方針通り <code>map countTwos l</code> で各数値の素因数の中にある2の数を数えます。
そこから最小値を取り出すのに <code>foldl min 100</code> を使っています。ちょっとこれは解説をしましょう。</p>

<p><code>foldl</code> は「畳み込み」をする演算子です。
二項演算子と演算の最初の値、そしてリストを引数にとり、畳み込んだ結果を返します。
例えば <code>[1, 2, 3]</code> があったときに <code>foldl (+) 0 [1, 2, 3]</code> は以下の計算をします。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="ow">(((</span><span class="mi">0</span> <span class="ow">+</span> <span class="mi">1</span><span class="ow">)</span> <span class="ow">+</span> <span class="mi">2</span><span class="ow">)</span> <span class="ow">+</span> <span class="mi">3</span><span class="ow">)</span></code></pre></div>
<p>その結果6を返します。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; foldl (+) 0 [1, 2, 3]
6 : Integer</code></pre></div>
<p>ここで初期値に <code>0</code> を使っているのは <code>0</code> が <code>+</code> の単位元、すなわち $n + 0 = 0 + n = n$ を満たす値だからです。</p>

<p>同様のことを <code>min</code> で行ったのが <code>solve</code> です。
<code>foldl min 100 [1, 2, 3]</code> は <code>(((100 `min` 1) `min` 2) `min` 3)</code> を計算するので結果1が返ります。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Idris&gt; foldl min 100 [1, 2, 3]
1 : Integer</code></pre></div>
<p>ここででてきた100というのが妥協の産物です。
本来なら <code>min</code> の単位元を使いたいところですが、今回の対象である <code>Nat</code> には <code>min</code> の単位元が存在しません。 <code>min</code> の単位元はその型の値の最大値ですが、 <code>Nat</code> には最大値がないからです。
なので単位元は使えません。
そこで妥協案として「今回のどの入力よりも大きい値」を据えることにします。
今回の入力の $A_i$ の最大値は $10^9$ なので素因数に含まれる2の個数はせいぜい30個程度です。ということでどんなに大きめにみても100は越えないので100を据えました。</p>

<p>因みにですが <code>foldl</code> は <code>Foldable</code> インタフェースに定義されていて、 <code>List</code> での <code>foldl</code> の定義は以下です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="c1">-- foldl : ( acc -&gt; elem -&gt; acc) -&gt; acc -&gt; List elem -&gt; acc</span>
foldl f q <span class="ow">[]</span> <span class="ow">=</span> q
foldl f q <span class="ow">(</span>x<span class="ow">::</span>xs<span class="ow">)</span> <span class="ow">=</span> foldl f <span class="ow">(</span>f q x<span class="ow">)</span> xs</code></pre></div>
<p>さてさて、 <code>solve</code> が定義できたので一旦REPLで試してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">λΠ&gt; solve <span class="ow">[</span><span class="mi">8</span>, <span class="mi">12</span>, <span class="mi">40</span><span class="ow">]</span>
<span class="nf">2</span> <span class="ow">:</span> <span class="kt">Integer</span>
λΠ&gt; solve <span class="ow">[</span><span class="mi">5</span>, <span class="mi">6</span>, <span class="mi">8</span>, <span class="mi">10</span><span class="ow">]</span>
<span class="nf">0</span> <span class="ow">:</span> <span class="kt">Integer</span>
λΠ&gt; solve <span class="ow">[</span><span class="mi">382253568</span>, <span class="mi">723152896</span>, <span class="mi">37802240</span>, <span class="mi">379425024</span>, <span class="mi">404894720</span>, <span class="mi">471526144</span><span class="ow">]</span>
<span class="nf">8</span> <span class="ow">:</span> <span class="kt">Integer</span></code></pre></div>
<p>動いていますね。</p>

<p>それでは入力を受け取る部分を書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  <span class="kr">_</span> <span class="ow">&lt;-</span> getLine
  line <span class="ow">&lt;-</span> getLine
  <span class="kr">let</span> input <span class="ow">=</span> map cast <span class="ow">$</span> words line
  printLn <span class="ow">$</span> solve input</code></pre></div>
<p>最初に入力の個数を教えてくれていますが、 個数に関係なく <code>words</code> でバラしてしまうので無視してしまいます。</p>

<p>それではこれをコンパイル・実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="ow">$</span> <span class="ow">./</span><span class="kt">ShiftOnly</span>
<span class="mi">3</span>
<span class="mi">8</span> <span class="mi">12</span> <span class="mi">40</span>
<span class="mi">2</span>
<span class="ow">$</span> <span class="ow">./</span><span class="kt">ShiftOnly</span>
<span class="mi">4</span>
<span class="mi">5</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span>
<span class="mi">0</span>
<span class="ow">$</span> <span class="ow">./</span><span class="kt">ShiftOnly</span>
<span class="mi">6</span>
<span class="mi">382253568</span> <span class="mi">723152896</span> <span class="mi">37802240</span> <span class="mi">379425024</span> <span class="mi">404894720</span> <span class="mi">471526144</span>
<span class="mi">8</span></code></pre></div>
<p>動いていますね。</p>

<h1 id="ここまで解いたら">ここまで解いたら</h1>

<p>最初は10問全部やろうとしたのですが、疲れたのでこれでラストにします。
ラストは高橋君の出てくる問題です。</p>

<h2 id="問題-3">問題</h2>

<p><a href="https://atcoder.jp/contests/abc065/tasks/abc065_b">B - Trained?</a></p>

<blockquote>
<p>筋力をつけたい高橋君は、AtCoder 社のトレーニング設備で、トレーニングをすることにしました。</p>

<p>AtCoder 社のトレーニング設備には $N$ 個のボタンがついており、ちょうど $1$ 個のボタンが光っています。
ボタンには、$1$ から $N$ までの番号がついています。
ボタン $i$ が光っているときにそのボタンを押すと、ボタン $i$ の明かりが消え、その後ボタン $ai$ が光ります。
$i=ai$ であることもあります。
光っていないボタンを押しても、何も起こりません。</p>

<p>最初、ボタン $1$が光っています。高橋君は、ボタン $2$ が光っている状態で、トレーニングをやめたいと思っています。</p>

<p>そのようなことは可能かどうか判定し、もし可能なら最低で何回ボタンを押す必要があるかを求めてください。</p>

<h2 id="制約-3">制約</h2>

<ul>
<li>$2 \le N \le 10^5$</li>
<li>$1 \le a_i \le N$</li>
</ul>

<h2 id="入力-3">入力</h2>

<p>入力は以下の形式で標準入力から与えられる。</p>

<p>$N$<br />
$a_1$<br />
$a_2$<br />
$:$<br />
$a_N$</p>

<h2 id="出力-3">出力</h2>

<p>ボタン2を光らせることが不可能な場合は -1を出力せよ。
そうでない場合はボタン2を光らせるために必要なボタンを置く回数の最小値を出力せよ。</p>
</blockquote>

<h2 id="コード-3">コード</h2>

<p>困りましたね…。
高橋君のいる問題を選んだらまだ説明してない機能が必要になりました。
本来は集合とキーバリューマップが必要になる問題なのですが、それを使うにはモジュールや標準ライブラリ、パッケージ、コンパイラオプションなどの説明が必要になります。
ここでは非効率を承知の上で集合とキーバリューマップをリストで代用します。</p>

<p>さて、問題ですが、解けますよね？
$1$ を押したら $a_i$ が点灯し、 $a_i$ を押したら $a_j$ が点灯し…を繰り返していくとどこかで今まで押した番号に合流し、操作がループします。
今回の問題はループに突入する前に $2$ を引いたらそれまでの操作回数を、ループに突入したら $-1$ を返せばよさそうです。</p>

<p>まず集合とキーバリューマップの代用品を作ります。</p>

<p>集合は <code>empty</code> と <code>insert</code> と <code>contains</code> があれば十分です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="c1">-- Set</span>

<span class="nf">Set</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
<span class="kt">Set</span> <span class="ow">=</span> <span class="kt">List</span>

<span class="nf">empty</span> <span class="ow">:</span> <span class="kt">Set</span> a
empty <span class="ow">=</span> <span class="ow">[]</span>

<span class="nf">insert</span> <span class="ow">:</span> <span class="kt">Eq</span> a <span class="ow">=&gt;</span> a <span class="ow">-&gt;</span> <span class="kt">Set</span> a <span class="ow">-&gt;</span> <span class="kt">Set</span> a
insert a s <span class="ow">=</span> a <span class="ow">::</span> s

<span class="nf">contains</span> <span class="ow">:</span> <span class="kt">Eq</span> a <span class="ow">=&gt;</span> a <span class="ow">-&gt;</span> <span class="kt">Set</span> a <span class="ow">-&gt;</span> <span class="kt">Bool</span>
contains a s <span class="ow">=</span> elem a s</code></pre></div>
<p>Idrisは純粋関数型言語なので値が変更されることはありません。
なので <code>empty</code> は関数ではなく値です。
同じく <code>insert</code> は値を追加した新しい集合を返します。
使っている関数については、見てとれるかと思いますが、 <code>elm</code> は <code>a</code> が <code>s</code> に含まれるか検査する関数です。</p>

<p>キーバリューマップは <code>fromList</code> と <code>lookup</code> があれば十分です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="c1">-- Map</span>
<span class="nf">Map</span> <span class="ow">:</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span> <span class="ow">-&gt;</span> <span class="kt">Type</span>
<span class="kt">Map</span> k v <span class="ow">=</span> <span class="kt">List</span> <span class="ow">(</span>k, v<span class="ow">)</span>

<span class="nf">fromList</span> <span class="ow">:</span> <span class="kt">List</span> <span class="ow">(</span>k, v<span class="ow">)</span> <span class="ow">-&gt;</span> <span class="kt">Map</span> k v
fromList l <span class="ow">=</span> l

<span class="nf">lookup</span> <span class="ow">:</span> <span class="kt">Eq</span> k <span class="ow">=&gt;</span> k <span class="ow">-&gt;</span> <span class="kt">Map</span> k v <span class="ow">-&gt;</span> <span class="kt">Maybe</span> v
<span class="c1">-- ...</span></code></pre></div>
<p><code>List (k, v)</code> に対する <code>lookup</code> はプレリュードに既に定義されているので特に定義しなくてもよいです（というか定義すると多重定義で怒られます）。</p>

<p>では <code>solve</code> を定義していきましょう。
まずは <code>List a</code> から <code>List (Integer, a)</code> を作る <code>indexed</code> 関数です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">indexed</span> <span class="ow">:</span> <span class="kt">List</span> a <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="ow">(</span><span class="kt">Integer</span>, a<span class="ow">)</span>
indexed l <span class="ow">=</span> loop l <span class="mi">1</span>
<span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">List</span> a <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="ow">(</span><span class="kt">Integer</span>, a<span class="ow">)</span>
  loop <span class="ow">[]</span>      <span class="kr">_</span> <span class="ow">=</span> <span class="ow">[]</span>
  loop <span class="ow">(</span>x<span class="ow">::</span>xs<span class="ow">)</span> i <span class="ow">=</span> <span class="ow">(</span>i, x<span class="ow">)</span> <span class="ow">::</span> loop xs <span class="ow">(</span>i <span class="ow">+</span> <span class="mi">1</span><span class="ow">)</span></code></pre></div>
<p>Idrisではループは再帰関数で表わすのでした。
ループで持ち回る値（ここではインデックス）は引数で渡します。
<code>indexed</code> に無駄な引数を増やす訳にはいかないのでローカル関数を定義して、そこでループを回します。</p>

<p><code>solve</code> も <code>indexed</code> と同じようにループをするローカル関数を定義して、そちらで実行します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">solve</span> <span class="ow">:</span> <span class="kt">List</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span>
solve l <span class="ow">=</span>
  <span class="kr">let</span> map <span class="ow">=</span> fromList <span class="ow">$</span> indexed l <span class="kr">in</span>
  <span class="kr">let</span> set <span class="ow">=</span> empty <span class="kr">in</span>
  <span class="kr">case</span> loop map set <span class="mi">1</span> <span class="mi">0</span> <span class="kr">of</span>
    <span class="kt">Just</span> i  <span class="ow">=&gt;</span> i
    <span class="kt">Nothing</span> <span class="ow">=&gt;</span> <span class="ow">-</span><span class="mi">1</span>
<span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">Map</span> <span class="kt">Integer</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Set</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
  <span class="c1">-- ...</span></code></pre></div>
<p>ループで持ち回る値は以下です。</p>

<ul>
<li><code>map</code>   : $i$ 番目のボタンを押したら $a_i$ 番目のボタンが光るという対応関係</li>
<li><code>set</code>   : 今までに押したことのあるボタン</li>
<li><code>cur</code>   : 現在光っているボタン</li>
<li><code>count</code> : ボタンを押した回数</li>
</ul>

<p><code>map</code> は入力から最初に作ってしまって以後特に増減しません。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  <span class="kr">let</span> map <span class="ow">=</span> fromList <span class="ow">$</span> indexed l <span class="kr">in</span></code></pre></div>
<p><code>set</code> は初期値は空集合です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  <span class="kr">let</span> set <span class="ow">=</span> empty <span class="kr">in</span></code></pre></div>
<p><code>cur</code> は問題文にあるとおり1が、ボタンを押した回数は最初は0です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">loop map set <span class="mi">1</span> <span class="mi">0</span></code></pre></div>
<p>それでは <code>loop</code> の実装を見ていきましょう</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">where</span>
  <span class="nf">loop</span> <span class="ow">:</span> <span class="kt">Map</span> <span class="kt">Integer</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Set</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Integer</span> <span class="ow">-&gt;</span> <span class="kt">Maybe</span> <span class="kt">Integer</span>
  loop <span class="kr">_</span>    <span class="kr">_</span>  <span class="mi">2</span>   count <span class="ow">=</span> <span class="kt">Just</span> count
  loop map set cur count <span class="ow">=</span>
    <span class="kr">let</span> set <span class="ow">=</span> insert cur set <span class="kr">in</span>
    <span class="kr">let</span> <span class="kt">Just</span> next <span class="ow">=</span> lookup cur map <span class="ow">|</span> <span class="kr">_</span> <span class="ow">=&gt;</span> <span class="kt">Nothing</span> <span class="kr">in</span>
    <span class="kr">if</span> contains next set
    <span class="kr">then</span> <span class="kt">Nothing</span>
    <span class="kr">else</span> loop map set next <span class="ow">(</span>count <span class="ow">+</span> <span class="mi">1</span><span class="ow">)</span></code></pre></div>
<p>まず、現在光っているボタンが2なら今までにボタンを押した回数を返して終了です。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  loop <span class="kr">_</span>    <span class="kr">_</span>  <span class="mi">2</span>   count <span class="ow">=</span> <span class="kt">Just</span> count</code></pre></div>
<p>それ以外の場合はボタンを押します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  loop map set cur count <span class="ow">=</span>
  <span class="c1">-- ...</span></code></pre></div>
<p>押したボタンを記録しましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    <span class="kr">let</span> set <span class="ow">=</span> insert cur set <span class="kr">in</span></code></pre></div>
<p>すると次のボタンが光るはずです。それを <code>next</code> とします。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    <span class="kr">let</span> <span class="kt">Just</span> next <span class="ow">=</span> lookup cur map <span class="ow">|</span> <span class="kr">_</span> <span class="ow">=&gt;</span> <span class="kt">Nothing</span> <span class="kr">in</span></code></pre></div>
<p>ここで、ようやく <code>let</code> とパターンマッチが出てきました。<code>let パターン = 式 | 他の場合 =&gt; 式 in</code> の構文です。
パターンマッチで <code>lookup</code> の結果が <code>Just</code> の場合のみ変数を束縛しています。
では <code>Nothing</code> の場合はどうなるかというと、 <code>| _ =&gt; Nothing</code> の方にいきます。
<code>Nothing</code> は <code>_</code> パターンにマッチし、腕の <code>Nothing</code> が返ります。</p>

<p>全体として、上記の式は以下のように読み替えられます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="kr">case</span> lookup cur map <span class="kr">of</span>
  <span class="kt">Just</span> next <span class="ow">=&gt;</span> <span class="ow">....</span>
  <span class="kr">_</span>         <span class="ow">=&gt;</span> <span class="kt">Nothing</span></code></pre></div>
<p>パターンにマッチしなかったら強制終了するよりずっと安全に想定していないケースを扱うことができました。</p>

<p>さて、プログラムの続きをみていきましょう。
もし次に光ったランプが今までに光ったことのあるランプだったらループに突入するので <code>Nothing</code> です。それ以外の場合は次のボタンを調べるため、ループを回します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    <span class="kr">if</span> contains next set
    <span class="kr">then</span> <span class="kt">Nothing</span>
    <span class="kr">else</span> loop map set next <span class="ow">(</span>count <span class="ow">+</span> <span class="mi">1</span><span class="ow">)</span></code></pre></div>
<p>ボタンを押したら同じボタンが光ることもあると書いてあったので、その辺の処理にも気を配りましょう。今回は先に <code>insert cur set</code> しているので大丈夫です。</p>

<p>最終的に、2に到達すればそのときの操作数を、到達できなければ-1を返します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  <span class="kr">case</span> loop map set <span class="mi">1</span> <span class="mi">0</span> <span class="kr">of</span>
    <span class="kt">Just</span> i  <span class="ow">=&gt;</span> i
    <span class="kt">Nothing</span> <span class="ow">=&gt;</span> <span class="ow">-</span><span class="mi">1</span></code></pre></div>
<p>REPLで動作を確認してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">λΠ&gt; solve <span class="ow">[</span><span class="mi">3</span>, <span class="mi">1</span>, <span class="mi">2</span><span class="ow">]</span>
<span class="nf">2</span> <span class="ow">:</span> <span class="kt">Integer</span>
λΠ&gt; solve <span class="ow">[</span><span class="mi">3</span>, <span class="mi">4</span>, <span class="mi">1</span>, <span class="mi">2</span><span class="ow">]</span>
<span class="nf">-1</span> <span class="ow">:</span> <span class="kt">Integer</span>
λΠ&gt; solve <span class="ow">[</span><span class="mi">3</span>, <span class="mi">3</span>, <span class="mi">4</span>, <span class="mi">2</span>, <span class="mi">4</span><span class="ow">]</span>
<span class="nf">3</span> <span class="ow">:</span> <span class="kt">Integer</span></code></pre></div>
<p>正しく動いていそうです。</p>

<p>それでは入力を受け取る部分を書きます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris"><span class="nf">main</span> <span class="ow">:</span> <span class="kt">IO</span> <span class="ow">()</span>
main <span class="ow">=</span> <span class="kr">do</span>
  n <span class="ow">&lt;-</span> getLine
  l <span class="ow">&lt;-</span> getNIntegers <span class="ow">(</span>cast n<span class="ow">)</span>
  printLn <span class="ow">$</span> solve l
<span class="kr">where</span>
  <span class="nf">getNIntegers</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">List</span> <span class="kt">Integer</span><span class="ow">)</span>
  getNIntegers <span class="kt">Z</span>     <span class="ow">=</span> pure <span class="ow">[]</span>
  getNIntegers <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> <span class="ow">=</span> <span class="kr">do</span>
    i  <span class="ow">&lt;-</span> getLine
    is <span class="ow">&lt;-</span> getNIntegers n
    pure <span class="ow">$</span> <span class="ow">(</span>cast i<span class="ow">)</span> <span class="ow">::</span> is</code></pre></div>
<p>今回は <code>N</code> を使います。
<code>N</code> で受け取った数の分だけ <code>getLine</code> してその数値をリストに入れます。
そのためにローカル関数 <code>getNIntegers</code> を定義しています。</p>

<p><code>getNIntegers</code> は自然数を受け取って <code>IO (List Integer)</code> を返します。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  <span class="nf">getNIntegers</span> <span class="ow">:</span> <span class="kt">Nat</span> <span class="ow">-&gt;</span> <span class="kt">IO</span> <span class="ow">(</span><span class="kt">List</span> <span class="kt">Integer</span><span class="ow">)</span></code></pre></div>
<p><code>Nat</code> は <code>Z | S Nat</code> で定義されているのでした。パターンマッチもそれを使います。</p>

<p><code>Z</code> の場合は 0 要素のリストを返します。 <code>IO</code> モナドに入れるために <code>pure</code> を使っています。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  getNIntegers <span class="kt">Z</span>     <span class="ow">=</span> pure <span class="ow">[]</span></code></pre></div>
<p><code>Z</code> でない場合は <code>S n</code> にマッチします。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">  getNIntegers <span class="ow">(</span><span class="kt">S</span> n<span class="ow">)</span> <span class="ow">=</span> <span class="kr">do</span></code></pre></div>
<p><code>S n</code> でマッチしているので <code>getNIntegers 10</code> と呼ばれたら <code>n</code> には <code>9</code> が入っていることに注意して下さい。</p>

<p>まずは1行読み込みます。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    i  <span class="ow">&lt;-</span> getLine</code></pre></div>
<p>残り <code>n</code> 個の自然数を読めばいいので再帰呼び出しします。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    is <span class="ow">&lt;-</span> getNIntegers n</code></pre></div>
<p>あとは結合して返すだけです。</p>
<div class="highlight"><pre class="chroma"><code class="language-idris" data-lang="idris">    pure <span class="ow">$</span> <span class="ow">(</span>cast i<span class="ow">)</span> <span class="ow">::</span> is</code></pre></div>
<p>こちらも <code>IO</code> モナドに入れるために <code>pure</code> を使っています。</p>

<p>それではプログラムが完成したのでコンパイル・実行してみましょう。</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">$ idris -o Trained Trained.idr
$ ./Trained
3
3
1
2
2
$ ./Trained
4
3
4
1
2
-1
$ ./Trained
5
3
3
4
2
4
3</code></pre></div>
<p>正しく動いているようです。</p>

<h1 id="まとめ">まとめ</h1>

<p>リストや文字列、IOの操作の練習に競技プログラミングの問題を解いていみました。
ある程度は練習になったものの、ライブラリがないと足りない機能があることも分かりました。</p>

<p>次は標準ライブラリやモジュールを紹介できたらなと思います。</p>
                    </section>
                </article>
            </div>
        </div>

        <div class="row li-author">
    <div class="sixteen columns">
        Written by <strong>κeen</strong>
    </div>
</div>


        <div class="row li-pagination">
            <div class="eight columns">
                <div class="li-pagination-previous">
                    
                        Later article<br />
                        <a href="/blog/2020/12/15/rustnoconst_fnttenani_/"> Rustのconst fnって何？</a>
                    
                </div>
            </div>
            <div class="eight columns">
                <div class="li-pagination-next">
                    
                        Older article<br />
                        <a href="/blog/2020/12/09/idrisnointafe_sutomonadonadonado/"> Idrisのインタフェースとモナドなどなど</a>
                    
                </div>
            </div>
        </div>
    </div>

<footer class="li-page-footer">
    <div class="container">
        <div class="row">
            <div class="sixteen columns">
                <div class="li-page-footer-legal">
                    &copy; 2020. All rights reserved. 
                </div>
                <div class="li-page-footer-theme">
                    <span class=""><a href="https://github.com/eliasson/liquorice/">liquorice</a> is a theme for <a href="http://hugo.spf13.com">hugo</a></span>
                </div>
            </div>
        </div>
    </div>
</footer>

<script type="text/javascript">
 function toggle(id) {
     var e = document.getElementById(id);
     e.style.display == 'block' ? e.style.display = 'none' : e.style.display = 'block';
 }
</script>
<script src="https://unpkg.com/mermaid@7.0.4/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true
     });</script>

    </body>
</html>

